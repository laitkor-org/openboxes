{"remainingRequest":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js?presets[]=@babel/react&presets[]=@babel/env!/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js!/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/inbound/SendMovementPage.jsx","dependencies":[{"path":"/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/inbound/SendMovementPage.jsx","mtime":1698037749000},{"path":"/opt/MTOBS-BIKASH/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfSwgX3R5cGVvZihvYmopOyB9CmZ1bmN0aW9uIF9leHRlbmRzKCkgeyBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9OyByZXR1cm4gX2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfQpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsgfQpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9CmZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pOyBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB9CmZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7IGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoOyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfQpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7IHZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07IGlmIChudWxsICE9IF9pKSB7IHZhciBfcywgX2UsIF94LCBfciwgX2FyciA9IFtdLCBfbiA9ICEwLCBfZCA9ICExOyB0cnkgeyBpZiAoX3ggPSAoX2kgPSBfaS5jYWxsKGFycikpLm5leHQsIDAgPT09IGkpIHsgaWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47IF9uID0gITE7IH0gZWxzZSBmb3IgKDsgIShfbiA9IChfcyA9IF94LmNhbGwoX2kpKS5kb25lKSAmJiAoX2Fyci5wdXNoKF9zLnZhbHVlKSwgX2Fyci5sZW5ndGggIT09IGkpOyBfbiA9ICEwKSB7IDsgfSB9IGNhdGNoIChlcnIpIHsgX2QgPSAhMCwgX2UgPSBlcnI7IH0gZmluYWxseSB7IHRyeSB7IGlmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuOyB9IGZpbmFsbHkgeyBpZiAoX2QpIHRocm93IF9lOyB9IH0gcmV0dXJuIF9hcnI7IH0gfQpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7IH0KZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGVudW1lcmFibGVPbmx5ICYmIChzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSkpLCBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IG51bGwgIT0gYXJndW1lbnRzW2ldID8gYXJndW1lbnRzW2ldIDoge307IGkgJSAyID8gb3duS2V5cyhPYmplY3Qoc291cmNlKSwgITApLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSkgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSkgOiBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IHJldHVybiB0YXJnZXQ7IH0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIF90b1Byb3BlcnR5S2V5KGRlc2NyaXB0b3Iua2V5KSwgZGVzY3JpcHRvcik7IH0gfQpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBPYmplY3QuZGVmaW5lUHJvcGVydHkoc3ViQ2xhc3MsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0KZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IGVsc2UgaWYgKGNhbGwgIT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpIHsgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSAidW5kZWZpbmVkIiB8fCAhUmVmbGVjdC5jb25zdHJ1Y3QpIHJldHVybiBmYWxzZTsgaWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pIHJldHVybiBmYWxzZTsgaWYgKHR5cGVvZiBQcm94eSA9PT0gImZ1bmN0aW9uIikgcmV0dXJuIHRydWU7IHRyeSB7IEJvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLCBbXSwgZnVuY3Rpb24gKCkge30pKTsgcmV0dXJuIHRydWU7IH0gY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlOyB9IH0KZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBrZXkgPSBfdG9Qcm9wZXJ0eUtleShrZXkpOyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KZnVuY3Rpb24gX3RvUHJvcGVydHlLZXkoYXJnKSB7IHZhciBrZXkgPSBfdG9QcmltaXRpdmUoYXJnLCAic3RyaW5nIik7IHJldHVybiBfdHlwZW9mKGtleSkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7IH0KZnVuY3Rpb24gX3RvUHJpbWl0aXZlKGlucHV0LCBoaW50KSB7IGlmIChfdHlwZW9mKGlucHV0KSAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDsgdmFyIHByaW0gPSBpbnB1dFtTeW1ib2wudG9QcmltaXRpdmVdOyBpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7IHZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgImRlZmF1bHQiKTsgaWYgKF90eXBlb2YocmVzKSAhPT0gIm9iamVjdCIpIHJldHVybiByZXM7IHRocm93IG5ldyBUeXBlRXJyb3IoIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuIik7IH0gcmV0dXJuIChoaW50ID09PSAic3RyaW5nIiA/IFN0cmluZyA6IE51bWJlcikoaW5wdXQpOyB9CmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7CmltcG9ydCBhcnJheU11dGF0b3JzIGZyb20gJ2ZpbmFsLWZvcm0tYXJyYXlzJzsKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnOwppbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnOwppbXBvcnQgeyBjb25maXJtQWxlcnQgfSBmcm9tICdyZWFjdC1jb25maXJtLWFsZXJ0JzsKaW1wb3J0IERyb3B6b25lIGZyb20gJ3JlYWN0LWRyb3B6b25lJzsKaW1wb3J0IHsgRm9ybSB9IGZyb20gJ3JlYWN0LWZpbmFsLWZvcm0nOwppbXBvcnQgeyBnZXRUcmFuc2xhdGUgfSBmcm9tICdyZWFjdC1sb2NhbGl6ZS1yZWR1eCc7CmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWFjdC1yZWR1eCc7CmltcG9ydCBBbGVydCBmcm9tICdyZWFjdC1zLWFsZXJ0JzsKaW1wb3J0IHsgaGlkZVNwaW5uZXIsIHNob3dTcGlubmVyIH0gZnJvbSAnYWN0aW9ucyc7CmltcG9ydCBEb2N1bWVudEJ1dHRvbiBmcm9tICdjb21wb25lbnRzL0RvY3VtZW50QnV0dG9uJzsKaW1wb3J0IEFycmF5RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL0FycmF5RmllbGQnOwppbXBvcnQgRGF0ZUZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9EYXRlRmllbGQnOwppbXBvcnQgTGFiZWxGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvTGFiZWxGaWVsZCc7CmltcG9ydCBTZWxlY3RGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvU2VsZWN0RmllbGQnOwppbXBvcnQgVGV4dEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9UZXh0RmllbGQnOwppbXBvcnQgYXBpQ2xpZW50IGZyb20gJ3V0aWxzL2FwaUNsaWVudCc7CmltcG9ydCB7IHJlbmRlckZvcm1GaWVsZCB9IGZyb20gJ3V0aWxzL2Zvcm0tdXRpbHMnOwppbXBvcnQgeyBmb3JtYXRQcm9kdWN0RGlzcGxheU5hbWUgfSBmcm9tICd1dGlscy9mb3JtLXZhbHVlcy11dGlscyc7CmltcG9ydCB7IGRlYm91bmNlTG9jYXRpb25zRmV0Y2ggfSBmcm9tICd1dGlscy9vcHRpb24tdXRpbHMnOwppbXBvcnQgVHJhbnNsYXRlLCB7IHRyYW5zbGF0ZVdpdGhEZWZhdWx0TWVzc2FnZSB9IGZyb20gJ3V0aWxzL1RyYW5zbGF0ZSc7CmltcG9ydCBzcGxpdFRyYW5zbGF0aW9uIGZyb20gJ3V0aWxzL3RyYW5zbGF0aW9uLXV0aWxzJzsKaW1wb3J0ICdyZWFjdC1jb25maXJtLWFsZXJ0L3NyYy9yZWFjdC1jb25maXJtLWFsZXJ0LmNzcyc7CnZhciBTSElQTUVOVF9GSUVMRFMgPSB7CiAgJ29yaWdpbi5uYW1lJzogewogICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50Lm9yaWdpbi5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ09yaWdpbicsCiAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVGV4dEZpZWxkLCBwYXJhbXMpOwogICAgfSwKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgZGlzYWJsZWQ6IHRydWUKICAgIH0KICB9LAogIGRlc3RpbmF0aW9uOiB7CiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGVzdGluYXRpb24ubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdEZXN0aW5hdGlvbicsCiAgICBmaWVsZEtleTogJycsCiAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICBpZiAocGFyYW1zLmNhbkJlRWRpdGVkICYmICFwYXJhbXMuaGFzU3RvY2tMaXN0KSB7CiAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFNlbGVjdEZpZWxkLCBwYXJhbXMpOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmKSB7CiAgICAgIHZhciBjYW5CZUVkaXRlZCA9IF9yZWYuY2FuQmVFZGl0ZWQsCiAgICAgICAgaGFzU3RvY2tMaXN0ID0gX3JlZi5oYXNTdG9ja0xpc3QsCiAgICAgICAgZGVib3VuY2VkTG9jYXRpb25zRmV0Y2ggPSBfcmVmLmRlYm91bmNlZExvY2F0aW9uc0ZldGNoOwogICAgICBpZiAoY2FuQmVFZGl0ZWQgJiYgIWhhc1N0b2NrTGlzdCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgIGFzeW5jOiB0cnVlLAogICAgICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZSwKICAgICAgICAgIG9wZW5PbkNsaWNrOiBmYWxzZSwKICAgICAgICAgIGF1dG9sb2FkOiBmYWxzZSwKICAgICAgICAgIGxvYWRPcHRpb25zOiBkZWJvdW5jZWRMb2NhdGlvbnNGZXRjaCwKICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgIG9wdGlvbnM6IFtdLAogICAgICAgICAgZmlsdGVyT3B0aW9uczogZnVuY3Rpb24gZmlsdGVyT3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUoZmllbGRWYWx1ZSkgewogICAgICAgICAgcmV0dXJuIF8uZ2V0KGZpZWxkVmFsdWUsICduYW1lJyk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0sCiAgJ2Rlc3RpbmF0aW9uLm5hbWUnOiB7CiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGVzdGluYXRpb24ubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdEZXN0aW5hdGlvbicsCiAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICBpZiAocGFyYW1zLmNhbkJlRWRpdGVkICYmICFwYXJhbXMuaGFzU3RvY2tMaXN0KSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRleHRGaWVsZCwgcGFyYW1zKTsKICAgIH0sCiAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjIpIHsKICAgICAgdmFyIGNhbkJlRWRpdGVkID0gX3JlZjIuY2FuQmVFZGl0ZWQsCiAgICAgICAgaGFzU3RvY2tMaXN0ID0gX3JlZjIuaGFzU3RvY2tMaXN0OwogICAgICByZXR1cm4gewogICAgICAgIGRpc2FibGVkOiAhY2FuQmVFZGl0ZWQgfHwgaGFzU3RvY2tMaXN0CiAgICAgIH07CiAgICB9CiAgfSwKICBkYXRlU2hpcHBlZDogewogICAgdHlwZTogRGF0ZUZpZWxkLAogICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnNoaXBEYXRlLmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnU2hpcG1lbnQgZGF0ZScsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGRhdGVGb3JtYXQ6ICdNTS9ERC9ZWVlZIEhIOm1tIFonLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgc2hvd1RpbWVTZWxlY3Q6IHRydWUsCiAgICAgIGF1dG9Db21wbGV0ZTogJ29mZicsCiAgICAgIHNob3dFcnJvcjogdHJ1ZQogICAgfSwKICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMykgewogICAgICB2YXIgaXNzdWVkID0gX3JlZjMuaXNzdWVkLAogICAgICAgIHNob3dPbmx5ID0gX3JlZjMuc2hvd09ubHk7CiAgICAgIHJldHVybiB7CiAgICAgICAgZGlzYWJsZWQ6IGlzc3VlZCB8fCBzaG93T25seQogICAgICB9OwogICAgfQogIH0sCiAgc2hpcG1lbnRUeXBlOiB7CiAgICB0eXBlOiBTZWxlY3RGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5zaGlwbWVudFR5cGUubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdTaGlwbWVudCB0eXBlJywKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIHNob3dWYWx1ZVRvb2x0aXA6IHRydWUsCiAgICAgIHZhbHVlS2V5OiAnaWQnLAogICAgICBsYWJlbEtleTogJ25hbWUnCiAgICB9LAogICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY0KSB7CiAgICAgIHZhciBzaGlwbWVudFR5cGVzID0gX3JlZjQuc2hpcG1lbnRUeXBlcywKICAgICAgICByZWNlaXZlZCA9IF9yZWY0LnJlY2VpdmVkLAogICAgICAgIHNob3dPbmx5ID0gX3JlZjQuc2hvd09ubHk7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3B0aW9uczogc2hpcG1lbnRUeXBlcywKICAgICAgICBkaXNhYmxlZDogc2hvd09ubHkgfHwgcmVjZWl2ZWQKICAgICAgfTsKICAgIH0KICB9LAogIHRyYWNraW5nTnVtYmVyOiB7CiAgICB0eXBlOiBUZXh0RmllbGQsCiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQudHJhY2tpbmdOdW1iZXIubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdUcmFja2luZyBudW1iZXInLAogICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY1KSB7CiAgICAgIHZhciByZWNlaXZlZCA9IF9yZWY1LnJlY2VpdmVkLAogICAgICAgIHNob3dPbmx5ID0gX3JlZjUuc2hvd09ubHk7CiAgICAgIHJldHVybiB7CiAgICAgICAgZGlzYWJsZWQ6IHNob3dPbmx5IHx8IHJlY2VpdmVkCiAgICAgIH07CiAgICB9CiAgfSwKICBkcml2ZXJOYW1lOiB7CiAgICB0eXBlOiBUZXh0RmllbGQsCiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZHJpdmVyTmFtZS5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ0RyaXZlciBuYW1lJywKICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmNikgewogICAgICB2YXIgcmVjZWl2ZWQgPSBfcmVmNi5yZWNlaXZlZCwKICAgICAgICBzaG93T25seSA9IF9yZWY2LnNob3dPbmx5OwogICAgICByZXR1cm4gewogICAgICAgIGRpc2FibGVkOiBzaG93T25seSB8fCByZWNlaXZlZAogICAgICB9OwogICAgfQogIH0sCiAgY29tbWVudHM6IHsKICAgIHR5cGU6IFRleHRGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5jb21tZW50cy5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ0NvbW1lbnRzJywKICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmNykgewogICAgICB2YXIgcmVjZWl2ZWQgPSBfcmVmNy5yZWNlaXZlZCwKICAgICAgICBzaG93T25seSA9IF9yZWY3LnNob3dPbmx5OwogICAgICByZXR1cm4gewogICAgICAgIGRpc2FibGVkOiBzaG93T25seSB8fCByZWNlaXZlZAogICAgICB9OwogICAgfQogIH0sCiAgZXhwZWN0ZWREZWxpdmVyeURhdGU6IHsKICAgIHR5cGU6IERhdGVGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5leHBlY3RlZERlbGl2ZXJ5RGF0ZS5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ0V4cGVjdGVkIHJlY2VpcHQgZGF0ZScsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGRhdGVGb3JtYXQ6ICdNTS9ERC9ZWVlZJywKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIHNob3dUaW1lU2VsZWN0OiBmYWxzZSwKICAgICAgYXV0b0NvbXBsZXRlOiAnb2ZmJwogICAgfQogIH0KfTsKdmFyIFNVUFBMSUVSX0ZJRUxEUyA9IHsKICB0YWJsZUl0ZW1zOiB7CiAgICB0eXBlOiBBcnJheUZpZWxkLAogICAgdmlydHVhbGl6ZWQ6IHRydWUsCiAgICB0b3RhbENvdW50OiBmdW5jdGlvbiB0b3RhbENvdW50KF9yZWY4KSB7CiAgICAgIHZhciBfdG90YWxDb3VudCA9IF9yZWY4LnRvdGFsQ291bnQ7CiAgICAgIHJldHVybiBfdG90YWxDb3VudDsKICAgIH0sCiAgICBpc1Jvd0xvYWRlZDogZnVuY3Rpb24gaXNSb3dMb2FkZWQoX3JlZjkpIHsKICAgICAgdmFyIF9pc1Jvd0xvYWRlZCA9IF9yZWY5LmlzUm93TG9hZGVkOwogICAgICByZXR1cm4gX2lzUm93TG9hZGVkOwogICAgfSwKICAgIGxvYWRNb3JlUm93czogZnVuY3Rpb24gbG9hZE1vcmVSb3dzKF9yZWYxMCkgewogICAgICB2YXIgX2xvYWRNb3JlUm93cyA9IF9yZWYxMC5sb2FkTW9yZVJvd3M7CiAgICAgIHJldHVybiBfbG9hZE1vcmVSb3dzKCk7CiAgICB9LAogICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IGZ1bmN0aW9uIGlzRmlyc3RQYWdlTG9hZGVkKF9yZWYxMSkgewogICAgICB2YXIgX2lzRmlyc3RQYWdlTG9hZGVkID0gX3JlZjExLmlzRmlyc3RQYWdlTG9hZGVkOwogICAgICByZXR1cm4gX2lzRmlyc3RQYWdlTG9hZGVkOwogICAgfSwKICAgIGZpZWxkczogewogICAgICBwYWxsZXROYW1lOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucGFja0xldmVsMS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdQYWNrIGxldmVsIDEnLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTIpIHsKICAgICAgICAgIHZhciBpc1BhbGxldE5hbWVFbXB0eSA9IF9yZWYxMi5pc1BhbGxldE5hbWVFbXB0eTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGhpZGU6IGlzUGFsbGV0TmFtZUVtcHR5CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgYm94TmFtZTogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnBhY2tMZXZlbDIubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUGFjayBsZXZlbCAyJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjEzKSB7CiAgICAgICAgICB2YXIgaXNCb3hOYW1lRW1wdHkgPSBfcmVmMTMuaXNCb3hOYW1lRW1wdHk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBoaWRlOiBpc0JveE5hbWVFbXB0eQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHByb2R1Y3RDb2RlOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29kZS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDb2RlJwogICAgICB9LAogICAgICBwcm9kdWN0OiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucHJvZHVjdC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdQcm9kdWN0JywKICAgICAgICBoZWFkZXJBbGlnbjogJ2xlZnQnLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTQpIHsKICAgICAgICAgIHZhciBfZmllbGRWYWx1ZSRkaXNwbGF5TmE7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYxNC5maWVsZFZhbHVlLAogICAgICAgICAgICBpc0JveE5hbWVFbXB0eSA9IF9yZWYxNC5pc0JveE5hbWVFbXB0eSwKICAgICAgICAgICAgaXNQYWxsZXROYW1lRW1wdHkgPSBfcmVmMTQuaXNQYWxsZXROYW1lRW1wdHk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmbGV4V2lkdGg6IDEyICsgKGlzQm94TmFtZUVtcHR5ID8gMTIgOiAwKSArIChpc1BhbGxldE5hbWVFbXB0eSA/IDEyIDogMCksCiAgICAgICAgICAgIHNob3dWYWx1ZVRvb2x0aXA6ICEhKGZpZWxkVmFsdWUgIT09IG51bGwgJiYgZmllbGRWYWx1ZSAhPT0gdm9pZCAwICYmIChfZmllbGRWYWx1ZSRkaXNwbGF5TmEgPSBmaWVsZFZhbHVlLmRpc3BsYXlOYW1lcykgIT09IG51bGwgJiYgX2ZpZWxkVmFsdWUkZGlzcGxheU5hICE9PSB2b2lkIDAgJiYgX2ZpZWxkVmFsdWUkZGlzcGxheU5hWyJkZWZhdWx0Il0pLAogICAgICAgICAgICB0b29sdGlwVmFsdWU6IGZpZWxkVmFsdWUgPT09IG51bGwgfHwgZmllbGRWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGRWYWx1ZS5uYW1lCiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgY2xhc3NOYW1lOiAndGV4dC1sZWZ0JywKICAgICAgICAgIGZvcm1hdFZhbHVlOiBmb3JtYXRQcm9kdWN0RGlzcGxheU5hbWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGxvdE51bWJlcjogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmxvdC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdMb3QnCiAgICAgIH0sCiAgICAgIGV4cGlyYXRpb25EYXRlOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXhwaXJ5LmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0V4cGlyeScKICAgICAgfSwKICAgICAgcXVhbnRpdHlSZXF1ZXN0ZWQ6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGZpeGVkV2lkdGg6ICcxNTBweCcsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnF1YW50aXR5UGlja2VkLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1F0eSBQaWNrZWQnCiAgICAgIH0sCiAgICAgICdyZWNpcGllbnQubmFtZSc6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZWNpcGllbnQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVjaXBpZW50JwogICAgICB9CiAgICB9CiAgfQp9OwoKLyoqCiAqIFRoZSBsYXN0IHN0ZXAgb2Ygc3RvY2sgbW92ZW1lbnQgd2hlcmUgdXNlciBjYW4gc2VlIHRoZSB3aG9sZSBtb3ZlbWVudCwKICogcHJpbnQgZG9jdW1lbnRzLCB1cGxvYWQgZG9jdW1lbnRzLCBhZGQgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBhbmQgc2VuZCBpdC4KICovCnZhciBTZW5kTW92ZW1lbnRQYWdlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKFNlbmRNb3ZlbWVudFBhZ2UsIF9Db21wb25lbnQpOwogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoU2VuZE1vdmVtZW50UGFnZSk7CiAgZnVuY3Rpb24gU2VuZE1vdmVtZW50UGFnZShwcm9wcykgewogICAgdmFyIF90aGlzOwogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFNlbmRNb3ZlbWVudFBhZ2UpOwogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcyk7CiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJkYXRhRmV0Y2hlZCIsIGZhbHNlKTsKICAgIF90aGlzLnN0YXRlID0gewogICAgICBzaGlwbWVudFR5cGVzOiBbXSwKICAgICAgZG9jdW1lbnRzOiBbXSwKICAgICAgZmlsZXM6IFtdLAogICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXMucHJvcHMuaW5pdGlhbFZhbHVlcyksIHt9LCB7CiAgICAgICAgdGFibGVJdGVtczogW10KICAgICAgfSksCiAgICAgIHRvdGFsQ291bnQ6IDAsCiAgICAgIGlzRmlyc3RQYWdlTG9hZGVkOiBmYWxzZQogICAgfTsKICAgIF90aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICBfdGhpcy5vbkRyb3AgPSBfdGhpcy5vbkRyb3AuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5pc1Jvd0xvYWRlZCA9IF90aGlzLmlzUm93TG9hZGVkLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMubG9hZE1vcmVSb3dzID0gX3RoaXMubG9hZE1vcmVSb3dzLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMudG9nZ2xlRHJvcGRvd24gPSBfdGhpcy50b2dnbGVEcm9wZG93bi5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnZhbGlkYXRlID0gX3RoaXMudmFsaWRhdGUuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5kZWJvdW5jZWRMb2NhdGlvbnNGZXRjaCA9IGRlYm91bmNlTG9jYXRpb25zRmV0Y2goX3RoaXMucHJvcHMuZGVib3VuY2VUaW1lLCBfdGhpcy5wcm9wcy5taW5TZWFyY2hMZW5ndGgpOwogICAgcmV0dXJuIF90aGlzOwogIH0KICBfY3JlYXRlQ2xhc3MoU2VuZE1vdmVtZW50UGFnZSwgW3sKICAgIGtleTogImNvbXBvbmVudERpZE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICBpZiAodGhpcy5wcm9wcy5zdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZCkgewogICAgICAgIHRoaXMuZGF0YUZldGNoZWQgPSB0cnVlOwogICAgICAgIHRoaXMuZmV0Y2hTdG9ja01vdmVtZW50RGF0YSgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHsKICAgICAgaWYgKG5leHRQcm9wcy5zdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZCAmJiAhdGhpcy5kYXRhRmV0Y2hlZCkgewogICAgICAgIHRoaXMuZGF0YUZldGNoZWQgPSB0cnVlOwogICAgICAgIHRoaXMuZmV0Y2hTdG9ja01vdmVtZW50RGF0YSgpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGVzIGZpbGVzJyBhcnJheSBhZnRlciBkcm9wcGluZyB0aGVtIHRvIGRyb3B6b25lIGFyZWEuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gbmV3RmlsZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogIm9uRHJvcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Ecm9wKG5ld0ZpbGVzKSB7CiAgICAgIHZhciBmaWxlcyA9IHRoaXMuc3RhdGUuZmlsZXM7CiAgICAgIHZhciBkaWZmZXJlbmNlID0gXy5kaWZmZXJlbmNlQnkoZmlsZXMsIG5ld0ZpbGVzLCAnbmFtZScpOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBmaWxlczogXy5jb25jYXQoZGlmZmVyZW5jZSwgbmV3RmlsZXMpCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIm9uU2F2ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25TYXZlKHZhbHVlcykgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB0aGlzLnNhdmVWYWx1ZXModmFsdWVzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICBpZiAodmFsdWVzLnN0YXR1c0NvZGUgPT09ICdESVNQQVRDSEVEJykgewogICAgICAgICAgX3RoaXMyLmZldGNoU3RvY2tNb3ZlbWVudERhdGEoKTsKICAgICAgICB9CiAgICAgICAgQWxlcnQuc3VjY2VzcyhfdGhpczIucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmFsZXJ0LnNhdmVTdWNjZXNzLmxhYmVsJywgJ0NoYW5nZXMgc2F2ZWQgc3VjY2Vzc2Z1bGx5JyksIHsKICAgICAgICAgIHRpbWVvdXQ6IDMwMDAKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczIucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2F2ZVZhbHVlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZVZhbHVlcyh2YWx1ZXMpIHsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgJ2Rlc3RpbmF0aW9uLmlkJzogdmFsdWVzLmRlc3RpbmF0aW9uLmlkLAogICAgICAgIGRhdGVTaGlwcGVkOiB2YWx1ZXMuZGF0ZVNoaXBwZWQsCiAgICAgICAgJ3NoaXBtZW50VHlwZS5pZCc6IHZhbHVlcy5zaGlwbWVudFR5cGUuaWQsCiAgICAgICAgdHJhY2tpbmdOdW1iZXI6IHZhbHVlcy50cmFja2luZ051bWJlciB8fCAnJywKICAgICAgICBkcml2ZXJOYW1lOiB2YWx1ZXMuZHJpdmVyTmFtZSB8fCAnJywKICAgICAgICBjb21tZW50czogdmFsdWVzLmNvbW1lbnRzIHx8ICcnLAogICAgICAgIGV4cGVjdGVkRGVsaXZlcnlEYXRlOiB2YWx1ZXMuZXhwZWN0ZWREZWxpdmVyeURhdGUgfHwgJycKICAgICAgfTsKICAgICAgcmV0dXJuIHRoaXMuc2F2ZVNoaXBtZW50KHBheWxvYWQpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGZpbGUgYnkgbmFtZSBmcm9tIGZpbGVzIGFycmF5CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZQogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAicmVtb3ZlRmlsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRmlsZShuYW1lKSB7CiAgICAgIHZhciBmaWxlcyA9IHRoaXMuc3RhdGUuZmlsZXM7CiAgICAgIF8ucmVtb3ZlKGZpbGVzLCBmdW5jdGlvbiAoZmlsZSkgewogICAgICAgIHJldHVybiBmaWxlLm5hbWUgPT09IG5hbWU7CiAgICAgIH0pOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBmaWxlczogZmlsZXMKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmVzIGEgYnVsayBvZiBmaWxlcyBieSBuYW1lIGZyb20gZmlsZXMgYXJyYXkKICAgICAqIEBwYXJhbSB7QXJyYXl9IG5hbWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVGaWxlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRmlsZXMobmFtZXMpIHsKICAgICAgdmFyIGZpbGVzID0gdGhpcy5zdGF0ZS5maWxlczsKICAgICAgXy5mb3JFYWNoKG5hbWVzLCBmdW5jdGlvbiAobmFtZSkgewogICAgICAgIF8ucmVtb3ZlKGZpbGVzLCBmdW5jdGlvbiAoZmlsZSkgewogICAgICAgICAgcmV0dXJuIGZpbGUubmFtZSA9PT0gbmFtZTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIGZpbGVzOiBmaWxlcwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIEZldGNoZXMgYXZhaWxhYmxlIHNoaXBtZW50IHR5cGVzIGZyb20gQVBJLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiZmV0Y2hTaGlwbWVudFR5cGVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFNoaXBtZW50VHlwZXMoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgICB2YXIgdXJsID0gJy9vcGVuYm94ZXMvYXBpL2dlbmVyaWMvc2hpcG1lbnRUeXBlJzsKICAgICAgcmV0dXJuIGFwaUNsaWVudC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIHZhciBzaGlwbWVudFR5cGVzID0gXy5tYXAocmVzcG9uc2UuZGF0YS5kYXRhLCBmdW5jdGlvbiAodHlwZSkgewogICAgICAgICAgdmFyIF8kc3BsaXQgPSBfLnNwbGl0KHR5cGUubmFtZSwgJ3xmcjonKSwKICAgICAgICAgICAgXyRzcGxpdDIgPSBfc2xpY2VkVG9BcnJheShfJHNwbGl0LCAyKSwKICAgICAgICAgICAgZW4gPSBfJHNwbGl0MlswXSwKICAgICAgICAgICAgZnIgPSBfJHNwbGl0MlsxXTsKICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHR5cGUpLCB7fSwgewogICAgICAgICAgICBsYWJlbDogX3RoaXMzLnByb3BzLmxvY2FsZSA9PT0gJ2ZyJyAmJiBmciA/IGZyIDogZW4KICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIF90aGlzMy5zZXRTdGF0ZSh7CiAgICAgICAgICBzaGlwbWVudFR5cGVzOiBzaGlwbWVudFR5cGVzCiAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmZXRjaFN0b2NrTW92ZW1lbnRJdGVtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hTdG9ja01vdmVtZW50SXRlbXMoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi9zdG9ja01vdmVtZW50SXRlbXM/c3RlcE51bWJlcj02Iik7CiAgICAgIGFwaUNsaWVudC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgIHZhciB0YWJsZUl0ZW1zID0gZGF0YTsKICAgICAgICBfdGhpczQuc2V0U3RhdGUoewogICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzNC5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgICAgICB0YWJsZUl0ZW1zOiB0YWJsZUl0ZW1zCiAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJsb2FkTW9yZVJvd3MiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWRNb3JlUm93cyhfcmVmMTUpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CiAgICAgIHZhciBzdGFydEluZGV4ID0gX3JlZjE1LnN0YXJ0SW5kZXg7CiAgICAgIGlmICh0aGlzLnN0YXRlLnRvdGFsQ291bnQpIHsKICAgICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi9zdG9ja01vdmVtZW50SXRlbXM/b2Zmc2V0PSIpLmNvbmNhdChzdGFydEluZGV4LCAiJm1heD0iKS5jb25jYXQodGhpcy5wcm9wcy5wYWdlU2l6ZSwgIiZzdGVwTnVtYmVyPTYiKTsKICAgICAgICBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgdmFyIHRhYmxlSXRlbXNEYXRhID0gXy5tYXAoZGF0YSwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB2YWwpLCB7fSwgewogICAgICAgICAgICAgIHByb2R1Y3ROYW1lOiB2YWwucHJvZHVjdE5hbWUgPyB2YWwucHJvZHVjdE5hbWUgOiB2YWwucHJvZHVjdC5uYW1lCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgdW5pcUJ5ID0gXy5maW5kKHRhYmxlSXRlbXNEYXRhLCAnaWQnKSA/ICdpZCcgOiAnc2hpcG1lbnRJdGVtSWQnOwogICAgICAgICAgX3RoaXM1LnNldFN0YXRlKHsKICAgICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzNS5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgICAgICAgIHRhYmxlSXRlbXM6IF8udW5pcUJ5KF8uY29uY2F0KF90aGlzNS5zdGF0ZS52YWx1ZXMudGFibGVJdGVtcywgdGFibGVJdGVtc0RhdGEpLCB1bmlxQnkpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogdHJ1ZQogICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoX3RoaXM1LnN0YXRlLnZhbHVlcy50YWJsZUl0ZW1zLmxlbmd0aCAhPT0gX3RoaXM1LnN0YXRlLnRvdGFsQ291bnQpIHsKICAgICAgICAgICAgICBfdGhpczUubG9hZE1vcmVSb3dzKHsKICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXg6IHN0YXJ0SW5kZXggKyBfdGhpczUucHJvcHMucGFnZVNpemUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc1Jvd0xvYWRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNSb3dMb2FkZWQoX3JlZjE2KSB7CiAgICAgIHZhciBpbmRleCA9IF9yZWYxNi5pbmRleDsKICAgICAgcmV0dXJuICEhdGhpcy5zdGF0ZS52YWx1ZXMudGFibGVJdGVtc1tpbmRleF07CiAgICB9CgogICAgLyoqCiAgICAgKiBGZXRjaGVzIDV0aCBzdGVwIGRhdGEgZnJvbSBjdXJyZW50IHN0b2NrIG1vdmVtZW50LgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiZmV0Y2hTdG9ja01vdmVtZW50RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hTdG9ja01vdmVtZW50RGF0YSgpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiP3N0ZXBOdW1iZXI9NiIpOwogICAgICByZXR1cm4gYXBpQ2xpZW50LmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgdmFyIHN0b2NrTW92ZW1lbnREYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgIHZhciBhc3NvY2lhdGlvbnMgPSByZXNwb25zZS5kYXRhLmRhdGEuYXNzb2NpYXRpb25zOwogICAgICAgIHZhciB0b3RhbENvdW50ID0gcmVzcG9uc2UuZGF0YS50b3RhbENvdW50OwogICAgICAgIHZhciBkb2N1bWVudHMgPSBfLmZpbHRlcihhc3NvY2lhdGlvbnMuZG9jdW1lbnRzLCBmdW5jdGlvbiAoZG9jKSB7CiAgICAgICAgICByZXR1cm4gZG9jLnN0ZXBOdW1iZXIgPT09IDU7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGRlc3RpbmF0aW9uVHlwZSA9IHN0b2NrTW92ZW1lbnREYXRhLmRlc3RpbmF0aW9uLmxvY2F0aW9uVHlwZTsKICAgICAgICBfdGhpczYuc2V0U3RhdGUoewogICAgICAgICAgZG9jdW1lbnRzOiBkb2N1bWVudHMsCiAgICAgICAgICB0b3RhbENvdW50OiB0b3RhbENvdW50LAogICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzNi5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgICAgICBkYXRlU2hpcHBlZDogc3RvY2tNb3ZlbWVudERhdGEuZGF0ZVNoaXBwZWQsCiAgICAgICAgICAgIHNoaXBtZW50VHlwZTogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzdG9ja01vdmVtZW50RGF0YS5zaGlwbWVudFR5cGUpLCB7fSwgewogICAgICAgICAgICAgIGxhYmVsOiBzcGxpdFRyYW5zbGF0aW9uKHN0b2NrTW92ZW1lbnREYXRhLnNoaXBtZW50VHlwZS5uYW1lLCBfdGhpczYucHJvcHMubG9jYWxlKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgdHJhY2tpbmdOdW1iZXI6IHN0b2NrTW92ZW1lbnREYXRhLnRyYWNraW5nTnVtYmVyLAogICAgICAgICAgICBkcml2ZXJOYW1lOiBzdG9ja01vdmVtZW50RGF0YS5kcml2ZXJOYW1lLAogICAgICAgICAgICBjb21tZW50czogc3RvY2tNb3ZlbWVudERhdGEuY29tbWVudHMsCiAgICAgICAgICAgIGV4cGVjdGVkRGVsaXZlcnlEYXRlOiBzdG9ja01vdmVtZW50RGF0YS5leHBlY3RlZERlbGl2ZXJ5RGF0ZSwKICAgICAgICAgICAgLy8gQmVsb3cgdmFsdWVzIGFyZSByZWFzc2lnbmVkIGluIGNhc2Ugb2YgZWRpdGluZyBkZXN0aW5hdGlvbiBvciBkZXNjcmlwdGlvbgogICAgICAgICAgICBuYW1lOiBzdG9ja01vdmVtZW50RGF0YS5uYW1lLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogc3RvY2tNb3ZlbWVudERhdGEuZGVzY3JpcHRpb24sCiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiB7CiAgICAgICAgICAgICAgaWQ6IHN0b2NrTW92ZW1lbnREYXRhLmRlc3RpbmF0aW9uLmlkLAogICAgICAgICAgICAgIHR5cGU6IGRlc3RpbmF0aW9uVHlwZSA/IGRlc3RpbmF0aW9uVHlwZS5sb2NhdGlvblR5cGVDb2RlIDogbnVsbCwKICAgICAgICAgICAgICBuYW1lOiBzdG9ja01vdmVtZW50RGF0YS5kZXN0aW5hdGlvbi5uYW1lLAogICAgICAgICAgICAgIGxhYmVsOiAiIi5jb25jYXQoc3RvY2tNb3ZlbWVudERhdGEuZGVzdGluYXRpb24ubmFtZSwgIlxuICAgICAgICAgICAgICAgIFsiKS5jb25jYXQoZGVzdGluYXRpb25UeXBlID8gZGVzdGluYXRpb25UeXBlLmRlc2NyaXB0aW9uIDogbnVsbCwgIl0iKQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNi5wcm9wcy5uZXh0UGFnZShfdGhpczYuc3RhdGUudmFsdWVzKTsKICAgICAgICAgIF90aGlzNi5mZXRjaFNoaXBtZW50VHlwZXMoKTsKICAgICAgICAgIGlmICghX3RoaXM2LnByb3BzLmlzUGFnaW5hdGVkKSB7CiAgICAgICAgICAgIF90aGlzNi5mZXRjaFN0b2NrTW92ZW1lbnRJdGVtcygpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzNi5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmRzIGZpbGVzIHVwbG9hZGVkIGJ5IHVzZXIgdG8gYmFja2VuZC4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmaWxlCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzZW5kRmlsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZEZpbGUoZmlsZSkgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC91cGxvYWREb2N1bWVudC8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICB2YXIgZGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBkYXRhLmFwcGVuZCgnZmlsZUNvbnRlbnRzJywgZmlsZSk7CiAgICAgIHJldHVybiBhcGlDbGllbnQucG9zdCh1cmwsIGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogQnVsayBzZW5kIG9mIGZpbGVzIHVwbG9hZGVkIGJ5IHVzZXIgdG8gYmFja2VuZC4KICAgICAqIEBwYXJhbSB7QXJyYXl9IGZpbGVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzZW5kRmlsZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRGaWxlcyhmaWxlcykgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC91cGxvYWREb2N1bWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkKTsKICAgICAgdmFyIGRhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgXy5mb3JFYWNoKGZpbGVzLCBmdW5jdGlvbiAoZmlsZSwgaWR4KSB7CiAgICAgICAgZGF0YS5hcHBlbmQoImZpbGVzQ29udGVudHNbIi5jb25jYXQoaWR4LCAiXSIpLCBmaWxlKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBhcGlDbGllbnQucG9zdCh1cmwsIGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgZGF0YSB3aXRoIHNoaXBtZW50IGRldGFpbHMuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gcGF5bG9hZAogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZVNoaXBtZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlU2hpcG1lbnQocGF5bG9hZCkgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi91cGRhdGVTaGlwbWVudCIpOwogICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QodXJsLCBwYXlsb2FkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZXMgc3RvY2sgbW92ZW1lbnQgc3RhdHVzIHRvIERJU1BBVENIRUQgd2l0aCBwb3N0IG1ldGhvZC4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInN0YXRlVHJhbnNpdGlvblRvU2VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3RhdGVUcmFuc2l0aW9uVG9TZW50KCkgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi9zdGF0dXMiKTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgc3RhdHVzOiAnRElTUEFUQ0hFRCcKICAgICAgfTsKICAgICAgcmV0dXJuIGFwaUNsaWVudC5wb3N0KHVybCwgcGF5bG9hZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGxvYWRzIGZpbGVzIGFuZCBzZW5kcyB0aGUgd2hvbGUgc3RvY2sgbW92ZW1lbnQuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gdmFsdWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzZW5kRmlsZXNBbmRTYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kRmlsZXNBbmRTYXZlKHZhbHVlcykgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKICAgICAgdmFyIGVycm9ycyA9IHRoaXMudmFsaWRhdGUodmFsdWVzKTsKICAgICAgaWYgKF8uaXNFbXB0eShlcnJvcnMpKSB7CiAgICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICAgIHZhciBmaWxlcyA9IHRoaXMuc3RhdGUuZmlsZXM7CiAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgIHRoaXMuc2VuZEZpbGVzKGZpbGVzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgQWxlcnQuc3VjY2VzcyhfdGhpczcucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmFsZXJ0LmZpbGVzU3VjY2Vzcy5sYWJlbCcsICdGaWxlcyB1cGxvYWRlZCBzdWNjZXNzZnVseSEnKSwgewogICAgICAgICAgICAgIHRpbWVvdXQ6IDMwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF90aGlzNy5yZW1vdmVGaWxlcyhfLm1hcChmaWxlcywgZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZmlsZS5uYW1lOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIF90aGlzNy5wcmVwYXJlUmVxdWVzdEFuZFN1Ym1pdFN0b2NrTW92ZW1lbnQodmFsdWVzKTsKICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIEFsZXJ0LmVycm9yKF90aGlzNy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuYWxlcnQuZmlsZXNFcnJvci5sYWJlbCcsICdFcnJvciBvY2N1cmVkIGR1cmluZyBmaWxlcyB1cGxvYWQhJykpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChmaWxlcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIHRoaXMuc2VuZEZpbGUoZmlsZXNbMF0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBBbGVydC5zdWNjZXNzKF90aGlzNy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuYWxlcnQuZmlsZVN1Y2Nlc3MubGFiZWwnLCAnRmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVseSEnKSwgewogICAgICAgICAgICAgIHRpbWVvdXQ6IDMwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF90aGlzNy5yZW1vdmVGaWxlKGZpbGVzWzBdLm5hbWUpOwogICAgICAgICAgICBfdGhpczcucHJlcGFyZVJlcXVlc3RBbmRTdWJtaXRTdG9ja01vdmVtZW50KHZhbHVlcyk7CiAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBBbGVydC5lcnJvcihfdGhpczcucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmFsZXJ0LmZpbGVFcnJvci5sYWJlbCcsICdFcnJvciBvY2N1cmVkIGR1cmluZyBmaWxlIHVwbG9hZCEnKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5wcmVwYXJlUmVxdWVzdEFuZFN1Ym1pdFN0b2NrTW92ZW1lbnQodmFsdWVzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJwcmVwYXJlUmVxdWVzdEFuZFN1Ym1pdFN0b2NrTW92ZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByZXBhcmVSZXF1ZXN0QW5kU3VibWl0U3RvY2tNb3ZlbWVudCh2YWx1ZXMpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CiAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIGRhdGVTaGlwcGVkOiB2YWx1ZXMuZGF0ZVNoaXBwZWQsCiAgICAgICAgJ3NoaXBtZW50VHlwZS5pZCc6IHZhbHVlcy5zaGlwbWVudFR5cGUuaWQsCiAgICAgICAgdHJhY2tpbmdOdW1iZXI6IHZhbHVlcy50cmFja2luZ051bWJlciB8fCAnJywKICAgICAgICBkcml2ZXJOYW1lOiB2YWx1ZXMuZHJpdmVyTmFtZSB8fCAnJywKICAgICAgICBjb21tZW50czogdmFsdWVzLmNvbW1lbnRzIHx8ICcnLAogICAgICAgIGV4cGVjdGVkRGVsaXZlcnlEYXRlOiB2YWx1ZXMuZXhwZWN0ZWREZWxpdmVyeURhdGUgfHwgJycKICAgICAgfTsKICAgICAgaWYgKHRoaXMucHJvcHMuY3VycmVudExvY2F0aW9uSWQgIT09IHZhbHVlcy5vcmlnaW4uaWQgJiYgdmFsdWVzLm9yaWdpbi50eXBlICE9PSAnU1VQUExJRVInICYmIHZhbHVlcy5oYXNNYW5hZ2VJbnZlbnRvcnkpIHsKICAgICAgICBBbGVydC5lcnJvcih0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5hbGVydC5zZW5kU3RvY2tNb3ZlbWVudC5sYWJlbCcsICdZb3UgYXJlIG5vdCBhYmxlIHRvIHNlbmQgc2hpcG1lbnQgZnJvbSBhIGxvY2F0aW9uIG90aGVyIHRoYW4gb3JpZ2luLiBDaGFuZ2UgeW91ciBjdXJyZW50IGxvY2F0aW9uLicpKTsKICAgICAgICB0aGlzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWVzLnNoaXBtZW50VHlwZS5pZCA9PT0gXy5maW5kKHRoaXMuc3RhdGUuc2hpcG1lbnRUeXBlcywgZnVuY3Rpb24gKHNoaXBtZW50VHlwZSkgewogICAgICAgIHJldHVybiBzaGlwbWVudFR5cGUubGFiZWwgPT09ICdEZWZhdWx0JzsKICAgICAgfSkuaWQpIHsKICAgICAgICBBbGVydC5lcnJvcih0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5hbGVydC5wb3B1bGF0ZVNoaXBtZW50VHlwZS5sYWJlbCcsICdQbGVhc2UgcG9wdWxhdGUgc2hpcG1lbnQgdHlwZSBiZWZvcmUgY29udGludWluZycpKTsKICAgICAgICB0aGlzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zYXZlU2hpcG1lbnQocGF5bG9hZCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczguc3RhdGVUcmFuc2l0aW9uVG9TZW50KCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIHJlcXVpc2l0aW9uIGxpc3QKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9zaG93LyIuY29uY2F0KF90aGlzOC5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkKTsKICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgICAgfSk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzOC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjaGFuZ2VzIG1hZGUgYnkgdXNlciBpbiB0aGlzIHN0ZXAgYW5kIGdvIGJhY2sgdG8gcHJldmlvdXMgcGFnZQogICAgICogQHBhcmFtIHtvYmplY3R9IHZhbHVlcwogICAgICogQHBhcmFtIHtib29sZWFufSBpbnZhbGlkCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJwcmV2aW91c1BhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByZXZpb3VzUGFnZSh2YWx1ZXMsIGludmFsaWQpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CiAgICAgIGlmICghaW52YWxpZCkgewogICAgICAgIHRoaXMuc2F2ZVZhbHVlcyh2YWx1ZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzOS5wcm9wcy5wcmV2aW91c1BhZ2UodmFsdWVzKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25maXJtQWxlcnQoewogICAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1QcmV2aW91c1BhZ2UubGFiZWwnLCAnVmFsaWRhdGlvbiBlcnJvcicpLAogICAgICAgICAgbWVzc2FnZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVByZXZpb3VzUGFnZS5tZXNzYWdlLmxhYmVsJywgJ0Nhbm5vdCBzYXZlIGR1ZSB0byB2YWxpZGF0aW9uIGVycm9yIG9uIHBhZ2UnKSwKICAgICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUHJldmlvdXNQYWdlLmNvcnJlY3RFcnJvci5sYWJlbCcsICdDb3JyZWN0IGVycm9yJykKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1QcmV2aW91c1BhZ2UuY29udGludWUubGFiZWwnLCAnQ29udGludWUgKGxvc2UgdW5zYXZlZCB3b3JrKScpLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczkucHJvcHMucHJldmlvdXNQYWdlKHZhbHVlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGNoYW5nZXMgbWFkZSBieSB1c2VyIGluIHRoaXMgc3RlcCBhbmQgcmVkaXJlY3RzIHRvIHRoZSBzaGlwbWVudCB2aWV3IHBhZ2UKICAgICAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVBbmRFeGl0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlQW5kRXhpdCh2YWx1ZXMpIHsKICAgICAgdmFyIGVycm9ycyA9IHRoaXMudmFsaWRhdGUodmFsdWVzKTsKICAgICAgaWYgKF8uaXNFbXB0eShlcnJvcnMpKSB7CiAgICAgICAgdGhpcy5zYXZlVmFsdWVzKHZhbHVlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAiL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L3Nob3cvIi5jb25jYXQodmFsdWVzLnN0b2NrTW92ZW1lbnRJZCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtRXhpdC5sYWJlbCcsICdDb25maXJtIHNhdmUnKSwKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1FeGl0Lm1lc3NhZ2UnLCAnVmFsaWRhdGlvbiBlcnJvcnMgb2NjdXJyZWQuIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBleGl0IGFuZCBsb3NlIHVuc2F2ZWQgZGF0YT8nKSwKICAgICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC55ZXMubGFiZWwnLCAnWWVzJyksCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9zaG93LyIuY29uY2F0KHZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgICB9XQogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSb2xsYmFjayBzdG9jayBtb3ZlbWVudCBpZiBpdCBoYXMgYmVlbiBzaGlwcGVkCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyb2xsYmFja1N0b2NrTW92ZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvbGxiYWNrU3RvY2tNb3ZlbWVudCh2YWx1ZXMpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3N0YXR1cyIpOwogICAgICB2YXIgcGF5bG9hZCA9IHsKICAgICAgICByb2xsYmFjazogdHJ1ZQogICAgICB9OwogICAgICB2YXIgaXNPcmlnaW4gPSB0aGlzLnByb3BzLmN1cnJlbnRMb2NhdGlvbklkID09PSB2YWx1ZXMub3JpZ2luLmlkOwogICAgICB2YXIgaXNEZXN0aW5hdGlvbiA9IHRoaXMucHJvcHMuY3VycmVudExvY2F0aW9uSWQgPT09IHZhbHVlcy5kZXN0aW5hdGlvbi5pZDsKICAgICAgaWYgKHZhbHVlcy5oYXNNYW5hZ2VJbnZlbnRvcnkgJiYgaXNPcmlnaW4gfHwgIXZhbHVlcy5oYXNNYW5hZ2VJbnZlbnRvcnkgJiYgaXNEZXN0aW5hdGlvbikgewogICAgICAgIGFwaUNsaWVudC5wb3N0KHVybCwgcGF5bG9hZCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczEwLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIEFsZXJ0LmVycm9yKHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmFsZXJ0LnJvbGxiYWNrU2hpcG1lbnQubGFiZWwnLCAnWW91IGFyZSBub3QgYWJsZSB0byByb2xsYmFjayBzaGlwbWVudCBmcm9tIHlvdXIgbG9jYXRpb24uJykpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUb2dnbGUgdGhlIGRvd25sb2FkYWJsZSBmaWxlcwogICAgICovCiAgfSwgewogICAga2V5OiAidG9nZ2xlRHJvcGRvd24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkgewogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBpc0Ryb3Bkb3duVmlzaWJsZTogIXRoaXMuc3RhdGUuaXNEcm9wZG93blZpc2libGUKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidmFsaWRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlKHZhbHVlcykgewogICAgICB2YXIgZXJyb3JzID0ge307CiAgICAgIHZhciBkYXRlID0gbW9tZW50KHRoaXMucHJvcHMubWluaW11bUV4cGlyYXRpb25EYXRlLCAnTU0vREQvWVlZWScpOwogICAgICB2YXIgZGF0ZVNoaXBwZWQgPSBtb21lbnQodmFsdWVzLmRhdGVTaGlwcGVkLCAnTU0vREQvWVlZWScpOwogICAgICB2YXIgZXhwZWN0ZWREZWxpdmVyeURhdGUgPSBtb21lbnQodmFsdWVzLmV4cGVjdGVkRGVsaXZlcnlEYXRlLCAnTU0vREQvWVlZWScpOwogICAgICBpZiAoZGF0ZS5kaWZmKGRhdGVTaGlwcGVkKSA+IDApIHsKICAgICAgICBlcnJvcnMuZGF0ZVNoaXBwZWQgPSAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5pbnZhbGlkRGF0ZS5sYWJlbCc7CiAgICAgIH0KICAgICAgaWYgKCF2YWx1ZXMuZGF0ZVNoaXBwZWQpIHsKICAgICAgICBlcnJvcnMuZGF0ZVNoaXBwZWQgPSAncmVhY3QuZGVmYXVsdC5lcnJvci5yZXF1aXJlZEZpZWxkLmxhYmVsJzsKICAgICAgfQogICAgICBpZiAoIXZhbHVlcy5zaGlwbWVudFR5cGUpIHsKICAgICAgICBlcnJvcnMuc2hpcG1lbnRUeXBlID0gJ3JlYWN0LmRlZmF1bHQuZXJyb3IucmVxdWlyZWRGaWVsZC5sYWJlbCc7CiAgICAgIH0KICAgICAgaWYgKCF2YWx1ZXMuZXhwZWN0ZWREZWxpdmVyeURhdGUpIHsKICAgICAgICBlcnJvcnMuZXhwZWN0ZWREZWxpdmVyeURhdGUgPSAncmVhY3QuZGVmYXVsdC5lcnJvci5yZXF1aXJlZEZpZWxkLmxhYmVsJzsKICAgICAgfQogICAgICBpZiAobW9tZW50KGRhdGVTaGlwcGVkKS5kaWZmKGV4cGVjdGVkRGVsaXZlcnlEYXRlKSA+IDApIHsKICAgICAgICBlcnJvcnMuZXhwZWN0ZWREZWxpdmVyeURhdGUgPSAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5kZWxpdmVyeURhdGVCZWZvcmVTaGlwRGF0ZS5sYWJlbCc7CiAgICAgICAgZXJyb3JzLmRhdGVTaGlwcGVkID0gJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3IuZGVsaXZlcnlEYXRlQmVmb3JlU2hpcERhdGUubGFiZWwnOwogICAgICB9CiAgICAgIHJldHVybiBlcnJvcnM7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb3JtLCB7CiAgICAgICAgb25TdWJtaXQ6IGZ1bmN0aW9uIG9uU3VibWl0KCkge30sCiAgICAgICAgdmFsaWRhdGU6IHRoaXMudmFsaWRhdGUsCiAgICAgICAgbXV0YXRvcnM6IF9vYmplY3RTcHJlYWQoe30sIGFycmF5TXV0YXRvcnMpLAogICAgICAgIGluaXRpYWxWYWx1ZXM6IHRoaXMuc3RhdGUudmFsdWVzLAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKF9yZWYxNykgewogICAgICAgICAgdmFyIGhhbmRsZVN1Ym1pdCA9IF9yZWYxNy5oYW5kbGVTdWJtaXQsCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYxNy52YWx1ZXMsCiAgICAgICAgICAgIGludmFsaWQgPSBfcmVmMTcuaW52YWxpZDsKICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZm9ybSIsIHsKICAgICAgICAgICAgb25TdWJtaXQ6IGhhbmRsZVN1Ym1pdAogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiY2xhc3NpYy1mb3JtIGNsYXNzaWMtZm9ybS1jb25kZW5zZWQiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiYnV0dG9ucy1jb250YWluZXIgY2xhc3NpYy1mb3JtLWJ1dHRvbnMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJkcm9wem9uZSBmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRHJvcHpvbmUsIHsKICAgICAgICAgICAgZGlzYWJsZWQ6IHZhbHVlcy5zdGF0dXNDb2RlID09PSAnRElTUEFUQ0hFRCcsCiAgICAgICAgICAgIG9uRHJvcDogX3RoaXMxMS5vbkRyb3AsCiAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS11cGxvYWQgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5zdG9ja01vdmVtZW50LnVwbG9hZERvY3VtZW50cy5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVXBsb2FkIERvY3VtZW50cyIKICAgICAgICAgIH0pKSwgXy5tYXAoX3RoaXMxMS5zdGF0ZS5maWxlcywgZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgICAga2V5OiBmaWxlLm5hbWUsCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY2hvc2VuLWZpbGUgZC1mbGV4IGp1c3RpZnktY29udGVudC1jZW50ZXIgYWxpZ24taXRlbXMtY2VudGVyIgogICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogInRleHQtdHJ1bmNhdGUiCiAgICAgICAgICAgIH0sIGZpbGUubmFtZSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJhIiwgewogICAgICAgICAgICAgIGhyZWY6ICIjIiwKICAgICAgICAgICAgICBjbGFzc05hbWU6ICJyZW1vdmUtYnV0dG9uIiwKICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBfdGhpczExLnJlbW92ZUZpbGUoZmlsZS5uYW1lKTsKICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtcmVtb3ZlIgogICAgICAgICAgICB9KSkpOwogICAgICAgICAgfSkpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZHJvcGRvd24iCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgb25DbGljazogX3RoaXMxMS50b2dnbGVEcm9wZG93biwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZHJvcGRvd24tYnV0dG9uIGZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zaWduLW91dCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLmRvd25sb2FkLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJEb3dubG9hZCIKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImRyb3Bkb3duLWNvbnRlbnQgcHJpbnQtYnV0dG9ucy1jb250YWluZXIgY29sLW1kLTMgZmxleC1ncm93LTEgXG4gICAgICAgICAgICAgICAgICAgICAgIi5jb25jYXQoX3RoaXMxMS5zdGF0ZS5pc0Ryb3Bkb3duVmlzaWJsZSA/ICd2aXNpYmxlJyA6ICcnKQogICAgICAgICAgfSwgX3RoaXMxMS5zdGF0ZS5kb2N1bWVudHMubGVuZ3RoICYmIF8ubWFwKF90aGlzMTEuc3RhdGUuZG9jdW1lbnRzLCBmdW5jdGlvbiAoZG9jdW1lbnQsIGlkeCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQuaGlkZGVuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KERvY3VtZW50QnV0dG9uLCBfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgbGluazogZG9jdW1lbnQudXJpLAogICAgICAgICAgICAgIGJ1dHRvblRpdGxlOiBkb2N1bWVudC5uYW1lCiAgICAgICAgICAgIH0sIGRvY3VtZW50LCB7CiAgICAgICAgICAgICAga2V5OiBpZHgsCiAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczExLnNhdmVWYWx1ZXModmFsdWVzKTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGRpc2FibGVkOiBmYWxzZQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczExLm9uU2F2ZSh2YWx1ZXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGZsb2F0LXJpZ2h0IGJ0bi1mb3JtIGJ0bi14cyIsCiAgICAgICAgICAgIGRpc2FibGVkOiBpbnZhbGlkCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zYXZlIHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uc2F2ZS5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSIKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczExLnNhdmVBbmRFeGl0KHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zaWduLW91dCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnNhdmVBbmRFeGl0LmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZlIGFuZCBleGl0IgogICAgICAgICAgfSkpKSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmb3JtLXRpdGxlIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuYXR0cmlidXRlLm9wdGlvbnMubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNlbmRpbmcgb3B0aW9ucyIKICAgICAgICAgIH0pKSwgXy5tYXAoU0hJUE1FTlRfRklFTERTLCBmdW5jdGlvbiAoZmllbGRDb25maWcsIGZpZWxkTmFtZSkgewogICAgICAgICAgICByZXR1cm4gcmVuZGVyRm9ybUZpZWxkKGZpZWxkQ29uZmlnLCBmaWVsZE5hbWUsIHsKICAgICAgICAgICAgICBzaGlwbWVudFR5cGVzOiBfdGhpczExLnN0YXRlLnNoaXBtZW50VHlwZXMsCiAgICAgICAgICAgICAgaXNzdWVkOiB2YWx1ZXMuc3RhdHVzQ29kZSA9PT0gJ0RJU1BBVENIRUQnLAogICAgICAgICAgICAgIHJlY2VpdmVkOiB2YWx1ZXMucmVjZWl2ZWQsCiAgICAgICAgICAgICAgY2FuQmVFZGl0ZWQ6ICF2YWx1ZXMucmVjZWl2ZWQsCiAgICAgICAgICAgICAgZGVib3VuY2VkTG9jYXRpb25zRmV0Y2g6IF90aGlzMTEuZGVib3VuY2VkTG9jYXRpb25zRmV0Y2gKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJzdWJtaXQtYnV0dG9ucyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJzdWJtaXQiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtcHJpbWFyeSBidG4tZm9ybSBidG4teHMiLAogICAgICAgICAgICBkaXNhYmxlZDogdmFsdWVzLnN0YXR1c0NvZGUgPT09ICdESVNQQVRDSEVEJywKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMS5wcmV2aW91c1BhZ2UodmFsdWVzLCBpbnZhbGlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24ucHJldmlvdXMubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlByZXZpb3VzIgogICAgICAgICAgfSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICBfdGhpczExLnNlbmRGaWxlc0FuZFNhdmUodmFsdWVzKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiIi5jb25jYXQodmFsdWVzLnNoaXBwZWQgPyAnYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeScgOiAnYnRuIGJ0bi1vdXRsaW5lLXN1Y2Nlc3MnLCAiIGZsb2F0LXJpZ2h0IGJ0bi1mb3JtIGJ0bi14cyIpLAogICAgICAgICAgICBkaXNhYmxlZDogdmFsdWVzLnN0YXR1c0NvZGUgPT09ICdESVNQQVRDSEVEJwogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3Quc3RvY2tNb3ZlbWVudC5zZW5kU2hpcG1lbnQubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNlbmQgc2hpcG1lbnQiCiAgICAgICAgICB9KSksIHZhbHVlcy5zaGlwcGVkICYmIF90aGlzMTEucHJvcHMuaXNVc2VyQWRtaW4gPyAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICBfdGhpczExLnJvbGxiYWNrU3RvY2tNb3ZlbWVudCh2YWx1ZXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtc3VjY2VzcyBmbG9hdC1yaWdodCBidG4teHMiLAogICAgICAgICAgICBkaXNhYmxlZDogaW52YWxpZCB8fCAhKHZhbHVlcy5zdGF0dXNDb2RlID09PSAnRElTUEFUQ0hFRCcpCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS11bmRvIHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24ucm9sbGJhY2subGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlJvbGxiYWNrIgogICAgICAgICAgfSkpKSA6IG51bGwpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJteS0yIHRhYmxlLWZvcm0iCiAgICAgICAgICB9LCBfLm1hcChTVVBQTElFUl9GSUVMRFMsIGZ1bmN0aW9uIChmaWVsZENvbmZpZywgZmllbGROYW1lKSB7CiAgICAgICAgICAgIHJldHVybiByZW5kZXJGb3JtRmllbGQoZmllbGRDb25maWcsIGZpZWxkTmFtZSwgewogICAgICAgICAgICAgIGhhc0JpbkxvY2F0aW9uU3VwcG9ydDogX3RoaXMxMS5wcm9wcy5oYXNCaW5Mb2NhdGlvblN1cHBvcnQsCiAgICAgICAgICAgICAgdG90YWxDb3VudDogX3RoaXMxMS5zdGF0ZS50b3RhbENvdW50LAogICAgICAgICAgICAgIGxvYWRNb3JlUm93czogX3RoaXMxMS5sb2FkTW9yZVJvd3MsCiAgICAgICAgICAgICAgaXNSb3dMb2FkZWQ6IF90aGlzMTEuaXNSb3dMb2FkZWQsCiAgICAgICAgICAgICAgaXNQYWdpbmF0ZWQ6IF90aGlzMTEucHJvcHMuaXNQYWdpbmF0ZWQsCiAgICAgICAgICAgICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IF90aGlzMTEuc3RhdGUuaXNGaXJzdFBhZ2VMb2FkZWQsCiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW4KICAgICAgICAgICAgICBpc0JveE5hbWVFbXB0eTogXy5ldmVyeShfdGhpczExLnN0YXRlLnZhbHVlcy50YWJsZUl0ZW1zLCBmdW5jdGlvbiAoX3JlZjE4KSB7CiAgICAgICAgICAgICAgICB2YXIgYm94TmFtZSA9IF9yZWYxOC5ib3hOYW1lOwogICAgICAgICAgICAgICAgcmV0dXJuICFib3hOYW1lOwogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuCiAgICAgICAgICAgICAgaXNQYWxsZXROYW1lRW1wdHk6IF8uZXZlcnkoX3RoaXMxMS5zdGF0ZS52YWx1ZXMudGFibGVJdGVtcywgZnVuY3Rpb24gKF9yZWYxOSkgewogICAgICAgICAgICAgICAgdmFyIHBhbGxldE5hbWUgPSBfcmVmMTkucGFsbGV0TmFtZTsKICAgICAgICAgICAgICAgIHJldHVybiAhcGFsbGV0TmFtZTsKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKSkpOwogICAgICAgIH0KICAgICAgfSkpOwogICAgfQogIH1dKTsKICByZXR1cm4gU2VuZE1vdmVtZW50UGFnZTsKfShDb21wb25lbnQpOwp2YXIgbWFwU3RhdGVUb1Byb3BzID0gZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKHN0YXRlKSB7CiAgcmV0dXJuIHsKICAgIHRyYW5zbGF0ZTogdHJhbnNsYXRlV2l0aERlZmF1bHRNZXNzYWdlKGdldFRyYW5zbGF0ZShzdGF0ZS5sb2NhbGl6ZSkpLAogICAgY3VycmVudExvY2F0aW9uSWQ6IHN0YXRlLnNlc3Npb24uY3VycmVudExvY2F0aW9uLmlkLAogICAgc3RvY2tNb3ZlbWVudFRyYW5zbGF0aW9uc0ZldGNoZWQ6IHN0YXRlLnNlc3Npb24uZmV0Y2hlZFRyYW5zbGF0aW9ucy5zdG9ja01vdmVtZW50LAogICAgZGVib3VuY2VUaW1lOiBzdGF0ZS5zZXNzaW9uLnNlYXJjaENvbmZpZy5kZWJvdW5jZVRpbWUsCiAgICBtaW5TZWFyY2hMZW5ndGg6IHN0YXRlLnNlc3Npb24uc2VhcmNoQ29uZmlnLm1pblNlYXJjaExlbmd0aCwKICAgIGxvY2FsZTogc3RhdGUuc2Vzc2lvbi5hY3RpdmVMYW5ndWFnZSwKICAgIGlzVXNlckFkbWluOiBzdGF0ZS5zZXNzaW9uLmlzVXNlckFkbWluLAogICAgaGFzQmluTG9jYXRpb25TdXBwb3J0OiBzdGF0ZS5zZXNzaW9uLmN1cnJlbnRMb2NhdGlvbi5oYXNCaW5Mb2NhdGlvblN1cHBvcnQsCiAgICBpc1BhZ2luYXRlZDogc3RhdGUuc2Vzc2lvbi5pc1BhZ2luYXRlZCwKICAgIHBhZ2VTaXplOiBzdGF0ZS5zZXNzaW9uLnBhZ2VTaXplLAogICAgbWluaW11bUV4cGlyYXRpb25EYXRlOiBzdGF0ZS5zZXNzaW9uLm1pbmltdW1FeHBpcmF0aW9uRGF0ZQogIH07Cn07CmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzLCB7CiAgc2hvd1NwaW5uZXI6IHNob3dTcGlubmVyLAogIGhpZGVTcGlubmVyOiBoaWRlU3Bpbm5lcgp9KShTZW5kTW92ZW1lbnRQYWdlKTsKU2VuZE1vdmVtZW50UGFnZS5wcm9wVHlwZXMgPSB7CiAgLyoqIEluaXRpYWwgY29tcG9uZW50J3MgZGF0YSAqLwogIGluaXRpYWxWYWx1ZXM6IFByb3BUeXBlcy5zaGFwZSh7fSkuaXNSZXF1aXJlZCwKICAvKiogRnVuY3Rpb24gcmV0dXJuaW5nIHVzZXIgdG8gdGhlIHByZXZpb3VzIHBhZ2UgKi8KICBwcmV2aW91c1BhZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGRhdGEgaXMgbG9hZGluZyAqLwogIHNob3dTcGlubmVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiBkYXRhIGhhcyBsb2FkZWQgKi8KICBoaWRlU3Bpbm5lcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICBuZXh0UGFnZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICB0cmFuc2xhdGU6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIE5hbWUgb2YgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBsb2NhdGlvbiAqLwogIGN1cnJlbnRMb2NhdGlvbklkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsCiAgc3RvY2tNb3ZlbWVudFRyYW5zbGF0aW9uc0ZldGNoZWQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgZGVib3VuY2VUaW1lOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsCiAgbWluU2VhcmNoTGVuZ3RoOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsCiAgbG9jYWxlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsCiAgaXNVc2VyQWRtaW46IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgLyoqIElzIHRydWUgd2hlbiBjdXJyZW50bHkgc2VsZWN0ZWQgbG9jYXRpb24gc3VwcG9ydHMgYmlucyAqLwogIGhhc0JpbkxvY2F0aW9uU3VwcG9ydDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICAvKiogUmV0dXJuIHRydWUgaWYgcGFnaW5hdGlvbiBpcyBlbmFibGVkICovCiAgaXNQYWdpbmF0ZWQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgcGFnZVNpemU6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCwKICBtaW5pbXVtRXhwaXJhdGlvbkRhdGU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZAp9Ow=="},null]}