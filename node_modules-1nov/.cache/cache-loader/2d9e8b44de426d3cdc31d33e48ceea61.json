{"remainingRequest":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js?presets[]=@babel/react&presets[]=@babel/env!/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js!/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/combined-shipments/SendMovementPage.jsx","dependencies":[{"path":"/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/combined-shipments/SendMovementPage.jsx","mtime":1698037749000},{"path":"/opt/MTOBS-BIKASH/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfSwgX3R5cGVvZihvYmopOyB9CmZ1bmN0aW9uIF9leHRlbmRzKCkgeyBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9OyByZXR1cm4gX2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfQpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsgfQpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9CmZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pOyBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB9CmZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7IGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoOyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfQpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7IHZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07IGlmIChudWxsICE9IF9pKSB7IHZhciBfcywgX2UsIF94LCBfciwgX2FyciA9IFtdLCBfbiA9ICEwLCBfZCA9ICExOyB0cnkgeyBpZiAoX3ggPSAoX2kgPSBfaS5jYWxsKGFycikpLm5leHQsIDAgPT09IGkpIHsgaWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47IF9uID0gITE7IH0gZWxzZSBmb3IgKDsgIShfbiA9IChfcyA9IF94LmNhbGwoX2kpKS5kb25lKSAmJiAoX2Fyci5wdXNoKF9zLnZhbHVlKSwgX2Fyci5sZW5ndGggIT09IGkpOyBfbiA9ICEwKSB7IDsgfSB9IGNhdGNoIChlcnIpIHsgX2QgPSAhMCwgX2UgPSBlcnI7IH0gZmluYWxseSB7IHRyeSB7IGlmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuOyB9IGZpbmFsbHkgeyBpZiAoX2QpIHRocm93IF9lOyB9IH0gcmV0dXJuIF9hcnI7IH0gfQpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7IH0KZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGVudW1lcmFibGVPbmx5ICYmIChzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSkpLCBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IG51bGwgIT0gYXJndW1lbnRzW2ldID8gYXJndW1lbnRzW2ldIDoge307IGkgJSAyID8gb3duS2V5cyhPYmplY3Qoc291cmNlKSwgITApLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSkgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSkgOiBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IHJldHVybiB0YXJnZXQ7IH0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIF90b1Byb3BlcnR5S2V5KGRlc2NyaXB0b3Iua2V5KSwgZGVzY3JpcHRvcik7IH0gfQpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBPYmplY3QuZGVmaW5lUHJvcGVydHkoc3ViQ2xhc3MsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0KZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IGVsc2UgaWYgKGNhbGwgIT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpIHsgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSAidW5kZWZpbmVkIiB8fCAhUmVmbGVjdC5jb25zdHJ1Y3QpIHJldHVybiBmYWxzZTsgaWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pIHJldHVybiBmYWxzZTsgaWYgKHR5cGVvZiBQcm94eSA9PT0gImZ1bmN0aW9uIikgcmV0dXJuIHRydWU7IHRyeSB7IEJvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLCBbXSwgZnVuY3Rpb24gKCkge30pKTsgcmV0dXJuIHRydWU7IH0gY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlOyB9IH0KZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBrZXkgPSBfdG9Qcm9wZXJ0eUtleShrZXkpOyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KZnVuY3Rpb24gX3RvUHJvcGVydHlLZXkoYXJnKSB7IHZhciBrZXkgPSBfdG9QcmltaXRpdmUoYXJnLCAic3RyaW5nIik7IHJldHVybiBfdHlwZW9mKGtleSkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7IH0KZnVuY3Rpb24gX3RvUHJpbWl0aXZlKGlucHV0LCBoaW50KSB7IGlmIChfdHlwZW9mKGlucHV0KSAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDsgdmFyIHByaW0gPSBpbnB1dFtTeW1ib2wudG9QcmltaXRpdmVdOyBpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7IHZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgImRlZmF1bHQiKTsgaWYgKF90eXBlb2YocmVzKSAhPT0gIm9iamVjdCIpIHJldHVybiByZXM7IHRocm93IG5ldyBUeXBlRXJyb3IoIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuIik7IH0gcmV0dXJuIChoaW50ID09PSAic3RyaW5nIiA/IFN0cmluZyA6IE51bWJlcikoaW5wdXQpOyB9CmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7CmltcG9ydCBhcnJheU11dGF0b3JzIGZyb20gJ2ZpbmFsLWZvcm0tYXJyYXlzJzsKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnOwppbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnOwppbXBvcnQgeyBjb25maXJtQWxlcnQgfSBmcm9tICdyZWFjdC1jb25maXJtLWFsZXJ0JzsKaW1wb3J0IERyb3B6b25lIGZyb20gJ3JlYWN0LWRyb3B6b25lJzsKaW1wb3J0IHsgRm9ybSB9IGZyb20gJ3JlYWN0LWZpbmFsLWZvcm0nOwppbXBvcnQgeyBnZXRUcmFuc2xhdGUgfSBmcm9tICdyZWFjdC1sb2NhbGl6ZS1yZWR1eCc7CmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWFjdC1yZWR1eCc7CmltcG9ydCBBbGVydCBmcm9tICdyZWFjdC1zLWFsZXJ0JzsKaW1wb3J0IHsgaGlkZVNwaW5uZXIsIHNob3dTcGlubmVyIH0gZnJvbSAnYWN0aW9ucyc7CmltcG9ydCBEb2N1bWVudEJ1dHRvbiBmcm9tICdjb21wb25lbnRzL0RvY3VtZW50QnV0dG9uJzsKaW1wb3J0IEFycmF5RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL0FycmF5RmllbGQnOwppbXBvcnQgRGF0ZUZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9EYXRlRmllbGQnOwppbXBvcnQgTGFiZWxGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvTGFiZWxGaWVsZCc7CmltcG9ydCBTZWxlY3RGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvU2VsZWN0RmllbGQnOwppbXBvcnQgVGV4dEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9UZXh0RmllbGQnOwppbXBvcnQgYXBpQ2xpZW50IGZyb20gJ3V0aWxzL2FwaUNsaWVudCc7CmltcG9ydCB7IHJlbmRlckZvcm1GaWVsZCB9IGZyb20gJ3V0aWxzL2Zvcm0tdXRpbHMnOwppbXBvcnQgeyBmb3JtYXRQcm9kdWN0RGlzcGxheU5hbWUgfSBmcm9tICd1dGlscy9mb3JtLXZhbHVlcy11dGlscyc7CmltcG9ydCB7IGRlYm91bmNlTG9jYXRpb25zRmV0Y2ggfSBmcm9tICd1dGlscy9vcHRpb24tdXRpbHMnOwppbXBvcnQgVHJhbnNsYXRlLCB7IHRyYW5zbGF0ZVdpdGhEZWZhdWx0TWVzc2FnZSB9IGZyb20gJ3V0aWxzL1RyYW5zbGF0ZSc7CmltcG9ydCBzcGxpdFRyYW5zbGF0aW9uIGZyb20gJ3V0aWxzL3RyYW5zbGF0aW9uLXV0aWxzJzsKaW1wb3J0ICdyZWFjdC1jb25maXJtLWFsZXJ0L3NyYy9yZWFjdC1jb25maXJtLWFsZXJ0LmNzcyc7CnZhciBTSElQTUVOVF9GSUVMRFMgPSB7CiAgJ29yaWdpbi5uYW1lJzogewogICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50Lm9yaWdpbi5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ09yaWdpbicsCiAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVGV4dEZpZWxkLCBwYXJhbXMpOwogICAgfSwKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgZGlzYWJsZWQ6IHRydWUKICAgIH0KICB9LAogIGRlc3RpbmF0aW9uOiB7CiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGVzdGluYXRpb24ubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdEZXN0aW5hdGlvbicsCiAgICBmaWVsZEtleTogJycsCiAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICBpZiAocGFyYW1zLmNhbkJlRWRpdGVkICYmICFwYXJhbXMuaGFzU3RvY2tMaXN0KSB7CiAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFNlbGVjdEZpZWxkLCBwYXJhbXMpOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmKSB7CiAgICAgIHZhciBjYW5CZUVkaXRlZCA9IF9yZWYuY2FuQmVFZGl0ZWQsCiAgICAgICAgaGFzU3RvY2tMaXN0ID0gX3JlZi5oYXNTdG9ja0xpc3QsCiAgICAgICAgZGVib3VuY2VkTG9jYXRpb25zRmV0Y2ggPSBfcmVmLmRlYm91bmNlZExvY2F0aW9uc0ZldGNoOwogICAgICBpZiAoY2FuQmVFZGl0ZWQgJiYgIWhhc1N0b2NrTGlzdCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgIGFzeW5jOiB0cnVlLAogICAgICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZSwKICAgICAgICAgIG9wZW5PbkNsaWNrOiBmYWxzZSwKICAgICAgICAgIGF1dG9sb2FkOiBmYWxzZSwKICAgICAgICAgIGxvYWRPcHRpb25zOiBkZWJvdW5jZWRMb2NhdGlvbnNGZXRjaCwKICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgIG9wdGlvbnM6IFtdLAogICAgICAgICAgZmlsdGVyT3B0aW9uczogZnVuY3Rpb24gZmlsdGVyT3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUoZmllbGRWYWx1ZSkgewogICAgICAgICAgcmV0dXJuIF8uZ2V0KGZpZWxkVmFsdWUsICduYW1lJyk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0sCiAgJ2Rlc3RpbmF0aW9uLm5hbWUnOiB7CiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGVzdGluYXRpb24ubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdEZXN0aW5hdGlvbicsCiAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICBpZiAocGFyYW1zLmNhbkJlRWRpdGVkICYmICFwYXJhbXMuaGFzU3RvY2tMaXN0KSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRleHRGaWVsZCwgcGFyYW1zKTsKICAgIH0sCiAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjIpIHsKICAgICAgdmFyIGNhbkJlRWRpdGVkID0gX3JlZjIuY2FuQmVFZGl0ZWQsCiAgICAgICAgaGFzU3RvY2tMaXN0ID0gX3JlZjIuaGFzU3RvY2tMaXN0OwogICAgICByZXR1cm4gewogICAgICAgIGRpc2FibGVkOiAhY2FuQmVFZGl0ZWQgfHwgaGFzU3RvY2tMaXN0CiAgICAgIH07CiAgICB9CiAgfSwKICBkYXRlU2hpcHBlZDogewogICAgdHlwZTogRGF0ZUZpZWxkLAogICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnNoaXBEYXRlLmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnU2hpcG1lbnQgZGF0ZScsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGRhdGVGb3JtYXQ6ICdNTS9ERC9ZWVlZIEhIOm1tIFonLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgc2hvd1RpbWVTZWxlY3Q6IHRydWUsCiAgICAgIGF1dG9Db21wbGV0ZTogJ29mZicsCiAgICAgIHNob3dFcnJvcjogdHJ1ZQogICAgfSwKICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMykgewogICAgICB2YXIgaXNzdWVkID0gX3JlZjMuaXNzdWVkLAogICAgICAgIHNob3dPbmx5ID0gX3JlZjMuc2hvd09ubHk7CiAgICAgIHJldHVybiB7CiAgICAgICAgZGlzYWJsZWQ6IGlzc3VlZCB8fCBzaG93T25seQogICAgICB9OwogICAgfQogIH0sCiAgc2hpcG1lbnRUeXBlOiB7CiAgICB0eXBlOiBTZWxlY3RGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5zaGlwbWVudFR5cGUubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdTaGlwbWVudCB0eXBlJywKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIHNob3dWYWx1ZVRvb2x0aXA6IHRydWUsCiAgICAgIHZhbHVlS2V5OiAnaWQnLAogICAgICBsYWJlbEtleTogJ25hbWUnCiAgICB9LAogICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY0KSB7CiAgICAgIHZhciBzaGlwbWVudFR5cGVzID0gX3JlZjQuc2hpcG1lbnRUeXBlcywKICAgICAgICByZWNlaXZlZCA9IF9yZWY0LnJlY2VpdmVkLAogICAgICAgIHNob3dPbmx5ID0gX3JlZjQuc2hvd09ubHk7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3B0aW9uczogc2hpcG1lbnRUeXBlcywKICAgICAgICBkaXNhYmxlZDogc2hvd09ubHkgfHwgcmVjZWl2ZWQKICAgICAgfTsKICAgIH0KICB9LAogIHRyYWNraW5nTnVtYmVyOiB7CiAgICB0eXBlOiBUZXh0RmllbGQsCiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQudHJhY2tpbmdOdW1iZXIubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdUcmFja2luZyBudW1iZXInLAogICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY1KSB7CiAgICAgIHZhciByZWNlaXZlZCA9IF9yZWY1LnJlY2VpdmVkLAogICAgICAgIHNob3dPbmx5ID0gX3JlZjUuc2hvd09ubHk7CiAgICAgIHJldHVybiB7CiAgICAgICAgZGlzYWJsZWQ6IHNob3dPbmx5IHx8IHJlY2VpdmVkCiAgICAgIH07CiAgICB9CiAgfSwKICBkcml2ZXJOYW1lOiB7CiAgICB0eXBlOiBUZXh0RmllbGQsCiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZHJpdmVyTmFtZS5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ0RyaXZlciBuYW1lJywKICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmNikgewogICAgICB2YXIgcmVjZWl2ZWQgPSBfcmVmNi5yZWNlaXZlZCwKICAgICAgICBzaG93T25seSA9IF9yZWY2LnNob3dPbmx5OwogICAgICByZXR1cm4gewogICAgICAgIGRpc2FibGVkOiBzaG93T25seSB8fCByZWNlaXZlZAogICAgICB9OwogICAgfQogIH0sCiAgY29tbWVudHM6IHsKICAgIHR5cGU6IFRleHRGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5jb21tZW50cy5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ0NvbW1lbnRzJywKICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmNykgewogICAgICB2YXIgcmVjZWl2ZWQgPSBfcmVmNy5yZWNlaXZlZCwKICAgICAgICBzaG93T25seSA9IF9yZWY3LnNob3dPbmx5OwogICAgICByZXR1cm4gewogICAgICAgIGRpc2FibGVkOiBzaG93T25seSB8fCByZWNlaXZlZAogICAgICB9OwogICAgfQogIH0sCiAgZXhwZWN0ZWREZWxpdmVyeURhdGU6IHsKICAgIHR5cGU6IERhdGVGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5leHBlY3RlZERlbGl2ZXJ5RGF0ZS5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ0V4cGVjdGVkIHJlY2VpcHQgZGF0ZScsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGRhdGVGb3JtYXQ6ICdNTS9ERC9ZWVlZJywKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIHNob3dUaW1lU2VsZWN0OiBmYWxzZSwKICAgICAgYXV0b0NvbXBsZXRlOiAnb2ZmJwogICAgfQogIH0KfTsKdmFyIFNVUFBMSUVSX0ZJRUxEUyA9IHsKICB0YWJsZUl0ZW1zOiB7CiAgICB0eXBlOiBBcnJheUZpZWxkLAogICAgdmlydHVhbGl6ZWQ6IHRydWUsCiAgICB0b3RhbENvdW50OiBmdW5jdGlvbiB0b3RhbENvdW50KF9yZWY4KSB7CiAgICAgIHZhciBfdG90YWxDb3VudCA9IF9yZWY4LnRvdGFsQ291bnQ7CiAgICAgIHJldHVybiBfdG90YWxDb3VudDsKICAgIH0sCiAgICBpc1Jvd0xvYWRlZDogZnVuY3Rpb24gaXNSb3dMb2FkZWQoX3JlZjkpIHsKICAgICAgdmFyIF9pc1Jvd0xvYWRlZCA9IF9yZWY5LmlzUm93TG9hZGVkOwogICAgICByZXR1cm4gX2lzUm93TG9hZGVkOwogICAgfSwKICAgIGxvYWRNb3JlUm93czogZnVuY3Rpb24gbG9hZE1vcmVSb3dzKF9yZWYxMCkgewogICAgICB2YXIgX2xvYWRNb3JlUm93cyA9IF9yZWYxMC5sb2FkTW9yZVJvd3M7CiAgICAgIHJldHVybiBfbG9hZE1vcmVSb3dzKCk7CiAgICB9LAogICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IGZ1bmN0aW9uIGlzRmlyc3RQYWdlTG9hZGVkKF9yZWYxMSkgewogICAgICB2YXIgX2lzRmlyc3RQYWdlTG9hZGVkID0gX3JlZjExLmlzRmlyc3RQYWdlTG9hZGVkOwogICAgICByZXR1cm4gX2lzRmlyc3RQYWdlTG9hZGVkOwogICAgfSwKICAgIGZpZWxkczogewogICAgICBwYWxsZXROYW1lOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucGFja0xldmVsMS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdQYWNrIGxldmVsIDEnLAogICAgICAgIGZsZXhXaWR0aDogJzMnLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTIpIHsKICAgICAgICAgIHZhciBpc1BhbGxldE5hbWVFbXB0eSA9IF9yZWYxMi5pc1BhbGxldE5hbWVFbXB0eTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGhpZGU6IGlzUGFsbGV0TmFtZUVtcHR5CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgYm94TmFtZTogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnBhY2tMZXZlbDIubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUGFjayBsZXZlbCAyJywKICAgICAgICBmbGV4V2lkdGg6ICczJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjEzKSB7CiAgICAgICAgICB2YXIgaXNCb3hOYW1lRW1wdHkgPSBfcmVmMTMuaXNCb3hOYW1lRW1wdHk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBoaWRlOiBpc0JveE5hbWVFbXB0eQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHByb2R1Y3RDb2RlOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29kZS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDb2RlJywKICAgICAgICBmbGV4V2lkdGg6ICczLjUnCiAgICAgIH0sCiAgICAgIHByb2R1Y3Q6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5wcm9kdWN0LmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1Byb2R1Y3QnLAogICAgICAgIGhlYWRlckFsaWduOiAnbGVmdCcsCiAgICAgICAgZmxleFdpZHRoOiAnNycsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYxNCkgewogICAgICAgICAgdmFyIF9maWVsZFZhbHVlJGRpc3BsYXlOYTsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjE0LmZpZWxkVmFsdWUsCiAgICAgICAgICAgIGlzQm94TmFtZUVtcHR5ID0gX3JlZjE0LmlzQm94TmFtZUVtcHR5LAogICAgICAgICAgICBpc1BhbGxldE5hbWVFbXB0eSA9IF9yZWYxNC5pc1BhbGxldE5hbWVFbXB0eTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNob3dWYWx1ZVRvb2x0aXA6ICEhKGZpZWxkVmFsdWUgIT09IG51bGwgJiYgZmllbGRWYWx1ZSAhPT0gdm9pZCAwICYmIChfZmllbGRWYWx1ZSRkaXNwbGF5TmEgPSBmaWVsZFZhbHVlLmRpc3BsYXlOYW1lcykgIT09IG51bGwgJiYgX2ZpZWxkVmFsdWUkZGlzcGxheU5hICE9PSB2b2lkIDAgJiYgX2ZpZWxkVmFsdWUkZGlzcGxheU5hWyJkZWZhdWx0Il0pLAogICAgICAgICAgICB0b29sdGlwVmFsdWU6IGZpZWxkVmFsdWUgPT09IG51bGwgfHwgZmllbGRWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGRWYWx1ZS5uYW1lLAogICAgICAgICAgICBmbGV4V2lkdGg6IDcgKyAoaXNCb3hOYW1lRW1wdHkgPyAzIDogMCkgKyAoaXNQYWxsZXROYW1lRW1wdHkgPyAzIDogMCkKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBjbGFzc05hbWU6ICd0ZXh0LWxlZnQnLAogICAgICAgICAgZm9ybWF0VmFsdWU6IGZvcm1hdFByb2R1Y3REaXNwbGF5TmFtZQogICAgICAgIH0KICAgICAgfSwKICAgICAgbG90TnVtYmVyOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQubG90LmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0xvdCcsCiAgICAgICAgZmxleFdpZHRoOiAnMy41JwogICAgICB9LAogICAgICBleHBpcmF0aW9uRGF0ZTogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmV4cGlyeS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFeHBpcnknLAogICAgICAgIGZsZXhXaWR0aDogJzMuNScKICAgICAgfSwKICAgICAgcXVhbnRpdHlSZXF1ZXN0ZWQ6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGZpeGVkV2lkdGg6ICcxNTBweCcsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnF1YW50aXR5UGlja2VkLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1F0eSBQaWNrZWQnCiAgICAgIH0sCiAgICAgICdyZWNpcGllbnQubmFtZSc6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZWNpcGllbnQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVjaXBpZW50JywKICAgICAgICBmbGV4V2lkdGg6ICczLjUnCiAgICAgIH0KICAgIH0KICB9Cn07CgovKioKICogVGhlIGxhc3Qgc3RlcCBvZiBzdG9jayBtb3ZlbWVudCB3aGVyZSB1c2VyIGNhbiBzZWUgdGhlIHdob2xlIG1vdmVtZW50LAogKiBwcmludCBkb2N1bWVudHMsIHVwbG9hZCBkb2N1bWVudHMsIGFkZCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFuZCBzZW5kIGl0LgogKi8KdmFyIFNlbmRNb3ZlbWVudFBhZ2UgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoU2VuZE1vdmVtZW50UGFnZSwgX0NvbXBvbmVudCk7CiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihTZW5kTW92ZW1lbnRQYWdlKTsKICBmdW5jdGlvbiBTZW5kTW92ZW1lbnRQYWdlKHByb3BzKSB7CiAgICB2YXIgX3RoaXM7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2VuZE1vdmVtZW50UGFnZSk7CiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKTsKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRhdGFGZXRjaGVkIiwgZmFsc2UpOwogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIHNoaXBtZW50VHlwZXM6IFtdLAogICAgICBkb2N1bWVudHM6IFtdLAogICAgICBmaWxlczogW10sCiAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5wcm9wcy5pbml0aWFsVmFsdWVzKSwge30sIHsKICAgICAgICB0YWJsZUl0ZW1zOiBbXQogICAgICB9KSwKICAgICAgdG90YWxDb3VudDogMCwKICAgICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IGZhbHNlCiAgICB9OwogICAgX3RoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgIF90aGlzLm9uRHJvcCA9IF90aGlzLm9uRHJvcC5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmlzUm93TG9hZGVkID0gX3RoaXMuaXNSb3dMb2FkZWQuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5sb2FkTW9yZVJvd3MgPSBfdGhpcy5sb2FkTW9yZVJvd3MuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy50b2dnbGVEcm9wZG93biA9IF90aGlzLnRvZ2dsZURyb3Bkb3duLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMudmFsaWRhdGUgPSBfdGhpcy52YWxpZGF0ZS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmRlYm91bmNlZExvY2F0aW9uc0ZldGNoID0gZGVib3VuY2VMb2NhdGlvbnNGZXRjaChfdGhpcy5wcm9wcy5kZWJvdW5jZVRpbWUsIF90aGlzLnByb3BzLm1pblNlYXJjaExlbmd0aCk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQogIF9jcmVhdGVDbGFzcyhTZW5kTW92ZW1lbnRQYWdlLCBbewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIGlmICh0aGlzLnByb3BzLnN0b2NrTW92ZW1lbnRUcmFuc2xhdGlvbnNGZXRjaGVkKSB7CiAgICAgICAgdGhpcy5kYXRhRmV0Y2hlZCA9IHRydWU7CiAgICAgICAgdGhpcy5mZXRjaFN0b2NrTW92ZW1lbnREYXRhKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykgewogICAgICBpZiAobmV4dFByb3BzLnN0b2NrTW92ZW1lbnRUcmFuc2xhdGlvbnNGZXRjaGVkICYmICF0aGlzLmRhdGFGZXRjaGVkKSB7CiAgICAgICAgdGhpcy5kYXRhRmV0Y2hlZCA9IHRydWU7CiAgICAgICAgdGhpcy5mZXRjaFN0b2NrTW92ZW1lbnREYXRhKCk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZXMgZmlsZXMnIGFycmF5IGFmdGVyIGRyb3BwaW5nIHRoZW0gdG8gZHJvcHpvbmUgYXJlYS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBuZXdGaWxlcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAib25Ecm9wIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkRyb3AobmV3RmlsZXMpIHsKICAgICAgdmFyIGZpbGVzID0gdGhpcy5zdGF0ZS5maWxlczsKICAgICAgdmFyIGRpZmZlcmVuY2UgPSBfLmRpZmZlcmVuY2VCeShmaWxlcywgbmV3RmlsZXMsICduYW1lJyk7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIGZpbGVzOiBfLmNvbmNhdChkaWZmZXJlbmNlLCBuZXdGaWxlcykKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAib25TYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblNhdmUodmFsdWVzKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHRoaXMuc2F2ZVZhbHVlcyh2YWx1ZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIGlmICh2YWx1ZXMuc3RhdHVzQ29kZSA9PT0gJ0lTU1VFRCcpIHsKICAgICAgICAgIF90aGlzMi5mZXRjaFN0b2NrTW92ZW1lbnREYXRhKCk7CiAgICAgICAgfQogICAgICAgIEFsZXJ0LnN1Y2Nlc3MoX3RoaXMyLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5hbGVydC5zYXZlU3VjY2Vzcy5sYWJlbCcsICdDaGFuZ2VzIHNhdmVkIHN1Y2Nlc3NmdWxseScpLCB7CiAgICAgICAgICB0aW1lb3V0OiAzMDAwCiAgICAgICAgfSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInNhdmVWYWx1ZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmVWYWx1ZXModmFsdWVzKSB7CiAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgICdkZXN0aW5hdGlvbi5pZCc6IHZhbHVlcy5kZXN0aW5hdGlvbi5pZCwKICAgICAgICBkYXRlU2hpcHBlZDogdmFsdWVzLmRhdGVTaGlwcGVkLAogICAgICAgICdzaGlwbWVudFR5cGUuaWQnOiB2YWx1ZXMuc2hpcG1lbnRUeXBlLmlkLAogICAgICAgIHRyYWNraW5nTnVtYmVyOiB2YWx1ZXMudHJhY2tpbmdOdW1iZXIgfHwgJycsCiAgICAgICAgZHJpdmVyTmFtZTogdmFsdWVzLmRyaXZlck5hbWUgfHwgJycsCiAgICAgICAgY29tbWVudHM6IHZhbHVlcy5jb21tZW50cyB8fCAnJywKICAgICAgICBleHBlY3RlZERlbGl2ZXJ5RGF0ZTogdmFsdWVzLmV4cGVjdGVkRGVsaXZlcnlEYXRlIHx8ICcnCiAgICAgIH07CiAgICAgIHJldHVybiB0aGlzLnNhdmVTaGlwbWVudChwYXlsb2FkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBmaWxlIGJ5IG5hbWUgZnJvbSBmaWxlcyBhcnJheQogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInJlbW92ZUZpbGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUZpbGUobmFtZSkgewogICAgICB2YXIgZmlsZXMgPSB0aGlzLnN0YXRlLmZpbGVzOwogICAgICBfLnJlbW92ZShmaWxlcywgZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICByZXR1cm4gZmlsZS5uYW1lID09PSBuYW1lOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmlsZXM6IGZpbGVzCiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGJ1bGsgb2YgZmlsZXMgYnkgbmFtZSBmcm9tIGZpbGVzIGFycmF5CiAgICAgKiBAcGFyYW0ge0FycmF5fSBuYW1lcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAicmVtb3ZlRmlsZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUZpbGVzKG5hbWVzKSB7CiAgICAgIHZhciBmaWxlcyA9IHRoaXMuc3RhdGUuZmlsZXM7CiAgICAgIF8uZm9yRWFjaChuYW1lcywgZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICBfLnJlbW92ZShmaWxlcywgZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICAgIHJldHVybiBmaWxlLm5hbWUgPT09IG5hbWU7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBmaWxlczogZmlsZXMKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGZXRjaGVzIGF2YWlsYWJsZSBzaGlwbWVudCB0eXBlcyBmcm9tIEFQSS4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImZldGNoU2hpcG1lbnRUeXBlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hTaGlwbWVudFR5cGVzKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgdmFyIHVybCA9ICcvb3BlbmJveGVzL2FwaS9nZW5lcmljL3NoaXBtZW50VHlwZSc7CiAgICAgIHJldHVybiBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgc2hpcG1lbnRUeXBlcyA9IF8ubWFwKHJlc3BvbnNlLmRhdGEuZGF0YSwgZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgIHZhciBfJHNwbGl0ID0gXy5zcGxpdCh0eXBlLm5hbWUsICd8ZnI6JyksCiAgICAgICAgICAgIF8kc3BsaXQyID0gX3NsaWNlZFRvQXJyYXkoXyRzcGxpdCwgMiksCiAgICAgICAgICAgIGVuID0gXyRzcGxpdDJbMF0sCiAgICAgICAgICAgIGZyID0gXyRzcGxpdDJbMV07CiAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB0eXBlKSwge30sIHsKICAgICAgICAgICAgbGFiZWw6IF90aGlzMy5wcm9wcy5sb2NhbGUgPT09ICdmcicgJiYgZnIgPyBmciA6IGVuCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBfdGhpczMuc2V0U3RhdGUoewogICAgICAgICAgc2hpcG1lbnRUeXBlczogc2hpcG1lbnRUeXBlcwogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczMucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczMucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZmV0Y2hTdG9ja01vdmVtZW50SXRlbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoU3RvY2tNb3ZlbWVudEl0ZW1zKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvc3RvY2tNb3ZlbWVudEl0ZW1zP3N0ZXBOdW1iZXI9NiIpOwogICAgICBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICB2YXIgdGFibGVJdGVtcyA9IGRhdGE7CiAgICAgICAgX3RoaXM0LnNldFN0YXRlKHsKICAgICAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpczQuc3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgICAgdGFibGVJdGVtczogdGFibGVJdGVtcwogICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAibG9hZE1vcmVSb3dzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkTW9yZVJvd3MoX3JlZjE1KSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwogICAgICB2YXIgc3RhcnRJbmRleCA9IF9yZWYxNS5zdGFydEluZGV4OwogICAgICBpZiAodGhpcy5zdGF0ZS50b3RhbENvdW50KSB7CiAgICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvc3RvY2tNb3ZlbWVudEl0ZW1zP29mZnNldD0iKS5jb25jYXQoc3RhcnRJbmRleCwgIiZtYXg9IikuY29uY2F0KHRoaXMucHJvcHMucGFnZVNpemUsICImc3RlcE51bWJlcj02Iik7CiAgICAgICAgYXBpQ2xpZW50LmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgIHZhciB0YWJsZUl0ZW1zRGF0YSA9IF8ubWFwKGRhdGEsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdmFsKSwge30sIHsKICAgICAgICAgICAgICBwcm9kdWN0TmFtZTogdmFsLnByb2R1Y3ROYW1lID8gdmFsLnByb2R1Y3ROYW1lIDogdmFsLnByb2R1Y3QubmFtZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXM1LnNldFN0YXRlKHsKICAgICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzNS5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgICAgICAgIHRhYmxlSXRlbXM6IF8udW5pcUJ5KF8uY29uY2F0KF90aGlzNS5zdGF0ZS52YWx1ZXMudGFibGVJdGVtcywgdGFibGVJdGVtc0RhdGEpLCAnaWQnKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IHRydWUKICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKF90aGlzNS5zdGF0ZS52YWx1ZXMudGFibGVJdGVtcy5sZW5ndGggIT09IF90aGlzNS5zdGF0ZS50b3RhbENvdW50KSB7CiAgICAgICAgICAgICAgX3RoaXM1LmxvYWRNb3JlUm93cyh7CiAgICAgICAgICAgICAgICBzdGFydEluZGV4OiBzdGFydEluZGV4ICsgX3RoaXM1LnByb3BzLnBhZ2VTaXplCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNSb3dMb2FkZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzUm93TG9hZGVkKF9yZWYxNikgewogICAgICB2YXIgaW5kZXggPSBfcmVmMTYuaW5kZXg7CiAgICAgIHJldHVybiAhIXRoaXMuc3RhdGUudmFsdWVzLnRhYmxlSXRlbXNbaW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogRmV0Y2hlcyA1dGggc3RlcCBkYXRhIGZyb20gY3VycmVudCBzdG9jayBtb3ZlbWVudC4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImZldGNoU3RvY2tNb3ZlbWVudERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoU3RvY2tNb3ZlbWVudERhdGEoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIj9zdGVwTnVtYmVyPTYiKTsKICAgICAgcmV0dXJuIGFwaUNsaWVudC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIHZhciBzdG9ja01vdmVtZW50RGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICB2YXIgYXNzb2NpYXRpb25zID0gcmVzcG9uc2UuZGF0YS5kYXRhLmFzc29jaWF0aW9uczsKICAgICAgICB2YXIgdG90YWxDb3VudCA9IHJlc3BvbnNlLmRhdGEudG90YWxDb3VudDsKICAgICAgICB2YXIgZG9jdW1lbnRzID0gXy5maWx0ZXIoYXNzb2NpYXRpb25zLmRvY3VtZW50cywgZnVuY3Rpb24gKGRvYykgewogICAgICAgICAgcmV0dXJuIGRvYy5zdGVwTnVtYmVyID09PSA1OwogICAgICAgIH0pOwogICAgICAgIHZhciBkZXN0aW5hdGlvblR5cGUgPSBzdG9ja01vdmVtZW50RGF0YS5kZXN0aW5hdGlvbi5sb2NhdGlvblR5cGU7CiAgICAgICAgX3RoaXM2LnNldFN0YXRlKHsKICAgICAgICAgIGRvY3VtZW50czogZG9jdW1lbnRzLAogICAgICAgICAgdG90YWxDb3VudDogdG90YWxDb3VudCwKICAgICAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpczYuc3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgICAgZGF0ZVNoaXBwZWQ6IHN0b2NrTW92ZW1lbnREYXRhLmRhdGVTaGlwcGVkLAogICAgICAgICAgICBzaGlwbWVudFR5cGU6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc3RvY2tNb3ZlbWVudERhdGEuc2hpcG1lbnRUeXBlKSwge30sIHsKICAgICAgICAgICAgICBsYWJlbDogc3BsaXRUcmFuc2xhdGlvbihzdG9ja01vdmVtZW50RGF0YS5zaGlwbWVudFR5cGUubmFtZSwgX3RoaXM2LnByb3BzLmxvY2FsZSkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHRyYWNraW5nTnVtYmVyOiBzdG9ja01vdmVtZW50RGF0YS50cmFja2luZ051bWJlciwKICAgICAgICAgICAgZHJpdmVyTmFtZTogc3RvY2tNb3ZlbWVudERhdGEuZHJpdmVyTmFtZSwKICAgICAgICAgICAgY29tbWVudHM6IHN0b2NrTW92ZW1lbnREYXRhLmNvbW1lbnRzLAogICAgICAgICAgICBleHBlY3RlZERlbGl2ZXJ5RGF0ZTogc3RvY2tNb3ZlbWVudERhdGEuZXhwZWN0ZWREZWxpdmVyeURhdGUsCiAgICAgICAgICAgIC8vIEJlbG93IHZhbHVlcyBhcmUgcmVhc3NpZ25lZCBpbiBjYXNlIG9mIGVkaXRpbmcgZGVzdGluYXRpb24gb3IgZGVzY3JpcHRpb24KICAgICAgICAgICAgbmFtZTogc3RvY2tNb3ZlbWVudERhdGEubmFtZSwKICAgICAgICAgICAgZGVzY3JpcHRpb246IHN0b2NrTW92ZW1lbnREYXRhLmRlc2NyaXB0aW9uLAogICAgICAgICAgICBkZXN0aW5hdGlvbjogewogICAgICAgICAgICAgIGlkOiBzdG9ja01vdmVtZW50RGF0YS5kZXN0aW5hdGlvbi5pZCwKICAgICAgICAgICAgICB0eXBlOiBkZXN0aW5hdGlvblR5cGUgPyBkZXN0aW5hdGlvblR5cGUubG9jYXRpb25UeXBlQ29kZSA6IG51bGwsCiAgICAgICAgICAgICAgbmFtZTogc3RvY2tNb3ZlbWVudERhdGEuZGVzdGluYXRpb24ubmFtZSwKICAgICAgICAgICAgICBsYWJlbDogIiIuY29uY2F0KHN0b2NrTW92ZW1lbnREYXRhLmRlc3RpbmF0aW9uLm5hbWUsICJcbiAgICAgICAgICAgICAgICBbIikuY29uY2F0KGRlc3RpbmF0aW9uVHlwZSA/IGRlc3RpbmF0aW9uVHlwZS5kZXNjcmlwdGlvbiA6IG51bGwsICJdIikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2hpcG1lbnRTdGF0dXM6IHN0b2NrTW92ZW1lbnREYXRhLnNoaXBtZW50U3RhdHVzCiAgICAgICAgICB9KQogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNi5wcm9wcy5uZXh0UGFnZShfdGhpczYuc3RhdGUudmFsdWVzKTsKICAgICAgICAgIF90aGlzNi5mZXRjaFNoaXBtZW50VHlwZXMoKTsKICAgICAgICAgIGlmICghX3RoaXM2LnByb3BzLmlzUGFnaW5hdGVkKSB7CiAgICAgICAgICAgIF90aGlzNi5mZXRjaFN0b2NrTW92ZW1lbnRJdGVtcygpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzNi5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmRzIGZpbGVzIHVwbG9hZGVkIGJ5IHVzZXIgdG8gYmFja2VuZC4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmaWxlCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzZW5kRmlsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZEZpbGUoZmlsZSkgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC91cGxvYWREb2N1bWVudC8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICB2YXIgZGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBkYXRhLmFwcGVuZCgnZmlsZUNvbnRlbnRzJywgZmlsZSk7CiAgICAgIHJldHVybiBhcGlDbGllbnQucG9zdCh1cmwsIGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogQnVsayBzZW5kIG9mIGZpbGVzIHVwbG9hZGVkIGJ5IHVzZXIgdG8gYmFja2VuZC4KICAgICAqIEBwYXJhbSB7QXJyYXl9IGZpbGVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzZW5kRmlsZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRGaWxlcyhmaWxlcykgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC91cGxvYWREb2N1bWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkKTsKICAgICAgdmFyIGRhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgXy5mb3JFYWNoKGZpbGVzLCBmdW5jdGlvbiAoZmlsZSwgaWR4KSB7CiAgICAgICAgZGF0YS5hcHBlbmQoImZpbGVzQ29udGVudHNbIi5jb25jYXQoaWR4LCAiXSIpLCBmaWxlKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBhcGlDbGllbnQucG9zdCh1cmwsIGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgZGF0YSB3aXRoIHNoaXBtZW50IGRldGFpbHMuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gcGF5bG9hZAogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZVNoaXBtZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlU2hpcG1lbnQocGF5bG9hZCkgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi91cGRhdGVTaGlwbWVudCIpOwogICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QodXJsLCBwYXlsb2FkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZXMgc3RvY2sgbW92ZW1lbnQgc3RhdHVzIHRvIElTU1VFRCB3aXRoIHBvc3QgbWV0aG9kLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic3RhdGVUcmFuc2l0aW9uVG9Jc3N1ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN0YXRlVHJhbnNpdGlvblRvSXNzdWVkKCkgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi9zdGF0dXMiKTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgc3RhdHVzOiAnSVNTVUVEJwogICAgICB9OwogICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QodXJsLCBwYXlsb2FkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVwbG9hZHMgZmlsZXMgYW5kIHNlbmRzIHRoZSB3aG9sZSBzdG9jayBtb3ZlbWVudC4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNlbmRGaWxlc0FuZFNhdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRGaWxlc0FuZFNhdmUodmFsdWVzKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwogICAgICB2YXIgZXJyb3JzID0gdGhpcy52YWxpZGF0ZSh2YWx1ZXMpOwogICAgICBpZiAoXy5pc0VtcHR5KGVycm9ycykpIHsKICAgICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgICAgdmFyIGZpbGVzID0gdGhpcy5zdGF0ZS5maWxlczsKICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID4gMSkgewogICAgICAgICAgdGhpcy5zZW5kRmlsZXMoZmlsZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBBbGVydC5zdWNjZXNzKF90aGlzNy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuYWxlcnQuZmlsZXNTdWNjZXNzLmxhYmVsJywgJ0ZpbGVzIHVwbG9hZGVkIHN1Y2Nlc3NmdWx5IScpLCB7CiAgICAgICAgICAgICAgdGltZW91dDogMzAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3RoaXM3LnJlbW92ZUZpbGVzKF8ubWFwKGZpbGVzLCBmdW5jdGlvbiAoZmlsZSkgewogICAgICAgICAgICAgIHJldHVybiBmaWxlLm5hbWU7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgX3RoaXM3LnByZXBhcmVSZXF1ZXN0QW5kU3VibWl0U3RvY2tNb3ZlbWVudCh2YWx1ZXMpOwogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gQWxlcnQuZXJyb3IoX3RoaXM3LnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5hbGVydC5maWxlc0Vycm9yLmxhYmVsJywgJ0Vycm9yIG9jY3VyZWQgZHVyaW5nIGZpbGVzIHVwbG9hZCEnKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGZpbGVzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgdGhpcy5zZW5kRmlsZShmaWxlc1swXSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIEFsZXJ0LnN1Y2Nlc3MoX3RoaXM3LnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5hbGVydC5maWxlU3VjY2Vzcy5sYWJlbCcsICdGaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWx5IScpLCB7CiAgICAgICAgICAgICAgdGltZW91dDogMzAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3RoaXM3LnJlbW92ZUZpbGUoZmlsZXNbMF0ubmFtZSk7CiAgICAgICAgICAgIF90aGlzNy5wcmVwYXJlUmVxdWVzdEFuZFN1Ym1pdFN0b2NrTW92ZW1lbnQodmFsdWVzKTsKICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIEFsZXJ0LmVycm9yKF90aGlzNy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuYWxlcnQuZmlsZUVycm9yLmxhYmVsJywgJ0Vycm9yIG9jY3VyZWQgZHVyaW5nIGZpbGUgdXBsb2FkIScpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnByZXBhcmVSZXF1ZXN0QW5kU3VibWl0U3RvY2tNb3ZlbWVudCh2YWx1ZXMpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInByZXBhcmVSZXF1ZXN0QW5kU3VibWl0U3RvY2tNb3ZlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJlcGFyZVJlcXVlc3RBbmRTdWJtaXRTdG9ja01vdmVtZW50KHZhbHVlcykgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgJ2Rlc3RpbmF0aW9uLmlkJzogdmFsdWVzLmRlc3RpbmF0aW9uLmlkLAogICAgICAgIGRhdGVTaGlwcGVkOiB2YWx1ZXMuZGF0ZVNoaXBwZWQsCiAgICAgICAgJ3NoaXBtZW50VHlwZS5pZCc6IHZhbHVlcy5zaGlwbWVudFR5cGUuaWQsCiAgICAgICAgdHJhY2tpbmdOdW1iZXI6IHZhbHVlcy50cmFja2luZ051bWJlciB8fCAnJywKICAgICAgICBkcml2ZXJOYW1lOiB2YWx1ZXMuZHJpdmVyTmFtZSB8fCAnJywKICAgICAgICBjb21tZW50czogdmFsdWVzLmNvbW1lbnRzIHx8ICcnLAogICAgICAgIGV4cGVjdGVkRGVsaXZlcnlEYXRlOiB2YWx1ZXMuZXhwZWN0ZWREZWxpdmVyeURhdGUgfHwgJycKICAgICAgfTsKICAgICAgaWYgKHRoaXMucHJvcHMuY3VycmVudExvY2F0aW9uSWQgIT09IHZhbHVlcy5vcmlnaW4uaWQgJiYgdmFsdWVzLm9yaWdpbi50eXBlICE9PSAnU1VQUExJRVInICYmIHZhbHVlcy5oYXNNYW5hZ2VJbnZlbnRvcnkpIHsKICAgICAgICBBbGVydC5lcnJvcih0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5hbGVydC5zZW5kU3RvY2tNb3ZlbWVudC5sYWJlbCcsICdZb3UgYXJlIG5vdCBhYmxlIHRvIHNlbmQgc2hpcG1lbnQgZnJvbSBhIGxvY2F0aW9uIG90aGVyIHRoYW4gb3JpZ2luLiBDaGFuZ2UgeW91ciBjdXJyZW50IGxvY2F0aW9uLicpKTsKICAgICAgICB0aGlzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWVzLnNoaXBtZW50VHlwZS5pZCA9PT0gXy5maW5kKHRoaXMuc3RhdGUuc2hpcG1lbnRUeXBlcywgZnVuY3Rpb24gKHNoaXBtZW50VHlwZSkgewogICAgICAgIHJldHVybiBzaGlwbWVudFR5cGUubGFiZWwgPT09ICdEZWZhdWx0JzsKICAgICAgfSkuaWQpIHsKICAgICAgICBBbGVydC5lcnJvcih0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5hbGVydC5wb3B1bGF0ZVNoaXBtZW50VHlwZS5sYWJlbCcsICdQbGVhc2UgcG9wdWxhdGUgc2hpcG1lbnQgdHlwZSBiZWZvcmUgY29udGludWluZycpKTsKICAgICAgICB0aGlzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zYXZlU2hpcG1lbnQocGF5bG9hZCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczguc3RhdGVUcmFuc2l0aW9uVG9Jc3N1ZWQoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9zaG93LyIuY29uY2F0KF90aGlzOC5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkKTsKICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgICAgfSk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzOC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjaGFuZ2VzIG1hZGUgYnkgdXNlciBpbiB0aGlzIHN0ZXAgYW5kIGdvIGJhY2sgdG8gcHJldmlvdXMgcGFnZQogICAgICogQHBhcmFtIHtvYmplY3R9IHZhbHVlcwogICAgICogQHBhcmFtIHtib29sZWFufSBpbnZhbGlkCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJwcmV2aW91c1BhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByZXZpb3VzUGFnZSh2YWx1ZXMsIGludmFsaWQpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CiAgICAgIGlmICghaW52YWxpZCkgewogICAgICAgIHRoaXMuc2F2ZVZhbHVlcyh2YWx1ZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzOS5wcm9wcy5wcmV2aW91c1BhZ2UodmFsdWVzKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25maXJtQWxlcnQoewogICAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1QcmV2aW91c1BhZ2UubGFiZWwnLCAnVmFsaWRhdGlvbiBlcnJvcicpLAogICAgICAgICAgbWVzc2FnZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVByZXZpb3VzUGFnZS5tZXNzYWdlLmxhYmVsJywgJ0Nhbm5vdCBzYXZlIGR1ZSB0byB2YWxpZGF0aW9uIGVycm9yIG9uIHBhZ2UnKSwKICAgICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUHJldmlvdXNQYWdlLmNvcnJlY3RFcnJvci5sYWJlbCcsICdDb3JyZWN0IGVycm9yJykKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1QcmV2aW91c1BhZ2UuY29udGludWUubGFiZWwnLCAnQ29udGludWUgKGxvc2UgdW5zYXZlZCB3b3JrKScpLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczkucHJvcHMucHJldmlvdXNQYWdlKHZhbHVlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGNoYW5nZXMgbWFkZSBieSB1c2VyIGluIHRoaXMgc3RlcCBhbmQgcmVkaXJlY3RzIHRvIHRoZSBzaGlwbWVudCB2aWV3IHBhZ2UKICAgICAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVBbmRFeGl0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlQW5kRXhpdCh2YWx1ZXMpIHsKICAgICAgdmFyIGVycm9ycyA9IHRoaXMudmFsaWRhdGUodmFsdWVzKTsKICAgICAgaWYgKF8uaXNFbXB0eShlcnJvcnMpKSB7CiAgICAgICAgdGhpcy5zYXZlVmFsdWVzKHZhbHVlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAiL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L3Nob3cvIi5jb25jYXQodmFsdWVzLnN0b2NrTW92ZW1lbnRJZCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtRXhpdC5sYWJlbCcsICdDb25maXJtIHNhdmUnKSwKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1FeGl0Lm1lc3NhZ2UnLCAnVmFsaWRhdGlvbiBlcnJvcnMgb2NjdXJyZWQuIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBleGl0IGFuZCBsb3NlIHVuc2F2ZWQgZGF0YT8nKSwKICAgICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC55ZXMubGFiZWwnLCAnWWVzJyksCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9zaG93LyIuY29uY2F0KHZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgICB9XQogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSb2xsYmFjayBzdG9jayBtb3ZlbWVudCBpZiBpdCBoYXMgYmVlbiBzaGlwcGVkCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyb2xsYmFja1N0b2NrTW92ZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvbGxiYWNrU3RvY2tNb3ZlbWVudCh2YWx1ZXMpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3N0YXR1cyIpOwogICAgICB2YXIgcGF5bG9hZCA9IHsKICAgICAgICByb2xsYmFjazogdHJ1ZQogICAgICB9OwogICAgICB2YXIgaXNPcmlnaW4gPSB0aGlzLnByb3BzLmN1cnJlbnRMb2NhdGlvbklkID09PSB2YWx1ZXMub3JpZ2luLmlkOwogICAgICB2YXIgaXNEZXN0aW5hdGlvbiA9IHRoaXMucHJvcHMuY3VycmVudExvY2F0aW9uSWQgPT09IHZhbHVlcy5kZXN0aW5hdGlvbi5pZDsKICAgICAgaWYgKHZhbHVlcy5oYXNNYW5hZ2VJbnZlbnRvcnkgJiYgaXNPcmlnaW4gfHwgIXZhbHVlcy5oYXNNYW5hZ2VJbnZlbnRvcnkgJiYgaXNEZXN0aW5hdGlvbiB8fCB0aGlzLnByb3BzLmhhc0NlbnRyYWxQdXJjaGFzaW5nRW5hYmxlZCkgewogICAgICAgIGFwaUNsaWVudFsiZGVsZXRlIl0odXJsLCBwYXlsb2FkKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMTAucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgQWxlcnQuZXJyb3IodGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuYWxlcnQucm9sbGJhY2tTaGlwbWVudC5sYWJlbCcsICdZb3UgYXJlIG5vdCBhYmxlIHRvIHJvbGxiYWNrIHNoaXBtZW50IGZyb20geW91ciBsb2NhdGlvbi4nKSk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRvZ2dsZSB0aGUgZG93bmxvYWRhYmxlIGZpbGVzCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJ0b2dnbGVEcm9wZG93biIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIGlzRHJvcGRvd25WaXNpYmxlOiAhdGhpcy5zdGF0ZS5pc0Ryb3Bkb3duVmlzaWJsZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmFsaWRhdGUodmFsdWVzKSB7CiAgICAgIHZhciBlcnJvcnMgPSB7fTsKICAgICAgdmFyIGRhdGUgPSBtb21lbnQodGhpcy5wcm9wcy5taW5pbXVtRXhwaXJhdGlvbkRhdGUsICdNTS9ERC9ZWVlZJyk7CiAgICAgIHZhciBkYXRlU2hpcHBlZCA9IG1vbWVudCh2YWx1ZXMuZGF0ZVNoaXBwZWQsICdNTS9ERC9ZWVlZJyk7CiAgICAgIHZhciBleHBlY3RlZERlbGl2ZXJ5RGF0ZSA9IG1vbWVudCh2YWx1ZXMuZXhwZWN0ZWREZWxpdmVyeURhdGUsICdNTS9ERC9ZWVlZJyk7CiAgICAgIGlmIChkYXRlLmRpZmYoZGF0ZVNoaXBwZWQpID4gMCkgewogICAgICAgIGVycm9ycy5kYXRlU2hpcHBlZCA9ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmludmFsaWREYXRlLmxhYmVsJzsKICAgICAgfQogICAgICBpZiAoIXZhbHVlcy5kYXRlU2hpcHBlZCkgewogICAgICAgIGVycm9ycy5kYXRlU2hpcHBlZCA9ICdyZWFjdC5kZWZhdWx0LmVycm9yLnJlcXVpcmVkRmllbGQubGFiZWwnOwogICAgICB9CiAgICAgIGlmICghdmFsdWVzLnNoaXBtZW50VHlwZSkgewogICAgICAgIGVycm9ycy5zaGlwbWVudFR5cGUgPSAncmVhY3QuZGVmYXVsdC5lcnJvci5yZXF1aXJlZEZpZWxkLmxhYmVsJzsKICAgICAgfQogICAgICBpZiAoIXZhbHVlcy5leHBlY3RlZERlbGl2ZXJ5RGF0ZSkgewogICAgICAgIGVycm9ycy5leHBlY3RlZERlbGl2ZXJ5RGF0ZSA9ICdyZWFjdC5kZWZhdWx0LmVycm9yLnJlcXVpcmVkRmllbGQubGFiZWwnOwogICAgICB9CiAgICAgIGlmIChtb21lbnQoZGF0ZVNoaXBwZWQpLmRpZmYoZXhwZWN0ZWREZWxpdmVyeURhdGUpID4gMCkgewogICAgICAgIGVycm9ycy5leHBlY3RlZERlbGl2ZXJ5RGF0ZSA9ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmRlbGl2ZXJ5RGF0ZUJlZm9yZVNoaXBEYXRlLmxhYmVsJzsKICAgICAgICBlcnJvcnMuZGF0ZVNoaXBwZWQgPSAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5kZWxpdmVyeURhdGVCZWZvcmVTaGlwRGF0ZS5sYWJlbCc7CiAgICAgIH0KICAgICAgcmV0dXJuIGVycm9yczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwogICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEZvcm0sIHsKICAgICAgICBvblN1Ym1pdDogZnVuY3Rpb24gb25TdWJtaXQoKSB7fSwKICAgICAgICB2YWxpZGF0ZTogdGhpcy52YWxpZGF0ZSwKICAgICAgICBtdXRhdG9yczogX29iamVjdFNwcmVhZCh7fSwgYXJyYXlNdXRhdG9ycyksCiAgICAgICAgaW5pdGlhbFZhbHVlczogdGhpcy5zdGF0ZS52YWx1ZXMsCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoX3JlZjE3KSB7CiAgICAgICAgICB2YXIgaGFuZGxlU3VibWl0ID0gX3JlZjE3LmhhbmRsZVN1Ym1pdCwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjE3LnZhbHVlcywKICAgICAgICAgICAgaW52YWxpZCA9IF9yZWYxNy5pbnZhbGlkOwogICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJmb3JtIiwgewogICAgICAgICAgICBvblN1Ym1pdDogaGFuZGxlU3VibWl0CiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJjbGFzc2ljLWZvcm0gY2xhc3NpYy1mb3JtLWNvbmRlbnNlZCIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJidXR0b25zLWNvbnRhaW5lciBjbGFzc2ljLWZvcm0tYnV0dG9ucyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImRyb3B6b25lIGZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChEcm9wem9uZSwgewogICAgICAgICAgICBkaXNhYmxlZDogdmFsdWVzLnN0YXR1c0NvZGUgPT09ICdJU1NVRUQnLAogICAgICAgICAgICBvbkRyb3A6IF90aGlzMTEub25Ecm9wLAogICAgICAgICAgICBtdWx0aXBsZTogdHJ1ZQogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtdXBsb2FkIHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3Quc3RvY2tNb3ZlbWVudC51cGxvYWREb2N1bWVudHMubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlVwbG9hZCBEb2N1bWVudHMiCiAgICAgICAgICB9KSksIF8ubWFwKF90aGlzMTEuc3RhdGUuZmlsZXMsIGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgIGtleTogZmlsZS5uYW1lLAogICAgICAgICAgICAgIGNsYXNzTmFtZTogImNob3Nlbi1maWxlIGQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyIGFsaWduLWl0ZW1zLWNlbnRlciIKICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICJ0ZXh0LXRydW5jYXRlIgogICAgICAgICAgICB9LCBmaWxlLm5hbWUpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYSIsIHsKICAgICAgICAgICAgICBocmVmOiAiIyIsCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAicmVtb3ZlLWJ1dHRvbiIsCiAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljayhldmVudCkgewogICAgICAgICAgICAgICAgX3RoaXMxMS5yZW1vdmVGaWxlKGZpbGUubmFtZSk7CiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXJlbW92ZSIKICAgICAgICAgICAgfSkpKTsKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImRyb3Bkb3duIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIG9uQ2xpY2s6IF90aGlzMTEudG9nZ2xlRHJvcGRvd24sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImRyb3Bkb3duLWJ1dHRvbiBmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtc2lnbi1vdXQgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5kb3dubG9hZC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRG93bmxvYWQiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJkcm9wZG93bi1jb250ZW50IHByaW50LWJ1dHRvbnMtY29udGFpbmVyIGNvbC1tZC0zIGZsZXgtZ3Jvdy0xIFxuICAgICAgICAgICAgICAgICAgICAgICIuY29uY2F0KF90aGlzMTEuc3RhdGUuaXNEcm9wZG93blZpc2libGUgPyAndmlzaWJsZScgOiAnJykKICAgICAgICAgIH0sIF90aGlzMTEuc3RhdGUuZG9jdW1lbnRzLmxlbmd0aCAmJiBfLm1hcChfdGhpczExLnN0YXRlLmRvY3VtZW50cywgZnVuY3Rpb24gKGRvY3VtZW50LCBpZHgpIHsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmhpZGRlbikgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChEb2N1bWVudEJ1dHRvbiwgX2V4dGVuZHMoewogICAgICAgICAgICAgIGxpbms6IGRvY3VtZW50LnVyaSwKICAgICAgICAgICAgICBidXR0b25UaXRsZTogZG9jdW1lbnQubmFtZQogICAgICAgICAgICB9LCBkb2N1bWVudCwgewogICAgICAgICAgICAgIGtleTogaWR4LAogICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMS5zYXZlVmFsdWVzKHZhbHVlcyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczExLm9uU2F2ZSh2YWx1ZXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGZsb2F0LXJpZ2h0IGJ0bi1mb3JtIGJ0bi14cyIsCiAgICAgICAgICAgIGRpc2FibGVkOiBpbnZhbGlkCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zYXZlIHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uc2F2ZS5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSIKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczExLnNhdmVBbmRFeGl0KHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zaWduLW91dCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnNhdmVBbmRFeGl0LmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZlIGFuZCBleGl0IgogICAgICAgICAgfSkpKSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmb3JtLXRpdGxlIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuYXR0cmlidXRlLm9wdGlvbnMubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNlbmRpbmcgb3B0aW9ucyIKICAgICAgICAgIH0pKSwgXy5tYXAoU0hJUE1FTlRfRklFTERTLCBmdW5jdGlvbiAoZmllbGRDb25maWcsIGZpZWxkTmFtZSkgewogICAgICAgICAgICByZXR1cm4gcmVuZGVyRm9ybUZpZWxkKGZpZWxkQ29uZmlnLCBmaWVsZE5hbWUsIHsKICAgICAgICAgICAgICBzaGlwbWVudFR5cGVzOiBfdGhpczExLnN0YXRlLnNoaXBtZW50VHlwZXMsCiAgICAgICAgICAgICAgaXNzdWVkOiB2YWx1ZXMuc3RhdHVzQ29kZSA9PT0gJ0lTU1VFRCcsCiAgICAgICAgICAgICAgcmVjZWl2ZWQ6IHZhbHVlcy5yZWNlaXZlZCwKICAgICAgICAgICAgICBjYW5CZUVkaXRlZDogIXZhbHVlcy5yZWNlaXZlZCwKICAgICAgICAgICAgICBkZWJvdW5jZWRMb2NhdGlvbnNGZXRjaDogX3RoaXMxMS5kZWJvdW5jZWRMb2NhdGlvbnNGZXRjaAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogInN1Ym1pdC1idXR0b25zIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogInN1Ym1pdCIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogImJ0biBidG4tb3V0bGluZS1wcmltYXJ5IGJ0bi1mb3JtIGJ0bi14cyIsCiAgICAgICAgICAgIGRpc2FibGVkOiB2YWx1ZXMuc3RhdHVzQ29kZSA9PT0gJ0lTU1VFRCcsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTEucHJldmlvdXNQYWdlKHZhbHVlcywgaW52YWxpZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnByZXZpb3VzLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJQcmV2aW91cyIKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogInN1Ym1pdCIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgX3RoaXMxMS5zZW5kRmlsZXNBbmRTYXZlKHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogIiIuY29uY2F0KHZhbHVlcy5zaGlwcGVkID8gJ2J0biBidG4tb3V0bGluZS1zZWNvbmRhcnknIDogJ2J0biBidG4tb3V0bGluZS1zdWNjZXNzJywgIiBmbG9hdC1yaWdodCBidG4tZm9ybSBidG4teHMiKSwKICAgICAgICAgICAgZGlzYWJsZWQ6IHZhbHVlcy5zdGF0dXNDb2RlID09PSAnSVNTVUVEJwogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3Quc3RvY2tNb3ZlbWVudC5zZW5kU2hpcG1lbnQubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNlbmQgc2hpcG1lbnQiCiAgICAgICAgICB9KSksIHZhbHVlcy5zaGlwcGVkICYmIF90aGlzMTEucHJvcHMuaXNVc2VyQWRtaW4gPyAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICBfdGhpczExLnJvbGxiYWNrU3RvY2tNb3ZlbWVudCh2YWx1ZXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtc3VjY2VzcyBmbG9hdC1yaWdodCBidG4teHMiLAogICAgICAgICAgICBkaXNhYmxlZDogaW52YWxpZCB8fCB2YWx1ZXMuc3RhdHVzQ29kZSAhPT0gJ0lTU1VFRCcKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXVuZG8gcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5yb2xsYmFjay5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUm9sbGJhY2siCiAgICAgICAgICB9KSkpIDogbnVsbCksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogIm15LTIgdGFibGUtZm9ybSIKICAgICAgICAgIH0sIF8ubWFwKFNVUFBMSUVSX0ZJRUxEUywgZnVuY3Rpb24gKGZpZWxkQ29uZmlnLCBmaWVsZE5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHJlbmRlckZvcm1GaWVsZChmaWVsZENvbmZpZywgZmllbGROYW1lLCB7CiAgICAgICAgICAgICAgaGFzQmluTG9jYXRpb25TdXBwb3J0OiBfdGhpczExLnByb3BzLmhhc0JpbkxvY2F0aW9uU3VwcG9ydCwKICAgICAgICAgICAgICB0b3RhbENvdW50OiBfdGhpczExLnN0YXRlLnRvdGFsQ291bnQsCiAgICAgICAgICAgICAgbG9hZE1vcmVSb3dzOiBfdGhpczExLmxvYWRNb3JlUm93cywKICAgICAgICAgICAgICBpc1Jvd0xvYWRlZDogX3RoaXMxMS5pc1Jvd0xvYWRlZCwKICAgICAgICAgICAgICBpc1BhZ2luYXRlZDogX3RoaXMxMS5wcm9wcy5pc1BhZ2luYXRlZCwKICAgICAgICAgICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogX3RoaXMxMS5zdGF0ZS5pc0ZpcnN0UGFnZUxvYWRlZCwKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlbgogICAgICAgICAgICAgIGlzQm94TmFtZUVtcHR5OiBfLmV2ZXJ5KF90aGlzMTEuc3RhdGUudmFsdWVzLnRhYmxlSXRlbXMsIGZ1bmN0aW9uIChfcmVmMTgpIHsKICAgICAgICAgICAgICAgIHZhciBib3hOYW1lID0gX3JlZjE4LmJveE5hbWU7CiAgICAgICAgICAgICAgICByZXR1cm4gIWJveE5hbWU7CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW4KICAgICAgICAgICAgICBpc1BhbGxldE5hbWVFbXB0eTogXy5ldmVyeShfdGhpczExLnN0YXRlLnZhbHVlcy50YWJsZUl0ZW1zLCBmdW5jdGlvbiAoX3JlZjE5KSB7CiAgICAgICAgICAgICAgICB2YXIgcGFsbGV0TmFtZSA9IF9yZWYxOS5wYWxsZXROYW1lOwogICAgICAgICAgICAgICAgcmV0dXJuICFwYWxsZXROYW1lOwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkpKSk7CiAgICAgICAgfQogICAgICB9KSk7CiAgICB9CiAgfV0pOwogIHJldHVybiBTZW5kTW92ZW1lbnRQYWdlOwp9KENvbXBvbmVudCk7CnZhciBtYXBTdGF0ZVRvUHJvcHMgPSBmdW5jdGlvbiBtYXBTdGF0ZVRvUHJvcHMoc3RhdGUpIHsKICByZXR1cm4gewogICAgdHJhbnNsYXRlOiB0cmFuc2xhdGVXaXRoRGVmYXVsdE1lc3NhZ2UoZ2V0VHJhbnNsYXRlKHN0YXRlLmxvY2FsaXplKSksCiAgICBjdXJyZW50TG9jYXRpb25JZDogc3RhdGUuc2Vzc2lvbi5jdXJyZW50TG9jYXRpb24uaWQsCiAgICBzdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZDogc3RhdGUuc2Vzc2lvbi5mZXRjaGVkVHJhbnNsYXRpb25zLnN0b2NrTW92ZW1lbnQsCiAgICBkZWJvdW5jZVRpbWU6IHN0YXRlLnNlc3Npb24uc2VhcmNoQ29uZmlnLmRlYm91bmNlVGltZSwKICAgIG1pblNlYXJjaExlbmd0aDogc3RhdGUuc2Vzc2lvbi5zZWFyY2hDb25maWcubWluU2VhcmNoTGVuZ3RoLAogICAgbG9jYWxlOiBzdGF0ZS5zZXNzaW9uLmFjdGl2ZUxhbmd1YWdlLAogICAgaXNVc2VyQWRtaW46IHN0YXRlLnNlc3Npb24uaXNVc2VyQWRtaW4sCiAgICBoYXNCaW5Mb2NhdGlvblN1cHBvcnQ6IHN0YXRlLnNlc3Npb24uY3VycmVudExvY2F0aW9uLmhhc0JpbkxvY2F0aW9uU3VwcG9ydCwKICAgIGlzUGFnaW5hdGVkOiBzdGF0ZS5zZXNzaW9uLmlzUGFnaW5hdGVkLAogICAgcGFnZVNpemU6IHN0YXRlLnNlc3Npb24ucGFnZVNpemUsCiAgICBtaW5pbXVtRXhwaXJhdGlvbkRhdGU6IHN0YXRlLnNlc3Npb24ubWluaW11bUV4cGlyYXRpb25EYXRlLAogICAgaGFzQ2VudHJhbFB1cmNoYXNpbmdFbmFibGVkOiBzdGF0ZS5zZXNzaW9uLmN1cnJlbnRMb2NhdGlvbi5oYXNDZW50cmFsUHVyY2hhc2luZ0VuYWJsZWQKICB9Owp9OwpleHBvcnQgZGVmYXVsdCBjb25uZWN0KG1hcFN0YXRlVG9Qcm9wcywgewogIHNob3dTcGlubmVyOiBzaG93U3Bpbm5lciwKICBoaWRlU3Bpbm5lcjogaGlkZVNwaW5uZXIKfSkoU2VuZE1vdmVtZW50UGFnZSk7ClNlbmRNb3ZlbWVudFBhZ2UucHJvcFR5cGVzID0gewogIC8qKiBJbml0aWFsIGNvbXBvbmVudCdzIGRhdGEgKi8KICBpbml0aWFsVmFsdWVzOiBQcm9wVHlwZXMuc2hhcGUoe30pLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIHJldHVybmluZyB1c2VyIHRvIHRoZSBwcmV2aW91cyBwYWdlICovCiAgcHJldmlvdXNQYWdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiBkYXRhIGlzIGxvYWRpbmcgKi8KICBzaG93U3Bpbm5lcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAvKiogRnVuY3Rpb24gY2FsbGVkIHdoZW4gZGF0YSBoYXMgbG9hZGVkICovCiAgaGlkZVNwaW5uZXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgbmV4dFBhZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgdHJhbnNsYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBOYW1lIG9mIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgbG9jYXRpb24gKi8KICBjdXJyZW50TG9jYXRpb25JZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLAogIHN0b2NrTW92ZW1lbnRUcmFuc2xhdGlvbnNGZXRjaGVkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLAogIGRlYm91bmNlVGltZTogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLAogIG1pblNlYXJjaExlbmd0aDogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLAogIGxvY2FsZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLAogIGlzVXNlckFkbWluOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLAogIC8qKiBJcyB0cnVlIHdoZW4gY3VycmVudGx5IHNlbGVjdGVkIGxvY2F0aW9uIHN1cHBvcnRzIGJpbnMgKi8KICBoYXNCaW5Mb2NhdGlvblN1cHBvcnQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgLyoqIFJldHVybiB0cnVlIGlmIHBhZ2luYXRpb24gaXMgZW5hYmxlZCAqLwogIGlzUGFnaW5hdGVkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLAogIHBhZ2VTaXplOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsCiAgbWluaW11bUV4cGlyYXRpb25EYXRlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsCiAgLyoqIElzIHRydWUgd2hlbiBjdXJyZW50bHkgc2VsZWN0ZWQgbG9jYXRpb24gaGFzIGNlbnRyYWwgcHVyY2hhc2luZyBlbmFibGVkICovCiAgaGFzQ2VudHJhbFB1cmNoYXNpbmdFbmFibGVkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkCn07"},null]}