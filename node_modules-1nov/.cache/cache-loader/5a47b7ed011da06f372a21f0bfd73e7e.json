{"remainingRequest":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js?presets[]=@babel/react&presets[]=@babel/env!/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js!/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/outbound/AddItemsPage.jsx","dependencies":[{"path":"/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/outbound/AddItemsPage.jsx","mtime":1698037750000},{"path":"/opt/MTOBS-BIKASH/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfSwgX3R5cGVvZihvYmopOyB9CmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOyB9IH0KZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN1YkNsYXNzLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBlbnVtZXJhYmxlT25seSAmJiAoc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pKSwga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBudWxsICE9IGFyZ3VtZW50c1tpXSA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpICUgMiA/IG93bktleXMoT2JqZWN0KHNvdXJjZSksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpIDogb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSByZXR1cm4gdGFyZ2V0OyB9CmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsga2V5ID0gX3RvUHJvcGVydHlLZXkoa2V5KTsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CmZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgeyB2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgInN0cmluZyIpOyByZXR1cm4gX3R5cGVvZihrZXkpID09PSAic3ltYm9sIiA/IGtleSA6IFN0cmluZyhrZXkpOyB9CmZ1bmN0aW9uIF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkgeyBpZiAoX3R5cGVvZihpbnB1dCkgIT09ICJvYmplY3QiIHx8IGlucHV0ID09PSBudWxsKSByZXR1cm4gaW5wdXQ7IHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTsgaWYgKHByaW0gIT09IHVuZGVmaW5lZCkgeyB2YXIgcmVzID0gcHJpbS5jYWxsKGlucHV0LCBoaW50IHx8ICJkZWZhdWx0Iik7IGlmIChfdHlwZW9mKHJlcykgIT09ICJvYmplY3QiKSByZXR1cm4gcmVzOyB0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpOyB9IHJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTsgfQppbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnOwppbXBvcnQgYXJyYXlNdXRhdG9ycyBmcm9tICdmaW5hbC1mb3JtLWFycmF5cyc7CmltcG9ydCB1cGRhdGUgZnJvbSAnaW1tdXRhYmlsaXR5LWhlbHBlcic7CmltcG9ydCBmaWxlRG93bmxvYWQgZnJvbSAnanMtZmlsZS1kb3dubG9hZCc7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JzsKaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJzsKaW1wb3J0IHsgY29uZmlybUFsZXJ0IH0gZnJvbSAncmVhY3QtY29uZmlybS1hbGVydCc7CmltcG9ydCB7IEZvcm0gfSBmcm9tICdyZWFjdC1maW5hbC1mb3JtJzsKaW1wb3J0IHsgZ2V0VHJhbnNsYXRlIH0gZnJvbSAncmVhY3QtbG9jYWxpemUtcmVkdXgnOwppbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnOwppbXBvcnQgQWxlcnQgZnJvbSAncmVhY3Qtcy1hbGVydCc7CmltcG9ydCB7IGFkZFN0b2NrTW92ZW1lbnREcmFmdCwgY2xvc2VJbmZvQmFyLCBjcmVhdGVJbmZvQmFyLCBmZXRjaFVzZXJzLCBoaWRlSW5mb0JhciwgaGlkZVNwaW5uZXIsIHJlbW92ZVN0b2NrTW92ZW1lbnREcmFmdCwgc2hvd0luZm9CYXIsIHNob3dTcGlubmVyIH0gZnJvbSAnYWN0aW9ucyc7CmltcG9ydCBBcnJheUZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9BcnJheUZpZWxkJzsKaW1wb3J0IEJ1dHRvbkZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9CdXR0b25GaWVsZCc7CmltcG9ydCBMYWJlbEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9MYWJlbEZpZWxkJzsKaW1wb3J0IFByb2R1Y3RTZWxlY3RGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvUHJvZHVjdFNlbGVjdEZpZWxkJzsKaW1wb3J0IFNlbGVjdEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9TZWxlY3RGaWVsZCc7CmltcG9ydCBUZXh0RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL1RleHRGaWVsZCc7CmltcG9ydCBBdXRvc2F2ZUZlYXR1cmVNb2RhbCBmcm9tICdjb21wb25lbnRzL2luZm9CYXIvbW9kYWxzL2F1dG9zYXZlL0F1dG9zYXZlRmVhdHVyZU1vZGFsJzsKaW1wb3J0IG5vdGlmaWNhdGlvbiBmcm9tICdjb21wb25lbnRzL0xheW91dC9ub3RpZmljYXRpb25zL25vdGlmaWNhdGlvbic7CmltcG9ydCBTcGlubmVyIGZyb20gJ2NvbXBvbmVudHMvc3Bpbm5lci9TcGlubmVyJzsKaW1wb3J0IHsgSW5mb0JhciwgSW5mb0JhckNvbmZpZ3MgfSBmcm9tICdjb25zdHMvaW5mb0Jhcic7CmltcG9ydCBOb3RpZmljYXRpb25UeXBlIGZyb20gJ2NvbnN0cy9ub3RpZmljYXRpb25UeXBlcyc7CmltcG9ydCBSb3dTYXZlU3RhdHVzIGZyb20gJ2NvbnN0cy9yb3dTYXZlU3RhdHVzJzsKaW1wb3J0IGFwaUNsaWVudCBmcm9tICd1dGlscy9hcGlDbGllbnQnOwppbXBvcnQgeyByZW5kZXJGb3JtRmllbGQgfSBmcm9tICd1dGlscy9mb3JtLXV0aWxzJzsKaW1wb3J0IFJvd1NhdmVJY29uSW5kaWNhdG9yIGZyb20gJ3V0aWxzL1Jvd1NhdmVJY29uSW5kaWNhdG9yJzsKaW1wb3J0IFRyYW5zbGF0ZSwgeyB0cmFuc2xhdGVXaXRoRGVmYXVsdE1lc3NhZ2UgfSBmcm9tICd1dGlscy9UcmFuc2xhdGUnOwppbXBvcnQgJ3JlYWN0LWNvbmZpcm0tYWxlcnQvc3JjL3JlYWN0LWNvbmZpcm0tYWxlcnQuY3NzJzsKdmFyIERFTEVURV9CVVRUT05fRklFTEQgPSB7CiAgdHlwZTogQnV0dG9uRmllbGQsCiAgZGVmYXVsdE1lc3NhZ2U6ICdEZWxldGUnLAogIGZsZXhXaWR0aDogJzEnLAogIGZpZWxkS2V5OiAnJywKICBidXR0b25MYWJlbDogJ3JlYWN0LmRlZmF1bHQuYnV0dG9uLmRlbGV0ZS5sYWJlbCcsCiAgYnV0dG9uRGVmYXVsdE1lc3NhZ2U6ICdEZWxldGUnLAogIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmKSB7CiAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYuZmllbGRWYWx1ZSwKICAgICAgcmVtb3ZlSXRlbSA9IF9yZWYucmVtb3ZlSXRlbSwKICAgICAgcmVtb3ZlUm93ID0gX3JlZi5yZW1vdmVSb3csCiAgICAgIHNob3dPbmx5ID0gX3JlZi5zaG93T25seSwKICAgICAgdXBkYXRlVG90YWxDb3VudCA9IF9yZWYudXBkYXRlVG90YWxDb3VudDsKICAgIHJldHVybiB7CiAgICAgIC8vIG9uQ2xpY2sgLT4gb25Nb3VzZURvd24sIGJlY2F1c2Ugd2UgY2FuJ3QgY2FuY2VsCiAgICAgIC8vIGZ1bmN0aW9uIHRyaWdnZXJlZCBpbiBvbkJsdXIgKHJlcXVlc3Qgd2l0aCBpdGVtcyB0byBzYXZlKS4KICAgICAgLy8gb25DbGljayBkb2Vzbid0IHdvcmsgaW4gdGhpcyBjYXNlLCBiZWNhdXNlIGVsZW1lbnQgb24KICAgICAgLy8gd2hpY2ggd2Ugd2FudCB0byB0cmlnZ2VyIHRoaXMgZnVuY3Rpb24gaGFzIHRvIGhhdmUgZm9jdXMKICAgICAgLy8gYnV0IGlmIG9uQmx1ciB0YWtlcyBhIGxpdHRsZSBtb3JlIHRpbWUsIG9uQ2xpY2sgd2lsbCBub3QgYmUgZXhlY3V0ZWQKICAgICAgb25Nb3VzZURvd246IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5pZCA/IGZ1bmN0aW9uICgpIHsKICAgICAgICByZW1vdmVJdGVtKGZpZWxkVmFsdWUuaWQpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgdXBkYXRlVG90YWxDb3VudCgtMSk7CiAgICAgICAgICByZW1vdmVSb3coKTsKICAgICAgICB9KTsKICAgICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICB1cGRhdGVUb3RhbENvdW50KC0xKTsKICAgICAgICByZW1vdmVSb3coKTsKICAgICAgfSwKICAgICAgZGlzYWJsZWQ6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdGF0dXNDb2RlID09PSAnU1VCU1RJVFVURUQnIHx8IHNob3dPbmx5CiAgICB9OwogIH0sCiAgYXR0cmlidXRlczogewogICAgY2xhc3NOYW1lOiAnYnRuIGJ0bi1vdXRsaW5lLWRhbmdlcicKICB9Cn07CnZhciBST1dfU0FWRV9JQ09OX0ZJRUxEID0gewogIHR5cGU6IGZ1bmN0aW9uIHR5cGUocGFyYW1zKSB7CiAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm93U2F2ZUljb25JbmRpY2F0b3IsIHsKICAgICAgbGluZUl0ZW1TYXZlU3RhdHVzOiBwYXJhbXMuZmllbGRWYWx1ZQogICAgfSk7CiAgfSwKICBmbGV4V2lkdGg6ICcwLjInCn07CnZhciBOT19TVE9DS0xJU1RfRklFTERTID0gewogIGxpbmVJdGVtczogewogICAgdHlwZTogQXJyYXlGaWVsZCwKICAgIGFycm93c05hdmlnYXRpb246IHRydWUsCiAgICB2aXJ0dWFsaXplZDogdHJ1ZSwKICAgIHRvdGFsQ291bnQ6IGZ1bmN0aW9uIHRvdGFsQ291bnQoX3JlZjIpIHsKICAgICAgdmFyIF90b3RhbENvdW50ID0gX3JlZjIudG90YWxDb3VudDsKICAgICAgcmV0dXJuIF90b3RhbENvdW50OwogICAgfSwKICAgIGlzUm93TG9hZGVkOiBmdW5jdGlvbiBpc1Jvd0xvYWRlZChfcmVmMykgewogICAgICB2YXIgX2lzUm93TG9hZGVkID0gX3JlZjMuaXNSb3dMb2FkZWQ7CiAgICAgIHJldHVybiBfaXNSb3dMb2FkZWQ7CiAgICB9LAogICAgbG9hZE1vcmVSb3dzOiBmdW5jdGlvbiBsb2FkTW9yZVJvd3MoX3JlZjQpIHsKICAgICAgdmFyIF9sb2FkTW9yZVJvd3MgPSBfcmVmNC5sb2FkTW9yZVJvd3M7CiAgICAgIHJldHVybiBfbG9hZE1vcmVSb3dzKCk7CiAgICB9LAogICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IGZ1bmN0aW9uIGlzRmlyc3RQYWdlTG9hZGVkKF9yZWY1KSB7CiAgICAgIHZhciBfaXNGaXJzdFBhZ2VMb2FkZWQgPSBfcmVmNS5pc0ZpcnN0UGFnZUxvYWRlZDsKICAgICAgcmV0dXJuIF9pc0ZpcnN0UGFnZUxvYWRlZDsKICAgIH0sCiAgICBhZGRCdXR0b246IGZ1bmN0aW9uIGFkZEJ1dHRvbihfcmVmNikgewogICAgICB2YXIgYWRkUm93ID0gX3JlZjYuYWRkUm93LAogICAgICAgIGdldFNvcnRPcmRlciA9IF9yZWY2LmdldFNvcnRPcmRlciwKICAgICAgICBzaG93T25seSA9IF9yZWY2LnNob3dPbmx5LAogICAgICAgIHVwZGF0ZVRvdGFsQ291bnQgPSBfcmVmNi51cGRhdGVUb3RhbENvdW50LAogICAgICAgIGdldFN0b2NrTW92ZW1lbnREcmFmdCA9IF9yZWY2LmdldFN0b2NrTW92ZW1lbnREcmFmdCwKICAgICAgICBpc0RyYWZ0QXZhaWxhYmxlID0gX3JlZjYuaXNEcmFmdEF2YWlsYWJsZTsKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0LkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgIGlkOiAiYWRkQnV0dG9uIiwKICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtc3VjY2VzcyBidG4teHMiLAogICAgICAgIGRpc2FibGVkOiBzaG93T25seQogICAgICAgIC8vIG9uQ2xpY2sgLT4gb25Nb3VzZURvd24gKHNlZSBjb21tZW50IGZvciBERUxFVEVfQlVUVE9OX0ZJRUxEKQogICAgICAgICwKICAgICAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24gb25Nb3VzZURvd24oKSB7CiAgICAgICAgICB1cGRhdGVUb3RhbENvdW50KDEpOwogICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgc29ydE9yZGVyOiBnZXRTb3J0T3JkZXIoKSwKICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5QRU5ESU5HCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtcGx1cyBwci0yIgogICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5hZGRMaW5lLmxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkFkZCBsaW5lIgogICAgICB9KSkpLCBpc0RyYWZ0QXZhaWxhYmxlICYmIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgY2xhc3NOYW1lOiAiYnRuIGJ0bi1vdXRsaW5lLXByaW1hcnkgYnRuLXhzIGRyYWZ0LWJ1dHRvbiBtbC0xIiwKICAgICAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24gb25Nb3VzZURvd24oKSB7CiAgICAgICAgICByZXR1cm4gZ2V0U3RvY2tNb3ZlbWVudERyYWZ0KCk7CiAgICAgICAgfQogICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLmF2YWlsYWJsZURyYWZ0LmxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkF2YWlsYWJsZSBkcmFmdCIKICAgICAgfSkpKTsKICAgIH0sCiAgICBmaWVsZHM6IHsKICAgICAgcHJvZHVjdDogewogICAgICAgIHR5cGU6IFByb2R1Y3RTZWxlY3RGaWVsZCwKICAgICAgICBmaWVsZEtleTogJ2Rpc2FibGVkJywKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucmVxdWVzdGVkUHJvZHVjdC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZXF1ZXN0ZWQgcHJvZHVjdCcsCiAgICAgICAgaGVhZGVyQWxpZ246ICdsZWZ0JywKICAgICAgICBmbGV4V2lkdGg6ICc5LjUnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHNob3dTZWxlY3RlZE9wdGlvbkNvbG9yOiB0cnVlCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjcpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjcuZmllbGRWYWx1ZSwKICAgICAgICAgICAgcm93SW5kZXggPSBfcmVmNy5yb3dJbmRleCwKICAgICAgICAgICAgcm93Q291bnQgPSBfcmVmNy5yb3dDb3VudCwKICAgICAgICAgICAgb3JpZ2luSWQgPSBfcmVmNy5vcmlnaW5JZCwKICAgICAgICAgICAgZm9jdXNGaWVsZCA9IF9yZWY3LmZvY3VzRmllbGQ7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkaXNhYmxlZDogISFmaWVsZFZhbHVlLAogICAgICAgICAgICBhdXRvRm9jdXM6IHJvd0luZGV4ID09PSByb3dDb3VudCAtIDEsCiAgICAgICAgICAgIGxvY2F0aW9uSWQ6IG9yaWdpbklkLAogICAgICAgICAgICBvbkV4YWN0UHJvZHVjdFNlbGVjdGVkOiBmdW5jdGlvbiBvbkV4YWN0UHJvZHVjdFNlbGVjdGVkKF9yZWY4KSB7CiAgICAgICAgICAgICAgdmFyIHByb2R1Y3QgPSBfcmVmOC5wcm9kdWN0OwogICAgICAgICAgICAgIGlmIChmb2N1c0ZpZWxkICYmIHByb2R1Y3QpIHsKICAgICAgICAgICAgICAgIGZvY3VzRmllbGQocm93SW5kZXgsICdxdWFudGl0eVJlcXVlc3RlZCcpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiB7CiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5xdWFudGl0eS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdRdWFudGl0eScsCiAgICAgICAgZmxleFdpZHRoOiAnMi41JywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0eXBlOiAnbnVtYmVyJwogICAgICAgIH0sCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmOSkgewogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmOS5maWVsZFZhbHVlLAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmOS51cGRhdGVSb3csCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWY5LnZhbHVlcywKICAgICAgICAgICAgcm93SW5kZXggPSBfcmVmOS5yb3dJbmRleCwKICAgICAgICAgICAgc2F2ZVByb2dyZXNzID0gX3JlZjkuc2F2ZVByb2dyZXNzOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZGlzYWJsZWQ6IChmaWVsZFZhbHVlID09PSBudWxsIHx8IGZpZWxkVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkVmFsdWUucm93U2F2ZVN0YXR1cykgPT09IFJvd1NhdmVTdGF0dXMuU0FWSU5HIHx8IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdGF0dXNDb2RlID09PSAnU1VCU1RJVFVURUQnIHx8IF8uaXNOaWwoZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnByb2R1Y3QpLAogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICB1cGRhdGVSb3codmFsdWVzLCByb3dJbmRleCk7CiAgICAgICAgICAgICAgc2F2ZVByb2dyZXNzKHsKICAgICAgICAgICAgICAgIHZhbHVlczogdmFsdWVzCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZSh2YWx1ZSkgewogICAgICAgICAgICAgIHNhdmVQcm9ncmVzcyh7CiAgICAgICAgICAgICAgICB2YWx1ZXM6IHZhbHVlcywKICAgICAgICAgICAgICAgIHJvd0luZGV4OiByb3dJbmRleCwKICAgICAgICAgICAgICAgIGZpZWxkVmFsdWU6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgZmllbGRWYWx1ZSksIHt9LCB7CiAgICAgICAgICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiB2YWx1ZQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJlY2lwaWVudDogewogICAgICAgIHR5cGU6IFNlbGVjdEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZWNpcGllbnQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVjaXBpZW50JywKICAgICAgICBmbGV4V2lkdGg6ICcyLjUnLAogICAgICAgIGZpZWxkS2V5OiAnJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjEwKSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYxMC5maWVsZFZhbHVlLAogICAgICAgICAgICByZWNpcGllbnRzID0gX3JlZjEwLnJlY2lwaWVudHMsCiAgICAgICAgICAgIGFkZFJvdyA9IF9yZWYxMC5hZGRSb3csCiAgICAgICAgICAgIHJvd0NvdW50ID0gX3JlZjEwLnJvd0NvdW50LAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYxMC5yb3dJbmRleCwKICAgICAgICAgICAgZ2V0U29ydE9yZGVyID0gX3JlZjEwLmdldFNvcnRPcmRlciwKICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudCA9IF9yZWYxMC51cGRhdGVUb3RhbENvdW50LAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMTAudXBkYXRlUm93LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMTAudmFsdWVzLAogICAgICAgICAgICBzYXZlUHJvZ3Jlc3MgPSBfcmVmMTAuc2F2ZVByb2dyZXNzOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb3B0aW9uczogcmVjaXBpZW50cywKICAgICAgICAgICAgZGlzYWJsZWQ6IChmaWVsZFZhbHVlID09PSBudWxsIHx8IGZpZWxkVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkVmFsdWUucm93U2F2ZVN0YXR1cykgPT09IFJvd1NhdmVTdGF0dXMuU0FWSU5HIHx8IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdGF0dXNDb2RlID09PSAnU1VCU1RJVFVURUQnIHx8IF8uaXNOaWwoZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnByb2R1Y3QpLAogICAgICAgICAgICBvblRhYlByZXNzOiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHVwZGF0ZVRvdGFsQ291bnQoMSk7CiAgICAgICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCksCiAgICAgICAgICAgICAgICByb3dTYXZlU3RhdHVzOiBSb3dTYXZlU3RhdHVzLlBFTkRJTkcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgIGFycm93UmlnaHQ6IHJvd0NvdW50ID09PSByb3dJbmRleCArIDEgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudCgxKTsKICAgICAgICAgICAgICBhZGRSb3coewogICAgICAgICAgICAgICAgc29ydE9yZGVyOiBnZXRTb3J0T3JkZXIoKSwKICAgICAgICAgICAgICAgIHJvd1NhdmVTdGF0dXM6IFJvd1NhdmVTdGF0dXMuUEVORElORwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IDogbnVsbCwKICAgICAgICAgICAgYXJyb3dEb3duOiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB1cGRhdGVUb3RhbENvdW50KDEpOwogICAgICAgICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgICAgICAgc29ydE9yZGVyOiBnZXRTb3J0T3JkZXIoKSwKICAgICAgICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5QRU5ESU5HCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IDogbnVsbCwKICAgICAgICAgICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgdXBkYXRlUm93KHZhbHVlcywgcm93SW5kZXgpOwogICAgICAgICAgICAgIHNhdmVQcm9ncmVzcyh7CiAgICAgICAgICAgICAgICB2YWx1ZXM6IHZhbHVlcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZXZlbnQpIHsKICAgICAgICAgICAgICBzYXZlUHJvZ3Jlc3MoewogICAgICAgICAgICAgICAgdmFsdWVzOiB2YWx1ZXMsCiAgICAgICAgICAgICAgICByb3dJbmRleDogcm93SW5kZXgsCiAgICAgICAgICAgICAgICBmaWVsZFZhbHVlOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGZpZWxkVmFsdWUpLCB7fSwgewogICAgICAgICAgICAgICAgICByZWNpcGllbnQ6IGV2ZW50CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgbGFiZWxLZXk6ICduYW1lJywKICAgICAgICAgIG9wZW5PbkNsaWNrOiBmYWxzZQogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVsZXRlQnV0dG9uOiBERUxFVEVfQlVUVE9OX0ZJRUxECiAgICB9CiAgfQp9Owp2YXIgU1RPQ0tMSVNUX0ZJRUxEUyA9IHsKICBsaW5lSXRlbXM6IHsKICAgIHR5cGU6IEFycmF5RmllbGQsCiAgICBhcnJvd3NOYXZpZ2F0aW9uOiB0cnVlLAogICAgdmlydHVhbGl6ZWQ6IHRydWUsCiAgICBzaG93Um93U2F2ZUluZGljYXRvcjogdHJ1ZSwKICAgIHRvdGFsQ291bnQ6IGZ1bmN0aW9uIHRvdGFsQ291bnQoX3JlZjExKSB7CiAgICAgIHZhciBfdG90YWxDb3VudDIgPSBfcmVmMTEudG90YWxDb3VudDsKICAgICAgcmV0dXJuIF90b3RhbENvdW50MjsKICAgIH0sCiAgICBpc1Jvd0xvYWRlZDogZnVuY3Rpb24gaXNSb3dMb2FkZWQoX3JlZjEyKSB7CiAgICAgIHZhciBfaXNSb3dMb2FkZWQyID0gX3JlZjEyLmlzUm93TG9hZGVkOwogICAgICByZXR1cm4gX2lzUm93TG9hZGVkMjsKICAgIH0sCiAgICBsb2FkTW9yZVJvd3M6IGZ1bmN0aW9uIGxvYWRNb3JlUm93cyhfcmVmMTMpIHsKICAgICAgdmFyIF9sb2FkTW9yZVJvd3MyID0gX3JlZjEzLmxvYWRNb3JlUm93czsKICAgICAgcmV0dXJuIF9sb2FkTW9yZVJvd3MyKCk7CiAgICB9LAogICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IGZ1bmN0aW9uIGlzRmlyc3RQYWdlTG9hZGVkKF9yZWYxNCkgewogICAgICB2YXIgX2lzRmlyc3RQYWdlTG9hZGVkMiA9IF9yZWYxNC5pc0ZpcnN0UGFnZUxvYWRlZDsKICAgICAgcmV0dXJuIF9pc0ZpcnN0UGFnZUxvYWRlZDI7CiAgICB9LAogICAgYWRkQnV0dG9uOiBmdW5jdGlvbiBhZGRCdXR0b24oX3JlZjE1KSB7CiAgICAgIHZhciBhZGRSb3cgPSBfcmVmMTUuYWRkUm93LAogICAgICAgIGdldFNvcnRPcmRlciA9IF9yZWYxNS5nZXRTb3J0T3JkZXIsCiAgICAgICAgbmV3SXRlbUFkZGVkID0gX3JlZjE1Lm5ld0l0ZW1BZGRlZCwKICAgICAgICB1cGRhdGVUb3RhbENvdW50ID0gX3JlZjE1LnVwZGF0ZVRvdGFsQ291bnQsCiAgICAgICAgaXNEcmFmdEF2YWlsYWJsZSA9IF9yZWYxNS5pc0RyYWZ0QXZhaWxhYmxlLAogICAgICAgIGdldFN0b2NrTW92ZW1lbnREcmFmdCA9IF9yZWYxNS5nZXRTdG9ja01vdmVtZW50RHJhZnQ7CiAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdC5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICBpZDogImFkZEJ1dHRvbiIsCiAgICAgICAgY2xhc3NOYW1lOiAiYnRuIGJ0bi1vdXRsaW5lLXN1Y2Nlc3MgYnRuLXhzIgogICAgICAgIC8vIG9uQ2xpY2sgLT4gb25Nb3VzZURvd24gKHNlZSBjb21tZW50IGZvciBERUxFVEVfQlVUVE9OX0ZJRUxEKQogICAgICAgICwKICAgICAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24gb25Nb3VzZURvd24oKSB7CiAgICAgICAgICB1cGRhdGVUb3RhbENvdW50KDEpOwogICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgc29ydE9yZGVyOiBnZXRTb3J0T3JkZXIoKSwKICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5QRU5ESU5HCiAgICAgICAgICB9KTsKICAgICAgICAgIG5ld0l0ZW1BZGRlZCgpOwogICAgICAgIH0KICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1wbHVzIHByLTIiCiAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLmFkZExpbmUubGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQWRkIGxpbmUiCiAgICAgIH0pKSksIGlzRHJhZnRBdmFpbGFibGUgJiYgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtcHJpbWFyeSBidG4teHMgZHJhZnQtYnV0dG9uIG1sLTEiLAogICAgICAgIG9uTW91c2VEb3duOiBmdW5jdGlvbiBvbk1vdXNlRG93bigpIHsKICAgICAgICAgIHJldHVybiBnZXRTdG9ja01vdmVtZW50RHJhZnQoKTsKICAgICAgICB9CiAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uYXZhaWxhYmxlRHJhZnQubGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQXZhaWxhYmxlIGRyYWZ0IgogICAgICB9KSkpOwogICAgfSwKICAgIGZpZWxkczogewogICAgICBwcm9kdWN0OiB7CiAgICAgICAgZmllbGRLZXk6ICdkaXNhYmxlZCcsCiAgICAgICAgdHlwZTogUHJvZHVjdFNlbGVjdEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZXF1ZXN0ZWRQcm9kdWN0LmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1JlcXVlc3RlZCBwcm9kdWN0JywKICAgICAgICBoZWFkZXJBbGlnbjogJ2xlZnQnLAogICAgICAgIGZsZXhXaWR0aDogJzknLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHNob3dTZWxlY3RlZE9wdGlvbkNvbG9yOiB0cnVlCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjE2KSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYxNi5maWVsZFZhbHVlLAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYxNi5yb3dJbmRleCwKICAgICAgICAgICAgcm93Q291bnQgPSBfcmVmMTYucm93Q291bnQsCiAgICAgICAgICAgIG5ld0l0ZW0gPSBfcmVmMTYubmV3SXRlbSwKICAgICAgICAgICAgb3JpZ2luSWQgPSBfcmVmMTYub3JpZ2luSWQsCiAgICAgICAgICAgIGZvY3VzRmllbGQgPSBfcmVmMTYuZm9jdXNGaWVsZDsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRpc2FibGVkOiAhIWZpZWxkVmFsdWUsCiAgICAgICAgICAgIGF1dG9Gb2N1czogbmV3SXRlbSAmJiByb3dJbmRleCA9PT0gcm93Q291bnQgLSAxLAogICAgICAgICAgICBsb2NhdGlvbklkOiBvcmlnaW5JZCwKICAgICAgICAgICAgb25FeGFjdFByb2R1Y3RTZWxlY3RlZDogZnVuY3Rpb24gb25FeGFjdFByb2R1Y3RTZWxlY3RlZChfcmVmMTcpIHsKICAgICAgICAgICAgICB2YXIgcHJvZHVjdCA9IF9yZWYxNy5wcm9kdWN0OwogICAgICAgICAgICAgIGlmIChmb2N1c0ZpZWxkICYmIHByb2R1Y3QpIHsKICAgICAgICAgICAgICAgIGZvY3VzRmllbGQocm93SW5kZXgsICdxdWFudGl0eVJlcXVlc3RlZCcpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5QWxsb3dlZDogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50Lm1heFF1YW50aXR5LmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ01heCBRdHknLAogICAgICAgIGZsZXhXaWR0aDogJzEuNycsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgdHlwZTogJ251bWJlcicKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiB7CiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5uZWVkZWRRdWFudGl0eS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdOZWVkZWQgUXR5JywKICAgICAgICBmbGV4V2lkdGg6ICcxLjcnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHR5cGU6ICdudW1iZXInCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjE4KSB7CiAgICAgICAgICB2YXIgX3ZhbHVlcyRsaW5lSXRlbXMkcm93OwogICAgICAgICAgdmFyIGFkZFJvdyA9IF9yZWYxOC5hZGRSb3csCiAgICAgICAgICAgIHJvd0NvdW50ID0gX3JlZjE4LnJvd0NvdW50LAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYxOC5yb3dJbmRleCwKICAgICAgICAgICAgZ2V0U29ydE9yZGVyID0gX3JlZjE4LmdldFNvcnRPcmRlciwKICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudCA9IF9yZWYxOC51cGRhdGVUb3RhbENvdW50LAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMTgudXBkYXRlUm93LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMTgudmFsdWVzLAogICAgICAgICAgICBzYXZlUHJvZ3Jlc3MgPSBfcmVmMTguc2F2ZVByb2dyZXNzOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZGlzYWJsZWQ6ICgoX3ZhbHVlcyRsaW5lSXRlbXMkcm93ID0gdmFsdWVzLmxpbmVJdGVtc1tyb3dJbmRleF0pID09PSBudWxsIHx8IF92YWx1ZXMkbGluZUl0ZW1zJHJvdyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3ZhbHVlcyRsaW5lSXRlbXMkcm93LnJvd1NhdmVTdGF0dXMpID09PSBSb3dTYXZlU3RhdHVzLlNBVklORywKICAgICAgICAgICAgb25UYWJQcmVzczogcm93Q291bnQgPT09IHJvd0luZGV4ICsgMSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB1cGRhdGVUb3RhbENvdW50KDEpOwogICAgICAgICAgICAgIGFkZFJvdyh7CiAgICAgICAgICAgICAgICBzb3J0T3JkZXI6IGdldFNvcnRPcmRlcigpLAogICAgICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5QRU5ESU5HCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gOiBudWxsLAogICAgICAgICAgICBhcnJvd1JpZ2h0OiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHVwZGF0ZVRvdGFsQ291bnQoMSk7CiAgICAgICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCksCiAgICAgICAgICAgICAgICByb3dTYXZlU3RhdHVzOiBSb3dTYXZlU3RhdHVzLlBFTkRJTkcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgIGFycm93RG93bjogcm93Q291bnQgPT09IHJvd0luZGV4ICsgMSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudCgxKTsKICAgICAgICAgICAgICAgIGFkZFJvdyh7CiAgICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCksCiAgICAgICAgICAgICAgICAgIHJvd1NhdmVTdGF0dXM6IFJvd1NhdmVTdGF0dXMuUEVORElORwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICAgICAgICAgIHVwZGF0ZVJvdyh2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgICBzYXZlUHJvZ3Jlc3MoewogICAgICAgICAgICAgICAgdmFsdWVzOiB2YWx1ZXMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGV2ZW50KSB7CiAgICAgICAgICAgICAgc2F2ZVByb2dyZXNzKHsKICAgICAgICAgICAgICAgIHZhbHVlczogdmFsdWVzLAogICAgICAgICAgICAgICAgcm93SW5kZXg6IHJvd0luZGV4LAogICAgICAgICAgICAgICAgZmllbGRWYWx1ZTogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB2YWx1ZXMubGluZUl0ZW1zW3Jvd0luZGV4XSksIHt9LCB7CiAgICAgICAgICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiBldmVudAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRlbGV0ZUJ1dHRvbjogREVMRVRFX0JVVFRPTl9GSUVMRAogICAgfQogIH0KfTsKCi8vIFRoaXMgdmFyaWFibGUgaXMgYW4gaW5kaWNhdG9yCi8vIGlmIGFjdGlvbiBpcyBpbiBwcm9ncmVzcyB0byBhdm9pZAovLyB0cmlnZ2VyaW5nIHRoZSBzYW1lIHRyYW5zYWN0aW9uIHR3aWNlCi8vIGZvciBleGFtcGxlIHRyaWdnZXJpbmcgc2F2ZSBidXR0b24gZHVyaW5nIHRoZSBhdXRvc2F2ZQp2YXIgYWN0aW9uSW5Qcm9ncmVzcyA9IGZhbHNlOwoKLyoqCiAqIFRoZSBzZWNvbmQgc3RlcCBvZiBzdG9jayBtb3ZlbWVudCB3aGVyZSB1c2VyIGNhbiBhZGQgaXRlbXMgdG8gc3RvY2sgbGlzdC4KICogVGhpcyBjb21wb25lbnQgc3VwcG9ydHMgdGhyZWUgZGlmZmVyZW50IGNhc2VzOiB3aXRoIG9yIHdpdGhvdXQgc3RvY2tsaXN0CiAqIHdoZW4gbW92ZW1lbnQgaXMgZnJvbSBhIGRlcG90IGFuZCB3aGVuIG1vdmVtZW50IGlzIGZyb20gYSB2ZW5kb3IuCiAqLwp2YXIgQWRkSXRlbXNQYWdlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKEFkZEl0ZW1zUGFnZSwgX0NvbXBvbmVudCk7CiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihBZGRJdGVtc1BhZ2UpOwogIGZ1bmN0aW9uIEFkZEl0ZW1zUGFnZShwcm9wcykgewogICAgdmFyIF90aGlzOwogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFkZEl0ZW1zUGFnZSk7CiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKTsKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRhdGFGZXRjaGVkIiwgZmFsc2UpOwogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2F2ZVByb2dyZXNzIiwgZnVuY3Rpb24gKF9yZWYxOSkgewogICAgICB2YXIgdmFsdWVzID0gX3JlZjE5LnZhbHVlcywKICAgICAgICByb3dJbmRleCA9IF9yZWYxOS5yb3dJbmRleCwKICAgICAgICBmaWVsZFZhbHVlID0gX3JlZjE5LmZpZWxkVmFsdWU7CiAgICAgIGlmICghX3RoaXMucHJvcHMuaXNBdXRvc2F2ZUVuYWJsZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGFjdGlvbkluUHJvZ3Jlc3MpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8gSSBjYW4ndCBjaGVjayAhIXJvd0luZGV4LCBiZWNhdXNlIGl0IGNhbiBiZSAwLAogICAgICAvLyBzbyB0aGVyZSBpcyBwb3NzaWJpbGl0eSB0byByZXR1cm4gZmFsc2Ugd2hlbiB0aGUKICAgICAgLy8gcm93SW5kZXggaXMgcHJlc2VudAogICAgICB2YXIgaXNFZGl0ZWQgPSByb3dJbmRleCAhPT0gdW5kZWZpbmVkOwogICAgICB2YXIgaXRlbXNXaXRoU3RhdHVzZXMgPSB2YWx1ZXMubGluZUl0ZW1zLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlmIChpc0VkaXRlZCAmJiByb3dJbmRleCA9PT0gdmFsdWVzLmxpbmVJdGVtcy5pbmRleE9mKGl0ZW0pKSB7CiAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBmaWVsZFZhbHVlKSwge30sIHsKICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5QRU5ESU5HCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKGl0ZW0ucHJvZHVjdCAmJiAoIWl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgfHwgcGFyc2VJbnQoaXRlbS5xdWFudGl0eVJlcXVlc3RlZCwgMTApIDw9IDApKSB7CiAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpdGVtKSwge30sIHsKICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5FUlJPUgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpdGVtOwogICAgICB9KTsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB2YWx1ZXMpLCB7fSwgewogICAgICAgICAgbGluZUl0ZW1zOiBpdGVtc1dpdGhTdGF0dXNlcwogICAgICAgIH0pCiAgICAgIH0pOwoKICAgICAgLy8gV2UgZG9uJ3Qgd2FudCB0byBzYXZlIHRoZSBpdGVtIGR1cmluZyBlZGl0aW5nIG9yCiAgICAgIC8vIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgaW4gbGluZQogICAgICBpZiAoaXNFZGl0ZWQpIHsKICAgICAgICBfdGhpcy5kZWJvdW5jZWRTYXZlKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIF90aGlzLmRlYm91bmNlZFNhdmUuY2FuY2VsKCk7CiAgICAgIF90aGlzLnNhdmVSZXF1aXNpdGlvbkl0ZW1zSW5DdXJyZW50U3RlcChpdGVtc1dpdGhTdGF0dXNlcywgZmFsc2UpOwogICAgfSk7CiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgY3VycmVudExpbmVJdGVtczogW10sCiAgICAgIHNvcnRPcmRlcjogMCwKICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzLnByb3BzLmluaXRpYWxWYWx1ZXMpLCB7fSwgewogICAgICAgIGxpbmVJdGVtczogW10KICAgICAgfSksCiAgICAgIG5ld0l0ZW06IGZhbHNlLAogICAgICB0b3RhbENvdW50OiAwLAogICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogZmFsc2UsCiAgICAgIGlzRHJhZnRBdmFpbGFibGU6IGZhbHNlCiAgICB9OwogICAgX3RoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgIF90aGlzLnJlbW92ZUl0ZW0gPSBfdGhpcy5yZW1vdmVJdGVtLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMuaW1wb3J0VGVtcGxhdGUgPSBfdGhpcy5pbXBvcnRUZW1wbGF0ZS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmdldFNvcnRPcmRlciA9IF90aGlzLmdldFNvcnRPcmRlci5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmNvbmZpcm1TYXZlID0gX3RoaXMuY29uZmlybVNhdmUuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5jb25maXJtVHJhbnNpdGlvbiA9IF90aGlzLmNvbmZpcm1UcmFuc2l0aW9uLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMubmV3SXRlbUFkZGVkID0gX3RoaXMubmV3SXRlbUFkZGVkLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMudmFsaWRhdGUgPSBfdGhpcy52YWxpZGF0ZS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmlzUm93TG9hZGVkID0gX3RoaXMuaXNSb3dMb2FkZWQuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5sb2FkTW9yZVJvd3MgPSBfdGhpcy5sb2FkTW9yZVJvd3MuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy51cGRhdGVUb3RhbENvdW50ID0gX3RoaXMudXBkYXRlVG90YWxDb3VudC5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnVwZGF0ZVJvdyA9IF90aGlzLnVwZGF0ZVJvdy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmdldFN0b2NrTW92ZW1lbnREcmFmdCA9IF90aGlzLmdldFN0b2NrTW92ZW1lbnREcmFmdC5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnRyYW5zaXRpb25Ub05leHRTdGVwID0gX3RoaXMudHJhbnNpdGlvblRvTmV4dFN0ZXAuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5zYXZlQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAgPSBfdGhpcy5zYXZlQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5zaG91bGRTaG93QXV0b3NhdmVGZWF0dXJlQmFyID0gX3RoaXMuc2hvdWxkU2hvd0F1dG9zYXZlRmVhdHVyZUJhci5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnNob3VsZENyZWF0ZUF1dG9zYXZlRmVhdHVyZUJhciA9IF90aGlzLnNob3VsZENyZWF0ZUF1dG9zYXZlRmVhdHVyZUJhci5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmRlYm91bmNlZFNhdmUgPSBfLmRlYm91bmNlKGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2F2ZVJlcXVpc2l0aW9uSXRlbXNJbkN1cnJlbnRTdGVwKF90aGlzLnN0YXRlLnZhbHVlcy5saW5lSXRlbXMsIGZhbHNlKTsKICAgIH0sIDEwMDApOwogICAgcmV0dXJuIF90aGlzOwogIH0KICBfY3JlYXRlQ2xhc3MoQWRkSXRlbXNQYWdlLCBbewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICBpZiAodGhpcy5wcm9wcy5zdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZCkgewogICAgICAgIHRoaXMuZGF0YUZldGNoZWQgPSB0cnVlOwogICAgICAgIHRoaXMuZmV0Y2hBbGxEYXRhKCk7CiAgICAgIH0KICAgICAgLy8gSWYgdGhlIGZlYXR1cmUgYmFyIGhhcyBub3QgeWV0IGJlZW4gdHJpZ2dlcmVkLCB0cnkgdG8gYWRkIGl0IHRvIHRoZSByZWR1eCBzdG9yZQogICAgICBpZiAodGhpcy5zaG91bGRDcmVhdGVBdXRvc2F2ZUZlYXR1cmVCYXIoKSkgewogICAgICAgIHRoaXMucHJvcHMuY3JlYXRlSW5mb0JhcihJbmZvQmFyQ29uZmlnc1tJbmZvQmFyLkFVVE9TQVZFXSk7CiAgICAgIH0KICAgICAgLy8gSWYgdGhlIGZlYXR1cmUgYmFyIGhhcyBub3QgeWV0IGJlZW4gY2xvc2VkIGJ5IHRoZSB1c2VyLCBzaG93IGl0CiAgICAgIGlmICh0aGlzLnNob3VsZFNob3dBdXRvc2F2ZUZlYXR1cmVCYXIoKSkgewogICAgICAgIHRoaXMucHJvcHMuc2hvd0luZm9CYXIoSW5mb0Jhci5BVVRPU0FWRSk7CiAgICAgIH0KICAgICAgLy8gSWYgdGhlIGF1dG9zYXZlIGlzIGRpc2FibGVkLCBoaWRlIHRoZSBiYXIKICAgICAgaWYgKCF0aGlzLnByb3BzLmlzQXV0b3NhdmVFbmFibGVkKSB7CiAgICAgICAgdGhpcy5wcm9wcy5oaWRlSW5mb0JhcihJbmZvQmFyLkFVVE9TQVZFKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7CiAgICAgIGlmIChuZXh0UHJvcHMuc3RvY2tNb3ZlbWVudFRyYW5zbGF0aW9uc0ZldGNoZWQgJiYgIXRoaXMuZGF0YUZldGNoZWQpIHsKICAgICAgICB0aGlzLmRhdGFGZXRjaGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmZldGNoQWxsRGF0YSgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50V2lsbFVubW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkgewogICAgICAvLyBXZSB3YW50IHRvIGhpZGUgdGhlIGZlYXR1cmUgYmFyIHdoZW4gdW5tb3VudGluZyB0aGUgY29tcG9uZW50CiAgICAgIC8vIG5vdCB0byBzaG93IGl0IG9uIGFueSBvdGhlciBwYWdlCiAgICAgIHRoaXMucHJvcHMuaGlkZUluZm9CYXIoSW5mb0Jhci5BVVRPU0FWRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHByb3BlciBmaWVsZHMgZGVwZW5kaW5nIG9uIG9yaWdpbiB0eXBlIG9yIGlmIHN0b2NrIGxpc3QgaXMgY2hvc2VuLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiZ2V0RmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZHMoKSB7CiAgICAgIHZhciBmaWVsZHMgPSBfLmdldCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja2xpc3QsICdpZCcpID8gU1RPQ0tMSVNUX0ZJRUxEUyA6IE5PX1NUT0NLTElTVF9GSUVMRFM7CiAgICAgIHZhciBmaWVsZHNXaXRoUm93U2F2ZUljb24gPSB7CiAgICAgICAgbGluZUl0ZW1zOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGZpZWxkcy5saW5lSXRlbXMpLCB7fSwgewogICAgICAgICAgZmllbGRzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGZpZWxkcy5saW5lSXRlbXMuZmllbGRzKSwge30sIHsKICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUk9XX1NBVkVfSUNPTl9GSUVMRAogICAgICAgICAgfSkKICAgICAgICB9KQogICAgICB9OwogICAgICByZXR1cm4gdGhpcy5wcm9wcy5pc0F1dG9zYXZlRW5hYmxlZCA/IGZpZWxkc1dpdGhSb3dTYXZlSWNvbiA6IGZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXJyYXkgb2YgbmV3IHN0b2NrIG1vdmVtZW50J3MgaXRlbXMgYW5kIGl0ZW1zIHRvIGJlCiAgICAgKiB1cGRhdGVkIChjb21wYXJpbmcgdG8gcHJldmlvdXMgc3RhdGUgb2YgbGluZSBpdGVtcykuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gbGluZUl0ZW1zCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJnZXRMaW5lSXRlbXNUb0JlU2F2ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExpbmVJdGVtc1RvQmVTYXZlZChsaW5lSXRlbXMpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIHZhciBsaW5lSXRlbXNUb0JlQWRkZWQgPSBfLmZpbHRlcihsaW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuICFpdGVtLnN0YXR1c0NvZGUgJiYgcGFyc2VJbnQoaXRlbS5xdWFudGl0eVJlcXVlc3RlZCwgMTApID4gMCAmJiBpdGVtLnByb2R1Y3Q7CiAgICAgIH0pOwogICAgICB2YXIgbGluZUl0ZW1zV2l0aFN0YXR1cyA9IF8uZmlsdGVyKGxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5zdGF0dXNDb2RlOwogICAgICB9KTsKICAgICAgdmFyIGxpbmVJdGVtc1RvQmVVcGRhdGVkID0gW107CiAgICAgIF8uZm9yRWFjaChsaW5lSXRlbXNXaXRoU3RhdHVzLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIC8vIFdlIHdvdWxkbid0IHVwZGF0ZSBpdGVtcyB3aXRoIHF1YW50aXR5IHJlcXVlc3RlZCA8PSAwCiAgICAgICAgaWYgKCFpdGVtLnF1YW50aXR5UmVxdWVzdGVkIHx8IHBhcnNlSW50KGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQsIDEwKSA8PSAwKSB7CiAgICAgICAgICByZXR1cm47IC8vIGxvZGFzaCBjb250aW51ZQogICAgICAgIH0KCiAgICAgICAgdmFyIG9sZEl0ZW0gPSBfLmZpbmQoX3RoaXMyLnN0YXRlLmN1cnJlbnRMaW5lSXRlbXMsIGZ1bmN0aW9uIChvbGQpIHsKICAgICAgICAgIHJldHVybiBvbGQuaWQgPT09IGl0ZW0uaWQ7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIG9sZFF0eSA9IHBhcnNlSW50KG9sZEl0ZW0gPT09IG51bGwgfHwgb2xkSXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2xkSXRlbS5xdWFudGl0eVJlcXVlc3RlZCwgMTApOwogICAgICAgIHZhciBuZXdRdHkgPSBwYXJzZUludChpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQsIDEwKTsKICAgICAgICB2YXIgb2xkUmVjaXBpZW50ID0gb2xkSXRlbSAhPT0gbnVsbCAmJiBvbGRJdGVtICE9PSB2b2lkIDAgJiYgb2xkSXRlbS5yZWNpcGllbnQgJiYgXy5pc09iamVjdChvbGRJdGVtID09PSBudWxsIHx8IG9sZEl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9sZEl0ZW0ucmVjaXBpZW50KSA/IG9sZEl0ZW0gPT09IG51bGwgfHwgb2xkSXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2xkSXRlbS5yZWNpcGllbnQuaWQgOiBvbGRJdGVtID09PSBudWxsIHx8IG9sZEl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9sZEl0ZW0ucmVjaXBpZW50OwogICAgICAgIHZhciBuZXdSZWNpcGllbnQgPSBpdGVtICE9PSBudWxsICYmIGl0ZW0gIT09IHZvaWQgMCAmJiBpdGVtLnJlY2lwaWVudCAmJiBfLmlzT2JqZWN0KGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5yZWNpcGllbnQpID8gaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLnJlY2lwaWVudC5pZCA6IGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5yZWNpcGllbnQ7CgogICAgICAgIC8vIEludGVyc2VjdGlvbiBvZiBrZXlzIGNvbW1vbiB0byBib3RoIG9iamVjdHMgKGV4Y2x1ZGluZyBwcm9kdWN0IGtleSkKICAgICAgICB2YXIga2V5SW50ZXJzZWN0aW9uID0gXy5yZW1vdmUoXy5pbnRlcnNlY3Rpb24oXy5rZXlzKG9sZEl0ZW0pLCBfLmtleXMoaXRlbSkpLCBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICByZXR1cm4ga2V5ICE9PSAncHJvZHVjdCc7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKG5ld1F0eSA9PT0gb2xkUXR5ICYmIG5ld1JlY2lwaWVudCA9PT0gb2xkUmVjaXBpZW50ICYmIF90aGlzMi5wcm9wcy5pc0F1dG9zYXZlRW5hYmxlZCkgewogICAgICAgICAgX3RoaXMyLnNldFN0YXRlKGZ1bmN0aW9uIChwcmV2KSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHByZXYudmFsdWVzKSwge30sIHsKICAgICAgICAgICAgICAgIGxpbmVJdGVtczogcHJldi52YWx1ZXMubGluZUl0ZW1zLm1hcChmdW5jdGlvbiAobGluZUl0ZW0pIHsKICAgICAgICAgICAgICAgICAgaWYgKGxpbmVJdGVtLmlkID09PSBpdGVtLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgbGluZUl0ZW0pLCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5TQVZFRAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBsaW5lSXRlbTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoKF90aGlzMi5zdGF0ZS52YWx1ZXMub3JpZ2luLnR5cGUgPT09ICdTVVBQTElFUicgfHwgIV90aGlzMi5zdGF0ZS52YWx1ZXMuaGFzTWFuYWdlSW52ZW50b3J5KSAmJiAoIV8uaXNFcXVhbChfLnBpY2soaXRlbSwga2V5SW50ZXJzZWN0aW9uKSwgXy5waWNrKG9sZEl0ZW0sIGtleUludGVyc2VjdGlvbikpIHx8IGl0ZW0ucHJvZHVjdC5pZCAhPT0gb2xkSXRlbS5wcm9kdWN0LmlkKSkgewogICAgICAgICAgbGluZUl0ZW1zVG9CZVVwZGF0ZWQucHVzaChpdGVtKTsKICAgICAgICB9IGVsc2UgaWYgKG5ld1F0eSAhPT0gb2xkUXR5IHx8IG5ld1JlY2lwaWVudCAhPT0gb2xkUmVjaXBpZW50KSB7CiAgICAgICAgICBsaW5lSXRlbXNUb0JlVXBkYXRlZC5wdXNoKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHZhciBsaW5lSXRlbXNUb1NhdmUgPSBbXS5jb25jYXQoXy5tYXAobGluZUl0ZW1zVG9CZUFkZGVkLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAncHJvZHVjdC5pZCc6IGl0ZW0ucHJvZHVjdC5pZCwKICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiBpdGVtLnF1YW50aXR5UmVxdWVzdGVkLAogICAgICAgICAgJ3JlY2lwaWVudC5pZCc6IF8uaXNPYmplY3QoaXRlbS5yZWNpcGllbnQpID8gaXRlbS5yZWNpcGllbnQuaWQgfHwgJycgOiBpdGVtLnJlY2lwaWVudCB8fCAnJywKICAgICAgICAgIHNvcnRPcmRlcjogaXRlbS5zb3J0T3JkZXIKICAgICAgICB9OwogICAgICB9KSwgXy5tYXAobGluZUl0ZW1zVG9CZVVwZGF0ZWQsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGlkOiBpdGVtLmlkLAogICAgICAgICAgJ3Byb2R1Y3QuaWQnOiBpdGVtLnByb2R1Y3QuaWQsCiAgICAgICAgICBxdWFudGl0eVJlcXVlc3RlZDogaXRlbS5xdWFudGl0eVJlcXVlc3RlZCwKICAgICAgICAgICdyZWNpcGllbnQuaWQnOiBfLmlzT2JqZWN0KGl0ZW0ucmVjaXBpZW50KSA/IGl0ZW0ucmVjaXBpZW50LmlkIHx8ICcnIDogaXRlbS5yZWNpcGllbnQgfHwgJycsCiAgICAgICAgICBzb3J0T3JkZXI6IGl0ZW0uc29ydE9yZGVyCiAgICAgICAgfTsKICAgICAgfSkpOwogICAgICBpZiAodGhpcy5wcm9wcy5pc0F1dG9zYXZlRW5hYmxlZCAmJiBsaW5lSXRlbXNUb1NhdmUubGVuZ3RoKSB7CiAgICAgICAgLy8gSGVyZSBJIGFtIGNoYW5naW5nIHJvd1NhdmVTdGF0dXMgZnJvbSBQRU5ESU5HIHRvIFNBVklORwogICAgICAgIC8vIGJlY2F1c2UgYWxsIG9mIHRoZXNlIGxpbmVzIHdlcmUgc2VudCB0byBzYXZlCiAgICAgICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAocHJldmlvdXNTdGF0ZSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHByZXZpb3VzU3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgICAgICBsaW5lSXRlbXM6IHByZXZpb3VzU3RhdGUudmFsdWVzLmxpbmVJdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChpdGVtLnJvd1NhdmVTdGF0dXMgPT09IFJvd1NhdmVTdGF0dXMuUEVORElORyAmJiBpdGVtLnByb2R1Y3QgJiYgaXRlbS5xdWFudGl0eVJlcXVlc3RlZCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpdGVtKSwge30sIHsKICAgICAgICAgICAgICAgICAgICByb3dTYXZlU3RhdHVzOiBSb3dTYXZlU3RhdHVzLlNBVklORwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBsaW5lSXRlbXNUb1NhdmU7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0U29ydE9yZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTb3J0T3JkZXIoKSB7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIHNvcnRPcmRlcjogdGhpcy5zdGF0ZS5zb3J0T3JkZXIgKyAxMDAKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLnN0YXRlLnNvcnRPcmRlcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRMaW5lSXRlbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldExpbmVJdGVtcyhyZXNwb25zZSwgc3RhcnRJbmRleCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgIHZhciBsaW5lSXRlbXNEYXRhOwogICAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zLmxlbmd0aCA9PT0gMCAmJiAhZGF0YS5sZW5ndGgpIHsKICAgICAgICBsaW5lSXRlbXNEYXRhID0gbmV3IEFycmF5KDEpLmZpbGwoewogICAgICAgICAgc29ydE9yZGVyOiAxMDAsCiAgICAgICAgICByb3dTYXZlU3RhdHVzOiBSb3dTYXZlU3RhdHVzLlBFTkRJTkcKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsaW5lSXRlbXNEYXRhID0gXy5tYXAoZGF0YSwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdmFsKSwge30sIHsKICAgICAgICAgICAgZGlzYWJsZWQ6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHZhciBzb3J0T3JkZXIgPSBfLnRvSW50ZWdlcihfLmxhc3QobGluZUl0ZW1zRGF0YSkuc29ydE9yZGVyKSArIDEwMDsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgY3VycmVudExpbmVJdGVtczogdGhpcy5wcm9wcy5pc1BhZ2luYXRlZCA/IF8udW5pcUJ5KF8uY29uY2F0KHRoaXMuc3RhdGUuY3VycmVudExpbmVJdGVtcywgZGF0YSksICdpZCcpIDogZGF0YSwKICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgICAgbGluZUl0ZW1zOiB0aGlzLnByb3BzLmlzUGFnaW5hdGVkID8gXy51bmlxQnkoXy5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zLCBsaW5lSXRlbXNEYXRhKSwgJ2lkJykgOiBsaW5lSXRlbXNEYXRhCiAgICAgICAgfSksCiAgICAgICAgc29ydE9yZGVyOiBzb3J0T3JkZXIKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghXy5pc051bGwoc3RhcnRJbmRleCkgJiYgX3RoaXMzLnN0YXRlLnZhbHVlcy5saW5lSXRlbXMubGVuZ3RoICE9PSBfdGhpczMuc3RhdGUudG90YWxDb3VudCkgewogICAgICAgICAgX3RoaXMzLmxvYWRNb3JlUm93cyh7CiAgICAgICAgICAgIHN0YXJ0SW5kZXg6IHN0YXJ0SW5kZXggKyBfdGhpczMucHJvcHMucGFnZVNpemUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBfdGhpczMucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0U3RvY2tNb3ZlbWVudERyYWZ0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTdG9ja01vdmVtZW50RHJhZnQoKSB7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICBsaW5lSXRlbXM6IHRoaXMucHJvcHMuc2F2ZWRTdG9ja01vdmVtZW50LmxpbmVJdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaXRlbSksIHt9LCB7CiAgICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5QRU5ESU5HCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkKICAgICAgICB9KSwKICAgICAgICB0b3RhbENvdW50OiB0aGlzLnByb3BzLnNhdmVkU3RvY2tNb3ZlbWVudC5saW5lSXRlbXMubGVuZ3RoLAogICAgICAgIGlzRHJhZnRBdmFpbGFibGU6IGZhbHNlCiAgICAgIH0pOwogICAgICB0aGlzLnNhdmVSZXF1aXNpdGlvbkl0ZW1zSW5DdXJyZW50U3RlcCh0aGlzLnByb3BzLnNhdmVkU3RvY2tNb3ZlbWVudC5saW5lSXRlbXMsIHRydWUpOwogICAgICB0aGlzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2hvdWxkQ3JlYXRlQXV0b3NhdmVGZWF0dXJlQmFyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRDcmVhdGVBdXRvc2F2ZUZlYXR1cmVCYXIoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wcyA9IHRoaXMucHJvcHMsCiAgICAgICAgYmFycyA9IF90aGlzJHByb3BzLmJhcnMsCiAgICAgICAgaXNBdXRvc2F2ZUVuYWJsZWQgPSBfdGhpcyRwcm9wcy5pc0F1dG9zYXZlRW5hYmxlZDsKICAgICAgLy8gQ3JlYXRlIHRoZSBmZWF0dXJlIGJhciBpZiBpdCBoYXMgbm90IGJlZW4geWV0IGNyZWF0ZWQgYW5kIHRoZSBhdXRvc2F2ZSBpcyBlbmFibGVkCiAgICAgIHJldHVybiBpc0F1dG9zYXZlRW5hYmxlZCAmJiAhKGJhcnMgIT09IG51bGwgJiYgYmFycyAhPT0gdm9pZCAwICYmIGJhcnNbSW5mb0Jhci5BVVRPU0FWRV0pOwogICAgfQogIH0sIHsKICAgIGtleTogInNob3VsZFNob3dBdXRvc2F2ZUZlYXR1cmVCYXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3VsZFNob3dBdXRvc2F2ZUZlYXR1cmVCYXIoKSB7CiAgICAgIHZhciBiYXJzID0gdGhpcy5wcm9wcy5iYXJzOwogICAgICAvLyBTaG93IHRoZSBhdXRvc2F2ZSBmZWF0dXJlIGJhciBpZiBpdCBoYXMgYmVlbiBjcmVhdGVkIChhZGRlZCB0byBzdG9yZSkKICAgICAgLy8gYW5kIGhhcyBub3QgeWV0IGJlZW4gY2xvc2VkIGJ5IGEgdXNlcgogICAgICByZXR1cm4gKGJhcnMgPT09IG51bGwgfHwgYmFycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYmFyc1tJbmZvQmFyLkFVVE9TQVZFXSkgJiYgIWJhcnNbSW5mb0Jhci5BVVRPU0FWRV0uY2xvc2VkOwogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZVRvdGFsQ291bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVRvdGFsQ291bnQodmFsdWUpIHsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdG90YWxDb3VudDogdGhpcy5zdGF0ZS50b3RhbENvdW50ICsgdmFsdWUgPT09IDAgPyAxIDogdGhpcy5zdGF0ZS50b3RhbENvdW50ICsgdmFsdWUKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidmFsaWRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlKHZhbHVlcykgewogICAgICB2YXIgZXJyb3JzID0ge307CiAgICAgIGVycm9ycy5saW5lSXRlbXMgPSBbXTsKICAgICAgdmFyIGRhdGUgPSBtb21lbnQodGhpcy5wcm9wcy5taW5pbXVtRXhwaXJhdGlvbkRhdGUsICdNTS9ERC9ZWVlZJyk7CiAgICAgIF8uZm9yRWFjaCh2YWx1ZXMubGluZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7CiAgICAgICAgaWYgKCFfLmlzTmlsKGl0ZW0ucHJvZHVjdCkgJiYgKCFpdGVtLnF1YW50aXR5UmVxdWVzdGVkIHx8IGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgPD0gMCkpIHsKICAgICAgICAgIGVycm9ycy5saW5lSXRlbXNba2V5XSA9IHsKICAgICAgICAgICAgcXVhbnRpdHlSZXF1ZXN0ZWQ6ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmVudGVyUXVhbnRpdHkubGFiZWwnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAoIV8uaXNFbXB0eShpdGVtLmJveE5hbWUpICYmIF8uaXNFbXB0eShpdGVtLnBhbGxldE5hbWUpKSB7CiAgICAgICAgICBlcnJvcnMubGluZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgICAgIGJveE5hbWU6ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmJveFdpdGhvdXRQYWxsZXQubGFiZWwnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICB2YXIgZGF0ZVJlcXVlc3RlZCA9IG1vbWVudChpdGVtLmV4cGlyYXRpb25EYXRlLCAnTU0vREQvWVlZWScpOwogICAgICAgIGlmIChkYXRlLmRpZmYoZGF0ZVJlcXVlc3RlZCkgPiAwKSB7CiAgICAgICAgICBlcnJvcnMubGluZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5pbnZhbGlkRGF0ZS5sYWJlbCcKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGVycm9yczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVSb3ciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVJvdyh2YWx1ZXMsIGluZGV4KSB7CiAgICAgIHZhciBpdGVtID0gdmFsdWVzLmxpbmVJdGVtc1tpbmRleF07CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIHZhbHVlczogdXBkYXRlKHZhbHVlcywgewogICAgICAgICAgbGluZUl0ZW1zOiBfZGVmaW5lUHJvcGVydHkoe30sIGluZGV4LCB7CiAgICAgICAgICAgICRzZXQ6IGl0ZW0KICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAibmV3SXRlbUFkZGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBuZXdJdGVtQWRkZWQoKSB7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIG5ld0l0ZW06IHRydWUKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93cyBzYXZlIGNvbmZpcm1hdGlvbiBkaWFsb2cuCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBvbkNvbmZpcm0KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImNvbmZpcm1TYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb25maXJtU2F2ZShvbkNvbmZpcm0pIHsKICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQubWVzc2FnZS5jb25maXJtU2F2ZS5sYWJlbCcsICdDb25maXJtIHNhdmUnKSwKICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtU2F2ZS5tZXNzYWdlJywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBzYXZlPyBUaGVyZSBhcmUgc29tZSBsaW5lcyB3aXRoIGVtcHR5IG9yIHplcm8gcXVhbnRpdHksIHRob3NlIGxpbmVzIHdpbGwgYmUgZGVsZXRlZC4nKSwKICAgICAgICBidXR0b25zOiBbewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lnllcy5sYWJlbCcsICdZZXMnKSwKICAgICAgICAgIG9uQ2xpY2s6IG9uQ29uZmlybQogICAgICAgIH0sIHsKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgfV0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93cyB0cmFuc2l0aW9uIGNvbmZpcm1hdGlvbiBkaWFsb2cgaWYgdGhlcmUgYXJlIGl0ZW1zIHdpdGggdGhlIHNhbWUgY29kZS4KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IG9uQ29uZmlybQogICAgICogQHBhcmFtIHtvYmplY3R9IGl0ZW1zCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJjb25maXJtVHJhbnNpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29uZmlybVRyYW5zaXRpb24ob25Db25maXJtLCBpdGVtcykgewogICAgICBjb25maXJtQWxlcnQoewogICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtVHJhbnNpdGlvbi5sYWJlbCcsICdZb3UgaGF2ZSBlbnRlcmVkIHRoZSBzYW1lIGNvZGUgdHdpY2UuIERvIHlvdSB3YW50IHRvIGNvbnRpbnVlPycpLAogICAgICAgIG1lc3NhZ2U6IF8ubWFwKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgdmFyIF9pdGVtJHByb2R1Y3QkZGlzcGxheTsKICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgicCIsIHsKICAgICAgICAgICAga2V5OiBpdGVtLnNvcnRPcmRlcgogICAgICAgICAgfSwgIiIuY29uY2F0KGl0ZW0ucHJvZHVjdC5wcm9kdWN0Q29kZSwgIiAiKS5jb25jYXQoKChfaXRlbSRwcm9kdWN0JGRpc3BsYXkgPSBpdGVtLnByb2R1Y3QuZGlzcGxheU5hbWVzKSA9PT0gbnVsbCB8fCBfaXRlbSRwcm9kdWN0JGRpc3BsYXkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9pdGVtJHByb2R1Y3QkZGlzcGxheVsiZGVmYXVsdCJdKSB8fCBpdGVtLnByb2R1Y3QubmFtZSwgIiAiKS5jb25jYXQoaXRlbS5xdWFudGl0eVJlcXVlc3RlZCkpOwogICAgICAgIH0pLAogICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQueWVzLmxhYmVsJywgJ1llcycpLAogICAgICAgICAgb25DbGljazogb25Db25maXJtCiAgICAgICAgfSwgewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lm5vLmxhYmVsJywgJ05vJykKICAgICAgICB9XQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb25maXJtU3VibWl0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb25maXJtU3VibWl0KG9uQ29uZmlybSkgewogICAgICBjb25maXJtQWxlcnQoewogICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5tZXNzYWdlLmNvbmZpcm1TdWJtaXQubGFiZWwnLCAnQ29uZmlybSBzdWJtaXQnKSwKICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtU3VibWl0Lm1lc3NhZ2UnLCAnUGxlYXNlIGNvbmZpcm0geW91IGFyZSByZWFkeSB0byBzdWJtaXQgeW91ciByZXF1ZXN0LiBPbmNlIHN1Ym1pdHRlZCwgeW91IGNhbm5vdCBlZGl0IHRoZSByZXF1ZXN0LicpLAogICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQuZ29CYWNrLmxhYmVsJywgJ0dvIGJhY2snKQogICAgICAgIH0sIHsKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5zdWJtaXQubGFiZWwnLCAnU3VibWl0JyksCiAgICAgICAgICBvbkNsaWNrOiBvbkNvbmZpcm0KICAgICAgICB9XQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIEZldGNoZXMgYWxsIHJlcXVpcmVkIGRhdGEuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJmZXRjaEFsbERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoQWxsRGF0YSgpIHsKICAgICAgdGhpcy5wcm9wcy5mZXRjaFVzZXJzKCk7CiAgICAgIHRoaXMuZmV0Y2hBZGRJdGVtc1BhZ2VEYXRhKCk7CiAgICAgIGlmICghdGhpcy5wcm9wcy5pc1BhZ2luYXRlZCkgewogICAgICAgIHRoaXMuZmV0Y2hMaW5lSXRlbXMoKTsKICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmV0Y2hlcyAybmQgc3RlcCBkYXRhIGZyb20gY3VycmVudCBzdG9jayBtb3ZlbWVudC4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImZldGNoTGluZUl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaExpbmVJdGVtcygpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3N0b2NrTW92ZW1lbnRJdGVtcz9zdGVwTnVtYmVyPTIiKTsKICAgICAgcmV0dXJuIGFwaUNsaWVudC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNC5zZXRTdGF0ZSh7CiAgICAgICAgICB0b3RhbENvdW50OiByZXNwb25zZS5kYXRhLmRhdGEubGVuZ3RoCiAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzNC5zZXRMaW5lSXRlbXMocmVzcG9uc2UsIG51bGwpOwogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgcmV0dXJuIGVycjsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGZXRjaGVzIHN0b2NrIG1vdmVtZW50J3MgbGluZSBpdGVtcyBhbmQgc2V0cyB0aGVtIGluIHJlZHV4IGZvcm0gYW5kIGluCiAgICAgKiBzdGF0ZSBhcyBjdXJyZW50IGxpbmUgaXRlbXMuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJmZXRjaEFkZEl0ZW1zUGFnZURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoQWRkSXRlbXNQYWdlRGF0YSgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgdmFyIF90aGlzJHByb3BzJHNhdmVkU3RvYyA9IHRoaXMucHJvcHMuc2F2ZWRTdG9ja01vdmVtZW50LAogICAgICAgIGxhc3RTYXZlZCA9IF90aGlzJHByb3BzJHNhdmVkU3RvYy5sYXN0VXBkYXRlZCwKICAgICAgICBzYXZlZFN0YXR1c0NvZGUgPSBfdGhpcyRwcm9wcyRzYXZlZFN0b2Muc3RhdHVzQ29kZSwKICAgICAgICBpZCA9IF90aGlzJHByb3BzJHNhdmVkU3RvYy5pZDsKICAgICAgdmFyIHN0b2NrTW92ZW1lbnRJZCA9IHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZDsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdChzdG9ja01vdmVtZW50SWQpOwogICAgICBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgIHZhciBfcmVzcCRkYXRhJGRhdGEgPSByZXNwLmRhdGEuZGF0YSwKICAgICAgICAgIGhhc01hbmFnZUludmVudG9yeSA9IF9yZXNwJGRhdGEkZGF0YS5oYXNNYW5hZ2VJbnZlbnRvcnksCiAgICAgICAgICBzdGF0dXNDb2RlID0gX3Jlc3AkZGF0YSRkYXRhLnN0YXR1c0NvZGUsCiAgICAgICAgICBsYXN0VXBkYXRlZCA9IF9yZXNwJGRhdGEkZGF0YS5sYXN0VXBkYXRlZDsKICAgICAgICB2YXIgdG90YWxDb3VudCA9IHJlc3AuZGF0YS50b3RhbENvdW50OwogICAgICAgIC8vIGlmIGRhdGEgZnJvbSBiYWNrZW5kIGlzIG9sZGVyIHRoYW4gdGhlIHZlcnNpb24gZnJvbSBsb2NhbCBzdG9yYWdlCiAgICAgICAgLy8gd2Ugd2FudCB0byBhbGxvdyB1c2VycyB1c2UgdGhlaXIgdmVyc2lvbgogICAgICAgIHZhciBpc0RyYWZ0QXZhaWxhYmxlID0gX3RoaXM1LnByb3BzLmlzQXV0b3NhdmVFbmFibGVkICYmIHN0b2NrTW92ZW1lbnRJZCA9PT0gaWQgJiYgbGFzdFVwZGF0ZWQgPCBsYXN0U2F2ZWQgJiYgc2F2ZWRTdGF0dXNDb2RlID09PSBzdGF0dXNDb2RlOwogICAgICAgIF90aGlzNS5zZXRTdGF0ZSh7CiAgICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXM1LnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICAgIGhhc01hbmFnZUludmVudG9yeTogaGFzTWFuYWdlSW52ZW50b3J5LAogICAgICAgICAgICBzdGF0dXNDb2RlOiBzdGF0dXNDb2RlCiAgICAgICAgICB9KSwKICAgICAgICAgIHRvdGFsQ291bnQ6IHRvdGFsQ291bnQgPT09IDAgPyAxIDogdG90YWxDb3VudCwKICAgICAgICAgIGlzRHJhZnRBdmFpbGFibGU6IGlzRHJhZnRBdmFpbGFibGUKICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXM1LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImxvYWRNb3JlUm93cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZE1vcmVSb3dzKF9yZWYyMCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKICAgICAgdmFyIHN0YXJ0SW5kZXggPSBfcmVmMjAuc3RhcnRJbmRleDsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IHRydWUKICAgICAgfSk7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3N0b2NrTW92ZW1lbnRJdGVtcz9vZmZzZXQ9IikuY29uY2F0KHN0YXJ0SW5kZXgsICImbWF4PSIpLmNvbmNhdCh0aGlzLnByb3BzLnBhZ2VTaXplLCAiJnN0ZXBOdW1iZXI9MiIpOwogICAgICBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczYuc2V0TGluZUl0ZW1zKHJlc3BvbnNlLCBzdGFydEluZGV4KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjdXJyZW50IHN0b2NrIG1vdmVtZW50IHByb2dyZXNzIChsaW5lIGl0ZW1zKSBhbmQgZ29lcyB0byB0aGUgbmV4dCBzdG9jayBtb3ZlbWVudCBzdGVwLgogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogIm5leHRQYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBuZXh0UGFnZShmb3JtVmFsdWVzKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwogICAgICB2YXIgbGluZUl0ZW1zID0gXy5maWx0ZXIoZm9ybVZhbHVlcy5saW5lSXRlbXMsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICByZXR1cm4gIV8uaXNFbXB0eSh2YWwpICYmIHZhbC5wcm9kdWN0OwogICAgICB9KTsKICAgICAgaWYgKF8uc29tZShsaW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuICFpdGVtLnF1YW50aXR5UmVxdWVzdGVkIHx8IGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgPT09ICcwJzsKICAgICAgfSkpIHsKICAgICAgICB0aGlzLmNvbmZpcm1TYXZlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczcuY2hlY2tEdXBsaWNhdGVzQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAobGluZUl0ZW1zLCBmb3JtVmFsdWVzKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNoZWNrRHVwbGljYXRlc0FuZFRyYW5zaXRpb25Ub05leHRTdGVwKGxpbmVJdGVtcywgZm9ybVZhbHVlcyk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjaGVja0R1cGxpY2F0ZXNBbmRUcmFuc2l0aW9uVG9OZXh0U3RlcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tEdXBsaWNhdGVzQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAobGluZUl0ZW1zLCBmb3JtVmFsdWVzKSB7CiAgICAgIHZhciB0cmFuc2l0aW9uRnVuY3Rpb24gPSB0aGlzLnByb3BzLmlzQXV0b3NhdmVFbmFibGVkID8gdGhpcy50cmFuc2l0aW9uVG9OZXh0U3RlcCA6IHRoaXMuc2F2ZUFuZFRyYW5zaXRpb25Ub05leHRTdGVwOwogICAgICB2YXIgaXRlbXNNYXAgPSB7fTsKICAgICAgXy5mb3JFYWNoKGxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbXNNYXBbaXRlbS5wcm9kdWN0LnByb2R1Y3RDb2RlXSkgewogICAgICAgICAgaXRlbXNNYXBbaXRlbS5wcm9kdWN0LnByb2R1Y3RDb2RlXS5wdXNoKGl0ZW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpdGVtc01hcFtpdGVtLnByb2R1Y3QucHJvZHVjdENvZGVdID0gW2l0ZW1dOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHZhciBpdGVtc1dpdGhTYW1lQ29kZSA9IF8uZmlsdGVyKGl0ZW1zTWFwLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLmxlbmd0aCA+IDE7CiAgICAgIH0pOwogICAgICBpZiAoXy5zb21lKGl0ZW1zTWFwLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLmxlbmd0aCA+IDE7CiAgICAgIH0pICYmICEodGhpcy5zdGF0ZS52YWx1ZXMub3JpZ2luLnR5cGUgPT09ICdTVVBQTElFUicgfHwgIXRoaXMuc3RhdGUudmFsdWVzLmhhc01hbmFnZUludmVudG9yeSkpIHsKICAgICAgICB0aGlzLmNvbmZpcm1UcmFuc2l0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0cmFuc2l0aW9uRnVuY3Rpb24oZm9ybVZhbHVlcywgbGluZUl0ZW1zKTsKICAgICAgICB9LCBfLnJlZHVjZShpdGVtc1dpdGhTYW1lQ29kZSwgZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLmNvbmNhdChiKTsKICAgICAgICB9LCBbXSkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRyYW5zaXRpb25GdW5jdGlvbihmb3JtVmFsdWVzLCBsaW5lSXRlbXMpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2F2ZUFuZFRyYW5zaXRpb25Ub05leHRTdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAoZm9ybVZhbHVlcywgbGluZUl0ZW1zKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHRoaXMuc2F2ZVJlcXVpc2l0aW9uSXRlbXMobGluZUl0ZW1zKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgaWYgKHJlc3ApIHsKICAgICAgICAgIF90aGlzOC50cmFuc2l0aW9uVG9OZXh0U3RlcCh7CiAgICAgICAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBmb3JtVmFsdWVzKSwge30sIHsKICAgICAgICAgICAgICBsaW5lSXRlbXM6IHJlc3AuZGF0YS5kYXRhLmxpbmVJdGVtcwogICAgICAgICAgICB9KQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIF90aGlzOC50cmFuc2l0aW9uVG9OZXh0U3RlcCh7CiAgICAgICAgICB2YWx1ZXM6IGZvcm1WYWx1ZXMKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczgucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBsaXN0IG9mIHN0b2NrIG1vdmVtZW50IGl0ZW1zIHdpdGggcG9zdCBtZXRob2QuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gbGluZUl0ZW1zCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzYXZlUmVxdWlzaXRpb25JdGVtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZVJlcXVpc2l0aW9uSXRlbXMobGluZUl0ZW1zKSB7CiAgICAgIHZhciBpdGVtc1RvU2F2ZSA9IHRoaXMuZ2V0TGluZUl0ZW1zVG9CZVNhdmVkKGxpbmVJdGVtcyk7CiAgICAgIHZhciB1cGRhdGVJdGVtc1VybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvdXBkYXRlSXRlbXMiKTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgaWQ6IHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwKICAgICAgICBsaW5lSXRlbXM6IGl0ZW1zVG9TYXZlCiAgICAgIH07CiAgICAgIGlmIChwYXlsb2FkLmxpbmVJdGVtcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QodXBkYXRlSXRlbXNVcmwsIHBheWxvYWQpWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3Iuc2F2ZVJlcXVpc2l0aW9uSXRlbXMubGFiZWwnKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgbGlzdCBvZiByZXF1aXNpdGlvbiBpdGVtcyBpbiBjdXJyZW50IHN0ZXAgKHdpdGhvdXQgc3RlcCBjaGFuZ2UpLiBVc2VkIHRvIGV4cG9ydCB0ZW1wbGF0ZS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBpdGVtQ2FuZGlkYXRlc1RvU2F2ZQogICAgICogQHBhcmFtIHtib29sZWFufSB3aXRoU3RhdGVDaGFuZ2UKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVSZXF1aXNpdGlvbkl0ZW1zSW5DdXJyZW50U3RlcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZVJlcXVpc2l0aW9uSXRlbXNJbkN1cnJlbnRTdGVwKGl0ZW1DYW5kaWRhdGVzVG9TYXZlKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwogICAgICB2YXIgd2l0aFN0YXRlQ2hhbmdlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0cnVlOwogICAgICAvLyBXZSBmaWx0ZXIgb3V0IGl0ZW1zIHdoaWNoIHdlcmUgYWxyZWFkeSBzZW50IHRvIHNhdmUKICAgICAgdmFyIGZpbHRlcmVkQ2FuZGlkYXRlcyA9IGl0ZW1DYW5kaWRhdGVzVG9TYXZlLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnJvd1NhdmVTdGF0dXMgIT09IFJvd1NhdmVTdGF0dXMuU0FWSU5HOwogICAgICB9KTsKICAgICAgdmFyIGl0ZW1zVG9TYXZlID0gdGhpcy5nZXRMaW5lSXRlbXNUb0JlU2F2ZWQoZmlsdGVyZWRDYW5kaWRhdGVzKTsKICAgICAgdmFyIHVwZGF0ZUl0ZW1zVXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi91cGRhdGVJdGVtcyIpOwogICAgICB2YXIgcGF5bG9hZCA9IHsKICAgICAgICBpZDogdGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLAogICAgICAgIGxpbmVJdGVtczogaXRlbXNUb1NhdmUKICAgICAgfTsKICAgICAgaWYgKHBheWxvYWQubGluZUl0ZW1zLmxlbmd0aCkgewogICAgICAgIGlmICghdGhpcy5wcm9wcy5pc09ubGluZSAmJiB0aGlzLnByb3BzLmlzQXV0b3NhdmVFbmFibGVkKSB7CiAgICAgICAgICB0aGlzLnByb3BzLmFkZFN0b2NrTW92ZW1lbnREcmFmdCh7CiAgICAgICAgICAgIGxpbmVJdGVtczogaXRlbUNhbmRpZGF0ZXNUb1NhdmUsCiAgICAgICAgICAgIGlkOiB0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsCiAgICAgICAgICAgIHN0YXR1c0NvZGU6IHRoaXMuc3RhdGUudmFsdWVzLnN0YXR1c0NvZGUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QodXBkYXRlSXRlbXNVcmwsIHBheWxvYWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAgIHZhciBsaW5lSXRlbXMgPSByZXNwLmRhdGEuZGF0YS5saW5lSXRlbXM7CiAgICAgICAgICB2YXIgbGluZUl0ZW1zQmFja2VuZERhdGEgPSBfLm1hcChsaW5lSXRlbXMsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdmFsKSwge30sIHsKICAgICAgICAgICAgICBkaXNhYmxlZDogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgLy8gSW4gYXV0b3NhdmUsIHdlIGRvbid0IG1vZGlmeSB0aGUgc3RhdGUsIGJlY2F1c2UKICAgICAgICAgIC8vIGxpbmVzIHdoaWNoIGhhdmUgbm90IHBhc3NlZCB0aGUgdmFsaWRhdGlvbiB3aWxsIGJlCiAgICAgICAgICAvLyBkZWxldGVkIGR1cmluZyB1c2VycyB3b3JrCiAgICAgICAgICBpZiAoIXdpdGhTdGF0ZUNoYW5nZSkgewogICAgICAgICAgICAvLyBXZSB3YW50IHRvIGRpc2FibGUgc2F2ZWQgbGluZSwgc28gSSBhbSBsb29raW5nIGZvciBwcm9kdWN0IHdpdGggdGhlIHNhbWUKICAgICAgICAgICAgLy8gY29kZSBhbmQgcXVhbnRpdHkgaGlnaGVyIHRoYW4gMCBpbiByZXNwb25zZQogICAgICAgICAgICAvLyAodG8gYXZvaWQgZGlzYWJsaW5nIG5ldyBsaW5lIHdpdGggdGhlIHNhbWUgcHJvZHVjdENvZGUpCgogICAgICAgICAgICAvLyBUT0RPOiBBZGQgbmV3IGFwaSBlbmRwb2ludHMgaW4gU3RvY2tNb3ZlbWVudEl0ZW1BcGlDb250cm9sbGVyCiAgICAgICAgICAgIC8vIGZvciBQT1NUIGFuZCBQVVQgKGNyZWF0ZSBhbmQgdXBkYXRlKSB0aGF0IHJldHVybnMgb25seSB1cGRhdGVkIGl0ZW1zIGRhdGEKICAgICAgICAgICAgLy8gYW5kIHNlcGFyYXRlIGF1dG9zYXZlIGxvZ2ljIGZyb20gc2F2ZSBidXR0b24gbG9naWMKICAgICAgICAgICAgdmFyIHNhdmVkSXRlbXNQcm9kdWN0Q29kZXMgPSBsaW5lSXRlbXNCYWNrZW5kRGF0YS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbS5wcm9kdWN0Q29kZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBzYXZlZEl0ZW1zSWRzID0gbGluZUl0ZW1zQmFja2VuZERhdGEubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uaWQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBXZSBhcmUgc2VuZGluZyBpdGVtIGJ5IGl0ZW0gdG8gQVBJLiBIZXJlIHdlIGhhdmUgdG8gZmluZAogICAgICAgICAgICAvLyBuZXdseSBzYXZlZCBpdGVtIHRvIHJlcGxhY2UgaXRzIGVxdWl2YWxlbnQgaW4gc3RhdGUKICAgICAgICAgICAgdmFyIGl0ZW1Ub0NoYW5nZSA9IF8ubGFzdChfLmRpZmZlcmVuY2VCeShsaW5lSXRlbXNCYWNrZW5kRGF0YSwgaXRlbUNhbmRpZGF0ZXNUb1NhdmUsICdpZCcpKTsKICAgICAgICAgICAgdmFyIGxpbmVJdGVtc0FmdGVyU2F2ZSA9IF90aGlzOS5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHZhciBfaXRlbSRwcm9kdWN0OwogICAgICAgICAgICAgIC8vIEluIHRoaXMgY2FzZSB3ZSBjaGVjayBpZiB3ZSdyZSBlZGl0aW5nIGl0ZW0KICAgICAgICAgICAgICAvLyBXZSBkb24ndCBoYXZlIHRvIGRpc2FibGUgZWRpdGVkIGl0ZW0sIGJlY2F1c2UgdGhpcwogICAgICAgICAgICAgIC8vIGxpbmUgaXMgZGlzYWJsZWQgYnkgZGVmYXVsdAogICAgICAgICAgICAgIGlmIChfLmluY2x1ZGVzKHNhdmVkSXRlbXNJZHMsIGl0ZW0uaWQpICYmIGl0ZW0ucm93U2F2ZVN0YXR1cyAhPT0gUm93U2F2ZVN0YXR1cy5FUlJPUikgewogICAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaXRlbSksIHt9LCB7CiAgICAgICAgICAgICAgICAgIHJvd1NhdmVTdGF0dXM6IFJvd1NhdmVTdGF0dXMuU0FWRUQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoXy5pbmNsdWRlcyhzYXZlZEl0ZW1zUHJvZHVjdENvZGVzLCAoX2l0ZW0kcHJvZHVjdCA9IGl0ZW0ucHJvZHVjdCkgPT09IG51bGwgfHwgX2l0ZW0kcHJvZHVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2l0ZW0kcHJvZHVjdC5wcm9kdWN0Q29kZSkgJiYgcGFyc2VJbnQoaXRlbS5xdWFudGl0eVJlcXVlc3RlZCwgMTApID4gMCAmJiBpdGVtLnJvd1NhdmVTdGF0dXMgPT09IFJvd1NhdmVTdGF0dXMuU0FWSU5HKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpdGVtVG9DaGFuZ2UpLCB7fSwgewogICAgICAgICAgICAgICAgICBkaXNhYmxlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5TQVZFRAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3RoaXM5LnNldFN0YXRlKHsKICAgICAgICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXM5LnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICAgICAgICBsaW5lSXRlbXM6IGxpbmVJdGVtc0FmdGVyU2F2ZQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGN1cnJlbnRMaW5lSXRlbXM6IGxpbmVJdGVtc0FmdGVyU2F2ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgX3RoaXM5LnNldFN0YXRlKHsKICAgICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzOS5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgICAgICAgIGxpbmVJdGVtczogbGluZUl0ZW1zQmFja2VuZERhdGEKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIGN1cnJlbnRMaW5lSXRlbXM6IGxpbmVJdGVtc0JhY2tlbmREYXRhCiAgICAgICAgICB9KTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChfdGhpczkucHJvcHMuaXNBdXRvc2F2ZUVuYWJsZWQpIHsKICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gbmVlZCBmb3IgY3JlYXRpbmcgZHJhZnQKICAgICAgICAgICAgLy8gaWYgYWxsIG9mIG15IGl0ZW1zIGFyZSBzYXZlZCBjb3JyZWN0bHkKICAgICAgICAgICAgLy8gKGl0IG1lYW5zIHRoYXQgd2UgaGF2ZSBpbnRlcm5ldCBjb25uZWN0aW9uKQogICAgICAgICAgICBfdGhpczkucHJvcHMucmVtb3ZlU3RvY2tNb3ZlbWVudERyYWZ0KF90aGlzOS5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkKTsKICAgICAgICAgIH0KICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoX3RoaXM5LnByb3BzLmlzQXV0b3NhdmVFbmFibGVkKSB7CiAgICAgICAgICAgIC8vIFdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgZHVyaW5nIHNhdmluZyB3ZSBoYXZlIHRvIGZpbmQgcHJvZHVjdHMgd2hpY2gKICAgICAgICAgICAgLy8gY2F1c2VkIHRoZSBlcnJvci4gVGhlc2UgaXRlbXMgYXJlIG5vdCBzYXZlZCwgc28gd2UgZG9uJ3QgaGF2ZSBsaW5lIElELAogICAgICAgICAgICAvLyBhbmQgd2UgaGF2ZSB0byBmaW5kIHRoZXNlIGl0ZW1zIGJ5IHByb2R1Y3QgSUQgYW5kIFNhdmVTdGF0dXMKICAgICAgICAgICAgdmFyIG5vdFNhdmVkSXRlbXNJZHMgPSBwYXlsb2FkLmxpbmVJdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbVsncHJvZHVjdC5pZCddOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGxpbmVJdGVtc1dpdGhFcnJvcnMgPSBfdGhpczkuc3RhdGUudmFsdWVzLmxpbmVJdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICBpZiAoaXRlbS5wcm9kdWN0ICYmIGl0ZW0ucm93U2F2ZVN0YXR1cyA9PT0gUm93U2F2ZVN0YXR1cy5TQVZJTkcgJiYgXy5pbmNsdWRlcyhub3RTYXZlZEl0ZW1zSWRzLCBpdGVtLnByb2R1Y3QuaWQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpdGVtKSwge30sIHsKICAgICAgICAgICAgICAgICAgcm93U2F2ZVN0YXR1czogUm93U2F2ZVN0YXR1cy5FUlJPUgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3RoaXM5LnNldFN0YXRlKHsKICAgICAgICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXM5LnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICAgICAgICBsaW5lSXRlbXM6IGxpbmVJdGVtc1dpdGhFcnJvcnMKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKCFfdGhpczkucHJvcHMuaXNPbmxpbmUpIHsKICAgICAgICAgICAgICAvLyBXaGVuIHRoZXJlIGlzIGFuIGVycm9yLCB3ZSBhcmUgYWRkaW5nIGl0ZW1zIHRvCiAgICAgICAgICAgICAgLy8gc3RhdGUgZm9yIGRyYWZ0CiAgICAgICAgICAgICAgX3RoaXM5LnByb3BzLmFkZFN0b2NrTW92ZW1lbnREcmFmdCh7CiAgICAgICAgICAgICAgICBsaW5lSXRlbXM6IF90aGlzOS5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zLAogICAgICAgICAgICAgICAgaWQ6IF90aGlzOS5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLAogICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogX3RoaXM5LnN0YXRlLnZhbHVlcy5zdGF0dXNDb2RlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoX3RoaXM5LnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5zYXZlUmVxdWlzaXRpb25JdGVtcy5sYWJlbCcsICdDb3VsZCBub3Qgc2F2ZSByZXF1aXNpdGlvbiBpdGVtcycpKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgfQoKICAgIC8vIGlmIHJvd0luZGV4IGlzIHBhc3NlZCwgaXQgbWVhbnMgdGhhdCB3ZSBhcmUgZWRpdGluZyByb3cKICAgIC8vIG5vdCBhZGRpbmcgbmV3IG9uZQogIH0sIHsKICAgIGtleTogInNhdmUiLAogICAgdmFsdWU6CiAgICAvKioKICAgICAqIFNhdmVzIGxpc3Qgb2YgcmVxdWlzaXRpb24gaXRlbXMgaW4gY3VycmVudCBzdGVwICh3aXRob3V0IHN0ZXAgY2hhbmdlKS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmb3JtVmFsdWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNhdmUoZm9ybVZhbHVlcykgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CiAgICAgIGFjdGlvbkluUHJvZ3Jlc3MgPSB0cnVlOwogICAgICB2YXIgbGluZUl0ZW1zID0gXy5maWx0ZXIoZm9ybVZhbHVlcy5saW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuICFfLmlzRW1wdHkoaXRlbSk7CiAgICAgIH0pOwogICAgICBpZiAoXy5zb21lKGxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gIWl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgfHwgaXRlbS5xdWFudGl0eVJlcXVlc3RlZCA9PT0gJzAnOwogICAgICB9KSkgewogICAgICAgIHRoaXMuY29uZmlybVNhdmUoZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMxMC5zYXZlSXRlbXMobGluZUl0ZW1zKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNhdmVJdGVtcyhsaW5lSXRlbXMpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjaGFuZ2VzIG1hZGUgYnkgdXNlciBpbiB0aGlzIHN0ZXAgYW5kIHJlZGlyZWN0cyB0byB0aGUgc2hpcG1lbnQgdmlldyBwYWdlCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZm9ybVZhbHVlcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZUFuZEV4aXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmVBbmRFeGl0KGZvcm1WYWx1ZXMpIHsKICAgICAgYWN0aW9uSW5Qcm9ncmVzcyA9IHRydWU7CiAgICAgIHZhciBlcnJvcnMgPSB0aGlzLnZhbGlkYXRlKGZvcm1WYWx1ZXMpLmxpbmVJdGVtczsKICAgICAgaWYgKCFlcnJvcnMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5zYXZlUmVxdWlzaXRpb25JdGVtc0luQ3VycmVudFN0ZXAoZm9ybVZhbHVlcy5saW5lSXRlbXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9zaG93LyIuY29uY2F0KGZvcm1WYWx1ZXMuc3RvY2tNb3ZlbWVudElkKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25maXJtQWxlcnQoewogICAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1FeGl0LmxhYmVsJywgJ0NvbmZpcm0gc2F2ZScpLAogICAgICAgICAgbWVzc2FnZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybUV4aXQubWVzc2FnZScsICdWYWxpZGF0aW9uIGVycm9ycyBvY2N1cnJlZC4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGV4aXQgYW5kIGxvc2UgdW5zYXZlZCBkYXRhPycpLAogICAgICAgICAgYnV0dG9uczogW3sKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lnllcy5sYWJlbCcsICdZZXMnKSwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAiL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L3Nob3cvIi5jb25jYXQoZm9ybVZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgICB9XQogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBsaXN0IG9mIHJlcXVpc2l0aW9uIGl0ZW1zIGluIGN1cnJlbnQgc3RlcCAod2l0aG91dCBzdGVwIGNoYW5nZSkuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gbGluZUl0ZW1zCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzYXZlSXRlbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmVJdGVtcyhsaW5lSXRlbXMpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHRoaXMuc2F2ZVJlcXVpc2l0aW9uSXRlbXNJbkN1cnJlbnRTdGVwKGxpbmVJdGVtcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMS5mZXRjaExpbmVJdGVtcygpOwogICAgICAgIF90aGlzMTEucHJvcHMucmVtb3ZlU3RvY2tNb3ZlbWVudERyYWZ0KF90aGlzMTEuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCk7CiAgICAgICAgX3RoaXMxMS5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIEFsZXJ0LnN1Y2Nlc3MoX3RoaXMxMS5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuYWxlcnQuc2F2ZVN1Y2Nlc3MubGFiZWwnLCAnQ2hhbmdlcyBzYXZlZCBzdWNjZXNzZnVsbHknKSwgewogICAgICAgICAgdGltZW91dDogMzAwMAogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMTEucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSlbImZpbmFsbHkiXShmdW5jdGlvbiAoKSB7CiAgICAgICAgYWN0aW9uSW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmV0Y2ggdGhlIGRhdGEsIGFsbCBub3Qgc2F2ZWQgY2hhbmdlcyB3aWxsIGJlIGxvc3QuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CiAgICAgIGNvbmZpcm1BbGVydCh7CiAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50Lm1lc3NhZ2UuY29uZmlybVJlZnJlc2gubGFiZWwnLCAnQ29uZmlybSByZWZyZXNoJyksCiAgICAgICAgbWVzc2FnZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVJlZnJlc2gubWVzc2FnZScsICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVmcmVzaD8gWW91ciBwcm9ncmVzcyBzaW5jZSBsYXN0IHNhdmUgd2lsbCBiZSBsb3N0LicpLAogICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQueWVzLmxhYmVsJywgJ1llcycpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMTIuZmV0Y2hBbGxEYXRhKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lm5vLmxhYmVsJywgJ05vJykKICAgICAgICB9XQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZXMgY2hvc2VuIGl0ZW0gZnJvbSByZXF1aXNpdGlvbidzIGl0ZW1zIGxpc3QuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaXRlbUlkCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVJdGVtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVJdGVtKGl0ZW1JZCkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CiAgICAgIHZhciByZW1vdmVJdGVtc1VybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50SXRlbXMvIi5jb25jYXQoaXRlbUlkLCAiL3JlbW92ZUl0ZW0iKTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgc3RvY2tNb3ZlbWVudElkOiB0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQKICAgICAgfTsKICAgICAgcmV0dXJuIGFwaUNsaWVudFsiZGVsZXRlIl0ocmVtb3ZlSXRlbXNVcmwsIHsKICAgICAgICBkYXRhOiBwYXlsb2FkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghX3RoaXMxMy5wcm9wcy5pc09ubGluZSkgewogICAgICAgICAgX3RoaXMxMy5wcm9wcy5hZGRTdG9ja01vdmVtZW50RHJhZnQoewogICAgICAgICAgICBsaW5lSXRlbXM6IF90aGlzMTMuc3RhdGUudmFsdWVzLmxpbmVJdGVtcywKICAgICAgICAgICAgaWQ6IF90aGlzMTMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwKICAgICAgICAgICAgc3RhdHVzQ29kZTogX3RoaXMxMy5zdGF0ZS52YWx1ZXMuc3RhdHVzQ29kZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3IuZGVsZXRlUmVxdWlzaXRpb25JdGVtLmxhYmVsJykpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZXMgYWxsIGl0ZW1zIGZyb20gcmVxdWlzaXRpb24ncyBpdGVtcyBsaXN0LgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAicmVtb3ZlQWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVBbGwoKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKICAgICAgYWN0aW9uSW5Qcm9ncmVzcyA9IHRydWU7CiAgICAgIHZhciByZW1vdmVJdGVtc1VybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvcmVtb3ZlQWxsSXRlbXMiKTsKICAgICAgcmV0dXJuIGFwaUNsaWVudFsiZGVsZXRlIl0ocmVtb3ZlSXRlbXNVcmwpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTQucHJvcHMucmVtb3ZlU3RvY2tNb3ZlbWVudERyYWZ0KF90aGlzMTQuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCk7CiAgICAgICAgX3RoaXMxNC5zZXRTdGF0ZSh7CiAgICAgICAgICB0b3RhbENvdW50OiAxLAogICAgICAgICAgY3VycmVudExpbmVJdGVtczogW10sCiAgICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXMxNC5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgICAgICBsaW5lSXRlbXM6IG5ldyBBcnJheSgxKS5maWxsKHsKICAgICAgICAgICAgICBzb3J0T3JkZXI6IDEwMCwKICAgICAgICAgICAgICByb3dTYXZlU3RhdHVzOiBSb3dTYXZlU3RhdHVzLlBFTkRJTkcKICAgICAgICAgICAgfSkKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE0LmZldGNoTGluZUl0ZW1zKCk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcigncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5kZWxldGVSZXF1aXNpdGlvbkl0ZW0ubGFiZWwnKSk7CiAgICAgIH0pWyJmaW5hbGx5Il0oZnVuY3Rpb24gKCkgewogICAgICAgIGFjdGlvbkluUHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2l0aW9uIHRvIG5leHQgc3RvY2sgbW92ZW1lbnQgc3RhdHVzOgogICAgICogLSAnQ0hFQ0tJTkcnIGlmIG9yaWdpbiB0eXBlIGlzIHN1cHBsaWVyLgogICAgICogLSAnVkVSSUZZSU5HJyBpZiBvcmlnaW4gdHlwZSBpcyBvdGhlciB0aGFuIHN1cHBsaWVyLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAidHJhbnNpdGlvblRvTmV4dFN0ZXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyYW5zaXRpb25Ub05leHRTdGVwKF9yZWYyMSkgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CiAgICAgIHZhciB2YWx1ZXMgPSBfcmVmMjEudmFsdWVzOwogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi9zdGF0dXMiKTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgc3RhdHVzOiAnUkVRVUVTVEVEJwogICAgICB9OwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgaWYgKF90aGlzMTUuc3RhdGUudmFsdWVzLnN0YXR1c0NvZGUgPT09ICdDUkVBVEVEJykgewogICAgICAgICAgcmVzb2x2ZShhcGlDbGllbnQucG9zdCh1cmwsIHBheWxvYWQpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc29sdmUoKTsKICAgICAgfSkudGhlbih0aGlzLnByb3BzLm5leHRQYWdlKHZhbHVlcyB8fCB0aGlzLnN0YXRlLnZhbHVlcykpWyJmaW5hbGx5Il0odGhpcy5wcm9wcy5oaWRlU3Bpbm5lcigpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4cG9ydHMgY3VycmVudCBzdGF0ZSBvZiBzdG9jayBtb3ZlbWVudCdzIHRvIGNzdiBmaWxlLgogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImV4cG9ydFRlbXBsYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBleHBvcnRUZW1wbGF0ZShmb3JtVmFsdWVzKSB7CiAgICAgIHZhciBsaW5lSXRlbXMgPSBfLmZpbHRlcihmb3JtVmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gIV8uaXNFbXB0eShpdGVtKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2F2ZUl0ZW1zQW5kRXhwb3J0VGVtcGxhdGUoZm9ybVZhbHVlcywgbGluZUl0ZW1zKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc1Jvd0xvYWRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNSb3dMb2FkZWQoX3JlZjIyKSB7CiAgICAgIHZhciBpbmRleCA9IF9yZWYyMi5pbmRleDsKICAgICAgcmV0dXJuICEhdGhpcy5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zW2luZGV4XTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4cG9ydHMgY3VycmVudCBzdGF0ZSBvZiBzdG9jayBtb3ZlbWVudCdzIHRvIGNzdiBmaWxlLgogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBsaW5lSXRlbXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVJdGVtc0FuZEV4cG9ydFRlbXBsYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlSXRlbXNBbmRFeHBvcnRUZW1wbGF0ZShmb3JtVmFsdWVzLCBsaW5lSXRlbXMpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHZhciBtb3ZlbWVudE51bWJlciA9IGZvcm1WYWx1ZXMubW92ZW1lbnROdW1iZXIsCiAgICAgICAgc3RvY2tNb3ZlbWVudElkID0gZm9ybVZhbHVlcy5zdG9ja01vdmVtZW50SWQ7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L2V4cG9ydENzdi8iLmNvbmNhdChzdG9ja01vdmVtZW50SWQpOwogICAgICB0aGlzLnNhdmVSZXF1aXNpdGlvbkl0ZW1zSW5DdXJyZW50U3RlcChsaW5lSXRlbXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIGFwaUNsaWVudC5nZXQodXJsLCB7CiAgICAgICAgICByZXNwb25zZVR5cGU6ICdibG9iJwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBmaWxlRG93bmxvYWQocmVzcG9uc2UuZGF0YSwgIkl0ZW1MaXN0Ii5jb25jYXQobW92ZW1lbnROdW1iZXIgPyAiLSIuY29uY2F0KG1vdmVtZW50TnVtYmVyKSA6ICcnLCAiLmNzdiIpLCAndGV4dC9jc3YnKTsKICAgICAgICAgIF90aGlzMTYucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxNi5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzaG93UGVuZGluZ1NhdmVOb3RpZmljYXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3dQZW5kaW5nU2F2ZU5vdGlmaWNhdGlvbigpIHsKICAgICAgbm90aWZpY2F0aW9uKE5vdGlmaWNhdGlvblR5cGUuSU5GTykoewogICAgICAgIG1lc3NhZ2U6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5ub3RpZmljYXRpb24uYXV0b3NhdmUucGVuZGluZy5sYWJlbCcsICdQbGVhc2Ugd2FpdCB3aGlsZSB5b3VyIGxpbmUgaXRlbXMgYXJlIGJlaW5nIHNhdmVkLicpCiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogSW1wb3J0cyBjaG9zZW4gZmlsZSB0byBiYWNrZW5kIGFuZCB0aGVuIGZldGNoZXMgbGluZSBpdGVtcy4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBldmVudAogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiaW1wb3J0VGVtcGxhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGltcG9ydFRlbXBsYXRlKGV2ZW50KSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgdmFyIGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIHZhciBzdG9ja01vdmVtZW50SWQgPSB0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQ7CiAgICAgIGZvcm1EYXRhLmFwcGVuZCgnaW1wb3J0RmlsZScsIGZpbGUuc2xpY2UoMCwgZmlsZS5zaXplLCAndGV4dC9jc3YnKSk7CiAgICAgIHZhciBjb25maWcgPSB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL3N0b2NrTW92ZW1lbnQvaW1wb3J0Q3N2LyIuY29uY2F0KHN0b2NrTW92ZW1lbnRJZCk7CiAgICAgIHJldHVybiBhcGlDbGllbnQucG9zdCh1cmwsIGZvcm1EYXRhLCBjb25maWcpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTcuZmV0Y2hMaW5lSXRlbXMoKTsKICAgICAgICBpZiAoXy5pc05pbChfLmxhc3QoX3RoaXMxNy5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zKS5wcm9kdWN0KSkgewogICAgICAgICAgX3RoaXMxNy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpczE3LnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICAgICAgbGluZUl0ZW1zOiBbXQogICAgICAgICAgICB9KQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxNy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGNoYW5nZXMgbWFkZSBieSB1c2VyIGluIHRoaXMgc3RlcCBhbmQgZ28gYmFjayB0byBwcmV2aW91cyBwYWdlCiAgICAgKiBAcGFyYW0ge29iamVjdH0gdmFsdWVzCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGludmFsaWQKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInByZXZpb3VzUGFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJldmlvdXNQYWdlKHZhbHVlcywgaW52YWxpZCkgewogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CiAgICAgIGlmICghaW52YWxpZCkgewogICAgICAgIHRoaXMuc2F2ZVJlcXVpc2l0aW9uSXRlbXNJbkN1cnJlbnRTdGVwKHZhbHVlcy5saW5lSXRlbXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMTgucHJvcHMucHJldmlvdXNQYWdlKHZhbHVlcyk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUHJldmlvdXNQYWdlLmxhYmVsJywgJ1ZhbGlkYXRpb24gZXJyb3InKSwKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1QcmV2aW91c1BhZ2UubWVzc2FnZS5sYWJlbCcsICdDYW5ub3Qgc2F2ZSBkdWUgdG8gdmFsaWRhdGlvbiBlcnJvciBvbiBwYWdlJyksCiAgICAgICAgICBidXR0b25zOiBbewogICAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVByZXZpb3VzUGFnZS5jb3JyZWN0RXJyb3IubGFiZWwnLCAnQ29ycmVjdCBlcnJvcicpCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUHJldmlvdXNQYWdlLmNvbnRpbnVlLmxhYmVsJywgJ0NvbnRpbnVlIChsb3NlIHVuc2F2ZWQgd29yayknKSwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxOC5wcm9wcy5wcmV2aW91c1BhZ2UodmFsdWVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfV0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMxOSA9IHRoaXM7CiAgICAgIHZhciBzaG93T25seSA9IHRoaXMucHJvcHMuc2hvd09ubHk7CiAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdC5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybSwgewogICAgICAgIG9uU3VibWl0OiBmdW5jdGlvbiBvblN1Ym1pdCgpIHt9LAogICAgICAgIHZhbGlkYXRlOiB0aGlzLnZhbGlkYXRlLAogICAgICAgIG11dGF0b3JzOiBfb2JqZWN0U3ByZWFkKHt9LCBhcnJheU11dGF0b3JzKSwKICAgICAgICBpbml0aWFsVmFsdWVzOiB0aGlzLnN0YXRlLnZhbHVlcywKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihfcmVmMjMpIHsKICAgICAgICAgIHZhciBoYW5kbGVTdWJtaXQgPSBfcmVmMjMuaGFuZGxlU3VibWl0LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMjMudmFsdWVzLAogICAgICAgICAgICBpbnZhbGlkID0gX3JlZjIzLmludmFsaWQ7CiAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZC1mbGV4IGZsZXgtY29sdW1uIgogICAgICAgICAgfSwgIXNob3dPbmx5ID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImJ1dHRvbnMtY29udGFpbmVyIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImxhYmVsIiwgewogICAgICAgICAgICBodG1sRm9yOiAiY3N2SW5wdXQiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgbWwtMSBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1kb3dubG9hZCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLmltcG9ydFRlbXBsYXRlLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJJbXBvcnQgdGVtcGxhdGUiCiAgICAgICAgICB9KSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgaWQ6ICJjc3ZJbnB1dCIsCiAgICAgICAgICAgIHR5cGU6ICJmaWxlIiwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25DaGFuZ2U6IF90aGlzMTkuaW1wb3J0VGVtcGxhdGUsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soZXZlbnQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24KICAgICAgICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSBudWxsOwogICAgICAgICAgICB9LAogICAgICAgICAgICBhY2NlcHQ6ICIuY3N2IgogICAgICAgICAgfSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxOS5leHBvcnRUZW1wbGF0ZSh2YWx1ZXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgbWwtMSBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS11cGxvYWQgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5leHBvcnRUZW1wbGF0ZS5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRXhwb3J0IHRlbXBsYXRlIgogICAgICAgICAgfSkpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTkucmVmcmVzaCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgbWwtMSBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1yZWZyZXNoIHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24ucmVmcmVzaC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUmVsb2FkIgogICAgICAgICAgfSkpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIGRpc2FibGVkOiBpbnZhbGlkLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczE5LnJlbW92ZUFsbCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1kYW5nZXIgYWxpZ24tc2VsZi1lbmQgbWwtMSBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1yZW1vdmUgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5kZWxldGVBbGwubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRlbGV0ZSBhbGwiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgZGlzYWJsZWQ6IGludmFsaWQKICAgICAgICAgICAgLy8gb25DbGljayAtPiBvbk1vdXNlRG93biAoc2VlIGNvbW1lbnQgZm9yIERFTEVURV9CVVRUT05fRklFTEQpCiAgICAgICAgICAgICwKICAgICAgICAgICAgb25Nb3VzZURvd246IGZ1bmN0aW9uIG9uTW91c2VEb3duKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczE5LnNhdmUodmFsdWVzKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmxvYXQtcmlnaHQgbWItMSBidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGFsaWduLXNlbGYtZW5kIG1sLTEgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogInNhdmluZy1idXR0b24iCiAgICAgICAgICB9LCBfLnNvbWUodmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0ucm93U2F2ZVN0YXR1cyA9PT0gUm93U2F2ZVN0YXR1cy5TQVZJTkc7CiAgICAgICAgICB9KSA/IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFNwaW5uZXIsIG51bGwpIDogLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXNhdmUgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5zYXZlLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZlIgogICAgICAgICAgfSkpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIGRpc2FibGVkOiBpbnZhbGlkCiAgICAgICAgICAgIC8vIG9uQ2xpY2sgLT4gb25Nb3VzZURvd24gKHNlZSBjb21tZW50IGZvciBERUxFVEVfQlVUVE9OX0ZJRUxEKQogICAgICAgICAgICAsCiAgICAgICAgICAgIG9uTW91c2VEb3duOiBmdW5jdGlvbiBvbk1vdXNlRG93bigpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxOS5zYXZlQW5kRXhpdCh2YWx1ZXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgbWwtMSBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zaWduLW91dCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnNhdmVBbmRFeGl0LmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZlIGFuZCBleGl0IgogICAgICAgICAgfSkpKSkgOiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgZGlzYWJsZWQ6IGludmFsaWQsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9saXN0P2RpcmVjdGlvbj1PVVRCT1VORCc7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLWRhbmdlciBhbGlnbi1zZWxmLWVuZCBidG4teHMgbXItMiIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXNpZ24tb3V0IHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uZXhpdC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRXhpdCIKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJmb3JtIiwgewogICAgICAgICAgICBvblN1Ym1pdDogaGFuZGxlU3VibWl0CiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJ0YWJsZS1mb3JtIgogICAgICAgICAgfSwgXy5tYXAoX3RoaXMxOS5nZXRGaWVsZHMoKSwgZnVuY3Rpb24gKGZpZWxkQ29uZmlnLCBmaWVsZE5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHJlbmRlckZvcm1GaWVsZChmaWVsZENvbmZpZywgZmllbGROYW1lLCB7CiAgICAgICAgICAgICAgc3RvY2tsaXN0OiB2YWx1ZXMuc3RvY2tsaXN0LAogICAgICAgICAgICAgIHJlY2lwaWVudHM6IF90aGlzMTkucHJvcHMucmVjaXBpZW50cywKICAgICAgICAgICAgICByZW1vdmVJdGVtOiBfdGhpczE5LnJlbW92ZUl0ZW0sCiAgICAgICAgICAgICAgb3JpZ2luSWQ6IF90aGlzMTkucHJvcHMuaW5pdGlhbFZhbHVlcy5vcmlnaW4uaWQsCiAgICAgICAgICAgICAgZ2V0U29ydE9yZGVyOiBfdGhpczE5LmdldFNvcnRPcmRlciwKICAgICAgICAgICAgICBuZXdJdGVtQWRkZWQ6IF90aGlzMTkubmV3SXRlbUFkZGVkLAogICAgICAgICAgICAgIG5ld0l0ZW06IF90aGlzMTkuc3RhdGUubmV3SXRlbSwKICAgICAgICAgICAgICB0b3RhbENvdW50OiBfdGhpczE5LnN0YXRlLnRvdGFsQ291bnQsCiAgICAgICAgICAgICAgbG9hZE1vcmVSb3dzOiBfdGhpczE5LmxvYWRNb3JlUm93cywKICAgICAgICAgICAgICBpc1Jvd0xvYWRlZDogX3RoaXMxOS5pc1Jvd0xvYWRlZCwKICAgICAgICAgICAgICB1cGRhdGVUb3RhbENvdW50OiBfdGhpczE5LnVwZGF0ZVRvdGFsQ291bnQsCiAgICAgICAgICAgICAgaXNQYWdpbmF0ZWQ6IF90aGlzMTkucHJvcHMuaXNQYWdpbmF0ZWQsCiAgICAgICAgICAgICAgaXNGcm9tT3JkZXI6IF90aGlzMTkuc3RhdGUudmFsdWVzLmlzRnJvbU9yZGVyLAogICAgICAgICAgICAgIHNob3dPbmx5OiBzaG93T25seSwKICAgICAgICAgICAgICB1cGRhdGVSb3c6IF90aGlzMTkudXBkYXRlUm93LAogICAgICAgICAgICAgIHZhbHVlczogdmFsdWVzLAogICAgICAgICAgICAgIGlzRmlyc3RQYWdlTG9hZGVkOiBfdGhpczE5LnN0YXRlLmlzRmlyc3RQYWdlTG9hZGVkLAogICAgICAgICAgICAgIHNhdmVQcm9ncmVzczogX3RoaXMxOS5zYXZlUHJvZ3Jlc3MsCiAgICAgICAgICAgICAgZ2V0U3RvY2tNb3ZlbWVudERyYWZ0OiBfdGhpczE5LmdldFN0b2NrTW92ZW1lbnREcmFmdCwKICAgICAgICAgICAgICBpc0RyYWZ0QXZhaWxhYmxlOiBfdGhpczE5LnN0YXRlLmlzRHJhZnRBdmFpbGFibGUsCiAgICAgICAgICAgICAgaXNBdXRvc2F2ZUVuYWJsZWQ6IF90aGlzMTkucHJvcHMuaXNBdXRvc2F2ZUVuYWJsZWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogInN1Ym1pdC1idXR0b25zIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIGRpc2FibGVkOiBpbnZhbGlkIHx8IHNob3dPbmx5IHx8IF8uc29tZSh2YWx1ZXMubGluZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBpdGVtLnF1YW50aXR5UmVxdWVzdGVkIDw9IDA7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC8vIG9uQ2xpY2sgLT4gb25Nb3VzZURvd24gKHNlZSBjb21tZW50IGZvciBERUxFVEVfQlVUVE9OX0ZJRUxEKQogICAgICAgICAgICAsCiAgICAgICAgICAgIG9uTW91c2VEb3duOiBmdW5jdGlvbiBvbk1vdXNlRG93bigpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXMxOS5wcm9wcy5pc0F1dG9zYXZlRW5hYmxlZCAmJiBfLnNvbWUodmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGxpbmVJdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKGxpbmVJdGVtLnJvd1NhdmVTdGF0dXMgPT09IFJvd1NhdmVTdGF0dXMuUEVORElORyB8fCBsaW5lSXRlbS5yb3dTYXZlU3RhdHVzID09PSBSb3dTYXZlU3RhdHVzLlNBVklORykgJiYgbGluZUl0ZW0ucHJvZHVjdDsKICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgX3RoaXMxOS5zaG93UGVuZGluZ1NhdmVOb3RpZmljYXRpb24oKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgX3RoaXMxOS5wcmV2aW91c1BhZ2UodmFsdWVzLCBpbnZhbGlkKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiYnRuIGJ0bi1vdXRsaW5lLXByaW1hcnkgYnRuLWZvcm0gYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24ucHJldmlvdXMubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlByZXZpb3VzIgogICAgICAgICAgfSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAic3VibWl0IgogICAgICAgICAgICAvLyBvbkNsaWNrIC0+IG9uTW91c2VEb3duIChzZWUgY29tbWVudCBmb3IgREVMRVRFX0JVVFRPTl9GSUVMRCkKICAgICAgICAgICAgLAogICAgICAgICAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24gb25Nb3VzZURvd24oKSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzMTkucHJvcHMuaXNBdXRvc2F2ZUVuYWJsZWQgJiYgXy5zb21lKHZhbHVlcy5saW5lSXRlbXMsIGZ1bmN0aW9uIChsaW5lSXRlbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxpbmVJdGVtLnJvd1NhdmVTdGF0dXMgPT09IFJvd1NhdmVTdGF0dXMuUEVORElORyB8fCBsaW5lSXRlbS5yb3dTYXZlU3RhdHVzID09PSBSb3dTYXZlU3RhdHVzLlNBVklORzsKICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgX3RoaXMxOS5zaG93UGVuZGluZ1NhdmVOb3RpZmljYXRpb24oKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCFpbnZhbGlkKSB7CiAgICAgICAgICAgICAgICBfdGhpczE5Lm5leHRQYWdlKHZhbHVlcyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtcHJpbWFyeSBidG4tZm9ybSBmbG9hdC1yaWdodCBidG4teHMiLAogICAgICAgICAgICBkaXNhYmxlZDogdmFsdWVzLmxpbmVJdGVtcy5sZW5ndGggPT09IDAgfHwgdmFsdWVzLmxpbmVJdGVtcy5sZW5ndGggPT09IDEgJiYgISgncHJvZHVjdCcgaW4gdmFsdWVzLmxpbmVJdGVtc1swXSkgfHwgaW52YWxpZCB8fCBzaG93T25seSB8fCBfLnNvbWUodmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbS5xdWFudGl0eVJlcXVlc3RlZCA8PSAwOwogICAgICAgICAgICB9KQogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24ubmV4dC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiTmV4dCIKICAgICAgICAgIH0pKSkpKTsKICAgICAgICB9CiAgICAgIH0pLCB0aGlzLnByb3BzLmF1dG9TYXZlSW5mb0JhclZpc2liaWxpdHkgJiYgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQXV0b3NhdmVGZWF0dXJlTW9kYWwsIG51bGwpKTsKICAgIH0KICB9XSk7CiAgcmV0dXJuIEFkZEl0ZW1zUGFnZTsKfShDb21wb25lbnQpOwp2YXIgbWFwU3RhdGVUb1Byb3BzID0gZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKHN0YXRlLCBvd25Qcm9wcykgewogIHJldHVybiB7CiAgICByZWNpcGllbnRzOiBzdGF0ZS51c2Vycy5kYXRhLAogICAgdHJhbnNsYXRlOiB0cmFuc2xhdGVXaXRoRGVmYXVsdE1lc3NhZ2UoZ2V0VHJhbnNsYXRlKHN0YXRlLmxvY2FsaXplKSksCiAgICBzdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZDogc3RhdGUuc2Vzc2lvbi5mZXRjaGVkVHJhbnNsYXRpb25zLnN0b2NrTW92ZW1lbnQsCiAgICBtaW5pbXVtRXhwaXJhdGlvbkRhdGU6IHN0YXRlLnNlc3Npb24ubWluaW11bUV4cGlyYXRpb25EYXRlLAogICAgaGFzUGFja2luZ1N1cHBvcnQ6IHN0YXRlLnNlc3Npb24uY3VycmVudExvY2F0aW9uLmhhc1BhY2tpbmdTdXBwb3J0LAogICAgaXNQYWdpbmF0ZWQ6IHN0YXRlLnNlc3Npb24uaXNQYWdpbmF0ZWQsCiAgICBwYWdlU2l6ZTogc3RhdGUuc2Vzc2lvbi5wYWdlU2l6ZSwKICAgIHNhdmVkU3RvY2tNb3ZlbWVudDogc3RhdGUuc3RvY2tNb3ZlbWVudERyYWZ0W293blByb3BzLmluaXRpYWxWYWx1ZXMuaWRdLAogICAgaXNPbmxpbmU6IHN0YXRlLmNvbm5lY3Rpb24ub25saW5lLAogICAgaXNBdXRvc2F2ZUVuYWJsZWQ6IHN0YXRlLnNlc3Npb24uaXNBdXRvc2F2ZUVuYWJsZWQsCiAgICBiYXJzOiBzdGF0ZS5pbmZvQmFyLmJhcnMsCiAgICBhdXRvU2F2ZUluZm9CYXJWaXNpYmlsaXR5OiBzdGF0ZS5pbmZvQmFyVmlzaWJpbGl0eVtJbmZvQmFyLkFVVE9TQVZFXSwKICAgIHN1cHBvcnRlZEFjdGl2aXRpZXM6IHN0YXRlLnNlc3Npb24uc3VwcG9ydGVkQWN0aXZpdGllcwogIH07Cn07CnZhciBtYXBEaXNwYXRjaFRvUHJvcHMgPSB7CiAgc2hvd1NwaW5uZXI6IHNob3dTcGlubmVyLAogIGhpZGVTcGlubmVyOiBoaWRlU3Bpbm5lciwKICBmZXRjaFVzZXJzOiBmZXRjaFVzZXJzLAogIGFkZFN0b2NrTW92ZW1lbnREcmFmdDogYWRkU3RvY2tNb3ZlbWVudERyYWZ0LAogIHJlbW92ZVN0b2NrTW92ZW1lbnREcmFmdDogcmVtb3ZlU3RvY2tNb3ZlbWVudERyYWZ0LAogIGNyZWF0ZUluZm9CYXI6IGNyZWF0ZUluZm9CYXIsCiAgaGlkZUluZm9CYXI6IGhpZGVJbmZvQmFyLAogIGNsb3NlSW5mb0JhcjogY2xvc2VJbmZvQmFyLAogIHNob3dJbmZvQmFyOiBzaG93SW5mb0Jhcgp9OwpleHBvcnQgZGVmYXVsdCBjb25uZWN0KG1hcFN0YXRlVG9Qcm9wcywgbWFwRGlzcGF0Y2hUb1Byb3BzKShBZGRJdGVtc1BhZ2UpOwpBZGRJdGVtc1BhZ2UucHJvcFR5cGVzID0gewogIC8qKiBJbml0aWFsIGNvbXBvbmVudCdzIGRhdGEgKi8KICBpbml0aWFsVmFsdWVzOiBQcm9wVHlwZXMuc2hhcGUoewogICAgb3JpZ2luOiBQcm9wVHlwZXMuc2hhcGUoewogICAgICBpZDogUHJvcFR5cGVzLnN0cmluZwogICAgfSksCiAgICBoYXNNYW5hZ2VJbnZlbnRvcnk6IFByb3BUeXBlcy5ib29sCiAgfSkuaXNSZXF1aXJlZCwKICAvKiogRnVuY3Rpb24gcmV0dXJuaW5nIHVzZXIgdG8gdGhlIHByZXZpb3VzIHBhZ2UgKi8KICBwcmV2aW91c1BhZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqCiAgICogRnVuY3Rpb24gY2FsbGVkIHdpdGggdGhlIGZvcm0gZGF0YSB3aGVuIHRoZSBoYW5kbGVTdWJtaXQoKQogICAqIGlzIGZpcmVkIGZyb20gd2l0aGluIHRoZSBmb3JtIGNvbXBvbmVudC4KICAgKi8KICBuZXh0UGFnZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAvKiogRnVuY3Rpb24gY2FsbGVkIHdoZW4gZGF0YSBpcyBsb2FkaW5nICovCiAgc2hvd1NwaW5uZXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGRhdGEgaGFzIGxvYWRlZCAqLwogIGhpZGVTcGlubmVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBGdW5jdGlvbiBmZXRjaGluZyB1c2VycyAqLwogIGZldGNoVXNlcnM6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEFycmF5IG9mIGF2YWlsYWJsZSByZWNpcGllbnRzICAqLwogIHJlY2lwaWVudHM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zaGFwZSh7fSkpLmlzUmVxdWlyZWQsCiAgdHJhbnNsYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIHN0b2NrTW92ZW1lbnRUcmFuc2xhdGlvbnNGZXRjaGVkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLAogIG1pbmltdW1FeHBpcmF0aW9uRGF0ZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLAogIC8qKiBSZXR1cm4gdHJ1ZSBpZiBwYWdpbmF0aW9uIGlzIGVuYWJsZWQgKi8KICBpc1BhZ2luYXRlZDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICAvKiogUmV0dXJuIHRydWUgaWYgc2hvdyBvbmx5ICovCiAgc2hvd09ubHk6IFByb3BUeXBlcy5ib29sLAogIHBhZ2VTaXplOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsCiAgYWRkU3RvY2tNb3ZlbWVudERyYWZ0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIHJlbW92ZVN0b2NrTW92ZW1lbnREcmFmdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICBzYXZlZFN0b2NrTW92ZW1lbnQ6IFByb3BUeXBlcy5zaGFwZSh7CiAgICBpZDogUHJvcFR5cGVzLnN0cmluZywKICAgIGxpbmVJdGVtczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnNoYXBlKHt9KSksCiAgICBsYXN0VXBkYXRlZDogUHJvcFR5cGVzLnN0cmluZywKICAgIHN0YXR1c0NvZGU6IG51bGwKICB9KSwKICBpc09ubGluZTogUHJvcFR5cGVzLmJvb2wsCiAgaXNBdXRvc2F2ZUVuYWJsZWQ6IFByb3BUeXBlcy5ib29sLAogIGNyZWF0ZUluZm9CYXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgYmFyczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnNoYXBlKHsKICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCwKICAgIHNob3c6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgICBjbG9zZWQ6IFByb3BUeXBlcy5ib29sLAogICAgdGl0bGU6IFByb3BUeXBlcy5zaGFwZSh7CiAgICAgIGxhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsCiAgICAgIGRlZmF1bHRMYWJlbDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkCiAgICB9KSwKICAgIHZlcnNpb25MYWJlbDogUHJvcFR5cGVzLnNoYXBlKHsKICAgICAgbGFiZWw6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCwKICAgICAgZGVmYXVsdExhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQKICAgIH0pCiAgfSkpLmlzUmVxdWlyZWQsCiAgYXV0b1NhdmVJbmZvQmFyVmlzaWJpbGl0eTogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICBzaG93SW5mb0JhcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICBoaWRlSW5mb0JhcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZAp9OwpBZGRJdGVtc1BhZ2UuZGVmYXVsdFByb3BzID0gewogIHNob3dPbmx5OiBmYWxzZSwKICBzYXZlZFN0b2NrTW92ZW1lbnQ6IHsKICAgIGlkOiBudWxsLAogICAgbGluZUl0ZW1zOiBbXSwKICAgIGxhc3RVcGRhdGVkOiBudWxsLAogICAgc3RhdHVzQ29kZTogbnVsbAogIH0sCiAgaXNPbmxpbmU6IHRydWUsCiAgaXNBdXRvc2F2ZUVuYWJsZWQ6IGZhbHNlCn07"},null]}