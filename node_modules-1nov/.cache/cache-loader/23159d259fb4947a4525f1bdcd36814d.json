{"remainingRequest":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js?presets[]=@babel/react&presets[]=@babel/env!/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js!/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/request/CreateStockMovement.jsx","dependencies":[{"path":"/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/request/CreateStockMovement.jsx","mtime":1698037750000},{"path":"/opt/MTOBS-BIKASH/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfSwgX3R5cGVvZihvYmopOyB9CmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgeyByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOyB9CmZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7IH0KZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IH0KZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsgdmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTsgaWYgKG51bGwgIT0gX2kpIHsgdmFyIF9zLCBfZSwgX3gsIF9yLCBfYXJyID0gW10sIF9uID0gITAsIF9kID0gITE7IHRyeSB7IGlmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkgeyBpZiAoT2JqZWN0KF9pKSAhPT0gX2kpIHJldHVybjsgX24gPSAhMTsgfSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApIHsgOyB9IH0gY2F0Y2ggKGVycikgeyBfZCA9ICEwLCBfZSA9IGVycjsgfSBmaW5hbGx5IHsgdHJ5IHsgaWYgKCFfbiAmJiBudWxsICE9IF9pWyJyZXR1cm4iXSAmJiAoX3IgPSBfaVsicmV0dXJuIl0oKSwgT2JqZWN0KF9yKSAhPT0gX3IpKSByZXR1cm47IH0gZmluYWxseSB7IGlmIChfZCkgdGhyb3cgX2U7IH0gfSByZXR1cm4gX2FycjsgfSB9CmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsgfQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgX3RvUHJvcGVydHlLZXkoZGVzY3JpcHRvci5rZXkpLCBkZXNjcmlwdG9yKTsgfSB9CmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzdWJDbGFzcywgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQpmdW5jdGlvbiBfY3JlYXRlU3VwZXIoRGVyaXZlZCkgeyB2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKTsgcmV0dXJuIGZ1bmN0aW9uIF9jcmVhdGVTdXBlckludGVybmFsKCkgeyB2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCksIHJlc3VsdDsgaWYgKGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QpIHsgdmFyIE5ld1RhcmdldCA9IF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3RvcjsgcmVzdWx0ID0gUmVmbGVjdC5jb25zdHJ1Y3QoU3VwZXIsIGFyZ3VtZW50cywgTmV3VGFyZ2V0KTsgfSBlbHNlIHsgcmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgcmVzdWx0KTsgfTsgfQpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gZWxzZSBpZiAoY2FsbCAhPT0gdm9pZCAwKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkRlcml2ZWQgY29uc3RydWN0b3JzIG1heSBvbmx5IHJldHVybiBvYmplY3Qgb3IgdW5kZWZpbmVkIik7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQpmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOyBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlOyBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgZW51bWVyYWJsZU9ubHkgJiYgKHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KSksIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gbnVsbCAhPSBhcmd1bWVudHNbaV0gPyBhcmd1bWVudHNbaV0gOiB7fTsgaSAlIDIgPyBvd25LZXlzKE9iamVjdChzb3VyY2UpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKSA6IG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gcmV0dXJuIHRhcmdldDsgfQpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGtleSA9IF90b1Byb3BlcnR5S2V5KGtleSk7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQpmdW5jdGlvbiBfdG9Qcm9wZXJ0eUtleShhcmcpIHsgdmFyIGtleSA9IF90b1ByaW1pdGl2ZShhcmcsICJzdHJpbmciKTsgcmV0dXJuIF90eXBlb2Yoa2V5KSA9PT0gInN5bWJvbCIgPyBrZXkgOiBTdHJpbmcoa2V5KTsgfQpmdW5jdGlvbiBfdG9QcmltaXRpdmUoaW5wdXQsIGhpbnQpIHsgaWYgKF90eXBlb2YoaW5wdXQpICE9PSAib2JqZWN0IiB8fCBpbnB1dCA9PT0gbnVsbCkgcmV0dXJuIGlucHV0OyB2YXIgcHJpbSA9IGlucHV0W1N5bWJvbC50b1ByaW1pdGl2ZV07IGlmIChwcmltICE9PSB1bmRlZmluZWQpIHsgdmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCAiZGVmYXVsdCIpOyBpZiAoX3R5cGVvZihyZXMpICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKTsgfSByZXR1cm4gKGhpbnQgPT09ICJzdHJpbmciID8gU3RyaW5nIDogTnVtYmVyKShpbnB1dCk7IH0KaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHVwZGF0ZSBmcm9tICdpbW11dGFiaWxpdHktaGVscGVyJzsKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnOwppbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnOwppbXBvcnQgeyBjb25maXJtQWxlcnQgfSBmcm9tICdyZWFjdC1jb25maXJtLWFsZXJ0JzsKaW1wb3J0IHsgRm9ybSB9IGZyb20gJ3JlYWN0LWZpbmFsLWZvcm0nOwppbXBvcnQgeyBnZXRUcmFuc2xhdGUgfSBmcm9tICdyZWFjdC1sb2NhbGl6ZS1yZWR1eCc7CmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWFjdC1yZWR1eCc7CmltcG9ydCB7IHdpdGhSb3V0ZXIgfSBmcm9tICdyZWFjdC1yb3V0ZXItZG9tJzsKaW1wb3J0IHsgaGlkZVNwaW5uZXIsIHNob3dTcGlubmVyIH0gZnJvbSAnYWN0aW9ucyc7CmltcG9ydCB1c2VyQXBpIGZyb20gJ2FwaS9zZXJ2aWNlcy9Vc2VyQXBpJzsKaW1wb3J0IERhdGVGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvRGF0ZUZpZWxkJzsKaW1wb3J0IFNlbGVjdEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9TZWxlY3RGaWVsZCc7CmltcG9ydCBUZXh0RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL1RleHRGaWVsZCc7CmltcG9ydCBBY3Rpdml0eUNvZGUgZnJvbSAnY29uc3RzL2FjdGl2aXR5Q29kZSc7CmltcG9ydCBSb2xlVHlwZSBmcm9tICdjb25zdHMvcm9sZVR5cGUnOwppbXBvcnQgYXBpQ2xpZW50IGZyb20gJ3V0aWxzL2FwaUNsaWVudCc7CmltcG9ydCB7IHJlbmRlckZvcm1GaWVsZCB9IGZyb20gJ3V0aWxzL2Zvcm0tdXRpbHMnOwppbXBvcnQgeyBkZWJvdW5jZUxvY2F0aW9uc0ZldGNoLCBkZWJvdW5jZVBlb3BsZUZldGNoIH0gZnJvbSAndXRpbHMvb3B0aW9uLXV0aWxzJzsKaW1wb3J0IFRyYW5zbGF0ZSwgeyB0cmFuc2xhdGVXaXRoRGVmYXVsdE1lc3NhZ2UgfSBmcm9tICd1dGlscy9UcmFuc2xhdGUnOwppbXBvcnQgJ3JlYWN0LWNvbmZpcm0tYWxlcnQvc3JjL3JlYWN0LWNvbmZpcm0tYWxlcnQuY3NzJzsKZnVuY3Rpb24gdmFsaWRhdGUodmFsdWVzKSB7CiAgdmFyIGVycm9ycyA9IHt9OwogIGlmICghdmFsdWVzLmRlc2NyaXB0aW9uKSB7CiAgICBlcnJvcnMuZGVzY3JpcHRpb24gPSAncmVhY3QuZGVmYXVsdC5lcnJvci5yZXF1aXJlZEZpZWxkLmxhYmVsJzsKICB9CiAgaWYgKCF2YWx1ZXMub3JpZ2luKSB7CiAgICBlcnJvcnMub3JpZ2luID0gJ3JlYWN0LmRlZmF1bHQuZXJyb3IucmVxdWlyZWRGaWVsZC5sYWJlbCc7CiAgfQogIGlmICghdmFsdWVzLmRlc3RpbmF0aW9uKSB7CiAgICBlcnJvcnMuZGVzdGluYXRpb24gPSAncmVhY3QuZGVmYXVsdC5lcnJvci5yZXF1aXJlZEZpZWxkLmxhYmVsJzsKICB9CiAgaWYgKCF2YWx1ZXMucmVxdWVzdGVkQnkpIHsKICAgIGVycm9ycy5yZXF1ZXN0ZWRCeSA9ICdyZWFjdC5kZWZhdWx0LmVycm9yLnJlcXVpcmVkRmllbGQubGFiZWwnOwogIH0KICBpZiAoIXZhbHVlcy5yZXF1ZXN0VHlwZSkgewogICAgZXJyb3JzLnJlcXVlc3RUeXBlID0gJ3JlYWN0LmRlZmF1bHQuZXJyb3IucmVxdWlyZWRGaWVsZC5sYWJlbCc7CiAgfQogIGlmICghdmFsdWVzLmRhdGVSZXF1ZXN0ZWQpIHsKICAgIGVycm9ycy5kYXRlUmVxdWVzdGVkID0gJ3JlYWN0LmRlZmF1bHQuZXJyb3IucmVxdWlyZWRGaWVsZC5sYWJlbCc7CiAgfSBlbHNlIHsKICAgIHZhciBkYXRlUmVxdWVzdGVkID0gbW9tZW50KHZhbHVlcy5kYXRlUmVxdWVzdGVkLCAnTU0vREQvWVlZWScpOwogICAgaWYgKG1vbWVudCgpLmRpZmYoZGF0ZVJlcXVlc3RlZCkgPCAwKSB7CiAgICAgIGVycm9ycy5kYXRlUmVxdWVzdGVkID0gJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3IuZnV0dXJlRGF0ZS5sYWJlbCc7CiAgICB9CiAgfQogIHJldHVybiBlcnJvcnM7Cn0KdmFyIERFRkFVTFRfRklFTERTID0gewogIGRlc2NyaXB0aW9uOiB7CiAgICB0eXBlOiBUZXh0RmllbGQsCiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGVzY3JpcHRpb24ubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdEZXNjcmlwdGlvbicsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICBhdXRvRm9jdXM6IHRydWUKICAgIH0KICB9LAogIGRlc3RpbmF0aW9uOiB7CiAgICB0eXBlOiBTZWxlY3RGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZXF1ZXN0aW5nTG9jYXRpb24ubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdSZXF1ZXN0aW5nIExvY2F0aW9uJywKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIGFzeW5jOiB0cnVlLAogICAgICBzaG93VmFsdWVUb29sdGlwOiB0cnVlLAogICAgICBvcGVuT25DbGljazogZmFsc2UsCiAgICAgIGF1dG9sb2FkOiBmYWxzZSwKICAgICAgY2FjaGU6IGZhbHNlLAogICAgICBvcHRpb25zOiBbXSwKICAgICAgZGlzYWJsZWQ6IHRydWUsCiAgICAgIGZpbHRlck9wdGlvbnM6IGZ1bmN0aW9uIGZpbHRlck9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHJldHVybiBvcHRpb25zOwogICAgICB9CiAgICB9LAogICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKHByb3BzKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbG9hZE9wdGlvbnM6IHByb3BzLmRlYm91bmNlZExvY2F0aW9uc0ZldGNoLAogICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZSh2YWx1ZSkgewogICAgICAgICAgaWYgKHZhbHVlICYmIHByb3BzLm9yaWdpbiAmJiBwcm9wcy5vcmlnaW4uaWQpIHsKICAgICAgICAgICAgcHJvcHMuZmV0Y2hTdG9ja0xpc3RzKHByb3BzLm9yaWdpbiwgdmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9LAogIG9yaWdpbjogewogICAgdHlwZTogU2VsZWN0RmllbGQsCiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZnVsZmlsbGluZ0xvY2F0aW9uLmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnRnVsZmlsbGluZyBMb2NhdGlvbicsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICBhc3luYzogdHJ1ZSwKICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZSwKICAgICAgb3Blbk9uQ2xpY2s6IGZhbHNlLAogICAgICBhdXRvbG9hZDogZmFsc2UsCiAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgb3B0aW9uczogW10sCiAgICAgIGZpbHRlck9wdGlvbnM6IGZ1bmN0aW9uIGZpbHRlck9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHJldHVybiBvcHRpb25zOwogICAgICB9CiAgICB9LAogICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKHByb3BzKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbG9hZE9wdGlvbnM6IHByb3BzLmRlYm91bmNlZExvY2F0aW9uc0ZldGNoLAogICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZSh2YWx1ZSkgewogICAgICAgICAgaWYgKHZhbHVlICYmIHByb3BzLmRlc3RpbmF0aW9uICYmIHByb3BzLmRlc3RpbmF0aW9uLmlkKSB7CiAgICAgICAgICAgIHZhciBfdmFsdWUkc3VwcG9ydGVkQWN0aXY7CiAgICAgICAgICAgIHByb3BzLmZldGNoU3RvY2tMaXN0cyh2YWx1ZSwgcHJvcHMuZGVzdGluYXRpb24pOwogICAgICAgICAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHZvaWQgMCAmJiAoX3ZhbHVlJHN1cHBvcnRlZEFjdGl2ID0gdmFsdWUuc3VwcG9ydGVkQWN0aXZpdGllcykgIT09IG51bGwgJiYgX3ZhbHVlJHN1cHBvcnRlZEFjdGl2ICE9PSB2b2lkIDAgJiYgX3ZhbHVlJHN1cHBvcnRlZEFjdGl2LmluY2x1ZGVzKEFjdGl2aXR5Q29kZS5BUFBST1ZFX1JFUVVFU1QpKSB7CiAgICAgICAgICAgICAgcHJvcHMuc2V0U3VwcG9ydHNBcHByb3Zlcih0cnVlKTsKICAgICAgICAgICAgICBwcm9wcy5mZXRjaEF2YWlsYWJsZUFwcHJvdmVycygpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHByb3BzLnNldFN1cHBvcnRzQXBwcm92ZXIoZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkaXNhYmxlZDogZmFsc2UKICAgICAgfTsKICAgIH0KICB9LAogIHJlcXVlc3RlZEJ5OiB7CiAgICB0eXBlOiBTZWxlY3RGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZXF1ZXN0ZWRCeS5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ1JlcXVlc3RlZCBieScsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGFzeW5jOiB0cnVlLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZSwKICAgICAgb3Blbk9uQ2xpY2s6IGZhbHNlLAogICAgICBhdXRvbG9hZDogZmFsc2UsCiAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgb3B0aW9uczogW10sCiAgICAgIGxhYmVsS2V5OiAnbmFtZScsCiAgICAgIGZpbHRlck9wdGlvbnM6IGZ1bmN0aW9uIGZpbHRlck9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHJldHVybiBvcHRpb25zOwogICAgICB9CiAgICB9LAogICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKHByb3BzKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbG9hZE9wdGlvbnM6IHByb3BzLmRlYm91bmNlZFBlb3BsZUZldGNoCiAgICAgIH07CiAgICB9CiAgfSwKICBkYXRlUmVxdWVzdGVkOiB7CiAgICB0eXBlOiBEYXRlRmllbGQsCiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGF0ZVJlcXVlc3RlZC5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ0RhdGUgcmVxdWVzdGVkJywKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIGRhdGVGb3JtYXQ6ICdNTS9ERC9ZWVlZJywKICAgICAgYXV0b0NvbXBsZXRlOiAnb2ZmJwogICAgfQogIH0sCiAgcmVxdWVzdFR5cGU6IHsKICAgIHR5cGU6IFNlbGVjdEZpZWxkLAogICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnJlcXVlc3RUeXBlLmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVxdWVzdCB0eXBlJywKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgdmFsdWVLZXk6ICdpZCcsCiAgICAgIGxhYmVsS2V5OiAnbmFtZScsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICBzaG93VmFsdWVUb29sdGlwOiB0cnVlCiAgICB9LAogICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYpIHsKICAgICAgdmFyIHJlcXVlc3RUeXBlcyA9IF9yZWYucmVxdWVzdFR5cGVzOwogICAgICByZXR1cm4gewogICAgICAgIG9wdGlvbnM6IHJlcXVlc3RUeXBlcwogICAgICB9OwogICAgfQogIH0sCiAgc3RvY2tsaXN0OiB7CiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuc3RvY2tsaXN0LmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnU3RvY2tsaXN0JywKICAgIHR5cGU6IFNlbGVjdEZpZWxkLAogICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYyKSB7CiAgICAgIHZhciBvcmlnaW4gPSBfcmVmMi5vcmlnaW4sCiAgICAgICAgZGVzdGluYXRpb24gPSBfcmVmMi5kZXN0aW5hdGlvbiwKICAgICAgICBzdG9ja2xpc3RzID0gX3JlZjIuc3RvY2tsaXN0cywKICAgICAgICBzZXRSZXF1ZXN0VHlwZSA9IF9yZWYyLnNldFJlcXVlc3RUeXBlLAogICAgICAgIHZhbHVlcyA9IF9yZWYyLnZhbHVlczsKICAgICAgcmV0dXJuIHsKICAgICAgICBkaXNhYmxlZDogIShvcmlnaW4gJiYgZGVzdGluYXRpb24gJiYgb3JpZ2luLmlkICYmIGRlc3RpbmF0aW9uLmlkKSwKICAgICAgICBvcHRpb25zOiBzdG9ja2xpc3RzLAogICAgICAgIHNob3dWYWx1ZVRvb2x0aXA6IHRydWUsCiAgICAgICAgdmFsdWVLZXk6ICdpZCcsCiAgICAgICAgbGFiZWxLZXk6ICduYW1lJywKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UodmFsdWUpIHsKICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICBzZXRSZXF1ZXN0VHlwZSh2YWx1ZXMsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfQp9Owp2YXIgQVBQUk9WRVJfRklFTERTID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBERUZBVUxUX0ZJRUxEUyksIHt9LCB7CiAgYXBwcm92ZXJzOiB7CiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucmVxdWVzdC5hcHByb3ZlcnMubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdBcHByb3ZlcnMnLAogICAgYXR0cmlidXRlczogewogICAgICBtdWx0aTogdHJ1ZSwKICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZSwKICAgICAgdmFsdWVLZXk6ICdpZCcsCiAgICAgIGxhYmVsS2V5OiAnbmFtZScsCiAgICAgIHN1YnRleHQ6ICdyZWFjdC5zdG9ja01vdmVtZW50LnJlcXVlc3QuYXBwcm92ZXJzLmxlYXZlQmxhbmsubGFiZWwnCiAgICB9LAogICAgdHlwZTogU2VsZWN0RmllbGQsCiAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIocHJvcHMpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBvcHRpb25zOiBwcm9wcy5hdmFpbGFibGVBcHByb3ZlcnMKICAgICAgfTsKICAgIH0KICB9Cn0pOwp2YXIgRUxFQ1RST05JQyA9ICdFTEVDVFJPTklDJzsKCi8qKiBUaGUgZmlyc3Qgc3RlcCBvZiBzdG9jayBtb3ZlbWVudCB3aGVyZSB1c2VyIGNhbiBhZGQgYWxsIHRoZSBiYXNpYyBpbmZvcm1hdGlvbi4gKi8KdmFyIENyZWF0ZVN0b2NrTW92ZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoQ3JlYXRlU3RvY2tNb3ZlbWVudCwgX0NvbXBvbmVudCk7CiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihDcmVhdGVTdG9ja01vdmVtZW50KTsKICBmdW5jdGlvbiBDcmVhdGVTdG9ja01vdmVtZW50KHByb3BzKSB7CiAgICB2YXIgX3RoaXM7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ3JlYXRlU3RvY2tNb3ZlbWVudCk7CiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKTsKICAgIF90aGlzLnN0YXRlID0gewogICAgICBzdG9ja2xpc3RzOiBbXSwKICAgICAgYXZhaWxhYmxlQXBwcm92ZXJzOiBbXSwKICAgICAgc3VwcG9ydHNBcHByb3ZlcjogZmFsc2UsCiAgICAgIHNldEluaXRpYWxWYWx1ZXM6IHRydWUsCiAgICAgIHZhbHVlczogX3RoaXMucHJvcHMuaW5pdGlhbFZhbHVlcywKICAgICAgcmVxdWVzdFR5cGVzOiBbXQogICAgfTsKICAgIF90aGlzLmZldGNoU3RvY2tMaXN0cyA9IF90aGlzLmZldGNoU3RvY2tMaXN0cy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnNldFJlcXVlc3RUeXBlID0gX3RoaXMuc2V0UmVxdWVzdFR5cGUuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5mZXRjaEF2YWlsYWJsZUFwcHJvdmVycyA9IF90aGlzLmZldGNoQXZhaWxhYmxlQXBwcm92ZXJzLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMuc2V0U3VwcG9ydHNBcHByb3ZlciA9IF90aGlzLnNldFN1cHBvcnRzQXBwcm92ZXIuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5kZWJvdW5jZWRQZW9wbGVGZXRjaCA9IGRlYm91bmNlUGVvcGxlRmV0Y2goX3RoaXMucHJvcHMuZGVib3VuY2VUaW1lLCBfdGhpcy5wcm9wcy5taW5TZWFyY2hMZW5ndGgpOwogICAgX3RoaXMuZGVib3VuY2VkTG9jYXRpb25zRmV0Y2ggPSBkZWJvdW5jZUxvY2F0aW9uc0ZldGNoKF90aGlzLnByb3BzLmRlYm91bmNlVGltZSwgX3RoaXMucHJvcHMubWluU2VhcmNoTGVuZ3RoLCBbJ0ZVTEZJTExfUkVRVUVTVCddKTsKICAgIHJldHVybiBfdGhpczsKICB9CiAgX2NyZWF0ZUNsYXNzKENyZWF0ZVN0b2NrTW92ZW1lbnQsIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIGlmICh0aGlzLnN0YXRlLnZhbHVlcy5vcmlnaW4gJiYgdGhpcy5zdGF0ZS52YWx1ZXMuZGVzdGluYXRpb24pIHsKICAgICAgICB0aGlzLmZldGNoU3RvY2tMaXN0cyh0aGlzLnN0YXRlLnZhbHVlcy5vcmlnaW4sIHRoaXMuc3RhdGUudmFsdWVzLmRlc3RpbmF0aW9uKTsKICAgICAgfQogICAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZXMub3JpZ2luKSB7CiAgICAgICAgdmFyIF90aGlzJHN0YXRlJHZhbHVlcyRvciwgX3RoaXMkc3RhdGUkdmFsdWVzJG9yMjsKICAgICAgICBpZiAoKF90aGlzJHN0YXRlJHZhbHVlcyRvciA9IHRoaXMuc3RhdGUudmFsdWVzLm9yaWdpbikgIT09IG51bGwgJiYgX3RoaXMkc3RhdGUkdmFsdWVzJG9yICE9PSB2b2lkIDAgJiYgKF90aGlzJHN0YXRlJHZhbHVlcyRvcjIgPSBfdGhpcyRzdGF0ZSR2YWx1ZXMkb3Iuc3VwcG9ydGVkQWN0aXZpdGllcykgIT09IG51bGwgJiYgX3RoaXMkc3RhdGUkdmFsdWVzJG9yMiAhPT0gdm9pZCAwICYmIF90aGlzJHN0YXRlJHZhbHVlcyRvcjIuaW5jbHVkZXMoQWN0aXZpdHlDb2RlLkFQUFJPVkVfUkVRVUVTVCkpIHsKICAgICAgICAgIHRoaXMuc2V0U3VwcG9ydHNBcHByb3Zlcih0cnVlKTsKICAgICAgICAgIHRoaXMuZmV0Y2hBdmFpbGFibGVBcHByb3ZlcnMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zZXRTdXBwb3J0c0FwcHJvdmVyKGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5mZXRjaFJlcXVpc2l0aW9uVHlwZXMoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykgewogICAgICBpZiAoIXRoaXMucHJvcHMubWF0Y2gucGFyYW1zLnN0b2NrTW92ZW1lbnRJZCAmJiB0aGlzLnN0YXRlLnNldEluaXRpYWxWYWx1ZXMgJiYgbmV4dFByb3BzLmxvY2F0aW9uLmlkKSB7CiAgICAgICAgdGhpcy5zZXRJbml0aWFsVmFsdWVzKG5leHRQcm9wcy5sb2NhdGlvbiwgbmV4dFByb3BzLnVzZXIpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0UmVxdWVzdFR5cGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFJlcXVlc3RUeXBlKHZhbHVlcywgc3RvY2tsaXN0KSB7CiAgICAgIHZhciByZXF1ZXN0VHlwZSA9IF8uZmluZCh0aGlzLnN0YXRlLnJlcXVlc3RUeXBlcywgZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICByZXR1cm4gdHlwZS5pZCA9PT0gJ1NUT0NLJzsKICAgICAgfSk7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIHZhbHVlczogdXBkYXRlKHZhbHVlcywgewogICAgICAgICAgcmVxdWVzdFR5cGU6IHsKICAgICAgICAgICAgJHNldDogcmVxdWVzdFR5cGUKICAgICAgICAgIH0sCiAgICAgICAgICBzdG9ja2xpc3Q6IHsKICAgICAgICAgICAgJHNldDogc3RvY2tsaXN0CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0SW5pdGlhbFZhbHVlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0SW5pdGlhbFZhbHVlcyhsb2NhdGlvbiwgdXNlcikgewogICAgICB2YXIgaWQgPSBsb2NhdGlvbi5pZCwKICAgICAgICBsb2NhdGlvblR5cGUgPSBsb2NhdGlvbi5sb2NhdGlvblR5cGUsCiAgICAgICAgbmFtZSA9IGxvY2F0aW9uLm5hbWU7CiAgICAgIHZhciB2YWx1ZXMgPSB7CiAgICAgICAgZGVzdGluYXRpb246IHsKICAgICAgICAgIGlkOiBpZCwKICAgICAgICAgIHR5cGU6IGxvY2F0aW9uVHlwZSA/IGxvY2F0aW9uVHlwZS5sb2NhdGlvblR5cGVDb2RlIDogbnVsbCwKICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICBsYWJlbDogIiIuY29uY2F0KG5hbWUsICIgWyIpLmNvbmNhdChsb2NhdGlvblR5cGUgPyBsb2NhdGlvblR5cGUuZGVzY3JpcHRpb24gOiBudWxsLCAiXSIpCiAgICAgICAgfSwKICAgICAgICByZXF1ZXN0ZWRCeTogewogICAgICAgICAgaWQ6IHVzZXIuaWQsCiAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUsCiAgICAgICAgICBsYWJlbDogIiIuY29uY2F0KHVzZXIubmFtZSkKICAgICAgICB9LAogICAgICAgIGRhdGVSZXF1ZXN0ZWQ6IG1vbWVudChuZXcgRGF0ZSgpKS5mb3JtYXQoJ01NL0REL1lZWVknKSwKICAgICAgICBhcHByb3ZlcnM6IHVuZGVmaW5lZAogICAgICB9OwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICB2YWx1ZXM6IHZhbHVlcywKICAgICAgICBzZXRJbml0aWFsVmFsdWVzOiBmYWxzZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRTdXBwb3J0c0FwcHJvdmVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRTdXBwb3J0c0FwcHJvdmVyKHZhbHVlKSB7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIHN1cHBvcnRzQXBwcm92ZXI6IHZhbHVlCiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogRmV0Y2hlcyBhdmFpbGFibGUgc2hpcG1lbnQgdHlwZXMgZnJvbSBBUEkuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJmZXRjaFJlcXVpc2l0aW9uVHlwZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVxdWlzaXRpb25UeXBlcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIHZhciB1cmwgPSAnL29wZW5ib3hlcy9hcGkvZ2V0UmVxdWVzdFR5cGVzJzsKICAgICAgcmV0dXJuIGFwaUNsaWVudC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7CiAgICAgICAgICByZXF1ZXN0VHlwZXM6IHJlc3BvbnNlLmRhdGEuZGF0YQogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczIucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczIucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZmV0Y2hBdmFpbGFibGVBcHByb3ZlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoQXZhaWxhYmxlQXBwcm92ZXJzKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgcmV0dXJuIHVzZXJBcGkuZ2V0VXNlcnNPcHRpb25zKHsKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIHJvbGVUeXBlczogUm9sZVR5cGUuUk9MRV9SRVFVSVNJVElPTl9BUFBST1ZFUgogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgX3Jlc3BvbnNlJGRhdGEkZGF0YTsKICAgICAgICB2YXIgb3B0aW9ucyA9IChfcmVzcG9uc2UkZGF0YSRkYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhKSA9PT0gbnVsbCB8fCBfcmVzcG9uc2UkZGF0YSRkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcmVzcG9uc2UkZGF0YSRkYXRhLm1hcChmdW5jdGlvbiAodXNlcikgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaWQ6IHVzZXIuaWQsCiAgICAgICAgICAgIHZhbHVlOiB1c2VyLmlkLAogICAgICAgICAgICBsYWJlbDogdXNlci5uYW1lCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIF90aGlzMy5zZXRTdGF0ZSh7CiAgICAgICAgICBhdmFpbGFibGVBcHByb3ZlcnM6IG9wdGlvbnMKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gb3B0aW9uczsKICAgICAgfSlbImZpbmFsbHkiXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjaGVja1N0b2NrTW92ZW1lbnRDaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrU3RvY2tNb3ZlbWVudENoYW5nZShuZXdWYWx1ZXMpIHsKICAgICAgdmFyIF90aGlzJHByb3BzJGluaXRpYWxWYSA9IHRoaXMucHJvcHMuaW5pdGlhbFZhbHVlcywKICAgICAgICBvcmlnaW4gPSBfdGhpcyRwcm9wcyRpbml0aWFsVmEub3JpZ2luLAogICAgICAgIGRlc3RpbmF0aW9uID0gX3RoaXMkcHJvcHMkaW5pdGlhbFZhLmRlc3RpbmF0aW9uLAogICAgICAgIHN0b2NrbGlzdCA9IF90aGlzJHByb3BzJGluaXRpYWxWYS5zdG9ja2xpc3Q7CiAgICAgIHZhciBvcmlnaW5Mb2NzID0gbmV3VmFsdWVzLm9yaWdpbiAmJiBvcmlnaW47CiAgICAgIHZhciBpc09sZFN1cHBsaWVyID0gb3JpZ2luICYmIG9yaWdpbi50eXBlID09PSAnU1VQUExJRVInOwogICAgICB2YXIgaXNOZXdTdXBwbGllciA9IG5ld1ZhbHVlcy5vcmlnaW4gJiYgbmV3VmFsdWVzLnR5cGUgPT09ICdTVVBQTElFUic7CiAgICAgIHZhciBjaGVja09yaWdpbiA9IG9yaWdpbkxvY3MgJiYgKCFpc09sZFN1cHBsaWVyIHx8IGlzT2xkU3VwcGxpZXIgJiYgIWlzTmV3U3VwcGxpZXIpID8gbmV3VmFsdWVzLm9yaWdpbi5pZCAhPT0gb3JpZ2luLmlkIDogZmFsc2U7CiAgICAgIHZhciBjaGVja0Rlc3QgPSBzdG9ja2xpc3QgJiYgbmV3VmFsdWVzLmRlc3RpbmF0aW9uICYmIGRlc3RpbmF0aW9uID8gbmV3VmFsdWVzLmRlc3RpbmF0aW9uLmlkICE9PSBkZXN0aW5hdGlvbi5pZCA6IGZhbHNlOwogICAgICB2YXIgY2hlY2tTdG9ja0xpc3QgPSBuZXdWYWx1ZXMuc3RvY2tNb3ZlbWVudElkID8gXy5nZXQobmV3VmFsdWVzLnN0b2NrbGlzdCwgJ2lkJywgbnVsbCkgIT09IF8uZ2V0KHN0b2NrbGlzdCwgJ2lkJywgbnVsbCkgOiBmYWxzZTsKICAgICAgcmV0dXJuIGNoZWNrT3JpZ2luIHx8IGNoZWNrRGVzdCB8fCBjaGVja1N0b2NrTGlzdDsKICAgIH0KCiAgICAvKioKICAgICAqIEZldGNoZXMgYXZhaWxhYmxlIHN0b2NrIGxpc3RzIGZyb20gQVBJIHdpdGggZ2l2ZW4gb3JpZ2luIGFuZCBkZXN0aW5hdGlvbi4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcmlnaW4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkZXN0aW5hdGlvbgogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2xlYXJTdG9ja2xpc3QKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImZldGNoU3RvY2tMaXN0cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hTdG9ja0xpc3RzKG9yaWdpbiwgZGVzdGluYXRpb24sIGNsZWFyU3RvY2tsaXN0KSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tsaXN0cz9vcmlnaW49Ii5jb25jYXQob3JpZ2luLmlkLCAiJmRlc3RpbmF0aW9uPSIpLmNvbmNhdChkZXN0aW5hdGlvbi5pZCk7CiAgICAgIHJldHVybiBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgc3RvY2tsaXN0cyA9IF8ubWFwKHJlc3BvbnNlLmRhdGEuZGF0YSwgZnVuY3Rpb24gKHN0b2NrbGlzdCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaWQ6IHN0b2NrbGlzdC5pZCwKICAgICAgICAgICAgbmFtZTogc3RvY2tsaXN0Lm5hbWUsCiAgICAgICAgICAgIHZhbHVlOiBzdG9ja2xpc3QuaWQsCiAgICAgICAgICAgIGxhYmVsOiBzdG9ja2xpc3QubmFtZQogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICB2YXIgc3RvY2tsaXN0Q2hhbmdlZCA9ICFfLmZpbmQoc3RvY2tsaXN0cywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiBpdGVtLnZhbHVlLmlkID09PSBfLmdldChfdGhpczQuc3RhdGUudmFsdWVzLCAnc3RvY2tsaXN0LmlkJyk7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKHN0b2NrbGlzdENoYW5nZWQgJiYgY2xlYXJTdG9ja2xpc3QpIHsKICAgICAgICAgIGNsZWFyU3RvY2tsaXN0KCk7CiAgICAgICAgfQogICAgICAgIF90aGlzNC5zZXRTdGF0ZSh7CiAgICAgICAgICBzdG9ja2xpc3RzOiBzdG9ja2xpc3RzCiAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzNC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzNC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgb3IgdXBkYXRlcyBzdG9jayBtb3ZlbWVudCB3aXRoIGdpdmVuIGRhdGEKICAgICAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVTdG9ja01vdmVtZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlU3RvY2tNb3ZlbWVudCh2YWx1ZXMpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CiAgICAgIGlmICh2YWx1ZXMub3JpZ2luICYmIHZhbHVlcy5kZXN0aW5hdGlvbiAmJiB2YWx1ZXMucmVxdWVzdGVkQnkgJiYgdmFsdWVzLmRhdGVSZXF1ZXN0ZWQgJiYgdmFsdWVzLmRlc2NyaXB0aW9uKSB7CiAgICAgICAgdmFyIF92YWx1ZXMkYXBwcm92ZXJzOwogICAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgICB2YXIgc3RvY2tNb3ZlbWVudFVybCA9ICcnOwogICAgICAgIGlmICh2YWx1ZXMuc3RvY2tNb3ZlbWVudElkKSB7CiAgICAgICAgICBzdG9ja01vdmVtZW50VXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvdXBkYXRlUmVxdWlzaXRpb24iKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RvY2tNb3ZlbWVudFVybCA9ICcvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cyc7CiAgICAgICAgfQogICAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgICAgbmFtZTogJycsCiAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsdWVzLmRlc2NyaXB0aW9uLAogICAgICAgICAgZGF0ZVJlcXVlc3RlZDogdmFsdWVzLmRhdGVSZXF1ZXN0ZWQsCiAgICAgICAgICAnb3JpZ2luLmlkJzogdmFsdWVzLm9yaWdpbi5pZCwKICAgICAgICAgICdkZXN0aW5hdGlvbi5pZCc6IHZhbHVlcy5kZXN0aW5hdGlvbi5pZCwKICAgICAgICAgICdyZXF1ZXN0ZWRCeS5pZCc6IHZhbHVlcy5yZXF1ZXN0ZWRCeS5pZCwKICAgICAgICAgICdzdG9ja2xpc3QuaWQnOiBfLmdldCh2YWx1ZXMuc3RvY2tsaXN0LCAnaWQnKSB8fCAnJywKICAgICAgICAgIHJlcXVlc3RUeXBlOiB2YWx1ZXMucmVxdWVzdFR5cGUuaWQsCiAgICAgICAgICBzb3VyY2VUeXBlOiBFTEVDVFJPTklDLAogICAgICAgICAgYXBwcm92ZXJzOiAoX3ZhbHVlcyRhcHByb3ZlcnMgPSB2YWx1ZXMuYXBwcm92ZXJzKSA9PT0gbnVsbCB8fCBfdmFsdWVzJGFwcHJvdmVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3ZhbHVlcyRhcHByb3ZlcnMubWFwKGZ1bmN0aW9uICh1c2VyKSB7CiAgICAgICAgICAgIHJldHVybiB1c2VyLmlkOwogICAgICAgICAgfSkKICAgICAgICB9OwogICAgICAgIGFwaUNsaWVudC5wb3N0KHN0b2NrTW92ZW1lbnRVcmwsIHBheWxvYWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICB2YXIgcmVzcCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgX3RoaXM1LnByb3BzLmhpc3RvcnkucHVzaCgiL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L2NyZWF0ZVJlcXVlc3QvIi5jb25jYXQocmVzcC5pZCkpOwogICAgICAgICAgICBfdGhpczUucHJvcHMubmV4dFBhZ2UoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB2YWx1ZXMpLCB7fSwgewogICAgICAgICAgICAgIHN0b2NrTW92ZW1lbnRJZDogcmVzcC5pZCwKICAgICAgICAgICAgICBsaW5lSXRlbXM6IHJlc3AubGluZUl0ZW1zLAogICAgICAgICAgICAgIG1vdmVtZW50TnVtYmVyOiByZXNwLmlkZW50aWZpZXIsCiAgICAgICAgICAgICAgbmFtZTogcmVzcC5uYW1lLAogICAgICAgICAgICAgIHN0b2NrbGlzdDogcmVzcC5zdG9ja2xpc3QsCiAgICAgICAgICAgICAgcmVwbGVuaXNobWVudFR5cGU6IHJlc3AucmVwbGVuaXNobWVudFR5cGUKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNS5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihfdGhpczUucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmNyZWF0ZVN0b2NrTW92ZW1lbnQubGFiZWwnLCAnQ291bGQgbm90IGNyZWF0ZSBzdG9jayBtb3ZlbWVudCcpKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNldFRvSW5pdGlhbFZhbHVlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXRUb0luaXRpYWxWYWx1ZXMoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICB2YWx1ZXM6IHt9CiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXM2LnNldFN0YXRlKHsKICAgICAgICAgIHZhbHVlczogX3RoaXM2LnByb3BzLmluaXRpYWxWYWx1ZXMKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxscyBtZXRob2QgY3JlYXRpbmcgb3Igc2F2aW5nIHN0b2NrIG1vdmVtZW50IGFuZCBtb3ZlcyB1c2VyIHRvIHRoZSBuZXh0IHBhZ2UuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gdmFsdWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJuZXh0UGFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbmV4dFBhZ2UodmFsdWVzKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwogICAgICB2YXIgc2hvd01vZGFsID0gdGhpcy5jaGVja1N0b2NrTW92ZW1lbnRDaGFuZ2UodmFsdWVzKTsKICAgICAgaWYgKCFzaG93TW9kYWwpIHsKICAgICAgICB0aGlzLnNhdmVTdG9ja01vdmVtZW50KHZhbHVlcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5tZXNzYWdlLmNvbmZpcm1DaGFuZ2UubGFiZWwnLCAnQ29uZmlybSBjaGFuZ2UnKSwKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1DaGFuZ2UubWVzc2FnZScsICdEbyB5b3Ugd2FudCB0byBjaGFuZ2Ugc3RvY2sgbW92ZW1lbnQgZGF0YT8gQ2hhbmdpbmcgb3JpZ2luLCBkZXN0aW5hdGlvbiBvciBzdG9jayBsaXN0IGNhbiBjYXVzZSBsb3NzIG9mIHlvdXIgY3VycmVudCB3b3JrJyksCiAgICAgICAgICBidXR0b25zOiBbewogICAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQubm8ubGFiZWwnLCAnTm8nKSwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM3LnJlc2V0VG9Jbml0aWFsVmFsdWVzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lnllcy5sYWJlbCcsICdZZXMnKSwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM3LnNhdmVTdG9ja01vdmVtZW50KHZhbHVlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CiAgICAgIHZhciBGSUVMRFMgPSB0aGlzLnN0YXRlLnN1cHBvcnRzQXBwcm92ZXIgPyBBUFBST1ZFUl9GSUVMRFMgOiBERUZBVUxUX0ZJRUxEUzsKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEZvcm0sIHsKICAgICAgICBvblN1Ym1pdDogZnVuY3Rpb24gb25TdWJtaXQodmFsdWVzKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXM4Lm5leHRQYWdlKHZhbHVlcyk7CiAgICAgICAgfSwKICAgICAgICB2YWxpZGF0ZTogdmFsaWRhdGUsCiAgICAgICAgaW5pdGlhbFZhbHVlczogdGhpcy5zdGF0ZS52YWx1ZXMsCiAgICAgICAgbXV0YXRvcnM6IHsKICAgICAgICAgIGNsZWFyU3RvY2tsaXN0OiBmdW5jdGlvbiBjbGVhclN0b2NrbGlzdChhcmdzLCBzdGF0ZSwgdXRpbHMpIHsKICAgICAgICAgICAgdXRpbHMuY2hhbmdlVmFsdWUoc3RhdGUsICdzdG9ja2xpc3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHNldEFwcHJvdmVyc1ZhbHVlczogZnVuY3Rpb24gc2V0QXBwcm92ZXJzVmFsdWVzKGFyZ3MsIHN0YXRlLCB1dGlscykgewogICAgICAgICAgICB2YXIgX2FyZ3MgPSBfc2xpY2VkVG9BcnJheShhcmdzLCAxKSwKICAgICAgICAgICAgICBzZWxlY3RlZE9wdGlvbnMgPSBfYXJnc1swXTsKICAgICAgICAgICAgdXRpbHMuY2hhbmdlVmFsdWUoc3RhdGUsICdhcHByb3ZlcnMnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkT3B0aW9uczsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihfcmVmMykgewogICAgICAgICAgdmFyIG11dGF0b3JzID0gX3JlZjMuZm9ybS5tdXRhdG9ycywKICAgICAgICAgICAgaGFuZGxlU3VibWl0ID0gX3JlZjMuaGFuZGxlU3VibWl0LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMy52YWx1ZXM7CiAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImZvcm0iLCB7CiAgICAgICAgICAgIG9uU3VibWl0OiBoYW5kbGVTdWJtaXQKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImNsYXNzaWMtZm9ybSB3aXRoLWRlc2NyaXB0aW9uIgogICAgICAgICAgfSwgXy5tYXAoRklFTERTLCBmdW5jdGlvbiAoZmllbGRDb25maWcsIGZpZWxkTmFtZSkgewogICAgICAgICAgICByZXR1cm4gcmVuZGVyRm9ybUZpZWxkKGZpZWxkQ29uZmlnLCBmaWVsZE5hbWUsIHsKICAgICAgICAgICAgICBzdG9ja2xpc3RzOiBfdGhpczguc3RhdGUuc3RvY2tsaXN0cywKICAgICAgICAgICAgICBmZXRjaFN0b2NrTGlzdHM6IGZ1bmN0aW9uIGZldGNoU3RvY2tMaXN0cyhvcmlnaW4sIGRlc3RpbmF0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM4LmZldGNoU3RvY2tMaXN0cyhvcmlnaW4sIGRlc3RpbmF0aW9uLCBtdXRhdG9ycy5jbGVhclN0b2NrbGlzdCk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBmZXRjaEF2YWlsYWJsZUFwcHJvdmVyczogZnVuY3Rpb24gZmV0Y2hBdmFpbGFibGVBcHByb3ZlcnMoKSB7CiAgICAgICAgICAgICAgICBfdGhpczguZmV0Y2hBdmFpbGFibGVBcHByb3ZlcnMoKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG9ubHkgb25lIGF2YWlsYWJsZSBhcHByb3ZlciB0byBjaG9vc2UgZnJvbQogICAgICAgICAgICAgICAgICAvLyB0aGVuIHByZXNlbGVjdCB0aGlzIG9wdGlvbnMgYnkgZGVmYXVsdAogICAgICAgICAgICAgICAgICBpZiAoKHJlc3AgPT09IG51bGwgfHwgcmVzcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcC5sZW5ndGgpID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgbXV0YXRvcnMuc2V0QXBwcm92ZXJzVmFsdWVzKHJlc3ApOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG11dGF0b3JzLnNldEFwcHJvdmVyc1ZhbHVlcyhbXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0U3VwcG9ydHNBcHByb3ZlcjogX3RoaXM4LnNldFN1cHBvcnRzQXBwcm92ZXIsCiAgICAgICAgICAgICAgb3JpZ2luOiB2YWx1ZXMub3JpZ2luLAogICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiB2YWx1ZXMuZGVzdGluYXRpb24sCiAgICAgICAgICAgICAgaXNTdXBlcnVzZXI6IF90aGlzOC5wcm9wcy5pc1N1cGVydXNlciwKICAgICAgICAgICAgICBkZWJvdW5jZWRQZW9wbGVGZXRjaDogX3RoaXM4LmRlYm91bmNlZFBlb3BsZUZldGNoLAogICAgICAgICAgICAgIGRlYm91bmNlZExvY2F0aW9uc0ZldGNoOiBfdGhpczguZGVib3VuY2VkTG9jYXRpb25zRmV0Y2gsCiAgICAgICAgICAgICAgcmVxdWVzdFR5cGVzOiBfdGhpczguc3RhdGUucmVxdWVzdFR5cGVzLAogICAgICAgICAgICAgIHNldFJlcXVlc3RUeXBlOiBfdGhpczguc2V0UmVxdWVzdFR5cGUsCiAgICAgICAgICAgICAgYXZhaWxhYmxlQXBwcm92ZXJzOiBfdGhpczguc3RhdGUuYXZhaWxhYmxlQXBwcm92ZXJzLAogICAgICAgICAgICAgIHZhbHVlczogdmFsdWVzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJzdWJtaXQtYnV0dG9ucyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJzdWJtaXQiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtcHJpbWFyeSBmbG9hdC1yaWdodCBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5uZXh0LmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJOZXh0IgogICAgICAgICAgfSkpKSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9XSk7CiAgcmV0dXJuIENyZWF0ZVN0b2NrTW92ZW1lbnQ7Cn0oQ29tcG9uZW50KTsKdmFyIG1hcFN0YXRlVG9Qcm9wcyA9IGZ1bmN0aW9uIG1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSkgewogIHJldHVybiB7CiAgICBsb2NhdGlvbjogc3RhdGUuc2Vzc2lvbi5jdXJyZW50TG9jYXRpb24sCiAgICBpc1N1cGVydXNlcjogc3RhdGUuc2Vzc2lvbi5pc1N1cGVydXNlciwKICAgIHRyYW5zbGF0ZTogdHJhbnNsYXRlV2l0aERlZmF1bHRNZXNzYWdlKGdldFRyYW5zbGF0ZShzdGF0ZS5sb2NhbGl6ZSkpLAogICAgZGVib3VuY2VUaW1lOiBzdGF0ZS5zZXNzaW9uLnNlYXJjaENvbmZpZy5kZWJvdW5jZVRpbWUsCiAgICBtaW5TZWFyY2hMZW5ndGg6IHN0YXRlLnNlc3Npb24uc2VhcmNoQ29uZmlnLm1pblNlYXJjaExlbmd0aCwKICAgIHVzZXI6IHN0YXRlLnNlc3Npb24udXNlcgogIH07Cn07CmV4cG9ydCBkZWZhdWx0IHdpdGhSb3V0ZXIoY29ubmVjdChtYXBTdGF0ZVRvUHJvcHMsIHsKICBzaG93U3Bpbm5lcjogc2hvd1NwaW5uZXIsCiAgaGlkZVNwaW5uZXI6IGhpZGVTcGlubmVyCn0pKENyZWF0ZVN0b2NrTW92ZW1lbnQpKTsKQ3JlYXRlU3RvY2tNb3ZlbWVudC5wcm9wVHlwZXMgPSB7CiAgLyoqIFJlYWN0IHJvdXRlcidzIG9iamVjdCB3aGljaCBjb250YWlucyBpbmZvcm1hdGlvbiBhYm91dCB1cmwgdmFyYWlhYmxlcyBhbmQgcGFyYW1zICovCiAgbWF0Y2g6IFByb3BUeXBlcy5zaGFwZSh7CiAgICBwYXJhbXM6IFByb3BUeXBlcy5zaGFwZSh7CiAgICAgIHN0b2NrTW92ZW1lbnRJZDogUHJvcFR5cGVzLnN0cmluZwogICAgfSkKICB9KS5pc1JlcXVpcmVkLAogIC8qKiBJbml0aWFsIGNvbXBvbmVudCdzIGRhdGEgKi8KICBpbml0aWFsVmFsdWVzOiBQcm9wVHlwZXMuc2hhcGUoewogICAgb3JpZ2luOiBQcm9wVHlwZXMuc2hhcGUoewogICAgICBpZDogUHJvcFR5cGVzLnN0cmluZwogICAgfSksCiAgICBkZXN0aW5hdGlvbjogUHJvcFR5cGVzLnNoYXBlKHsKICAgICAgaWQ6IFByb3BUeXBlcy5zdHJpbmcKICAgIH0pLAogICAgc3RvY2tsaXN0OiBQcm9wVHlwZXMuc2hhcGUoe30pCiAgfSkuaXNSZXF1aXJlZCwKICAvKiogRnVuY3Rpb24gY2FsbGVkIHdoZW4gZGF0YSBpcyBsb2FkaW5nICovCiAgc2hvd1NwaW5uZXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGRhdGEgaGFzIGxvYWRlZCAqLwogIGhpZGVTcGlubmVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKgogICAqIEZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSBmb3JtIGRhdGEgd2hlbiB0aGUgaGFuZGxlU3VibWl0KCkKICAgKiBpcyBmaXJlZCBmcm9tIHdpdGhpbiB0aGUgZm9ybSBjb21wb25lbnQuCiAgICovCiAgbmV4dFBhZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIFJlYWN0IHJvdXRlcidzIG9iamVjdCB1c2VkIHRvIG1hbmFnZSBzZXNzaW9uIGhpc3RvcnkgKi8KICBoaXN0b3J5OiBQcm9wVHlwZXMuc2hhcGUoewogICAgcHVzaDogUHJvcFR5cGVzLmZ1bmMKICB9KS5pc1JlcXVpcmVkLAogIC8qKiBDdXJyZW50IGxvY2F0aW9uICovCiAgbG9jYXRpb246IFByb3BUeXBlcy5zaGFwZSh7CiAgICBuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLAogICAgaWQ6IFByb3BUeXBlcy5zdHJpbmcsCiAgICBsb2NhdGlvblR5cGU6IFByb3BUeXBlcy5zaGFwZSh7CiAgICAgIGRlc2NyaXB0aW9uOiBQcm9wVHlwZXMuc3RyaW5nLAogICAgICBsb2NhdGlvblR5cGVDb2RlOiBQcm9wVHlwZXMuc3RyaW5nCiAgICB9KQogIH0pLmlzUmVxdWlyZWQsCiAgLyoqIFJldHVybiB0cnVlIGlmIGN1cnJlbnQgdXNlciBpcyBzdXBlcnVzZXIgKi8KICBpc1N1cGVydXNlcjogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICB0cmFuc2xhdGU6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgZGVib3VuY2VUaW1lOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsCiAgbWluU2VhcmNoTGVuZ3RoOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsCiAgdXNlcjogUHJvcFR5cGVzLnNoYXBlKHsKICAgIHVzZXJuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLAogICAgaWQ6IFByb3BUeXBlcy5zdHJpbmcsCiAgICBuYW1lOiBQcm9wVHlwZXMuc3RyaW5nCiAgfSkuaXNSZXF1aXJlZAp9Ow=="},null]}