{"remainingRequest":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js?presets[]=@babel/react&presets[]=@babel/env!/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js!/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/outbound/EditPage.jsx","dependencies":[{"path":"/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/outbound/EditPage.jsx","mtime":1698037750000},{"path":"/opt/MTOBS-BIKASH/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfSwgX3R5cGVvZihvYmopOyB9CmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsgfQpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9CmZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pOyBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB9CmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAodHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgaXRlcltTeW1ib2wuaXRlcmF0b3JdICE9IG51bGwgfHwgaXRlclsiQEBpdGVyYXRvciJdICE9IG51bGwpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KGFycik7IH0KZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBlbnVtZXJhYmxlT25seSAmJiAoc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pKSwga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBudWxsICE9IGFyZ3VtZW50c1tpXSA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpICUgMiA/IG93bktleXMoT2JqZWN0KHNvdXJjZSksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpIDogb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSByZXR1cm4gdGFyZ2V0OyB9CmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOyB9IH0KZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN1YkNsYXNzLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsga2V5ID0gX3RvUHJvcGVydHlLZXkoa2V5KTsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CmZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgeyB2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgInN0cmluZyIpOyByZXR1cm4gX3R5cGVvZihrZXkpID09PSAic3ltYm9sIiA/IGtleSA6IFN0cmluZyhrZXkpOyB9CmZ1bmN0aW9uIF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkgeyBpZiAoX3R5cGVvZihpbnB1dCkgIT09ICJvYmplY3QiIHx8IGlucHV0ID09PSBudWxsKSByZXR1cm4gaW5wdXQ7IHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTsgaWYgKHByaW0gIT09IHVuZGVmaW5lZCkgeyB2YXIgcmVzID0gcHJpbS5jYWxsKGlucHV0LCBoaW50IHx8ICJkZWZhdWx0Iik7IGlmIChfdHlwZW9mKHJlcykgIT09ICJvYmplY3QiKSByZXR1cm4gcmVzOyB0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpOyB9IHJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTsgfQppbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnOwppbXBvcnQgYXJyYXlNdXRhdG9ycyBmcm9tICdmaW5hbC1mb3JtLWFycmF5cyc7CmltcG9ydCB1cGRhdGUgZnJvbSAnaW1tdXRhYmlsaXR5LWhlbHBlcic7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7CmltcG9ydCB7IGNvbmZpcm1BbGVydCB9IGZyb20gJ3JlYWN0LWNvbmZpcm0tYWxlcnQnOwppbXBvcnQgeyBGb3JtIH0gZnJvbSAncmVhY3QtZmluYWwtZm9ybSc7CmltcG9ydCB7IGdldFRyYW5zbGF0ZSB9IGZyb20gJ3JlYWN0LWxvY2FsaXplLXJlZHV4JzsKaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ3JlYWN0LXJlZHV4JzsKaW1wb3J0IEFsZXJ0IGZyb20gJ3JlYWN0LXMtYWxlcnQnOwppbXBvcnQgeyBmZXRjaFJlYXNvbkNvZGVzLCBoaWRlU3Bpbm5lciwgc2hvd1NwaW5uZXIgfSBmcm9tICdhY3Rpb25zJzsKaW1wb3J0IEFycmF5RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL0FycmF5RmllbGQnOwppbXBvcnQgQnV0dG9uRmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL0J1dHRvbkZpZWxkJzsKaW1wb3J0IEZpbHRlcklucHV0IGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9GaWx0ZXJJbnB1dCc7CmltcG9ydCBMYWJlbEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9MYWJlbEZpZWxkJzsKaW1wb3J0IFNlbGVjdEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9TZWxlY3RGaWVsZCc7CmltcG9ydCBUYWJsZVJvd1dpdGhTdWJmaWVsZHMgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL1RhYmxlUm93V2l0aFN1YmZpZWxkcyc7CmltcG9ydCBUZXh0RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL1RleHRGaWVsZCc7CmltcG9ydCBEZXRhaWxzTW9kYWwgZnJvbSAnY29tcG9uZW50cy9zdG9jay1tb3ZlbWVudC13aXphcmQvbW9kYWxzL0RldGFpbHNNb2RhbCc7CmltcG9ydCBTdWJzdGl0dXRpb25zTW9kYWwgZnJvbSAnY29tcG9uZW50cy9zdG9jay1tb3ZlbWVudC13aXphcmQvbW9kYWxzL1N1YnN0aXR1dGlvbnNNb2RhbCc7CmltcG9ydCBhcGlDbGllbnQgZnJvbSAndXRpbHMvYXBpQ2xpZW50JzsKaW1wb3J0IHsgcmVuZGVyRm9ybUZpZWxkIH0gZnJvbSAndXRpbHMvZm9ybS11dGlscyc7CmltcG9ydCB7IGZvcm1hdFByb2R1Y3REaXNwbGF5TmFtZSwgbWF0Y2hlc1Byb2R1Y3RDb2RlT3JOYW1lLCBzaG93T3V0Ym91bmRFZGl0VmFsaWRhdGlvbkVycm9ycyB9IGZyb20gJ3V0aWxzL2Zvcm0tdmFsdWVzLXV0aWxzJzsKaW1wb3J0IFRyYW5zbGF0ZSwgeyB0cmFuc2xhdGVXaXRoRGVmYXVsdE1lc3NhZ2UgfSBmcm9tICd1dGlscy9UcmFuc2xhdGUnOwppbXBvcnQgJ3JlYWN0LWNvbmZpcm0tYWxlcnQvc3JjL3JlYWN0LWNvbmZpcm0tYWxlcnQuY3NzJzsKdmFyIEJUTl9DTEFTU19NQVBQRVIgPSB7CiAgWUVTOiAnYnRuIGJ0bi1vdXRsaW5lLXN1Y2Nlc3MnLAogIE5POiAnYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeScsCiAgRUFSTElFUjogJ2J0biBidG4tb3V0bGluZS13YXJuaW5nJywKICBISURERU46ICdidG4gaW52aXNpYmxlJwp9Owp2YXIgRklFTERTID0gewogIGVkaXRQYWdlSXRlbXM6IHsKICAgIHR5cGU6IEFycmF5RmllbGQsCiAgICBhcnJvd3NOYXZpZ2F0aW9uOiB0cnVlLAogICAgdmlydHVhbGl6ZWQ6IHRydWUsCiAgICB0b3RhbENvdW50OiBmdW5jdGlvbiB0b3RhbENvdW50KF9yZWYpIHsKICAgICAgdmFyIF90b3RhbENvdW50ID0gX3JlZi50b3RhbENvdW50OwogICAgICByZXR1cm4gX3RvdGFsQ291bnQ7CiAgICB9LAogICAgaXNSb3dMb2FkZWQ6IGZ1bmN0aW9uIGlzUm93TG9hZGVkKF9yZWYyKSB7CiAgICAgIHZhciBfaXNSb3dMb2FkZWQgPSBfcmVmMi5pc1Jvd0xvYWRlZDsKICAgICAgcmV0dXJuIF9pc1Jvd0xvYWRlZDsKICAgIH0sCiAgICBpc0ZpcnN0UGFnZUxvYWRlZDogZnVuY3Rpb24gaXNGaXJzdFBhZ2VMb2FkZWQoX3JlZjMpIHsKICAgICAgdmFyIF9pc0ZpcnN0UGFnZUxvYWRlZCA9IF9yZWYzLmlzRmlyc3RQYWdlTG9hZGVkOwogICAgICByZXR1cm4gX2lzRmlyc3RQYWdlTG9hZGVkOwogICAgfSwKICAgIGxvYWRNb3JlUm93czogZnVuY3Rpb24gbG9hZE1vcmVSb3dzKF9yZWY0KSB7CiAgICAgIHZhciBfbG9hZE1vcmVSb3dzID0gX3JlZjQubG9hZE1vcmVSb3dzOwogICAgICByZXR1cm4gX2xvYWRNb3JlUm93cygpOwogICAgfSwKICAgIHJvd0NvbXBvbmVudDogVGFibGVSb3dXaXRoU3ViZmllbGRzLAogICAgZ2V0RHluYW1pY1Jvd0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNSb3dBdHRyKF9yZWY1KSB7CiAgICAgIHZhciByb3dWYWx1ZXMgPSBfcmVmNS5yb3dWYWx1ZXMsCiAgICAgICAgc3ViZmllbGQgPSBfcmVmNS5zdWJmaWVsZCwKICAgICAgICBzaG93T25seUVycm9yZWRJdGVtcyA9IF9yZWY1LnNob3dPbmx5RXJyb3JlZEl0ZW1zLAogICAgICAgIGl0ZW1GaWx0ZXIgPSBfcmVmNS5pdGVtRmlsdGVyOwogICAgICB2YXIgY2xhc3NOYW1lID0gcm93VmFsdWVzLnN0YXR1c0NvZGUgPT09ICdTVUJTVElUVVRFRCcgPyAnY3Jvc3NlZC1vdXQgJyA6ICcnOwogICAgICBpZiAocm93VmFsdWVzLnF1YW50aXR5QXZhaWxhYmxlIDwgcm93VmFsdWVzLnF1YW50aXR5UmVxdWVzdGVkKSB7CiAgICAgICAgY2xhc3NOYW1lICs9ICdmb250LXdlaWdodC1ib2xkJzsKICAgICAgfQogICAgICB2YXIgZmlsdGVyT3V0SXRlbXMgPSBpdGVtRmlsdGVyICYmICFtYXRjaGVzUHJvZHVjdENvZGVPck5hbWUoewogICAgICAgIHByb2R1Y3Q6IHJvd1ZhbHVlcyA9PT0gbnVsbCB8fCByb3dWYWx1ZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJvd1ZhbHVlcy5wcm9kdWN0LAogICAgICAgIGZpbHRlclZhbHVlOiBpdGVtRmlsdGVyCiAgICAgIH0pOwogICAgICB2YXIgaGlkZVJvdyA9IChzaG93T25seUVycm9yZWRJdGVtcyAmJiAhcm93VmFsdWVzLmhhc0Vycm9yIHx8IGZpbHRlck91dEl0ZW1zKSAmJiAhc3ViZmllbGQ7CiAgICAgIHJldHVybiB7CiAgICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWUsCiAgICAgICAgaGlkZVJvdzogaGlkZVJvdwogICAgICB9OwogICAgfSwKICAgIHN1YmZpZWxkS2V5OiAnc3Vic3RpdHV0aW9uSXRlbXMnLAogICAgZmllbGRzOiB7CiAgICAgIHByb2R1Y3RDb2RlOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBoZWFkZXJBbGlnbjogJ2xlZnQnLAogICAgICAgIGZsZXhXaWR0aDogJzAuNicsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY2KSB7CiAgICAgICAgICB2YXIgc3ViZmllbGQgPSBfcmVmNi5zdWJmaWVsZDsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogc3ViZmllbGQgPyAndGV4dC1jZW50ZXInIDogJ3RleHQtbGVmdCBtbC0xJwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5jb2RlLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0NvZGUnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHNob3dWYWx1ZVRvb2x0aXA6IHRydWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHByb2R1Y3Q6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGhlYWRlckFsaWduOiAnbGVmdCcsCiAgICAgICAgZmxleFdpZHRoOiAnMy41JywKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucHJvZHVjdE5hbWUubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUHJvZHVjdCBuYW1lJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZm9ybWF0UHJvZHVjdERpc3BsYXlOYW1lCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjcpIHsKICAgICAgICAgIHZhciBfZmllbGRWYWx1ZSRkaXNwbGF5TmE7CiAgICAgICAgICB2YXIgc3ViZmllbGQgPSBfcmVmNy5zdWJmaWVsZCwKICAgICAgICAgICAgZmllbGRWYWx1ZSA9IF9yZWY3LmZpZWxkVmFsdWU7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjbGFzc05hbWU6IHN1YmZpZWxkID8gJ3RleHQtY2VudGVyJyA6ICd0ZXh0LWxlZnQgbWwtMScsCiAgICAgICAgICAgIHNob3dWYWx1ZVRvb2x0aXA6ICEhKGZpZWxkVmFsdWUgIT09IG51bGwgJiYgZmllbGRWYWx1ZSAhPT0gdm9pZCAwICYmIChfZmllbGRWYWx1ZSRkaXNwbGF5TmEgPSBmaWVsZFZhbHVlLmRpc3BsYXlOYW1lcykgIT09IG51bGwgJiYgX2ZpZWxkVmFsdWUkZGlzcGxheU5hICE9PSB2b2lkIDAgJiYgX2ZpZWxkVmFsdWUkZGlzcGxheU5hWyJkZWZhdWx0Il0pLAogICAgICAgICAgICB0b29sdGlwVmFsdWU6IGZpZWxkVmFsdWUgPT09IG51bGwgfHwgZmllbGRWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGRWYWx1ZS5uYW1lCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlSZXF1ZXN0ZWQ6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZXF1ZXN0ZWQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVxdWVzdGVkJywKICAgICAgICBmbGV4V2lkdGg6ICcxLjEnLAogICAgICAgIGhlYWRlckFsaWduOiAncmlnaHQnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNsYXNzTmFtZTogJ3RleHQtcmlnaHQnLAogICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IHZhbHVlLnRvTG9jYWxlU3RyaW5nKCdlbi1VUycpIDogdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBxdWFudGl0eU9uSGFuZDogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50Lm9uSGFuZC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdPbiBIYW5kJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY4KSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWY4LmZpZWxkVmFsdWU7CiAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gJ3RleHQtcmlnaHQnOwogICAgICAgICAgaWYgKGZpZWxkVmFsdWUgJiYgKCFmaWVsZFZhbHVlLnF1YW50aXR5T25IYW5kIHx8IGZpZWxkVmFsdWUucXVhbnRpdHlPbkhhbmQgPCBmaWVsZFZhbHVlLnF1YW50aXR5UmVxdWVzdGVkKSkgewogICAgICAgICAgICBjbGFzc05hbWUgPSAiIi5jb25jYXQoY2xhc3NOYW1lLCAiIHRleHQtZGFuZ2VyIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZQogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGhlYWRlckFsaWduOiAncmlnaHQnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGZvcm1hdFZhbHVlOiBmdW5jdGlvbiBmb3JtYXRWYWx1ZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUucXVhbnRpdHlPbkhhbmQgPyB2YWx1ZS5xdWFudGl0eU9uSGFuZC50b0xvY2FsZVN0cmluZygnZW4tVVMnKSA6IHZhbHVlLnF1YW50aXR5T25IYW5kOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5hdmFpbGFibGUubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQXZhaWxhYmxlJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY5KSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWY5LmZpZWxkVmFsdWU7CiAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gJ3RleHQtcmlnaHQnOwogICAgICAgICAgaWYgKGZpZWxkVmFsdWUgJiYgKCFmaWVsZFZhbHVlLnF1YW50aXR5QXZhaWxhYmxlIHx8IGZpZWxkVmFsdWUucXVhbnRpdHlBdmFpbGFibGUgPCBmaWVsZFZhbHVlLnF1YW50aXR5UmVxdWVzdGVkKSkgewogICAgICAgICAgICBjbGFzc05hbWUgPSAiIi5jb25jYXQoY2xhc3NOYW1lLCAiIHRleHQtZGFuZ2VyIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZQogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGhlYWRlckFsaWduOiAncmlnaHQnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGZvcm1hdFZhbHVlOiBmdW5jdGlvbiBmb3JtYXRWYWx1ZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUucXVhbnRpdHlBdmFpbGFibGUgPyB2YWx1ZS5xdWFudGl0eUF2YWlsYWJsZS50b0xvY2FsZVN0cmluZygnZW4tVVMnKSA6IHZhbHVlLnF1YW50aXR5QXZhaWxhYmxlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlEZW1hbmRGdWxmaWxsaW5nOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGVtYW5kUGVyTW9udGgubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGVtYW5kIHBlciBNb250aCcsCiAgICAgICAgZmxleFdpZHRoOiAnMS41JywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWUgIT09ICcwJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnRvTG9jYWxlU3RyaW5nKCdlbi1VUycpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gJzAnOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzaG93VmFsdWVUb29sdGlwOiB0cnVlCiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgaGVhZGVyQWxpZ246ICdyaWdodCcsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgY2xhc3NOYW1lOiAndGV4dC1yaWdodCcKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRldGFpbHNCdXR0b246IHsKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGV0YWlscy5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEZXRhaWxzJywKICAgICAgICB0eXBlOiBEZXRhaWxzTW9kYWwsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHRpdGxlOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5wZW5kaW5nUmVxdWlzaXRpb25EZXRhaWxzLmxhYmVsJywKICAgICAgICAgIGRlZmF1bHRUaXRsZU1lc3NhZ2U6ICdQZW5kaW5nIFJlcXVpc2l0aW9uIERldGFpbHMnCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjEwKSB7CiAgICAgICAgICB2YXIgX2ZpZWxkVmFsdWUkcHJvZHVjdCwgX2ZpZWxkVmFsdWUkcHJvZHVjdCRkOwogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmMTAuZmllbGRWYWx1ZSwKICAgICAgICAgICAgc3RvY2tNb3ZlbWVudElkID0gX3JlZjEwLnN0b2NrTW92ZW1lbnRJZCwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjEwLnZhbHVlczsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHByb2R1Y3RJZDogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnByb2R1Y3QgJiYgZmllbGRWYWx1ZS5wcm9kdWN0LmlkLAogICAgICAgICAgICBwcm9kdWN0Q29kZTogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnByb2R1Y3QgJiYgZmllbGRWYWx1ZS5wcm9kdWN0LnByb2R1Y3RDb2RlLAogICAgICAgICAgICBwcm9kdWN0TmFtZTogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnByb2R1Y3QgJiYgZmllbGRWYWx1ZS5wcm9kdWN0Lm5hbWUsCiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBmaWVsZFZhbHVlID09PSBudWxsIHx8IGZpZWxkVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfZmllbGRWYWx1ZSRwcm9kdWN0ID0gZmllbGRWYWx1ZS5wcm9kdWN0KSA9PT0gbnVsbCB8fCBfZmllbGRWYWx1ZSRwcm9kdWN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2ZpZWxkVmFsdWUkcHJvZHVjdCRkID0gX2ZpZWxkVmFsdWUkcHJvZHVjdC5kaXNwbGF5TmFtZXMpID09PSBudWxsIHx8IF9maWVsZFZhbHVlJHByb2R1Y3QkZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2ZpZWxkVmFsdWUkcHJvZHVjdCRkWyJkZWZhdWx0Il0sCiAgICAgICAgICAgIG9yaWdpbklkOiB2YWx1ZXMgJiYgdmFsdWVzLm9yaWdpbiAmJiB2YWx1ZXMub3JpZ2luLmlkLAogICAgICAgICAgICBzdG9ja01vdmVtZW50SWQ6IHN0b2NrTW92ZW1lbnRJZCwKICAgICAgICAgICAgcXVhbnRpdHlSZXF1ZXN0ZWQ6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5xdWFudGl0eVJlcXVlc3RlZCwKICAgICAgICAgICAgcXVhbnRpdHlPbkhhbmQ6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5xdWFudGl0eU9uSGFuZCwKICAgICAgICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5xdWFudGl0eUF2YWlsYWJsZSwKICAgICAgICAgICAgYnRuT3BlblRleHQ6ICdyZWFjdC5zdG9ja01vdmVtZW50LmRldGFpbHMubGFiZWwnLAogICAgICAgICAgICBidG5PcGVuRGVmYXVsdFRleHQ6ICdEZXRhaWxzJywKICAgICAgICAgICAgYnRuQ2FuY2VsVGV4dDogJ0Nsb3NlJywKICAgICAgICAgICAgYnRuU2F2ZVN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ25vbmUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJ0bkNvbnRhaW5lckNsYXNzTmFtZTogJ2Zsb2F0LXJpZ2h0JywKICAgICAgICAgICAgYnRuT3BlbkFzSWNvbjogdHJ1ZSwKICAgICAgICAgICAgYnRuT3BlblN0eWxlOiB7CiAgICAgICAgICAgICAgYm9yZGVyOiAnbm9uZScsCiAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYnRuT3Blbkljb246ICdmYS1zZWFyY2gnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgc3Vic3RpdHV0ZUJ1dHRvbjogewogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5zdWJzdGl0dXRpb24ubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU3Vic3RpdHV0aW9uJywKICAgICAgICB0eXBlOiBTdWJzdGl0dXRpb25zTW9kYWwsCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHRpdGxlOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5zdWJzdGl0dXRlcy5sYWJlbCcsCiAgICAgICAgICBkZWZhdWx0VGl0bGVNZXNzYWdlOiAnU3Vic3RpdHV0ZXMnCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjExKSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYxMS5maWVsZFZhbHVlLAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYxMS5yb3dJbmRleCwKICAgICAgICAgICAgc3RvY2tNb3ZlbWVudElkID0gX3JlZjExLnN0b2NrTW92ZW1lbnRJZCwKICAgICAgICAgICAgb25SZXNwb25zZSA9IF9yZWYxMS5vblJlc3BvbnNlLAogICAgICAgICAgICByZXZpc2VSZXF1aXNpdGlvbkl0ZW1zID0gX3JlZjExLnJldmlzZVJlcXVpc2l0aW9uSXRlbXMsCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYxMS52YWx1ZXMsCiAgICAgICAgICAgIHJlYXNvbkNvZGVzID0gX3JlZjExLnJlYXNvbkNvZGVzLAogICAgICAgICAgICBzaG93T25seSA9IF9yZWYxMS5zaG93T25seTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24gb25PcGVuKCkgewogICAgICAgICAgICAgIHJldHVybiByZXZpc2VSZXF1aXNpdGlvbkl0ZW1zKHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByb2R1Y3RDb2RlOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucHJvZHVjdENvZGUsCiAgICAgICAgICAgIGJ0bk9wZW5UZXh0OiAicmVhY3Quc3RvY2tNb3ZlbWVudC4iLmNvbmNhdChmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuc3Vic3RpdHV0aW9uU3RhdHVzLCAiLmxhYmVsIiksCiAgICAgICAgICAgIGJ0bk9wZW5EZWZhdWx0VGV4dDogIiIuY29uY2F0KGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdWJzdGl0dXRpb25TdGF0dXMpLAogICAgICAgICAgICBidG5PcGVuRGlzYWJsZWQ6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdGF0dXNDb2RlID09PSAnU1VCU1RJVFVURUQnIHx8IHNob3dPbmx5LAogICAgICAgICAgICBidG5PcGVuQ2xhc3NOYW1lOiBCVE5fQ0xBU1NfTUFQUEVSW2ZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdWJzdGl0dXRpb25TdGF0dXMgfHwgJ0hJRERFTiddLAogICAgICAgICAgICByb3dJbmRleDogcm93SW5kZXgsCiAgICAgICAgICAgIGxpbmVJdGVtOiBmaWVsZFZhbHVlLAogICAgICAgICAgICBzdG9ja01vdmVtZW50SWQ6IHN0b2NrTW92ZW1lbnRJZCwKICAgICAgICAgICAgb25SZXNwb25zZTogb25SZXNwb25zZSwKICAgICAgICAgICAgcmVhc29uQ29kZXM6IHJlYXNvbkNvZGVzCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlSZXZpc2VkOiB7CiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnF1YW50aXR5UmV2aXNlZC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdRdHkgcmV2aXNlZCcsCiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGZpZWxkS2V5OiAnc3RhdHVzQ29kZScsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgdHlwZTogJ251bWJlcicKICAgICAgICB9LAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTIpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjEyLmZpZWxkVmFsdWUsCiAgICAgICAgICAgIHN1YmZpZWxkID0gX3JlZjEyLnN1YmZpZWxkLAogICAgICAgICAgICBzaG93T25seSA9IF9yZWYxMi5zaG93T25seSwKICAgICAgICAgICAgdXBkYXRlUm93ID0gX3JlZjEyLnVwZGF0ZVJvdywKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjEyLnZhbHVlcywKICAgICAgICAgICAgcm93SW5kZXggPSBfcmVmMTIucm93SW5kZXg7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkaXNhYmxlZDogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlID09PSAnU1VCU1RJVFVURUQnIHx8IHN1YmZpZWxkIHx8IHNob3dPbmx5LAogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlUm93KHZhbHVlcywgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmVhc29uQ29kZTogewogICAgICAgIHR5cGU6IFNlbGVjdEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZWFzb25Db2RlLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1JlYXNvbiBjb2RlJywKICAgICAgICBmbGV4V2lkdGg6ICcxLjQnLAogICAgICAgIGZpZWxkS2V5OiAncXVhbnRpdHlSZXZpc2VkJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjEzKSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYxMy5maWVsZFZhbHVlLAogICAgICAgICAgICBzdWJmaWVsZCA9IF9yZWYxMy5zdWJmaWVsZCwKICAgICAgICAgICAgcmVhc29uQ29kZXMgPSBfcmVmMTMucmVhc29uQ29kZXMsCiAgICAgICAgICAgIHVwZGF0ZVJvdyA9IF9yZWYxMy51cGRhdGVSb3csCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYxMy52YWx1ZXMsCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjEzLnJvd0luZGV4OwogICAgICAgICAgdmFyIGlzU3Vic3RpdHV0ZWQgPSBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuc3RhdHVzQ29kZSA9PT0gJ1NVQlNUSVRVVEVEJzsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRpc2FibGVkOiBmaWVsZFZhbHVlID09PSBudWxsIHx8IGZpZWxkVmFsdWUgPT09IHVuZGVmaW5lZCB8fCBzdWJmaWVsZCB8fCBpc1N1YnN0aXR1dGVkLAogICAgICAgICAgICBvcHRpb25zOiByZWFzb25Db2RlcywKICAgICAgICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZSwKICAgICAgICAgICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVJvdyh2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJldmVydDogewogICAgICAgIHR5cGU6IEJ1dHRvbkZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3QuZGVmYXVsdC5idXR0b24udW5kby5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdVbmRvJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgYnV0dG9uTGFiZWw6ICdyZWFjdC5kZWZhdWx0LmJ1dHRvbi51bmRvLmxhYmVsJywKICAgICAgICBidXR0b25EZWZhdWx0TWVzc2FnZTogJ1VuZG8nLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTQpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjE0LmZpZWxkVmFsdWUsCiAgICAgICAgICAgIHJldmVydEl0ZW0gPSBfcmVmMTQucmV2ZXJ0SXRlbSwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjE0LnZhbHVlcywKICAgICAgICAgICAgc2hvd09ubHkgPSBfcmVmMTQuc2hvd09ubHk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvbkNsaWNrOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucmVxdWlzaXRpb25JdGVtSWQgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJldmVydEl0ZW0odmFsdWVzLCBmaWVsZFZhbHVlLnJlcXVpc2l0aW9uSXRlbUlkKTsKICAgICAgICAgICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGlkZGVuOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuc3RhdHVzQ29kZSA/ICFfLmluY2x1ZGVzKFsnQ0hBTkdFRCcsICdDQU5DRUxFRCddLCBmaWVsZFZhbHVlLnN0YXR1c0NvZGUpIDogZmFsc2UsCiAgICAgICAgICAgIGRpc2FibGVkOiBzaG93T25seQogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNsYXNzTmFtZTogJ2J0biBidG4tb3V0bGluZS1kYW5nZXInCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9OwpmdW5jdGlvbiB2YWxpZGF0ZUZvclNhdmUodmFsdWVzKSB7CiAgdmFyIGVycm9ycyA9IHt9OwogIGVycm9ycy5lZGl0UGFnZUl0ZW1zID0gW107CiAgXy5mb3JFYWNoKHZhbHVlcy5lZGl0UGFnZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7CiAgICBpZiAoIV8uaXNFbXB0eShpdGVtLnF1YW50aXR5UmV2aXNlZCkgJiYgXy5pc0VtcHR5KGl0ZW0ucmVhc29uQ29kZSkpIHsKICAgICAgZXJyb3JzLmVkaXRQYWdlSXRlbXNba2V5XSA9IHsKICAgICAgICByZWFzb25Db2RlOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvcnMucmVhc29uQ29kZVJlcXVpcmVkLmxhYmVsJwogICAgICB9OwogICAgfSBlbHNlIGlmIChfLmlzTmlsKGl0ZW0ucXVhbnRpdHlSZXZpc2VkKSAmJiAhXy5pc0VtcHR5KGl0ZW0ucmVhc29uQ29kZSkgJiYgaXRlbS5zdGF0dXNDb2RlICE9PSAnU1VCU1RJVFVURUQnKSB7CiAgICAgIGVycm9ycy5lZGl0UGFnZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgcXVhbnRpdHlSZXZpc2VkOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvcnMucmV2aXNlZFF1YW50aXR5UmVxdWlyZWQubGFiZWwnCiAgICAgIH07CiAgICB9CiAgICBpZiAocGFyc2VJbnQoaXRlbS5xdWFudGl0eVJldmlzZWQsIDEwKSA9PT0gaXRlbS5xdWFudGl0eVJlcXVlc3RlZCkgewogICAgICBlcnJvcnMuZWRpdFBhZ2VJdGVtc1trZXldID0gewogICAgICAgIHF1YW50aXR5UmV2aXNlZDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3JzLnNhbWVSZXZpc2VkUXR5LmxhYmVsJwogICAgICB9OwogICAgfQogICAgaWYgKCFfLmlzRW1wdHkoaXRlbS5xdWFudGl0eVJldmlzZWQpICYmIGl0ZW0ucXVhbnRpdHlBdmFpbGFibGUgPj0gMCAmJiBpdGVtLnF1YW50aXR5UmV2aXNlZCA+IGl0ZW0ucXVhbnRpdHlBdmFpbGFibGUpIHsKICAgICAgZXJyb3JzLmVkaXRQYWdlSXRlbXNba2V5XSA9IHsKICAgICAgICBxdWFudGl0eVJldmlzZWQ6ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9ycy5oaWdoZXJRdHkubGFiZWwnCiAgICAgIH07CiAgICB9CiAgICBpZiAoIV8uaXNFbXB0eShpdGVtLnF1YW50aXR5UmV2aXNlZCkgJiYgaXRlbS5xdWFudGl0eVJldmlzZWQgPCAwKSB7CiAgICAgIGVycm9ycy5lZGl0UGFnZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgcXVhbnRpdHlSZXZpc2VkOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvcnMubmVnYXRpdmVRdHkubGFiZWwnCiAgICAgIH07CiAgICB9CiAgfSk7CiAgcmV0dXJuIGVycm9yczsKfQoKLyoqCiAqIFRoZSB0aGlyZCBzdGVwIG9mIHN0b2NrIG1vdmVtZW50KGZvciBtb3ZlbWVudHMgZnJvbSBhIGRlcG90KSB3aGVyZSB1c2VyIGNhbiBzZWUgdGhlCiAqIHN0b2NrIGF2YWlsYWJsZSBhbmQgYWRqdXN0IHF1YW50aXRpZXMgb3IgbWFrZSBzdWJzdGl0dXRpb25zIGJhc2VkIG9uIHRoYXQgaW5mb3JtYXRpb24uCiAqLwp2YXIgRWRpdEl0ZW1zUGFnZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhFZGl0SXRlbXNQYWdlLCBfQ29tcG9uZW50KTsKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEVkaXRJdGVtc1BhZ2UpOwogIGZ1bmN0aW9uIEVkaXRJdGVtc1BhZ2UocHJvcHMpIHsKICAgIHZhciBfdGhpczsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFZGl0SXRlbXNQYWdlKTsKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpOwogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZGF0YUZldGNoZWQiLCBmYWxzZSk7CiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgc3RhdHVzQ29kZTogJycsCiAgICAgIHJldmlzZWRJdGVtczogW10sCiAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5wcm9wcy5pbml0aWFsVmFsdWVzKSwge30sIHsKICAgICAgICBlZGl0UGFnZUl0ZW1zOiBbXQogICAgICB9KSwKICAgICAgaGFzSXRlbXNMb2FkZWQ6IGZhbHNlLAogICAgICB0b3RhbENvdW50OiAwLAogICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogZmFsc2UsCiAgICAgIHNob3dPbmx5RXJyb3JlZEl0ZW1zOiBmYWxzZSwKICAgICAgaXRlbUZpbHRlcjogJycKICAgIH07CiAgICBfdGhpcy5yZXZlcnRJdGVtID0gX3RoaXMucmV2ZXJ0SXRlbS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmZldGNoRWRpdFBhZ2VJdGVtcyA9IF90aGlzLmZldGNoRWRpdFBhZ2VJdGVtcy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnJldmlzZVJlcXVpc2l0aW9uSXRlbXMgPSBfdGhpcy5yZXZpc2VSZXF1aXNpdGlvbkl0ZW1zLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMuaXNSb3dMb2FkZWQgPSBfdGhpcy5pc1Jvd0xvYWRlZC5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmxvYWRNb3JlUm93cyA9IF90aGlzLmxvYWRNb3JlUm93cy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnVwZGF0ZVJvdyA9IF90aGlzLnVwZGF0ZVJvdy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLm1hcmtFcnJvcmVkTGluZXMgPSBfdGhpcy5tYXJrRXJyb3JlZExpbmVzLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMudmFsaWRhdGUgPSBfdGhpcy52YWxpZGF0ZS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQogIF9jcmVhdGVDbGFzcyhFZGl0SXRlbXNQYWdlLCBbewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICBpZiAodGhpcy5wcm9wcy5zdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZCkgewogICAgICAgIHRoaXMuZGF0YUZldGNoZWQgPSB0cnVlOwogICAgICAgIHRoaXMuZmV0Y2hBbGxEYXRhKGZhbHNlKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7CiAgICAgIGlmIChuZXh0UHJvcHMuc3RvY2tNb3ZlbWVudFRyYW5zbGF0aW9uc0ZldGNoZWQgJiYgIXRoaXMuZGF0YUZldGNoZWQpIHsKICAgICAgICB0aGlzLmRhdGFGZXRjaGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmZldGNoQWxsRGF0YShmYWxzZSk7CiAgICAgIH0KCiAgICAgIC8vIElmIHdlIGNoYW5nZSB0aGUgbGFuZ3VhZ2UsIHJlZmV0Y2ggdGhlIHJlYXNvbiBjb2RlcwogICAgICBpZiAobmV4dFByb3BzLmN1cnJlbnRMb2NhbGUgIT09IHRoaXMucHJvcHMuY3VycmVudExvY2FsZSkgewogICAgICAgIHRoaXMucHJvcHMuZmV0Y2hSZWFzb25Db2RlcygpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0RWRpdFBhZ2VJdGVtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RWRpdFBhZ2VJdGVtcyhyZXNwb25zZSwgc3RhcnRJbmRleCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgdmFyIGVkaXRQYWdlSXRlbXMgPSBfLm1hcChkYXRhLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdmFsKSwge30sIHsKICAgICAgICAgIGRpc2FibGVkOiB0cnVlLAogICAgICAgICAgcXVhbnRpdHlPbkhhbmQ6IHZhbC5xdWFudGl0eU9uSGFuZCA+IDAgPyB2YWwucXVhbnRpdHlPbkhhbmQgOiAwLAogICAgICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IHZhbC5xdWFudGl0eUF2YWlsYWJsZSA+IDAgPyB2YWwucXVhbnRpdHlBdmFpbGFibGUgOiAwLAogICAgICAgICAgcHJvZHVjdDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB2YWwucHJvZHVjdCksIHt9LCB7CiAgICAgICAgICAgIGxhYmVsOiAiIi5jb25jYXQodmFsLnByb2R1Y3RDb2RlLCAiICIpLmNvbmNhdCh2YWwucHJvZHVjdE5hbWUpCiAgICAgICAgICB9KSwKICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuCiAgICAgICAgICByZWFzb25Db2RlOiBfLmZpbmQoX3RoaXMyLnByb3BzLnJlYXNvbkNvZGVzLCBmdW5jdGlvbiAoX3JlZjE1KSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9yZWYxNS52YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIF8uaW5jbHVkZXModmFsLnJlYXNvbkNvZGUsIHZhbHVlKTsKICAgICAgICAgIH0pLAogICAgICAgICAgc3Vic3RpdHV0aW9uSXRlbXM6IF8ubWFwKHZhbC5zdWJzdGl0dXRpb25JdGVtcywgZnVuY3Rpb24gKHN1YikgewogICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzdWIpLCB7fSwgewogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuCiAgICAgICAgICAgICAgcmVhc29uQ29kZTogXy5maW5kKF90aGlzMi5wcm9wcy5yZWFzb25Db2RlcywgZnVuY3Rpb24gKF9yZWYxNikgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gX3JlZjE2LnZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuIF8uaW5jbHVkZXModmFsLnJlYXNvbkNvZGUsIHZhbHVlKTsKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICByZXF1aXNpdGlvbkl0ZW1JZDogdmFsLnJlcXVpc2l0aW9uSXRlbUlkLAogICAgICAgICAgICAgIHByb2R1Y3Q6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc3ViLnByb2R1Y3QpLCB7fSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICIiLmNvbmNhdChzdWIucHJvZHVjdENvZGUsICIgIikuY29uY2F0KHN1Yi5wcm9kdWN0TmFtZSkKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICByZXZpc2VkSXRlbXM6IF8uZmlsdGVyKGVkaXRQYWdlSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5zdGF0dXNDb2RlID09PSAnQ0hBTkdFRCc7CiAgICAgICAgfSksCiAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRoaXMuc3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgIGVkaXRQYWdlSXRlbXM6IF8udW5pcUJ5KF8uY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLmVkaXRQYWdlSXRlbXMsIGVkaXRQYWdlSXRlbXMpLCAncmVxdWlzaXRpb25JdGVtSWQnKQogICAgICAgIH0pLAogICAgICAgIGhhc0l0ZW1zTG9hZGVkOiB0aGlzLnN0YXRlLmhhc0l0ZW1zTG9hZGVkIHx8IHRoaXMuc3RhdGUudG90YWxDb3VudCA9PT0gXy51bmlxQnkoXy5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuZWRpdFBhZ2VJdGVtcywgZWRpdFBhZ2VJdGVtcyksICdyZXF1aXNpdGlvbkl0ZW1JZCcpLmxlbmd0aAogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW4KICAgICAgICBpZiAoIV8uaXNOdWxsKHN0YXJ0SW5kZXgpICYmIF90aGlzMi5zdGF0ZS52YWx1ZXMuZWRpdFBhZ2VJdGVtcy5sZW5ndGggIT09IF90aGlzMi5zdGF0ZS50b3RhbENvdW50KSB7CiAgICAgICAgICBfdGhpczIubG9hZE1vcmVSb3dzKHsKICAgICAgICAgICAgc3RhcnRJbmRleDogc3RhcnRJbmRleCArIF90aGlzMi5wcm9wcy5wYWdlU2l6ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIF90aGlzMi5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmFsaWRhdGUodmFsdWVzKSB7CiAgICAgIHZhciBlcnJvcnMgPSB2YWxpZGF0ZUZvclNhdmUodmFsdWVzKTsKICAgICAgXy5mb3JFYWNoKHZhbHVlcy5lZGl0UGFnZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7CiAgICAgICAgaWYgKF8uaXNOaWwoaXRlbS5xdWFudGl0eVJldmlzZWQpICYmIGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgPiBpdGVtLnF1YW50aXR5QXZhaWxhYmxlICYmIGl0ZW0uc3RhdHVzQ29kZSAhPT0gJ1NVQlNUSVRVVEVEJykgewogICAgICAgICAgZXJyb3JzLmVkaXRQYWdlSXRlbXNba2V5XSA9IHsKICAgICAgICAgICAgcXVhbnRpdHlSZXZpc2VkOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvcnMubG93ZXJRdHkubGFiZWwnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMubWFya0Vycm9yZWRMaW5lcyh2YWx1ZXMsIGVycm9ycyk7CiAgICAgIHJldHVybiBlcnJvcnM7CiAgICB9CiAgfSwgewogICAga2V5OiAibWFya0Vycm9yZWRMaW5lcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbWFya0Vycm9yZWRMaW5lcyh2YWx1ZXMsIGVycm9ycykgewogICAgICB2YXIgdXBkYXRlZFZhbHVlcyA9IHZhbHVlczsKICAgICAgXy5mb3JFYWNoKHRoaXMuc3RhdGUudmFsdWVzLmVkaXRQYWdlSXRlbXMsIGZ1bmN0aW9uIChpdGVtLCBpdGVtSWR4KSB7CiAgICAgICAgdXBkYXRlZFZhbHVlcyA9IHVwZGF0ZSh1cGRhdGVkVmFsdWVzLCB7CiAgICAgICAgICBlZGl0UGFnZUl0ZW1zOiBfZGVmaW5lUHJvcGVydHkoe30sIGl0ZW1JZHgsIHsKICAgICAgICAgICAgaGFzRXJyb3I6IHsKICAgICAgICAgICAgICAkc2V0OiAhIV8uZmluZChlcnJvcnMuZWRpdFBhZ2VJdGVtcywgZnVuY3Rpb24gKGVycm9yLCBlcnJvcklkeCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1JZHggPT09IGVycm9ySWR4OwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICB2YWx1ZXM6IHVwZGF0ZWRWYWx1ZXMsCiAgICAgICAgc2hvd09ubHlFcnJvcmVkSXRlbXM6ICFlcnJvcnMuZWRpdFBhZ2VJdGVtcy5sZW5ndGggPyBmYWxzZSA6IHRoaXMuc3RhdGUuc2hvd09ubHlFcnJvcmVkSXRlbXMKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZmV0Y2hBbGxEYXRhIiwKICAgIHZhbHVlOgogICAgLyoqCiAgICAgKiBGZXRjaGVzIGFsbCByZXF1aXJlZCBkYXRhLgogICAgICogQHBhcmFtIHtib29sZWFufSBmb3JjZUZldGNoCiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZldGNoQWxsRGF0YShmb3JjZUZldGNoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHRoaXMucHJvcHMuZmV0Y2hSZWFzb25Db2RlcygpOwogICAgICB0aGlzLmZldGNoRWRpdFBhZ2VEYXRhKCkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgIHZhciBzdGF0dXNDb2RlID0gcmVzcC5kYXRhLmRhdGEuc3RhdHVzQ29kZTsKICAgICAgICB2YXIgdG90YWxDb3VudCA9IHJlc3AuZGF0YS50b3RhbENvdW50OwogICAgICAgIF90aGlzMy5zZXRTdGF0ZSh7CiAgICAgICAgICBzdGF0dXNDb2RlOiBzdGF0dXNDb2RlLAogICAgICAgICAgdG90YWxDb3VudDogdG90YWxDb3VudAogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICghX3RoaXMzLnByb3BzLmlzUGFnaW5hdGVkIHx8IGZvcmNlRmV0Y2gpIHsKICAgICAgICAgICAgX3RoaXMzLmZldGNoSXRlbXMoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmZXRjaEl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaEl0ZW1zKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvc3RvY2tNb3ZlbWVudEl0ZW1zP3N0ZXBOdW1iZXI9MyIpOwogICAgICBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczQuc2V0RWRpdFBhZ2VJdGVtcyhyZXNwb25zZSwgbnVsbCk7CiAgICAgICAgX3RoaXM0LnNldFN0YXRlKHsKICAgICAgICAgIGhhc0l0ZW1zTG9hZGVkOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgY2hhbmdlcyBtYWRlIGluIHN1YnNpdHV0aW9uIG1vZGFsIGFuZCB1cGRhdGVzIGRhdGEuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJmZXRjaEVkaXRQYWdlSXRlbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoRWRpdFBhZ2VJdGVtcygpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3N0b2NrTW92ZW1lbnRJdGVtcz9zdGVwTnVtYmVyPTMiKTsKICAgICAgYXBpQ2xpZW50LmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgX3RoaXM1LnNldFN0YXRlKHsKICAgICAgICAgIGhhc0l0ZW1zTG9hZGVkOiB0cnVlLAogICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzNS5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgICAgICBlZGl0UGFnZUl0ZW1zOiBfLm1hcChkYXRhLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGl0ZW0pLCB7fSwgewogICAgICAgICAgICAgICAgcXVhbnRpdHlPbkhhbmQ6IGl0ZW0ucXVhbnRpdHlPbkhhbmQgfHwgMCwKICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuCiAgICAgICAgICAgICAgICByZWFzb25Db2RlOiBfLmZpbmQoX3RoaXM1LnByb3BzLnJlYXNvbkNvZGVzLCBmdW5jdGlvbiAoX3JlZjE3KSB7CiAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9yZWYxNy52YWx1ZTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uaW5jbHVkZXMoaXRlbS5yZWFzb25Db2RlLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbkl0ZW1zOiBfLm1hcChpdGVtLnN1YnN0aXR1dGlvbkl0ZW1zLCBmdW5jdGlvbiAoc3ViKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHN1YiksIHt9LCB7CiAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW4KICAgICAgICAgICAgICAgICAgICByZWFzb25Db2RlOiBfLmZpbmQoX3RoaXM1LnByb3BzLnJlYXNvbkNvZGVzLCBmdW5jdGlvbiAoX3JlZjE4KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBfcmVmMTgudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5pbmNsdWRlcyhpdGVtLnJlYXNvbkNvZGUsIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICByZXF1aXNpdGlvbkl0ZW1JZDogaXRlbS5yZXF1aXNpdGlvbkl0ZW1JZAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KQogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNS5mZXRjaEFsbERhdGEoZmFsc2UpOwogICAgICAgICAgX3RoaXM1LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgfSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczUucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAibG9hZE1vcmVSb3dzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkTW9yZVJvd3MoX3JlZjE5KSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwogICAgICB2YXIgc3RhcnRJbmRleCA9IF9yZWYxOS5zdGFydEluZGV4OwogICAgICBpZiAodGhpcy5zdGF0ZS50b3RhbENvdW50KSB7CiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3N0b2NrTW92ZW1lbnRJdGVtcz9vZmZzZXQ9IikuY29uY2F0KHN0YXJ0SW5kZXgsICImbWF4PSIpLmNvbmNhdCh0aGlzLnByb3BzLnBhZ2VTaXplLCAiJnN0ZXBOdW1iZXI9MyIpOwogICAgICAgIGFwaUNsaWVudC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM2LnNldEVkaXRQYWdlSXRlbXMocmVzcG9uc2UsIHN0YXJ0SW5kZXgpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNSb3dMb2FkZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzUm93TG9hZGVkKF9yZWYyMCkgewogICAgICB2YXIgaW5kZXggPSBfcmVmMjAuaW5kZXg7CiAgICAgIHJldHVybiAhIXRoaXMuc3RhdGUudmFsdWVzLmVkaXRQYWdlSXRlbXNbaW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZHMgZGF0YSBvZiByZXZpc2VkIGl0ZW1zIHdpdGggcG9zdCBtZXRob2QuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gdmFsdWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZXZpc2VSZXF1aXNpdGlvbkl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXZpc2VSZXF1aXNpdGlvbkl0ZW1zKHZhbHVlcykgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKICAgICAgdmFyIGl0ZW1zVG9SZXZpc2UgPSBfLmZpbHRlcih2YWx1ZXMuZWRpdFBhZ2VJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbS5xdWFudGl0eVJldmlzZWQgJiYgaXRlbS5yZWFzb25Db2RlKSB7CiAgICAgICAgICB2YXIgb2xkUmV2aXNpb24gPSBfLmZpbmQoX3RoaXM3LnN0YXRlLnJldmlzZWRJdGVtcywgZnVuY3Rpb24gKHJldmlzaW9uKSB7CiAgICAgICAgICAgIHJldHVybiByZXZpc2lvbi5yZXF1aXNpdGlvbkl0ZW1JZCA9PT0gaXRlbS5yZXF1aXNpdGlvbkl0ZW1JZDsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIF8uaXNFbXB0eShvbGRSZXZpc2lvbikgPyB0cnVlIDogXy50b0ludGVnZXIob2xkUmV2aXNpb24ucXVhbnRpdHlSZXZpc2VkKSAhPT0gXy50b0ludGVnZXIoaXRlbS5xdWFudGl0eVJldmlzZWQpIHx8IG9sZFJldmlzaW9uLnJlYXNvbkNvZGUgIT09IGl0ZW0ucmVhc29uQ29kZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9KTsKICAgICAgdmFyIHVwZGF0ZWRWYWx1ZXMgPSB2YWx1ZXM7CiAgICAgIF8uZm9yRWFjaChpdGVtc1RvUmV2aXNlLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHZhciBlZGl0UGFnZUl0ZW1JbmRleCA9IF8uZmluZEluZGV4KF90aGlzNy5zdGF0ZS52YWx1ZXMuZWRpdFBhZ2VJdGVtcywgZnVuY3Rpb24gKGVkaXRQYWdlSXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW0ucmVxdWlzaXRpb25JdGVtSWQgPT09IGVkaXRQYWdlSXRlbS5yZXF1aXNpdGlvbkl0ZW1JZDsKICAgICAgICB9KTsKICAgICAgICB1cGRhdGVkVmFsdWVzID0gdXBkYXRlKHVwZGF0ZWRWYWx1ZXMsIHsKICAgICAgICAgIGVkaXRQYWdlSXRlbXM6IF9kZWZpbmVQcm9wZXJ0eSh7fSwgZWRpdFBhZ2VJdGVtSW5kZXgsIHsKICAgICAgICAgICAgc3RhdHVzQ29kZTogewogICAgICAgICAgICAgICRzZXQ6ICdDSEFOR0VEJwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdmFsdWVzOiB1cGRhdGVkVmFsdWVzCiAgICAgIH0pOwogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi9yZXZpc2VJdGVtcyIpOwogICAgICB2YXIgcGF5bG9hZCA9IHsKICAgICAgICBsaW5lSXRlbXM6IF8ubWFwKGl0ZW1zVG9SZXZpc2UsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBpZDogaXRlbS5yZXF1aXNpdGlvbkl0ZW1JZCwKICAgICAgICAgICAgcXVhbnRpdHlSZXZpc2VkOiBpdGVtLnF1YW50aXR5UmV2aXNlZCwKICAgICAgICAgICAgcmVhc29uQ29kZTogaXRlbS5yZWFzb25Db2RlLnZhbHVlCiAgICAgICAgICB9OwogICAgICAgIH0pCiAgICAgIH07CiAgICAgIGlmIChwYXlsb2FkLmxpbmVJdGVtcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QodXJsLCBwYXlsb2FkKTsKICAgICAgfQogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlUm93IiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVSb3codmFsdWVzLCBpbmRleCkgewogICAgICB2YXIgaXRlbSA9IHZhbHVlcy5lZGl0UGFnZUl0ZW1zW2luZGV4XTsKICAgICAgdmFyIHZhbCA9IHZhbHVlczsKICAgICAgdmFsID0gdXBkYXRlKHZhbHVlcywgewogICAgICAgIGVkaXRQYWdlSXRlbXM6IF9kZWZpbmVQcm9wZXJ0eSh7fSwgaW5kZXgsIHsKICAgICAgICAgICRzZXQ6IGl0ZW0KICAgICAgICB9KQogICAgICB9KTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdmFsdWVzOiB2YWwKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBsaXN0IG9mIHJlcXVpc2l0aW9uIGl0ZW1zIGluIGN1cnJlbnQgc3RlcCAod2l0aG91dCBzdGVwIGNoYW5nZSkuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZm9ybVZhbHVlcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZShmb3JtVmFsdWVzKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHZhciBlcnJvcnMgPSB2YWxpZGF0ZUZvclNhdmUoZm9ybVZhbHVlcykuZWRpdFBhZ2VJdGVtczsKICAgICAgaWYgKGVycm9ycy5sZW5ndGgpIHsKICAgICAgICBzaG93T3V0Ym91bmRFZGl0VmFsaWRhdGlvbkVycm9ycyh7CiAgICAgICAgICB0cmFuc2xhdGU6IHRoaXMucHJvcHMudHJhbnNsYXRlLAogICAgICAgICAgZXJyb3JzOiBlcnJvcnMKICAgICAgICB9KTsKICAgICAgICB0aGlzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMucmV2aXNlUmVxdWlzaXRpb25JdGVtcyhmb3JtVmFsdWVzKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgLy8gSWYgcmVwb25zZSAyMDAsIHRoZW4gc2F2ZSByZXZpc2UgaXRlbXMgdGFrZW4gZnJvbSB0aGUgcGF5bG9hZAogICAgICAgIHZhciBwYXlsb2FkID0gSlNPTi5wYXJzZShyZXNwLmNvbmZpZy5kYXRhKTsKICAgICAgICBpZiAocGF5bG9hZC5saW5lSXRlbXMgJiYgcGF5bG9hZC5saW5lSXRlbXMubGVuZ3RoKSB7CiAgICAgICAgICB2YXIgc2F2ZWRJdGVtSWRzID0gcGF5bG9hZC5saW5lSXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLmlkOwogICAgICAgICAgfSk7CiAgICAgICAgICAvLyBNYXAgdG8gaGF2ZSB0aGUgcmVxdWlyZWQgZmllbGQKICAgICAgICAgIC8vIChyZXF1aXNpdGlvbkl0ZW1JZCwgcXVhbnRpdHlSZXZpc2VkIGFuZCByZWFzb25Db2RlIGFzIG9iaikKICAgICAgICAgIHZhciBzYXZlZEl0ZW1zID0gcGF5bG9hZC5saW5lSXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGl0ZW0pLCB7fSwgewogICAgICAgICAgICAgIHJlcXVpc2l0aW9uSXRlbUlkOiBpdGVtLmlkLAogICAgICAgICAgICAgIHJlYXNvbkNvZGU6IF8uZmluZChfdGhpczgucHJvcHMucmVhc29uQ29kZXMsIGZ1bmN0aW9uIChfcmVmMjEpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9yZWYyMS52YWx1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBfLmluY2x1ZGVzKGl0ZW0ucmVhc29uQ29kZSwgdmFsdWUpOwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICAvLyBHZXQgb2xkIHJldmlzZSBpdGVtcywgdGhhdCB3ZXJlIG5vdCBjaGFuZ2VkIGluIHRoaXMgcmVxdWVzdAogICAgICAgICAgdmFyIG9sZEl0ZW1zID0gXy5maWx0ZXIoX3RoaXM4LnN0YXRlLnZhbHVlcy5lZGl0UGFnZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gc2F2ZWRJdGVtSWRzLmluZGV4T2YoaXRlbS5yZXF1aXNpdGlvbkl0ZW1JZCkgPCAwOwogICAgICAgICAgfSk7CiAgICAgICAgICBfdGhpczguc2V0U3RhdGUoewogICAgICAgICAgICByZXZpc2VkSXRlbXM6IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkob2xkSXRlbXMpLCBfdG9Db25zdW1hYmxlQXJyYXkoc2F2ZWRJdGVtcykpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgX3RoaXM4LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgQWxlcnQuc3VjY2VzcyhfdGhpczgucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmFsZXJ0LnNhdmVTdWNjZXNzLmxhYmVsJywgJ0NoYW5nZXMgc2F2ZWQgc3VjY2Vzc2Z1bGx5JyksIHsKICAgICAgICAgIHRpbWVvdXQ6IDMwMDAKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczgucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxvYWQgdGhlIGRhdGEsIGFsbCBub3Qgc2F2ZWQgY2hhbmdlcyB3aWxsIGJlIGxvc3QuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZWxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbG9hZCgpIHsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgcmV2aXNlZEl0ZW1zOiBbXSwKICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5wcm9wcy5pbml0aWFsVmFsdWVzKSwge30sIHsKICAgICAgICAgIGVkaXRQYWdlSXRlbXM6IFtdCiAgICAgICAgfSksCiAgICAgICAgaGFzSXRlbXNMb2FkZWQ6IGZhbHNlLAogICAgICAgIHRvdGFsQ291bnQ6IDAsCiAgICAgICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IGZhbHNlCiAgICAgIH0pOwogICAgICB0aGlzLmZldGNoQWxsRGF0YSh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmV0Y2ggdGhlIGRhdGEsIGFsbCBub3Qgc2F2ZWQgY2hhbmdlcyB3aWxsIGJlIGxvc3QuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQubWVzc2FnZS5jb25maXJtUmVmcmVzaC5sYWJlbCcsICdDb25maXJtIHJlZnJlc2gnKSwKICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUmVmcmVzaC5tZXNzYWdlJywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZWZyZXNoPyBZb3VyIHByb2dyZXNzIHNpbmNlIGxhc3Qgc2F2ZSB3aWxsIGJlIGxvc3QuJyksCiAgICAgICAgYnV0dG9uczogW3sKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC55ZXMubGFiZWwnLCAnWWVzJyksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXM5LnJlbG9hZCgpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgfV0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2l0aW9uIHRvIG5leHQgc3RvY2sgbW92ZW1lbnQgc3RhdHVzIChQSUNLSU5HKQogICAgICogYWZ0ZXIgc2VuZGluZyBjcmVhdGVQaWNrbGlzdDogJ3RydWUnIHRvIGJhY2tlbmQgYXV0b3BpY2sgZnVuY3Rpb25hbGl0eSBpcyBpbnZva2VkLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAidHJhbnNpdGlvblRvTmV4dFN0ZXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyYW5zaXRpb25Ub05leHRTdGVwKCkgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi9zdGF0dXMiKTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgc3RhdHVzOiAnUElDS0lORycsCiAgICAgICAgY3JlYXRlUGlja2xpc3Q6IHRoaXMuc3RhdGUuc3RhdHVzQ29kZSA9PT0gJ1JFUVVFU1RFRCcgPyAndHJ1ZScgOiAnZmFsc2UnCiAgICAgIH07CiAgICAgIHJldHVybiBhcGlDbGllbnQucG9zdCh1cmwsIHBheWxvYWQpOwogICAgfQoKICAgIC8qKgogICAgICogRmV0Y2hlcyAzcmQgc3RlcCBkYXRhIGZyb20gY3VycmVudCBzdG9jayBtb3ZlbWVudC4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImZldGNoRWRpdFBhZ2VEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaEVkaXRQYWdlRGF0YSgpIHsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICByZXR1cm4gYXBpQ2xpZW50LmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICByZXR1cm4gcmVzcDsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycikgewogICAgICAgIHJldHVybiBlcnI7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgY3VycmVudCBzdG9jayBtb3ZlbWVudCBwcm9ncmVzcyAobGluZSBpdGVtcykgYW5kIGdvZXMgdG8gdGhlIG5leHQgc3RvY2sgbW92ZW1lbnQgc3RlcC4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmb3JtVmFsdWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJuZXh0UGFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbmV4dFBhZ2UoZm9ybVZhbHVlcykgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgdGhpcy5yZXZpc2VSZXF1aXNpdGlvbkl0ZW1zKGZvcm1WYWx1ZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTAudHJhbnNpdGlvblRvTmV4dFN0ZXAoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczEwLnByb3BzLm5leHRQYWdlKGZvcm1WYWx1ZXMpOwogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczEwLnJlbG9hZCgpOwogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMTAucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjaGFuZ2VzIG1hZGUgd2hlbiBpdGVtIHJldmVydGVkLgogICAgICogQHBhcmFtIHtvYmplY3R9IGVkaXRQYWdlSXRlbQogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAidXBkYXRlRWRpdFBhZ2VJdGVtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVFZGl0UGFnZUl0ZW0odmFsdWVzLCBlZGl0UGFnZUl0ZW0pIHsKICAgICAgdmFyIGVkaXRQYWdlSXRlbUluZGV4ID0gXy5maW5kSW5kZXgodGhpcy5zdGF0ZS52YWx1ZXMuZWRpdFBhZ2VJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5yZXF1aXNpdGlvbkl0ZW1JZCA9PT0gZWRpdFBhZ2VJdGVtLnJlcXVpc2l0aW9uSXRlbUlkOwogICAgICB9KTsKICAgICAgdmFyIHJldmlzZWRJdGVtSW5kZXggPSBfLmZpbmRJbmRleCh0aGlzLnN0YXRlLnJldmlzZWRJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5yZXF1aXNpdGlvbkl0ZW1JZCA9PT0gZWRpdFBhZ2VJdGVtLnJlcXVpc2l0aW9uSXRlbUlkOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHZhbHVlcyksIHt9LCB7CiAgICAgICAgICBlZGl0UGFnZUl0ZW1zOiB1cGRhdGUodmFsdWVzLmVkaXRQYWdlSXRlbXMsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgZWRpdFBhZ2VJdGVtSW5kZXgsIHsKICAgICAgICAgICAgJHNldDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBlZGl0UGFnZUl0ZW0pLCB7fSwgewogICAgICAgICAgICAgIHF1YW50aXR5T25IYW5kOiBlZGl0UGFnZUl0ZW0ucXVhbnRpdHlPbkhhbmQgfHwgMCwKICAgICAgICAgICAgICBxdWFudGl0eUF2YWlsYWJsZTogZWRpdFBhZ2VJdGVtLnF1YW50aXR5QXZhaWxhYmxlIHx8IDAsCiAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uSXRlbXM6IF8ubWFwKGVkaXRQYWdlSXRlbS5zdWJzdGl0dXRpb25JdGVtcywgZnVuY3Rpb24gKHN1YikgewogICAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc3ViKSwge30sIHsKICAgICAgICAgICAgICAgICAgcmVxdWlzaXRpb25JdGVtSWQ6IGVkaXRQYWdlSXRlbS5yZXF1aXNpdGlvbkl0ZW1JZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICAgIH0pKQogICAgICAgIH0pLAogICAgICAgIHJldmlzZWRJdGVtczogdXBkYXRlKHRoaXMuc3RhdGUucmV2aXNlZEl0ZW1zLCByZXZpc2VkSXRlbUluZGV4ID4gLTEgPyB7CiAgICAgICAgICAkc3BsaWNlOiBbW3JldmlzZWRJdGVtSW5kZXgsIDFdXQogICAgICAgIH0gOiB7fSkKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjaGFuZ2VzIG1hZGUgYnkgdXNlciBpbiB0aGlzIHN0ZXAgYW5kIHJlZGlyZWN0cyB0byB0aGUgc2hpcG1lbnQgdmlldyBwYWdlCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZm9ybVZhbHVlcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZUFuZEV4aXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmVBbmRFeGl0KGZvcm1WYWx1ZXMpIHsKICAgICAgdmFyIGVycm9ycyA9IHZhbGlkYXRlRm9yU2F2ZShmb3JtVmFsdWVzKS5lZGl0UGFnZUl0ZW1zOwogICAgICBpZiAoZXJyb3JzLmxlbmd0aCkgewogICAgICAgIGNvbmZpcm1BbGVydCh7CiAgICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybUV4aXQubGFiZWwnLCAnQ29uZmlybSBzYXZlJyksCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtRXhpdC5tZXNzYWdlJywgJ1ZhbGlkYXRpb24gZXJyb3JzIG9jY3VycmVkLiBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZXhpdCBhbmQgbG9zZSB1bnNhdmVkIGRhdGE/JyksCiAgICAgICAgICBidXR0b25zOiBbewogICAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQueWVzLmxhYmVsJywgJ1llcycpLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICIvb3BlbmJveGVzL3N0b2NrTW92ZW1lbnQvc2hvdy8iLmNvbmNhdChmb3JtVmFsdWVzLnN0b2NrTW92ZW1lbnRJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lm5vLmxhYmVsJywgJ05vJykKICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmV2aXNlUmVxdWlzaXRpb25JdGVtcyhmb3JtVmFsdWVzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICIvb3BlbmJveGVzL3N0b2NrTW92ZW1lbnQvc2hvdy8iLmNvbmNhdChmb3JtVmFsdWVzLnN0b2NrTW92ZW1lbnRJZCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldmVydHMgdG8gcHJldmlvdXMgc3RhdGUgb2YgcmVxdWlzaXRpb24gaXRlbSAocmV2ZXJ0cyBzdWJzdGl0dXRpb25zIGFuZCBxdWFudGl0eSByZXZpc2lvbnMpCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaXRlbUlkCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZXZlcnRJdGVtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXZlcnRJdGVtKHZhbHVlcywgaXRlbUlkKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB2YXIgcmV2ZXJ0SXRlbXNVcmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudEl0ZW1zLyIuY29uY2F0KGl0ZW1JZCwgIi9yZXZlcnRJdGVtIik7CiAgICAgIHZhciBpdGVtc1VybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50SXRlbXMvIi5jb25jYXQoaXRlbUlkLCAiP3N0ZXBOdW1iZXI9MyIpOwogICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QocmV2ZXJ0SXRlbXNVcmwpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBhcGlDbGllbnQuZ2V0KGl0ZW1zVXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgdmFyIGVkaXRQYWdlSXRlbSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgIF90aGlzMTEudXBkYXRlRWRpdFBhZ2VJdGVtKHZhbHVlcywgZWRpdFBhZ2VJdGVtKTsKICAgICAgICAgIF90aGlzMTEucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczExLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKF90aGlzMTEucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLnJldmVydFJlcXVpc2l0aW9uSXRlbS5sYWJlbCcsICdDb3VsZCBub3QgcmV2ZXJ0IHJlcXVpc2l0aW9uIGl0ZW1zJykpKTsKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTEucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKF90aGlzMTEucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLnJldmVydFJlcXVpc2l0aW9uSXRlbS5sYWJlbCcsICdDb3VsZCBub3QgcmV2ZXJ0IHJlcXVpc2l0aW9uIGl0ZW1zJykpKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjaGFuZ2VzIG1hZGUgYnkgdXNlciBpbiB0aGlzIHN0ZXAgYW5kIGdvIGJhY2sgdG8gcHJldmlvdXMgcGFnZQogICAgICogQHBhcmFtIHtvYmplY3R9IHZhbHVlcwogICAgICogQHBhcmFtIHtib29sZWFufSBpbnZhbGlkCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJwcmV2aW91c1BhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByZXZpb3VzUGFnZSh2YWx1ZXMsIGludmFsaWQpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwogICAgICBpZiAoIWludmFsaWQpIHsKICAgICAgICB0aGlzLnJldmlzZVJlcXVpc2l0aW9uSXRlbXModmFsdWVzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczEyLnByb3BzLnByZXZpb3VzUGFnZSh2YWx1ZXMpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbmZpcm1BbGVydCh7CiAgICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVByZXZpb3VzUGFnZS5sYWJlbCcsICdWYWxpZGF0aW9uIGVycm9yJyksCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUHJldmlvdXNQYWdlLm1lc3NhZ2UubGFiZWwnLCAnQ2Fubm90IHNhdmUgZHVlIHRvIHZhbGlkYXRpb24gZXJyb3Igb24gcGFnZScpLAogICAgICAgICAgYnV0dG9uczogW3sKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1QcmV2aW91c1BhZ2UuY29ycmVjdEVycm9yLmxhYmVsJywgJ0NvcnJlY3QgZXJyb3InKQogICAgICAgICAgfSwgewogICAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVByZXZpb3VzUGFnZS5jb250aW51ZS5sYWJlbCcsICdDb250aW51ZSAobG9zZSB1bnNhdmVkIHdvcmspJyksCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTIucHJvcHMucHJldmlvdXNQYWdlKHZhbHVlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwogICAgICB2YXIgX3RoaXMkc3RhdGUgPSB0aGlzLnN0YXRlLAogICAgICAgIHNob3dPbmx5RXJyb3JlZEl0ZW1zID0gX3RoaXMkc3RhdGUuc2hvd09ubHlFcnJvcmVkSXRlbXMsCiAgICAgICAgaXRlbUZpbHRlciA9IF90aGlzJHN0YXRlLml0ZW1GaWx0ZXI7CiAgICAgIHZhciBzaG93T25seSA9IHRoaXMucHJvcHMuc2hvd09ubHk7CiAgICAgIHZhciBlcnJvcmVkSXRlbXNDb3VudCA9IHRoaXMuc3RhdGUudmFsdWVzICYmIHRoaXMuc3RhdGUudmFsdWVzLmVkaXRQYWdlSXRlbXMubGVuZ3RoID4gMCA/IF8uZmlsdGVyKHRoaXMuc3RhdGUudmFsdWVzLmVkaXRQYWdlSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0uaGFzRXJyb3I7CiAgICAgIH0pLmxlbmd0aCA6ICcwJzsKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEZvcm0sIHsKICAgICAgICBvblN1Ym1pdDogZnVuY3Rpb24gb25TdWJtaXQoKSB7fSwKICAgICAgICB2YWxpZGF0ZTogdGhpcy52YWxpZGF0ZSwKICAgICAgICBtdXRhdG9yczogX29iamVjdFNwcmVhZCh7fSwgYXJyYXlNdXRhdG9ycyksCiAgICAgICAgaW5pdGlhbFZhbHVlczogdGhpcy5zdGF0ZS52YWx1ZXMsCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoX3JlZjIyKSB7CiAgICAgICAgICB2YXIgaGFuZGxlU3VibWl0ID0gX3JlZjIyLmhhbmRsZVN1Ym1pdCwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjIyLnZhbHVlcywKICAgICAgICAgICAgaW52YWxpZCA9IF9yZWYyMi5pbnZhbGlkOwogICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImQtZmxleCBmbGV4LWNvbHVtbiIKICAgICAgICAgIH0sICFzaG93T25seSA/IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJidXR0b25zLWNvbnRhaW5lciIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEZpbHRlcklucHV0LCB7CiAgICAgICAgICAgIGl0ZW1GaWx0ZXI6IGl0ZW1GaWx0ZXIsCiAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXRlbUZpbHRlcjogZS50YXJnZXQudmFsdWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25DbGVhcjogZnVuY3Rpb24gb25DbGVhcigpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpdGVtRmlsdGVyOiAnJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgc2hvd09ubHlFcnJvcmVkSXRlbXM6ICFzaG93T25seUVycm9yZWRJdGVtcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgYnRuLXhzIG1sLTMgIi5jb25jYXQoc2hvd09ubHlFcnJvcmVkSXRlbXMgPyAnYWN0aXZlJyA6ICcnKQogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBlcnJvcmVkSXRlbXNDb3VudCwgIiAiLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yZWRJdGVtc0NvdW50LmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJpdGVtKHMpIHJlcXVpcmUgeW91ciBhdHRlbnRpb24iCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMy5yZWZyZXNoKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBidG4teHMgbWwtMyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXJlZnJlc2ggcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5yZWZyZXNoLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJSZWxvYWQiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMy5zYXZlKHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBtbC0zIGJ0bi14cyBtbC0zIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtc2F2ZSBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnNhdmUubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMy5zYXZlQW5kRXhpdCh2YWx1ZXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgbWwtMyBidG4teHMgbWwtMyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXNpZ24tb3V0IHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uc2F2ZUFuZEV4aXQubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUgYW5kIGV4aXQiCiAgICAgICAgICB9KSkpKSA6IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcvb3BlbmJveGVzL3N0b2NrTW92ZW1lbnQvbGlzdD9kaXJlY3Rpb249T1VUQk9VTkQnOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1kYW5nZXIgYWxpZ24tc2VsZi1lbmQgYnRuLXhzIG1yLTIiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zaWduLW91dCBwci0yIgogICAgICAgICAgfSksICIgIiwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uZXhpdC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRXhpdCIKICAgICAgICAgIH0pLCAiICIpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImZvcm0iLCB7CiAgICAgICAgICAgIG9uU3VibWl0OiBoYW5kbGVTdWJtaXQKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogInRhYmxlLWZvcm0iCiAgICAgICAgICB9LCBfLm1hcChGSUVMRFMsIGZ1bmN0aW9uIChmaWVsZENvbmZpZywgZmllbGROYW1lKSB7CiAgICAgICAgICAgIHJldHVybiByZW5kZXJGb3JtRmllbGQoZmllbGRDb25maWcsIGZpZWxkTmFtZSwgewogICAgICAgICAgICAgIHN0b2NrTW92ZW1lbnRJZDogdmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwKICAgICAgICAgICAgICB0cmFuc2xhdGU6IF90aGlzMTMucHJvcHMudHJhbnNsYXRlLAogICAgICAgICAgICAgIHJlYXNvbkNvZGVzOiBfdGhpczEzLnByb3BzLnJlYXNvbkNvZGVzLAogICAgICAgICAgICAgIG9uUmVzcG9uc2U6IF90aGlzMTMuZmV0Y2hFZGl0UGFnZUl0ZW1zLAogICAgICAgICAgICAgIHJldmVydEl0ZW06IF90aGlzMTMucmV2ZXJ0SXRlbSwKICAgICAgICAgICAgICByZXZpc2VSZXF1aXNpdGlvbkl0ZW1zOiBfdGhpczEzLnJldmlzZVJlcXVpc2l0aW9uSXRlbXMsCiAgICAgICAgICAgICAgdG90YWxDb3VudDogX3RoaXMxMy5zdGF0ZS50b3RhbENvdW50LAogICAgICAgICAgICAgIGxvYWRNb3JlUm93czogX3RoaXMxMy5sb2FkTW9yZVJvd3MsCiAgICAgICAgICAgICAgaXNSb3dMb2FkZWQ6IF90aGlzMTMuaXNSb3dMb2FkZWQsCiAgICAgICAgICAgICAgaXNQYWdpbmF0ZWQ6IF90aGlzMTMucHJvcHMuaXNQYWdpbmF0ZWQsCiAgICAgICAgICAgICAgdXBkYXRlUm93OiBfdGhpczEzLnVwZGF0ZVJvdywKICAgICAgICAgICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogX3RoaXMxMy5zdGF0ZS5pc0ZpcnN0UGFnZUxvYWRlZCwKICAgICAgICAgICAgICB2YWx1ZXM6IHZhbHVlcywKICAgICAgICAgICAgICBzaG93T25seTogc2hvd09ubHksCiAgICAgICAgICAgICAgc2hvd09ubHlFcnJvcmVkSXRlbXM6IHNob3dPbmx5RXJyb3JlZEl0ZW1zLAogICAgICAgICAgICAgIGl0ZW1GaWx0ZXI6IGl0ZW1GaWx0ZXIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogInN1Ym1pdC1idXR0b25zIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogInN1Ym1pdCIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTMucHJldmlvdXNQYWdlKHZhbHVlcywgaW52YWxpZCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRpc2FibGVkOiBzaG93T25seSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiYnRuIGJ0bi1vdXRsaW5lLXByaW1hcnkgYnRuLWZvcm0gYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24ucHJldmlvdXMubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlByZXZpb3VzIgogICAgICAgICAgfSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgZGlzYWJsZWQ6ICFfdGhpczEzLnN0YXRlLmhhc0l0ZW1zTG9hZGVkIHx8IHNob3dPbmx5LAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIGlmICghaW52YWxpZCkgewogICAgICAgICAgICAgICAgX3RoaXMxMy5uZXh0UGFnZSh2YWx1ZXMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiYnRuIGJ0bi1vdXRsaW5lLXByaW1hcnkgYnRuLWZvcm0gZmxvYXQtcmlnaHQgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24ubmV4dC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiTmV4dCIKICAgICAgICAgIH0pKSkpKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH1dKTsKICByZXR1cm4gRWRpdEl0ZW1zUGFnZTsKfShDb21wb25lbnQpOwp2YXIgbWFwU3RhdGVUb1Byb3BzID0gZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKHN0YXRlKSB7CiAgcmV0dXJuIHsKICAgIHJlYXNvbkNvZGVzOiBzdGF0ZS5yZWFzb25Db2Rlcy5kYXRhLAogICAgdHJhbnNsYXRlOiB0cmFuc2xhdGVXaXRoRGVmYXVsdE1lc3NhZ2UoZ2V0VHJhbnNsYXRlKHN0YXRlLmxvY2FsaXplKSksCiAgICBzdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZDogc3RhdGUuc2Vzc2lvbi5mZXRjaGVkVHJhbnNsYXRpb25zLnN0b2NrTW92ZW1lbnQsCiAgICBpc1BhZ2luYXRlZDogc3RhdGUuc2Vzc2lvbi5pc1BhZ2luYXRlZCwKICAgIHBhZ2VTaXplOiBzdGF0ZS5zZXNzaW9uLnBhZ2VTaXplLAogICAgY3VycmVudExvY2FsZTogc3RhdGUuc2Vzc2lvbi5hY3RpdmVMYW5ndWFnZQogIH07Cn07CmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzLCB7CiAgZmV0Y2hSZWFzb25Db2RlczogZmV0Y2hSZWFzb25Db2RlcywKICBzaG93U3Bpbm5lcjogc2hvd1NwaW5uZXIsCiAgaGlkZVNwaW5uZXI6IGhpZGVTcGlubmVyCn0pKEVkaXRJdGVtc1BhZ2UpOwpFZGl0SXRlbXNQYWdlLnByb3BUeXBlcyA9IHsKICAvKiogSW5pdGlhbCBjb21wb25lbnQncyBkYXRhICovCiAgaW5pdGlhbFZhbHVlczogUHJvcFR5cGVzLnNoYXBlKHt9KS5pc1JlcXVpcmVkLAogIC8qKiBGdW5jdGlvbiByZXR1cm5pbmcgdXNlciB0byB0aGUgcHJldmlvdXMgcGFnZSAqLwogIHByZXZpb3VzUGFnZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAvKioKICAgKiBGdW5jdGlvbiBjYWxsZWQgd2l0aCB0aGUgZm9ybSBkYXRhIHdoZW4gdGhlIGhhbmRsZVN1Ym1pdCgpCiAgICogaXMgZmlyZWQgZnJvbSB3aXRoaW4gdGhlIGZvcm0gY29tcG9uZW50LgogICAqLwogIG5leHRQYWdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiBkYXRhIGlzIGxvYWRpbmcgKi8KICBzaG93U3Bpbm5lcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAvKiogRnVuY3Rpb24gY2FsbGVkIHdoZW4gZGF0YSBoYXMgbG9hZGVkICovCiAgaGlkZVNwaW5uZXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIGZldGNoaW5nIHJlYXNvbiBjb2RlcyAqLwogIGZldGNoUmVhc29uQ29kZXM6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEFycmF5IG9mIGF2YWlsYWJsZSByZWFzb24gY29kZXMgKi8KICByZWFzb25Db2RlczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnNoYXBlKHt9KSkuaXNSZXF1aXJlZCwKICB0cmFuc2xhdGU6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgc3RvY2tNb3ZlbWVudFRyYW5zbGF0aW9uc0ZldGNoZWQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgLyoqIFJldHVybiB0cnVlIGlmIHBhZ2luYXRpb24gaXMgZW5hYmxlZCAqLwogIGlzUGFnaW5hdGVkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLAogIC8qKiBSZXR1cm4gdHJ1ZSBpZiBzaG93IG9ubHkgKi8KICBzaG93T25seTogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICBwYWdlU2l6ZTogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLAogIGN1cnJlbnRMb2NhbGU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZAp9Ow=="},null]}