{"remainingRequest":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js?presets[]=@babel/react&presets[]=@babel/env!/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js!/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/request/AddItemsPage.jsx","dependencies":[{"path":"/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/request/AddItemsPage.jsx","mtime":1698037750000},{"path":"/opt/MTOBS-BIKASH/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfSwgX3R5cGVvZihvYmopOyB9CmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOyB9IH0KZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN1YkNsYXNzLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBlbnVtZXJhYmxlT25seSAmJiAoc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pKSwga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBudWxsICE9IGFyZ3VtZW50c1tpXSA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpICUgMiA/IG93bktleXMoT2JqZWN0KHNvdXJjZSksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpIDogb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSByZXR1cm4gdGFyZ2V0OyB9CmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsga2V5ID0gX3RvUHJvcGVydHlLZXkoa2V5KTsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CmZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgeyB2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgInN0cmluZyIpOyByZXR1cm4gX3R5cGVvZihrZXkpID09PSAic3ltYm9sIiA/IGtleSA6IFN0cmluZyhrZXkpOyB9CmZ1bmN0aW9uIF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkgeyBpZiAoX3R5cGVvZihpbnB1dCkgIT09ICJvYmplY3QiIHx8IGlucHV0ID09PSBudWxsKSByZXR1cm4gaW5wdXQ7IHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTsgaWYgKHByaW0gIT09IHVuZGVmaW5lZCkgeyB2YXIgcmVzID0gcHJpbS5jYWxsKGlucHV0LCBoaW50IHx8ICJkZWZhdWx0Iik7IGlmIChfdHlwZW9mKHJlcykgIT09ICJvYmplY3QiKSByZXR1cm4gcmVzOyB0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpOyB9IHJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTsgfQppbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnOwppbXBvcnQgYXJyYXlNdXRhdG9ycyBmcm9tICdmaW5hbC1mb3JtLWFycmF5cyc7CmltcG9ydCB1cGRhdGUgZnJvbSAnaW1tdXRhYmlsaXR5LWhlbHBlcic7CmltcG9ydCBmaWxlRG93bmxvYWQgZnJvbSAnanMtZmlsZS1kb3dubG9hZCc7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JzsKaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJzsKaW1wb3J0IHsgY29uZmlybUFsZXJ0IH0gZnJvbSAncmVhY3QtY29uZmlybS1hbGVydCc7CmltcG9ydCB7IEZvcm0gfSBmcm9tICdyZWFjdC1maW5hbC1mb3JtJzsKaW1wb3J0IHsgZ2V0VHJhbnNsYXRlIH0gZnJvbSAncmVhY3QtbG9jYWxpemUtcmVkdXgnOwppbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnOwppbXBvcnQgeyB3aXRoUm91dGVyIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7CmltcG9ydCBBbGVydCBmcm9tICdyZWFjdC1zLWFsZXJ0JzsKaW1wb3J0IHsgZmV0Y2hVc2VycywgaGlkZVNwaW5uZXIsIHNob3dTcGlubmVyIH0gZnJvbSAnYWN0aW9ucyc7CmltcG9ydCBBcnJheUZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9BcnJheUZpZWxkJzsKaW1wb3J0IEJ1dHRvbkZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9CdXR0b25GaWVsZCc7CmltcG9ydCBMYWJlbEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9MYWJlbEZpZWxkJzsKaW1wb3J0IFByb2R1Y3RTZWxlY3RGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvUHJvZHVjdFNlbGVjdEZpZWxkJzsKaW1wb3J0IFRleHRGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvVGV4dEZpZWxkJzsKaW1wb3J0IGFwaUNsaWVudCBmcm9tICd1dGlscy9hcGlDbGllbnQnOwppbXBvcnQgeyByZW5kZXJGb3JtRmllbGQgfSBmcm9tICd1dGlscy9mb3JtLXV0aWxzJzsKaW1wb3J0IGlzUmVxdWVzdEZyb21XYXJkIGZyb20gJ3V0aWxzL3N1cHBvcnRlZEFjdGl2aXRpZXNVdGlscyc7CmltcG9ydCBUcmFuc2xhdGUsIHsgdHJhbnNsYXRlV2l0aERlZmF1bHRNZXNzYWdlIH0gZnJvbSAndXRpbHMvVHJhbnNsYXRlJzsKaW1wb3J0ICdyZWFjdC1jb25maXJtLWFsZXJ0L3NyYy9yZWFjdC1jb25maXJtLWFsZXJ0LmNzcyc7CmZ1bmN0aW9uIGFkZEJ1dHRvbihfcmVmKSB7CiAgdmFyIGFkZFJvdyA9IF9yZWYuYWRkUm93LAogICAgZ2V0U29ydE9yZGVyID0gX3JlZi5nZXRTb3J0T3JkZXIsCiAgICBuZXdJdGVtQWRkZWQgPSBfcmVmLm5ld0l0ZW1BZGRlZCwKICAgIHVwZGF0ZVRvdGFsQ291bnQgPSBfcmVmLnVwZGF0ZVRvdGFsQ291bnQ7CiAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICB0eXBlOiAiYnV0dG9uIiwKICAgIGNsYXNzTmFtZTogImJ0biBidG4tb3V0bGluZS1zdWNjZXNzIGJ0bi14cyIsCiAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICB1cGRhdGVUb3RhbENvdW50KDEpOwogICAgICBhZGRSb3coewogICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCkKICAgICAgfSk7CiAgICAgIG5ld0l0ZW1BZGRlZCgpOwogICAgfQogIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICBjbGFzc05hbWU6ICJmYSBmYS1wbHVzIHByLTIiCiAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5hZGRMaW5lLmxhYmVsIiwKICAgIGRlZmF1bHRNZXNzYWdlOiAiQWRkIGxpbmUiCiAgfSkpKTsKfQoKLy8gVXNlZCBmb3IgdXRpbCBmdW5jdGlvbiB0byBjYWxjdWxhdGUgcXVhbnRpdHlSZXF1ZXN0ZWQgZm9yIHJlcXVlc3RzIGZyb20gd2FyZHMKLy8gd2hlcmUgcXVhbnRpdHlSZXF1ZXN0ZWQgaXMgY2FsY3VsYXRlZCBieSBzdWJ0cmFjdGluZyBvbmUgb2YgYmVsb3cgZnJvbSBRT0gKdmFyIFJlcXVlc3RGcm9tV2FyZFR5cGVzID0gewogIE1BTlVBTDogewogICAgY2FsY3VsYXRlUXR5UmVxdWVzdGVkRnJvbTogJ21vbnRobHlEZW1hbmQnCiAgfSwKICBTVE9DS0xJU1RfUFVTSF9UWVBFOiB7CiAgICBjYWxjdWxhdGVRdHlSZXF1ZXN0ZWRGcm9tOiAncXVhbnRpdHlBbGxvd2VkJwogIH0sCiAgU1RPQ0tMSVNUX1BVTExfVFlQRTogewogICAgY2FsY3VsYXRlUXR5UmVxdWVzdGVkRnJvbTogJ2RlbWFuZFBlclJlcGxlbmlzaG1lbnRQZXJpb2QnCiAgfQp9Owp2YXIgRklFTERTID0gewogIHByb2R1Y3Q6IHsKICAgIHR5cGU6IFByb2R1Y3RTZWxlY3RGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZXF1ZXN0ZWRQcm9kdWN0LmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVxdWVzdGVkIHByb2R1Y3QnLAogICAgaGVhZGVyQWxpZ246ICdsZWZ0JywKICAgIGZsZXhXaWR0aDogJzknLAogICAgYXR0cmlidXRlczogewogICAgICBzaG93U2VsZWN0ZWRPcHRpb25Db2xvcjogdHJ1ZQogICAgfQogIH0sCiAgcXVhbnRpdHlPbkhhbmQ6IHsKICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucXVhbnRpdHlPbkhhbmQubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdRb0gnLAogICAgZmxleFdpZHRoOiAnMS43JywKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgdHlwZTogJ251bWJlcicKICAgIH0KICB9LAogIHF1YW50aXR5T25IYW5kQXRSZXF1ZXN0U2l0ZTogewogICAgdHlwZTogVGV4dEZpZWxkLAogICAgZmxleFdpZHRoOiAnMS43JywKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5xdWFudGl0eU9uSGFuZEF0UmVxdWVzdFNpdGUubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdRT0ggYXQgUmVxdWVzdCBTaXRlJywKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgdHlwZTogJ251bWJlcicKICAgIH0KICB9LAogIHF1YW50aXR5QXZhaWxhYmxlOiB7CiAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmF2YWlsYWJsZS5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ0F2YWlsYWJsZScsCiAgICBmbGV4V2lkdGg6ICcxLjcnLAogICAgYXR0cmlidXRlczogewogICAgICB0eXBlOiAnbnVtYmVyJwogICAgfQogIH0sCiAgcXVhbnRpdHlBbGxvd2VkOiB7CiAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50Lm1heFF1YW50aXR5LmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnTWF4IFF0eScsCiAgICBmbGV4V2lkdGg6ICcxLjcnLAogICAgYXR0cmlidXRlczogewogICAgICB0eXBlOiAnbnVtYmVyJwogICAgfQogIH0sCiAgbW9udGhseURlbWFuZDogewogICAgdHlwZTogTGFiZWxGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5kZW1hbmRQZXJNb250aC5sYWJlbCcsCiAgICBkZWZhdWx0TWVzc2FnZTogJ0RlbWFuZCBwZXIgTW9udGgnLAogICAgZmxleFdpZHRoOiAnMS43JywKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgdHlwZTogJ251bWJlcicKICAgIH0KICB9LAogIHF1YW50aXR5UmVxdWVzdGVkOiB7CiAgICB0eXBlOiBUZXh0RmllbGQsCiAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQubmVlZGVkUXVhbnRpdHkubGFiZWwnLAogICAgZGVmYXVsdE1lc3NhZ2U6ICdOZWVkZWQgUXR5JywKICAgIGZsZXhXaWR0aDogJzEuNycsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIHR5cGU6ICdudW1iZXInCiAgICB9CiAgfSwKICBjb21tZW50czogewogICAgdHlwZTogVGV4dEZpZWxkLAogICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmNvbW1lbnRzLmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnQ29tbWVudHMnLAogICAgZmxleFdpZHRoOiAnMS43JywKICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMikgewogICAgICB2YXIgYWRkUm93ID0gX3JlZjIuYWRkUm93LAogICAgICAgIHJvd0NvdW50ID0gX3JlZjIucm93Q291bnQsCiAgICAgICAgcm93SW5kZXggPSBfcmVmMi5yb3dJbmRleCwKICAgICAgICBnZXRTb3J0T3JkZXIgPSBfcmVmMi5nZXRTb3J0T3JkZXIsCiAgICAgICAgdXBkYXRlVG90YWxDb3VudCA9IF9yZWYyLnVwZGF0ZVRvdGFsQ291bnQsCiAgICAgICAgdXBkYXRlUm93ID0gX3JlZjIudXBkYXRlUm93LAogICAgICAgIHZhbHVlcyA9IF9yZWYyLnZhbHVlczsKICAgICAgcmV0dXJuIHsKICAgICAgICBvblRhYlByZXNzOiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgdXBkYXRlVG90YWxDb3VudCgxKTsKICAgICAgICAgIGFkZFJvdyh7CiAgICAgICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCkKICAgICAgICAgIH0pOwogICAgICAgIH0gOiBudWxsLAogICAgICAgIGFycm93UmlnaHQ6IHJvd0NvdW50ID09PSByb3dJbmRleCArIDEgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB1cGRhdGVUb3RhbENvdW50KDEpOwogICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgc29ydE9yZGVyOiBnZXRTb3J0T3JkZXIoKQogICAgICAgICAgfSk7CiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgYXJyb3dEb3duOiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudCgxKTsKICAgICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgICBzb3J0T3JkZXI6IGdldFNvcnRPcmRlcigpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKICAgICAgICB9IDogbnVsbCwKICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgIHJldHVybiB1cGRhdGVSb3codmFsdWVzLCByb3dJbmRleCk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0sCiAgZGVtYW5kUGVyUmVwbGVuaXNobWVudFBlcmlvZDogewogICAgdHlwZTogTGFiZWxGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5kZW1hbmRQZXJSZXBsZW5pc2htZW50UGVyaW9kLmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnRGVtYW5kIHBlciBSZXBsZW5pc2htZW50IFBlcmlvZCcsCiAgICBmbGV4V2lkdGg6ICcxLjcnLAogICAgYXR0cmlidXRlczogewogICAgICB0eXBlOiAnbnVtYmVyJwogICAgfQogIH0sCiAgZGVtYW5kUGVyUmVxdWVzdFBlcmlvZDogewogICAgdHlwZTogTGFiZWxGaWVsZCwKICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5kZW1hbmRQZXJSZXF1ZXN0UGVyaW9kLmxhYmVsJywKICAgIGRlZmF1bHRNZXNzYWdlOiAnRGVtYW5kIHBlciBSZXF1ZXN0IFBlcmlvZCcsCiAgICBmbGV4V2lkdGg6ICcxLjcnLAogICAgYXR0cmlidXRlczogewogICAgICB0eXBlOiAnbnVtYmVyJwogICAgfQogIH0KfTsKdmFyIERFTEVURV9CVVRUT05fRklFTEQgPSB7CiAgdHlwZTogQnV0dG9uRmllbGQsCiAgbGFiZWw6ICdyZWFjdC5kZWZhdWx0LmJ1dHRvbi5kZWxldGUubGFiZWwnLAogIGRlZmF1bHRNZXNzYWdlOiAnRGVsZXRlJywKICBmbGV4V2lkdGg6ICcxJywKICBmaWVsZEtleTogJycsCiAgYnV0dG9uTGFiZWw6ICdyZWFjdC5kZWZhdWx0LmJ1dHRvbi5kZWxldGUubGFiZWwnLAogIGJ1dHRvbkRlZmF1bHRNZXNzYWdlOiAnRGVsZXRlJywKICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjMpIHsKICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjMuZmllbGRWYWx1ZSwKICAgICAgcmVtb3ZlSXRlbSA9IF9yZWYzLnJlbW92ZUl0ZW0sCiAgICAgIHJlbW92ZVJvdyA9IF9yZWYzLnJlbW92ZVJvdywKICAgICAgdXBkYXRlVG90YWxDb3VudCA9IF9yZWYzLnVwZGF0ZVRvdGFsQ291bnQ7CiAgICByZXR1cm4gewogICAgICBvbkNsaWNrOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuaWQgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVtb3ZlSXRlbShmaWVsZFZhbHVlLmlkKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHVwZGF0ZVRvdGFsQ291bnQoLTEpOwogICAgICAgICAgcmVtb3ZlUm93KCk7CiAgICAgICAgfSk7CiAgICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdXBkYXRlVG90YWxDb3VudCgtMSk7CiAgICAgICAgcmVtb3ZlUm93KCk7CiAgICAgIH0KICAgIH07CiAgfSwKICBhdHRyaWJ1dGVzOiB7CiAgICBjbGFzc05hbWU6ICdidG4gYnRuLW91dGxpbmUtZGFuZ2VyJwogIH0KfTsKdmFyIExJTkVfSVRFTVNfQVRUUiA9IHsKICB0eXBlOiBBcnJheUZpZWxkLAogIGFycm93c05hdmlnYXRpb246IHRydWUsCiAgdmlydHVhbGl6ZWQ6IHRydWUsCiAgdG90YWxDb3VudDogZnVuY3Rpb24gdG90YWxDb3VudChfcmVmNCkgewogICAgdmFyIF90b3RhbENvdW50ID0gX3JlZjQudG90YWxDb3VudDsKICAgIHJldHVybiBfdG90YWxDb3VudDsKICB9LAogIGlzUm93TG9hZGVkOiBmdW5jdGlvbiBpc1Jvd0xvYWRlZChfcmVmNSkgewogICAgdmFyIF9pc1Jvd0xvYWRlZCA9IF9yZWY1LmlzUm93TG9hZGVkOwogICAgcmV0dXJuIF9pc1Jvd0xvYWRlZDsKICB9LAogIGxvYWRNb3JlUm93czogZnVuY3Rpb24gbG9hZE1vcmVSb3dzKF9yZWY2KSB7CiAgICB2YXIgX2xvYWRNb3JlUm93cyA9IF9yZWY2LmxvYWRNb3JlUm93czsKICAgIHJldHVybiBfbG9hZE1vcmVSb3dzKCk7CiAgfSwKICBpc0ZpcnN0UGFnZUxvYWRlZDogZnVuY3Rpb24gaXNGaXJzdFBhZ2VMb2FkZWQoX3JlZjcpIHsKICAgIHZhciBfaXNGaXJzdFBhZ2VMb2FkZWQgPSBfcmVmNy5pc0ZpcnN0UGFnZUxvYWRlZDsKICAgIHJldHVybiBfaXNGaXJzdFBhZ2VMb2FkZWQ7CiAgfSwKICBhZGRCdXR0b246IGFkZEJ1dHRvbgp9Owp2YXIgTk9fU1RPQ0tMSVNUX0ZJRUxEUyA9IHsKICBsaW5lSXRlbXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgTElORV9JVEVNU19BVFRSKSwge30sIHsKICAgIGZpZWxkczogewogICAgICBwcm9kdWN0OiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIEZJRUxEUy5wcm9kdWN0KSwge30sIHsKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgZmxleFdpZHRoOiAnOS41JywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjgpIHsKICAgICAgICAgIHZhciByb3dJbmRleCA9IF9yZWY4LnJvd0luZGV4LAogICAgICAgICAgICByb3dDb3VudCA9IF9yZWY4LnJvd0NvdW50LAogICAgICAgICAgICB1cGRhdGVQcm9kdWN0RGF0YSA9IF9yZWY4LnVwZGF0ZVByb2R1Y3REYXRhLAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmOC52YWx1ZXMsCiAgICAgICAgICAgIG9yaWdpbklkID0gX3JlZjgub3JpZ2luSWQsCiAgICAgICAgICAgIGZvY3VzRmllbGQgPSBfcmVmOC5mb2N1c0ZpZWxkOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKHZhbHVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVByb2R1Y3REYXRhKHZhbHVlLCB2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXV0b0ZvY3VzOiByb3dJbmRleCA9PT0gcm93Q291bnQgLSAxLAogICAgICAgICAgICBsb2NhdGlvbklkOiBvcmlnaW5JZCwKICAgICAgICAgICAgb25FeGFjdFByb2R1Y3RTZWxlY3RlZDogZnVuY3Rpb24gb25FeGFjdFByb2R1Y3RTZWxlY3RlZChfcmVmOSkgewogICAgICAgICAgICAgIHZhciBwcm9kdWN0ID0gX3JlZjkucHJvZHVjdDsKICAgICAgICAgICAgICBpZiAoZm9jdXNGaWVsZCAmJiBwcm9kdWN0KSB7CiAgICAgICAgICAgICAgICBmb2N1c0ZpZWxkKHJvd0luZGV4LCAncXVhbnRpdHlSZXF1ZXN0ZWQnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9KSwKICAgICAgcXVhbnRpdHlPbkhhbmQ6IEZJRUxEUy5xdWFudGl0eU9uSGFuZCwKICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IEZJRUxEUy5xdWFudGl0eUF2YWlsYWJsZSwKICAgICAgbW9udGhseURlbWFuZDogRklFTERTLm1vbnRobHlEZW1hbmQsCiAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIEZJRUxEUy5xdWFudGl0eVJlcXVlc3RlZCksIHt9LCB7CiAgICAgICAgZmxleFdpZHRoOiAnMi41JywKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYxMCkgewogICAgICAgICAgdmFyIHVwZGF0ZVJvdyA9IF9yZWYxMC51cGRhdGVSb3csCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYxMC52YWx1ZXMsCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjEwLnJvd0luZGV4OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVJvdyh2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0pLAogICAgICBjb21tZW50czogRklFTERTLmNvbW1lbnRzLAogICAgICBkZWxldGVCdXR0b246IERFTEVURV9CVVRUT05fRklFTEQKICAgIH0KICB9KQp9Owp2YXIgU1RPQ0tMSVNUX0ZJRUxEU19QVVNIX1RZUEUgPSB7CiAgbGluZUl0ZW1zOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIExJTkVfSVRFTVNfQVRUUiksIHt9LCB7CiAgICBmaWVsZHM6IHsKICAgICAgcHJvZHVjdDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBGSUVMRFMucHJvZHVjdCksIHt9LCB7CiAgICAgICAgZmllbGRLZXk6ICdkaXNhYmxlZCcsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYxMSkgewogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmMTEuZmllbGRWYWx1ZSwKICAgICAgICAgICAgcm93SW5kZXggPSBfcmVmMTEucm93SW5kZXgsCiAgICAgICAgICAgIHJvd0NvdW50ID0gX3JlZjExLnJvd0NvdW50LAogICAgICAgICAgICBuZXdJdGVtID0gX3JlZjExLm5ld0l0ZW0sCiAgICAgICAgICAgIG9yaWdpbklkID0gX3JlZjExLm9yaWdpbklkLAogICAgICAgICAgICBmb2N1c0ZpZWxkID0gX3JlZjExLmZvY3VzRmllbGQ7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsb2NhdGlvbklkOiBvcmlnaW5JZCwKICAgICAgICAgICAgZGlzYWJsZWQ6ICEhZmllbGRWYWx1ZSwKICAgICAgICAgICAgYXV0b0ZvY3VzOiBuZXdJdGVtICYmIHJvd0luZGV4ID09PSByb3dDb3VudCAtIDEsCiAgICAgICAgICAgIG9uRXhhY3RQcm9kdWN0U2VsZWN0ZWQ6IGZ1bmN0aW9uIG9uRXhhY3RQcm9kdWN0U2VsZWN0ZWQoX3JlZjEyKSB7CiAgICAgICAgICAgICAgdmFyIHByb2R1Y3QgPSBfcmVmMTIucHJvZHVjdDsKICAgICAgICAgICAgICBpZiAoZm9jdXNGaWVsZCAmJiBwcm9kdWN0KSB7CiAgICAgICAgICAgICAgICBmb2N1c0ZpZWxkKHJvd0luZGV4LCAncXVhbnRpdHlSZXF1ZXN0ZWQnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9KSwKICAgICAgcXVhbnRpdHlBbGxvd2VkOiBGSUVMRFMucXVhbnRpdHlBbGxvd2VkLAogICAgICBxdWFudGl0eU9uSGFuZDogRklFTERTLnF1YW50aXR5T25IYW5kLAogICAgICBxdWFudGl0eUF2YWlsYWJsZTogRklFTERTLnF1YW50aXR5QXZhaWxhYmxlLAogICAgICBxdWFudGl0eVJlcXVlc3RlZDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBGSUVMRFMucXVhbnRpdHlSZXF1ZXN0ZWQpLCB7fSwgewogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTMpIHsKICAgICAgICAgIHZhciByb3dJbmRleCA9IF9yZWYxMy5yb3dJbmRleCwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjEzLnZhbHVlcywKICAgICAgICAgICAgdXBkYXRlUm93ID0gX3JlZjEzLnVwZGF0ZVJvdzsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICAgICAgICAgIHJldHVybiB1cGRhdGVSb3codmFsdWVzLCByb3dJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9KSwKICAgICAgY29tbWVudHM6IEZJRUxEUy5jb21tZW50cywKICAgICAgZGVsZXRlQnV0dG9uOiBERUxFVEVfQlVUVE9OX0ZJRUxECiAgICB9CiAgfSkKfTsKdmFyIFNUT0NLTElTVF9GSUVMRFNfUFVMTF9UWVBFID0gewogIGxpbmVJdGVtczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBMSU5FX0lURU1TX0FUVFIpLCB7fSwgewogICAgZmllbGRzOiB7CiAgICAgIHByb2R1Y3Q6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgRklFTERTLnByb2R1Y3QpLCB7fSwgewogICAgICAgIGZpZWxkS2V5OiAnZGlzYWJsZWQnLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTQpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjE0LmZpZWxkVmFsdWUsCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjE0LnJvd0luZGV4LAogICAgICAgICAgICByb3dDb3VudCA9IF9yZWYxNC5yb3dDb3VudCwKICAgICAgICAgICAgbmV3SXRlbSA9IF9yZWYxNC5uZXdJdGVtLAogICAgICAgICAgICBvcmlnaW5JZCA9IF9yZWYxNC5vcmlnaW5JZCwKICAgICAgICAgICAgZm9jdXNGaWVsZCA9IF9yZWYxNC5mb2N1c0ZpZWxkOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbG9jYXRpb25JZDogb3JpZ2luSWQsCiAgICAgICAgICAgIGRpc2FibGVkOiAhIWZpZWxkVmFsdWUsCiAgICAgICAgICAgIGF1dG9Gb2N1czogbmV3SXRlbSAmJiByb3dJbmRleCA9PT0gcm93Q291bnQgLSAxLAogICAgICAgICAgICBvbkV4YWN0UHJvZHVjdFNlbGVjdGVkOiBmdW5jdGlvbiBvbkV4YWN0UHJvZHVjdFNlbGVjdGVkKF9yZWYxNSkgewogICAgICAgICAgICAgIHZhciBwcm9kdWN0ID0gX3JlZjE1LnByb2R1Y3Q7CiAgICAgICAgICAgICAgaWYgKGZvY3VzRmllbGQgJiYgcHJvZHVjdCkgewogICAgICAgICAgICAgICAgZm9jdXNGaWVsZChyb3dJbmRleCwgJ3F1YW50aXR5UmVxdWVzdGVkJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSksCiAgICAgIGRlbWFuZFBlclJlcGxlbmlzaG1lbnRQZXJpb2Q6IEZJRUxEUy5kZW1hbmRQZXJSZXBsZW5pc2htZW50UGVyaW9kLAogICAgICBxdWFudGl0eU9uSGFuZDogRklFTERTLnF1YW50aXR5T25IYW5kLAogICAgICBxdWFudGl0eUF2YWlsYWJsZTogRklFTERTLnF1YW50aXR5QXZhaWxhYmxlLAogICAgICBxdWFudGl0eVJlcXVlc3RlZDogRklFTERTLnF1YW50aXR5UmVxdWVzdGVkLAogICAgICBjb21tZW50czogRklFTERTLmNvbW1lbnRzLAogICAgICBkZWxldGVCdXR0b246IERFTEVURV9CVVRUT05fRklFTEQKICAgIH0KICB9KQp9Owp2YXIgUkVRVUVTVF9GUk9NX1dBUkRfU1RPQ0tMSVNUX0ZJRUxEU19QVVNIX1RZUEUgPSB7CiAgbGluZUl0ZW1zOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIExJTkVfSVRFTVNfQVRUUiksIHt9LCB7CiAgICBmaWVsZHM6IHsKICAgICAgcHJvZHVjdDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBGSUVMRFMucHJvZHVjdCksIHt9LCB7CiAgICAgICAgZmllbGRLZXk6ICdkaXNhYmxlZCcsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYxNikgewogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmMTYuZmllbGRWYWx1ZSwKICAgICAgICAgICAgcm93SW5kZXggPSBfcmVmMTYucm93SW5kZXgsCiAgICAgICAgICAgIHJvd0NvdW50ID0gX3JlZjE2LnJvd0NvdW50LAogICAgICAgICAgICBuZXdJdGVtID0gX3JlZjE2Lm5ld0l0ZW0sCiAgICAgICAgICAgIG9yaWdpbklkID0gX3JlZjE2Lm9yaWdpbklkLAogICAgICAgICAgICBmb2N1c0ZpZWxkID0gX3JlZjE2LmZvY3VzRmllbGQ7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsb2NhdGlvbklkOiBvcmlnaW5JZCwKICAgICAgICAgICAgZGlzYWJsZWQ6ICEhZmllbGRWYWx1ZSwKICAgICAgICAgICAgYXV0b0ZvY3VzOiBuZXdJdGVtICYmIHJvd0luZGV4ID09PSByb3dDb3VudCAtIDEsCiAgICAgICAgICAgIG9uRXhhY3RQcm9kdWN0U2VsZWN0ZWQ6IGZ1bmN0aW9uIG9uRXhhY3RQcm9kdWN0U2VsZWN0ZWQoX3JlZjE3KSB7CiAgICAgICAgICAgICAgdmFyIHByb2R1Y3QgPSBfcmVmMTcucHJvZHVjdDsKICAgICAgICAgICAgICBpZiAoZm9jdXNGaWVsZCAmJiBwcm9kdWN0KSB7CiAgICAgICAgICAgICAgICBmb2N1c0ZpZWxkKHJvd0luZGV4LCAncXVhbnRpdHlPbkhhbmQnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9KSwKICAgICAgcXVhbnRpdHlBbGxvd2VkOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIEZJRUxEUy5xdWFudGl0eUFsbG93ZWQpLCB7fSwgewogICAgICAgIGhlYWRlclRvb2x0aXA6ICdyZWFjdC5zdG9ja01vdmVtZW50LnRvb2x0aXAubWF4UXVhbnRpdHkubGFiZWwnLAogICAgICAgIGhlYWRlckFsaWduOiAncmlnaHQnLAogICAgICAgIGF0dHJpYnV0ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgRklFTERTLnF1YW50aXR5QWxsb3dlZC5hdHRyaWJ1dGVzKSwge30sIHsKICAgICAgICAgIGNlbGxDbGFzc05hbWU6ICd0ZXh0LXJpZ2h0JwogICAgICAgIH0pCiAgICAgIH0pLAogICAgICBxdWFudGl0eU9uSGFuZDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBGSUVMRFMucXVhbnRpdHlPbkhhbmQpLCB7fSwgewogICAgICAgIHR5cGU6IFRleHRGaWVsZCwKICAgICAgICBoZWFkZXJUb29sdGlwOiAncmVhY3Quc3RvY2tNb3ZlbWVudC50b29sdGlwLnF1YW50aXR5T25IYW5kLmxhYmVsJywKICAgICAgICBoZWFkZXJBbGlnbjogJ3JpZ2h0JywKICAgICAgICBhdHRyaWJ1dGVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIEZJRUxEUy5xdWFudGl0eU9uSGFuZC5hdHRyaWJ1dGVzKSwge30sIHsKICAgICAgICAgIGNlbGxDbGFzc05hbWU6ICd0ZXh0LXJpZ2h0JwogICAgICAgIH0pLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTgpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjE4LmZpZWxkVmFsdWUsCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjE4LnJvd0luZGV4LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMTgudmFsdWVzLAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMTgudXBkYXRlUm93LAogICAgICAgICAgICBjYWxjdWxhdGVRdHlSZXF1ZXN0ZWQgPSBfcmVmMTguY2FsY3VsYXRlUXR5UmVxdWVzdGVkOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgdmFyIHZhbHVlc1dpdGhVcGRhdGVkUXR5UmVxdWVzdGVkID0gY2FsY3VsYXRlUXR5UmVxdWVzdGVkKHZhbHVlcywgcm93SW5kZXgsIGZpZWxkVmFsdWUsIFJlcXVlc3RGcm9tV2FyZFR5cGVzLlNUT0NLTElTVF9QVVNIX1RZUEUpOwogICAgICAgICAgICAgIHVwZGF0ZVJvdyh2YWx1ZXNXaXRoVXBkYXRlZFF0eVJlcXVlc3RlZCwgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSksCiAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIEZJRUxEUy5xdWFudGl0eVJlcXVlc3RlZCksIHt9LCB7CiAgICAgICAgaGVhZGVyQWxpZ246ICdyaWdodCcsCiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgaGVhZGVyVG9vbHRpcDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQudG9vbHRpcC5xdWFudGl0eVJlcXVlc3RlZC5sYWJlbCcsCiAgICAgICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBGSUVMRFMucXVhbnRpdHlSZXF1ZXN0ZWQuYXR0cmlidXRlcyksIHt9LCB7CiAgICAgICAgICBjZWxsQ2xhc3NOYW1lOiAndGV4dC1yaWdodCcKICAgICAgICB9KSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjE5KSB7CiAgICAgICAgICB2YXIgcm93SW5kZXggPSBfcmVmMTkucm93SW5kZXgsCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYxOS52YWx1ZXMsCiAgICAgICAgICAgIHVwZGF0ZVJvdyA9IF9yZWYxOS51cGRhdGVSb3c7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlUm93KHZhbHVlcywgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSksCiAgICAgIGNvbW1lbnRzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIEZJRUxEUy5jb21tZW50cyksIHt9LCB7CiAgICAgICAgaGVhZGVyVG9vbHRpcDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQudG9vbHRpcC5jb21tZW50cy5sYWJlbCcsCiAgICAgICAgaGVhZGVyQWxpZ246ICdsZWZ0JywKICAgICAgICBhdHRyaWJ1dGVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIEZJRUxEUy5jb21tZW50cy5hdHRyaWJ1dGVzKSwge30sIHsKICAgICAgICAgIGNlbGxDbGFzc05hbWU6ICd0ZXh0LWxlZnQnCiAgICAgICAgfSkKICAgICAgfSksCiAgICAgIGRlbGV0ZUJ1dHRvbjogREVMRVRFX0JVVFRPTl9GSUVMRAogICAgfQogIH0pCn07CnZhciBSRVFVRVNUX0ZST01fV0FSRF9TVE9DS0xJU1RfRklFTERTX1BVTExfVFlQRSA9IHsKICBsaW5lSXRlbXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgTElORV9JVEVNU19BVFRSKSwge30sIHsKICAgIGZpZWxkczogewogICAgICBwcm9kdWN0OiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIEZJRUxEUy5wcm9kdWN0KSwge30sIHsKICAgICAgICBmaWVsZEtleTogJ2Rpc2FibGVkJywKICAgICAgICBmbGV4V2lkdGg6ICcyJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjIwKSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYyMC5maWVsZFZhbHVlLAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYyMC5yb3dJbmRleCwKICAgICAgICAgICAgcm93Q291bnQgPSBfcmVmMjAucm93Q291bnQsCiAgICAgICAgICAgIG5ld0l0ZW0gPSBfcmVmMjAubmV3SXRlbSwKICAgICAgICAgICAgb3JpZ2luSWQgPSBfcmVmMjAub3JpZ2luSWQsCiAgICAgICAgICAgIGZvY3VzRmllbGQgPSBfcmVmMjAuZm9jdXNGaWVsZDsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxvY2F0aW9uSWQ6IG9yaWdpbklkLAogICAgICAgICAgICBkaXNhYmxlZDogISFmaWVsZFZhbHVlLAogICAgICAgICAgICBhdXRvRm9jdXM6IG5ld0l0ZW0gJiYgcm93SW5kZXggPT09IHJvd0NvdW50IC0gMSwKICAgICAgICAgICAgb25FeGFjdFByb2R1Y3RTZWxlY3RlZDogZnVuY3Rpb24gb25FeGFjdFByb2R1Y3RTZWxlY3RlZChfcmVmMjEpIHsKICAgICAgICAgICAgICB2YXIgcHJvZHVjdCA9IF9yZWYyMS5wcm9kdWN0OwogICAgICAgICAgICAgIGlmIChmb2N1c0ZpZWxkICYmIHByb2R1Y3QpIHsKICAgICAgICAgICAgICAgIGZvY3VzRmllbGQocm93SW5kZXgsICdxdWFudGl0eU9uSGFuZCcpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0pLAogICAgICBkZW1hbmRQZXJSZXBsZW5pc2htZW50UGVyaW9kOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGVtYW5kUGVyUmVxdWVzdFBlcmlvZC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEZW1hbmQgcGVyIFJlcXVlc3QgUGVyaW9kJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBoZWFkZXJBbGlnbjogJ3JpZ2h0JywKICAgICAgICBoZWFkZXJUb29sdGlwOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5kZW1hbmRQZXJSZXF1ZXN0UGVyaW9kLmhlYWRlclRvb2x0aXAubGFiZWwnLAogICAgICAgIGhlYWRlckRlZmF1bHRUb29sdGlwOiAnVGhlIGF2ZXJhZ2Ugb2YgeW91ciBwcmV2aW91cyByZXF1ZXN0cyBmb3IgdGhpcyBwcm9kdWN0LicsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgdHlwZTogJ251bWJlcicsCiAgICAgICAgICBjbGFzc05hbWU6ICd0ZXh0LXJpZ2h0JwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlPbkhhbmQ6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgRklFTERTLnF1YW50aXR5T25IYW5kQXRSZXF1ZXN0U2l0ZSksIHt9LCB7CiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnF1YW50aXR5T25IYW5kLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1FPSCcsCiAgICAgICAgZmxleFdpZHRoOiAnMC42JywKICAgICAgICBoZWFkZXJBbGlnbjogJ3JpZ2h0JywKICAgICAgICBoZWFkZXJUb29sdGlwOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5xdWFudGl0eU9uSGFuZC5oZWFkZXJUb29sdGlwLmxhYmVsJywKICAgICAgICBoZWFkZXJEZWZhdWx0VG9vbHRpcDogJ0VudGVyIHlvdXIgY3VycmVudCBxdWFudGl0eSBvbiBoYW5kIGZvciB0aGlzIHByb2R1Y3QnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHR5cGU6ICdudW1iZXInCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjIyKSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYyMi5maWVsZFZhbHVlLAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYyMi5yb3dJbmRleCwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjIyLnZhbHVlcywKICAgICAgICAgICAgdXBkYXRlUm93ID0gX3JlZjIyLnVwZGF0ZVJvdywKICAgICAgICAgICAgY2FsY3VsYXRlUXR5UmVxdWVzdGVkID0gX3JlZjIyLmNhbGN1bGF0ZVF0eVJlcXVlc3RlZDsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICAgICAgICAgIHZhciB2YWx1ZXNXaXRoVXBkYXRlZFF0eVJlcXVlc3RlZCA9IGNhbGN1bGF0ZVF0eVJlcXVlc3RlZCh2YWx1ZXMsIHJvd0luZGV4LCBmaWVsZFZhbHVlLCBSZXF1ZXN0RnJvbVdhcmRUeXBlcy5TVE9DS0xJU1RfUFVMTF9UWVBFKTsKICAgICAgICAgICAgICB1cGRhdGVSb3codmFsdWVzV2l0aFVwZGF0ZWRRdHlSZXF1ZXN0ZWQsIHJvd0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0pLAogICAgICBxdWFudGl0eVJlcXVlc3RlZDogewogICAgICAgIHR5cGU6IFRleHRGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQubmVlZGVkUXVhbnRpdHkubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTmVlZGVkIFF0eScsCiAgICAgICAgZmxleFdpZHRoOiAnMC42JywKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICBoZWFkZXJBbGlnbjogJ3JpZ2h0JywKICAgICAgICBoZWFkZXJUb29sdGlwOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5xdWFudGl0eVJlcXVlc3RlZC5oZWFkZXJUb29sdGlwLmxhYmVsJywKICAgICAgICBoZWFkZXJEZWZhdWx0VG9vbHRpcDogJ1lvdXIgZGVtYW5kIGZvciB0aGUgcmVxdWVzdCBwZXJpb2QgbWludXMgeW91ciBRT0guIEVkaXQgYXMgbmVlZGVkLicsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgdHlwZTogJ251bWJlcicKICAgICAgICB9LAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMjMpIHsKICAgICAgICAgIHZhciByb3dJbmRleCA9IF9yZWYyMy5yb3dJbmRleCwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjIzLnZhbHVlcywKICAgICAgICAgICAgdXBkYXRlUm93ID0gX3JlZjIzLnVwZGF0ZVJvdzsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICAgICAgICAgIHJldHVybiB1cGRhdGVSb3codmFsdWVzLCByb3dJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBjb21tZW50czogewogICAgICAgIHR5cGU6IFRleHRGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29tbWVudHMubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ29tbWVudHMnLAogICAgICAgIGZsZXhXaWR0aDogJzEuNicsCiAgICAgICAgaGVhZGVyQWxpZ246ICdsZWZ0JywKICAgICAgICBoZWFkZXJUb29sdGlwOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5jb21tZW50cy5oZWFkZXJUb29sdGlwLmxhYmVsJywKICAgICAgICBoZWFkZXJEZWZhdWx0VG9vbHRpcDogJ0xlYXZlIGEgY29tbWVudCBmb3IgdGhlIHBlcnNvbiB3aG8gd2lsbCByZXZpZXcgdGhpcyByZXF1ZXN0LicsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYyNCkgewogICAgICAgICAgdmFyIGFkZFJvdyA9IF9yZWYyNC5hZGRSb3csCiAgICAgICAgICAgIHJvd0NvdW50ID0gX3JlZjI0LnJvd0NvdW50LAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYyNC5yb3dJbmRleCwKICAgICAgICAgICAgZ2V0U29ydE9yZGVyID0gX3JlZjI0LmdldFNvcnRPcmRlciwKICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudCA9IF9yZWYyNC51cGRhdGVUb3RhbENvdW50LAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMjQudXBkYXRlUm93LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMjQudmFsdWVzOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25UYWJQcmVzczogcm93Q291bnQgPT09IHJvd0luZGV4ICsgMSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB1cGRhdGVUb3RhbENvdW50KDEpOwogICAgICAgICAgICAgIGFkZFJvdyh7CiAgICAgICAgICAgICAgICBzb3J0T3JkZXI6IGdldFNvcnRPcmRlcigpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gOiBudWxsLAogICAgICAgICAgICBhcnJvd1JpZ2h0OiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHVwZGF0ZVRvdGFsQ291bnQoMSk7CiAgICAgICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgIGFycm93RG93bjogcm93Q291bnQgPT09IHJvd0luZGV4ICsgMSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudCgxKTsKICAgICAgICAgICAgICAgIGFkZFJvdyh7CiAgICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gOiBudWxsLAogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlUm93KHZhbHVlcywgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVsZXRlQnV0dG9uOiBERUxFVEVfQlVUVE9OX0ZJRUxECiAgICB9CiAgfSkKfTsKdmFyIFJFUVVFU1RfRlJPTV9XQVJEX0ZJRUxEUyA9IHsKICBsaW5lSXRlbXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgTElORV9JVEVNU19BVFRSKSwge30sIHsKICAgIGZpZWxkczogewogICAgICBwcm9kdWN0OiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIEZJRUxEUy5wcm9kdWN0KSwge30sIHsKICAgICAgICBmaWVsZEtleTogJ2Rpc2FibGVkJywKICAgICAgICBmbGV4V2lkdGg6ICcyLjQnLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMjUpIHsKICAgICAgICAgIHZhciByb3dJbmRleCA9IF9yZWYyNS5yb3dJbmRleCwKICAgICAgICAgICAgcm93Q291bnQgPSBfcmVmMjUucm93Q291bnQsCiAgICAgICAgICAgIHVwZGF0ZVByb2R1Y3REYXRhID0gX3JlZjI1LnVwZGF0ZVByb2R1Y3REYXRhLAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMjUudmFsdWVzLAogICAgICAgICAgICBuZXdJdGVtID0gX3JlZjI1Lm5ld0l0ZW0sCiAgICAgICAgICAgIG9yaWdpbklkID0gX3JlZjI1Lm9yaWdpbklkLAogICAgICAgICAgICBmb2N1c0ZpZWxkID0gX3JlZjI1LmZvY3VzRmllbGQ7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsb2NhdGlvbklkOiBvcmlnaW5JZCwKICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKHZhbHVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVByb2R1Y3REYXRhKHZhbHVlLCB2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXV0b0ZvY3VzOiBuZXdJdGVtICYmIHJvd0luZGV4ID09PSByb3dDb3VudCAtIDEsCiAgICAgICAgICAgIG9uRXhhY3RQcm9kdWN0U2VsZWN0ZWQ6IGZ1bmN0aW9uIG9uRXhhY3RQcm9kdWN0U2VsZWN0ZWQoX3JlZjI2KSB7CiAgICAgICAgICAgICAgdmFyIHByb2R1Y3QgPSBfcmVmMjYucHJvZHVjdDsKICAgICAgICAgICAgICBpZiAoZm9jdXNGaWVsZCAmJiBwcm9kdWN0KSB7CiAgICAgICAgICAgICAgICBmb2N1c0ZpZWxkKHJvd0luZGV4LCAncXVhbnRpdHlPbkhhbmQnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9KSwKICAgICAgbW9udGhseURlbWFuZDogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmRlbWFuZFBlck1vbnRoLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0RlbWFuZCBwZXIgTW9udGgnLAogICAgICAgIGhlYWRlckFsaWduOiAncmlnaHQnLAogICAgICAgIGZsZXhXaWR0aDogJzAuOCcsCiAgICAgICAgaGVhZGVyVG9vbHRpcDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGVtYW5kUGVyUmVxdWVzdFBlcmlvZC5oZWFkZXJUb29sdGlwLmxhYmVsJywKICAgICAgICBoZWFkZXJEZWZhdWx0VG9vbHRpcDogJ1RoZSBhdmVyYWdlIG9mIHlvdXIgcHJldmlvdXMgcmVxdWVzdHMgZm9yIHRoaXMgcHJvZHVjdC4nLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHR5cGU6ICdudW1iZXInLAogICAgICAgICAgY2xhc3NOYW1lOiAndGV4dC1yaWdodCcKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5T25IYW5kOiB7CiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5xdWFudGl0eU9uSGFuZC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdRT0gnLAogICAgICAgIGZsZXhXaWR0aDogJzAuNicsCiAgICAgICAgaGVhZGVyQWxpZ246ICdyaWdodCcsCiAgICAgICAgaGVhZGVyVG9vbHRpcDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucXVhbnRpdHlPbkhhbmQuaGVhZGVyVG9vbHRpcC5sYWJlbCcsCiAgICAgICAgaGVhZGVyRGVmYXVsdFRvb2x0aXA6ICdFbnRlciB5b3VyIGN1cnJlbnQgcXVhbnRpdHkgb24gaGFuZCBmb3IgdGhpcyBwcm9kdWN0JywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0eXBlOiAnbnVtYmVyJwogICAgICAgIH0sCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYyNykgewogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmMjcuZmllbGRWYWx1ZSwKICAgICAgICAgICAgcm93SW5kZXggPSBfcmVmMjcucm93SW5kZXgsCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYyNy52YWx1ZXMsCiAgICAgICAgICAgIHVwZGF0ZVJvdyA9IF9yZWYyNy51cGRhdGVSb3csCiAgICAgICAgICAgIGNhbGN1bGF0ZVF0eVJlcXVlc3RlZCA9IF9yZWYyNy5jYWxjdWxhdGVRdHlSZXF1ZXN0ZWQ7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICB2YXIgdmFsdWVzV2l0aFVwZGF0ZWRRdHlSZXF1ZXN0ZWQgPSBjYWxjdWxhdGVRdHlSZXF1ZXN0ZWQodmFsdWVzLCByb3dJbmRleCwgZmllbGRWYWx1ZSwgUmVxdWVzdEZyb21XYXJkVHlwZXMuTUFOVUFMKTsKICAgICAgICAgICAgICB1cGRhdGVSb3codmFsdWVzV2l0aFVwZGF0ZWRRdHlSZXF1ZXN0ZWQsIHJvd0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiB7CiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5uZWVkZWRRdWFudGl0eS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdOZWVkZWQgUXR5JywKICAgICAgICBmbGV4V2lkdGg6ICcwLjYnLAogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIGhlYWRlckFsaWduOiAncmlnaHQnLAogICAgICAgIGhlYWRlclRvb2x0aXA6ICdyZWFjdC5zdG9ja01vdmVtZW50LnF1YW50aXR5UmVxdWVzdGVkLmhlYWRlclRvb2x0aXAubGFiZWwnLAogICAgICAgIGhlYWRlckRlZmF1bHRUb29sdGlwOiAnWW91ciBkZW1hbmQgZm9yIHRoZSByZXF1ZXN0IHBlcmlvZCBtaW51cyB5b3VyIFFPSC4gRWRpdCBhcyBuZWVkZWQuJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0eXBlOiAnbnVtYmVyJwogICAgICAgIH0sCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYyOCkgewogICAgICAgICAgdmFyIHJvd0luZGV4ID0gX3JlZjI4LnJvd0luZGV4LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMjgudmFsdWVzLAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMjgudXBkYXRlUm93OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVJvdyh2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNvbW1lbnRzOiB7CiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5jb21tZW50cy5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDb21tZW50cycsCiAgICAgICAgZmxleFdpZHRoOiAnMi40JywKICAgICAgICBoZWFkZXJBbGlnbjogJ2xlZnQnLAogICAgICAgIGhlYWRlclRvb2x0aXA6ICdyZWFjdC5zdG9ja01vdmVtZW50LmNvbW1lbnRzLmhlYWRlclRvb2x0aXAubGFiZWwnLAogICAgICAgIGhlYWRlckRlZmF1bHRUb29sdGlwOiAnTGVhdmUgYSBjb21tZW50IGZvciB0aGUgcGVyc29uIHdobyB3aWxsIHJldmlldyB0aGlzIHJlcXVlc3QuJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjI5KSB7CiAgICAgICAgICB2YXIgYWRkUm93ID0gX3JlZjI5LmFkZFJvdywKICAgICAgICAgICAgcm93Q291bnQgPSBfcmVmMjkucm93Q291bnQsCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjI5LnJvd0luZGV4LAogICAgICAgICAgICBnZXRTb3J0T3JkZXIgPSBfcmVmMjkuZ2V0U29ydE9yZGVyLAogICAgICAgICAgICB1cGRhdGVUb3RhbENvdW50ID0gX3JlZjI5LnVwZGF0ZVRvdGFsQ291bnQsCiAgICAgICAgICAgIHVwZGF0ZVJvdyA9IF9yZWYyOS51cGRhdGVSb3csCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYyOS52YWx1ZXM7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvblRhYlByZXNzOiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHVwZGF0ZVRvdGFsQ291bnQoMSk7CiAgICAgICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgIGFycm93UmlnaHQ6IHJvd0NvdW50ID09PSByb3dJbmRleCArIDEgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudCgxKTsKICAgICAgICAgICAgICBhZGRSb3coewogICAgICAgICAgICAgICAgc29ydE9yZGVyOiBnZXRTb3J0T3JkZXIoKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IDogbnVsbCwKICAgICAgICAgICAgYXJyb3dEb3duOiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB1cGRhdGVUb3RhbENvdW50KDEpOwogICAgICAgICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgICAgICAgc29ydE9yZGVyOiBnZXRTb3J0T3JkZXIoKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICAgICAgICAgIHJldHVybiB1cGRhdGVSb3codmFsdWVzLCByb3dJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWxldGVCdXR0b246IERFTEVURV9CVVRUT05fRklFTEQKICAgIH0KICB9KQp9Owp2YXIgUkVQTEVOSVNITUVOVF9UWVBFX1BVTEwgPSAnUFVMTCc7CmZ1bmN0aW9uIGNhbGN1bGF0ZVF1YW50aXR5UmVxdWVzdGVkKHZhbHVlcywgcm93SW5kZXgsIGZpZWxkVmFsdWUsIHJlcXVlc3RUeXBlKSB7CiAgdmFyIHZhbHVlc1dpdGhVcGRhdGVkUXR5UmVxdWVzdGVkID0gdmFsdWVzOwogIHZhciBsaW5lSXRlbSA9IHZhbHVlc1dpdGhVcGRhdGVkUXR5UmVxdWVzdGVkLmxpbmVJdGVtc1tyb3dJbmRleF07CiAgLy8gT3B0aW9uczogcXVhbnRpdHlBbGxvd2VkLCBkZW1hbmRQZXJSZXBsZW5pc2htZW50UGVyaW9kLCBtb250aGx5RGVtYW5kCiAgLy8gZGVwZW5kaW5nIG9uIHJlcXVlc3QgZnJvbSB3YXJkIHR5cGU6IHN0b2NrbGlzdCBwdXNoLCBzdG9ja2xpc3QgcHVsbCwgbWFudWFsIHJlc3BlY3RpdmVseQogIHZhciBiYXNlVmFsdWUgPSBsaW5lSXRlbVtyZXF1ZXN0VHlwZS5jYWxjdWxhdGVRdHlSZXF1ZXN0ZWRGcm9tXTsKICBpZiAoYmFzZVZhbHVlICYmIGZpZWxkVmFsdWUpIHsKICAgIHZhbHVlc1dpdGhVcGRhdGVkUXR5UmVxdWVzdGVkLmxpbmVJdGVtc1tyb3dJbmRleF0ucXVhbnRpdHlSZXF1ZXN0ZWQgPSBiYXNlVmFsdWUgLSBmaWVsZFZhbHVlID49IDAgPyBiYXNlVmFsdWUgLSBmaWVsZFZhbHVlIDogMDsKICB9CiAgcmV0dXJuIHZhbHVlc1dpdGhVcGRhdGVkUXR5UmVxdWVzdGVkOwp9CgovKioKICogVGhlIHNlY29uZCBzdGVwIG9mIHN0b2NrIG1vdmVtZW50IHdoZXJlIHVzZXIgY2FuIGFkZCBpdGVtcyB0byBzdG9jayBsaXN0LgogKiBUaGlzIGNvbXBvbmVudCBzdXBwb3J0cyB0aHJlZSBkaWZmZXJlbnQgY2FzZXM6IHdpdGggb3Igd2l0aG91dCBzdG9ja2xpc3QKICogd2hlbiBtb3ZlbWVudCBpcyBmcm9tIGEgZGVwb3QgYW5kIHdoZW4gbW92ZW1lbnQgaXMgZnJvbSBhIHZlbmRvci4KICovCnZhciBBZGRJdGVtc1BhZ2UgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoQWRkSXRlbXNQYWdlLCBfQ29tcG9uZW50KTsKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEFkZEl0ZW1zUGFnZSk7CiAgZnVuY3Rpb24gQWRkSXRlbXNQYWdlKHByb3BzKSB7CiAgICB2YXIgX3RoaXM7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQWRkSXRlbXNQYWdlKTsKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpOwogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZGF0YUZldGNoZWQiLCBmYWxzZSk7CiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgY3VycmVudExpbmVJdGVtczogW10sCiAgICAgIHNvcnRPcmRlcjogMCwKICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzLnByb3BzLmluaXRpYWxWYWx1ZXMpLCB7fSwgewogICAgICAgIGxpbmVJdGVtczogW10KICAgICAgfSksCiAgICAgIG5ld0l0ZW06IGZhbHNlLAogICAgICB0b3RhbENvdW50OiAwLAogICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogZmFsc2UsCiAgICAgIGlzUmVxdWVzdEZyb21XYXJkOiBmYWxzZQogICAgfTsKICAgIF90aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICBfdGhpcy5yZW1vdmVJdGVtID0gX3RoaXMucmVtb3ZlSXRlbS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmltcG9ydFRlbXBsYXRlID0gX3RoaXMuaW1wb3J0VGVtcGxhdGUuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5nZXRTb3J0T3JkZXIgPSBfdGhpcy5nZXRTb3J0T3JkZXIuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5jb25maXJtU2F2ZSA9IF90aGlzLmNvbmZpcm1TYXZlLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMuY29uZmlybVRyYW5zaXRpb24gPSBfdGhpcy5jb25maXJtVHJhbnNpdGlvbi5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLm5ld0l0ZW1BZGRlZCA9IF90aGlzLm5ld0l0ZW1BZGRlZC5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnZhbGlkYXRlID0gX3RoaXMudmFsaWRhdGUuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5pc1Jvd0xvYWRlZCA9IF90aGlzLmlzUm93TG9hZGVkLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMubG9hZE1vcmVSb3dzID0gX3RoaXMubG9hZE1vcmVSb3dzLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMudXBkYXRlVG90YWxDb3VudCA9IF90aGlzLnVwZGF0ZVRvdGFsQ291bnQuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy51cGRhdGVSb3cgPSBfdGhpcy51cGRhdGVSb3cuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy51cGRhdGVQcm9kdWN0RGF0YSA9IF90aGlzLnVwZGF0ZVByb2R1Y3REYXRhLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMuc3VibWl0UmVxdWVzdCA9IF90aGlzLnN1Ym1pdFJlcXVlc3QuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5jYWxjdWxhdGVRdWFudGl0eVJlcXVlc3RlZCA9IGNhbGN1bGF0ZVF1YW50aXR5UmVxdWVzdGVkLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMuY2FuY2VsUmVxdWVzdCA9IF90aGlzLmNhbmNlbFJlcXVlc3QuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQogIF9jcmVhdGVDbGFzcyhBZGRJdGVtc1BhZ2UsIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIGlmICh0aGlzLnByb3BzLnN0b2NrTW92ZW1lbnRUcmFuc2xhdGlvbnNGZXRjaGVkKSB7CiAgICAgICAgdGhpcy5kYXRhRmV0Y2hlZCA9IHRydWU7CiAgICAgICAgdGhpcy5mZXRjaEFsbERhdGEoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7CiAgICAgIGlmIChuZXh0UHJvcHMuc3RvY2tNb3ZlbWVudFRyYW5zbGF0aW9uc0ZldGNoZWQgJiYgIXRoaXMuZGF0YUZldGNoZWQpIHsKICAgICAgICB0aGlzLmRhdGFGZXRjaGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmZldGNoQWxsRGF0YSgpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHByb3BlciBmaWVsZHMgZGVwZW5kaW5nIG9uIG9yaWdpbiB0eXBlIG9yIGlmIHN0b2NrIGxpc3QgaXMgY2hvc2VuLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiZ2V0RmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZHMoKSB7CiAgICAgIGlmICh0aGlzLnN0YXRlLmlzUmVxdWVzdEZyb21XYXJkKSB7CiAgICAgICAgaWYgKF8uZ2V0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrbGlzdCwgJ2lkJykpIHsKICAgICAgICAgIGlmIChfLmdldCh0aGlzLnN0YXRlLnZhbHVlcy5yZXBsZW5pc2htZW50VHlwZSwgJ25hbWUnKSA9PT0gUkVQTEVOSVNITUVOVF9UWVBFX1BVTEwpIHsKICAgICAgICAgICAgcmV0dXJuIFJFUVVFU1RfRlJPTV9XQVJEX1NUT0NLTElTVF9GSUVMRFNfUFVMTF9UWVBFOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFJFUVVFU1RfRlJPTV9XQVJEX1NUT0NLTElTVF9GSUVMRFNfUFVTSF9UWVBFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUkVRVUVTVF9GUk9NX1dBUkRfRklFTERTOwogICAgICB9CiAgICAgIGlmIChfLmdldCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja2xpc3QsICdpZCcpKSB7CiAgICAgICAgaWYgKF8uZ2V0KHRoaXMuc3RhdGUudmFsdWVzLnJlcGxlbmlzaG1lbnRUeXBlLCAnbmFtZScpID09PSBSRVBMRU5JU0hNRU5UX1RZUEVfUFVMTCkgewogICAgICAgICAgcmV0dXJuIFNUT0NLTElTVF9GSUVMRFNfUFVMTF9UWVBFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gU1RPQ0tMSVNUX0ZJRUxEU19QVVNIX1RZUEU7CiAgICAgIH0KICAgICAgcmV0dXJuIE5PX1NUT0NLTElTVF9GSUVMRFM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIG5ldyBzdG9jayBtb3ZlbWVudCdzIGl0ZW1zIGFuZCBpdGVtcyB0byBiZQogICAgICogdXBkYXRlZCAoY29tcGFyaW5nIHRvIHByZXZpb3VzIHN0YXRlIG9mIGxpbmUgaXRlbXMpLgogICAgICogQHBhcmFtIHtvYmplY3R9IGxpbmVJdGVtcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiZ2V0TGluZUl0ZW1zVG9CZVNhdmVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMaW5lSXRlbXNUb0JlU2F2ZWQobGluZUl0ZW1zKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwogICAgICAvLyBGaXJzdCBmaW5kIGl0ZW1zIHRoYXQgYXJlIG5ldyBhbmQgc2hvdWxkIGJlIGFkZGVkIChkb24ndCBoYXZlIHN0YXR1cyBjb2RlKQogICAgICB2YXIgbGluZUl0ZW1zVG9CZUFkZGVkID0gXy5maWx0ZXIobGluZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiAhaXRlbS5zdGF0dXNDb2RlICYmIGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgJiYgaXRlbS5xdWFudGl0eVJlcXVlc3RlZCAhPT0gJzAnICYmIGl0ZW0ucHJvZHVjdDsKICAgICAgfSk7CiAgICAgIC8vIFRoZW4gZ2V0IGEgbGlzdCBvZiBpdGVtcyB0aGF0IGFscmVhZHkgZXhpc3QgaW4gdGhpcyByZXF1ZXN0IChoYXZlIHN0YXR1cyBjb2RlKQogICAgICB2YXIgbGluZUl0ZW1zV2l0aFN0YXR1cyA9IF8uZmlsdGVyKGxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5zdGF0dXNDb2RlOwogICAgICB9KTsKICAgICAgdmFyIGxpbmVJdGVtc1RvQmVVcGRhdGVkID0gW107CiAgICAgIC8vIEZvciBlYWNoIGFscmVhZHkgZXhpc3RpbmcgaXRlbXMgLSBmaW5kIHRoZSBvbmVzIHRoYXQgaGF2ZSBjaGFuZ2VkCiAgICAgIF8uZm9yRWFjaChsaW5lSXRlbXNXaXRoU3RhdHVzLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHZhciBvbGRJdGVtID0gXy5maW5kKF90aGlzMi5zdGF0ZS5jdXJyZW50TGluZUl0ZW1zLCBmdW5jdGlvbiAob2xkKSB7CiAgICAgICAgICByZXR1cm4gb2xkLmlkID09PSBpdGVtLmlkOwogICAgICAgIH0pOwogICAgICAgIHZhciBvbGRRdHkgPSBwYXJzZUludChvbGRJdGVtLnF1YW50aXR5UmVxdWVzdGVkLCAxMCk7CiAgICAgICAgdmFyIG5ld1F0eSA9IHBhcnNlSW50KGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQsIDEwKTsKICAgICAgICAvLyBJbnRlcnNlY3Rpb24gb2Yga2V5cyBjb21tb24gdG8gYm90aCBvYmplY3RzIChleGNsdWRpbmcgcHJvZHVjdCBrZXkpCiAgICAgICAgdmFyIGtleUludGVyc2VjdGlvbiA9IF8ucmVtb3ZlKF8uaW50ZXJzZWN0aW9uKF8ua2V5cyhvbGRJdGVtKSwgXy5rZXlzKGl0ZW0pKSwgZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgcmV0dXJuIGtleSAhPT0gJ3Byb2R1Y3QnOwogICAgICAgIH0pOwogICAgICAgIGlmICgoX3RoaXMyLnN0YXRlLnZhbHVlcy5vcmlnaW4udHlwZSA9PT0gJ1NVUFBMSUVSJyB8fCAhX3RoaXMyLnN0YXRlLnZhbHVlcy5oYXNNYW5hZ2VJbnZlbnRvcnkpICYmICghXy5pc0VxdWFsKF8ucGljayhpdGVtLCBrZXlJbnRlcnNlY3Rpb24pLCBfLnBpY2sob2xkSXRlbSwga2V5SW50ZXJzZWN0aW9uKSkgfHwgaXRlbS5wcm9kdWN0LmlkICE9PSBvbGRJdGVtLnByb2R1Y3QuaWQpKSB7CiAgICAgICAgICBsaW5lSXRlbXNUb0JlVXBkYXRlZC5wdXNoKGl0ZW0pOwogICAgICAgIH0gZWxzZSBpZiAobmV3UXR5ICE9PSBvbGRRdHkgfHwgIWl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgfHwgb2xkSXRlbS5jb21tZW50cyAhPT0gaXRlbS5jb21tZW50cyAmJiAhXy5pc05pbChpdGVtLmNvbW1lbnRzKSkgewogICAgICAgICAgbGluZUl0ZW1zVG9CZVVwZGF0ZWQucHVzaChpdGVtKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8gQ29tYmluZSBpdGVtcyB0byBiZSBhZGRlZCBhbmQgaXRlbXMgdG8gYmUgdXBkYXRlZCBpbnRvIG9uZSBsaXN0IHRvIGJlIHNhdmVkCiAgICAgIHJldHVybiBbXS5jb25jYXQoXy5tYXAobGluZUl0ZW1zVG9CZUFkZGVkLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAncHJvZHVjdC5pZCc6IGl0ZW0ucHJvZHVjdC5pZCwKICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiBpdGVtLnF1YW50aXR5UmVxdWVzdGVkLAogICAgICAgICAgc29ydE9yZGVyOiBpdGVtLnNvcnRPcmRlciwKICAgICAgICAgIGNvbW1lbnRzOiAhXy5pc05pbChpdGVtLmNvbW1lbnRzKSA/IGl0ZW0uY29tbWVudHMgOiAnJwogICAgICAgIH07CiAgICAgIH0pLCBfLm1hcChsaW5lSXRlbXNUb0JlVXBkYXRlZCwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaWQ6IGl0ZW0uaWQsCiAgICAgICAgICAncHJvZHVjdC5pZCc6IGl0ZW0ucHJvZHVjdC5pZCwKICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiBpdGVtLnF1YW50aXR5UmVxdWVzdGVkLAogICAgICAgICAgc29ydE9yZGVyOiBpdGVtLnNvcnRPcmRlciwKICAgICAgICAgIGNvbW1lbnRzOiAhXy5pc05pbChpdGVtLmNvbW1lbnRzKSA/IGl0ZW0uY29tbWVudHMgOiAnJwogICAgICAgIH07CiAgICAgIH0pKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTb3J0T3JkZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNvcnRPcmRlcigpIHsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc29ydE9yZGVyOiB0aGlzLnN0YXRlLnNvcnRPcmRlciArIDEwMAogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuc29ydE9yZGVyOwogICAgfQogIH0sIHsKICAgIGtleTogInNldExpbmVJdGVtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TGluZUl0ZW1zKHJlc3BvbnNlLCBzdGFydEluZGV4KSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgdmFyIGxpbmVJdGVtc0RhdGE7CiAgICAgIHZhciBpc1B1bGxUeXBlID0gXy5nZXQodGhpcy5zdGF0ZS52YWx1ZXMucmVwbGVuaXNobWVudFR5cGUsICduYW1lJykgPT09IFJFUExFTklTSE1FTlRfVFlQRV9QVUxMOwogICAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zLmxlbmd0aCA9PT0gMCAmJiAhZGF0YS5sZW5ndGgpIHsKICAgICAgICBsaW5lSXRlbXNEYXRhID0gbmV3IEFycmF5KDEpLmZpbGwoewogICAgICAgICAgc29ydE9yZGVyOiAxMDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLmlzUmVxdWVzdEZyb21XYXJkICYmIF8uZ2V0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrbGlzdCwgJ2lkJykpIHsKICAgICAgICBsaW5lSXRlbXNEYXRhID0gXy5tYXAoZGF0YSwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgdmFyIHF1YW50aXR5UmVxdWVzdGVkID0gdmFsLnF1YW50aXR5UmVxdWVzdGVkLAogICAgICAgICAgICBkZW1hbmRQZXJSZXBsZW5pc2htZW50UGVyaW9kID0gdmFsLmRlbWFuZFBlclJlcGxlbmlzaG1lbnRQZXJpb2QsCiAgICAgICAgICAgIHF1YW50aXR5T25IYW5kID0gdmFsLnF1YW50aXR5T25IYW5kLAogICAgICAgICAgICBxdWFudGl0eUFsbG93ZWQgPSB2YWwucXVhbnRpdHlBbGxvd2VkOwogICAgICAgICAgdmFyIHF0eVJlcXVlc3RlZCA9IDA7CiAgICAgICAgICBpZiAocXVhbnRpdHlSZXF1ZXN0ZWQpIHF0eVJlcXVlc3RlZCA9IHF1YW50aXR5UmVxdWVzdGVkO2Vsc2UgaWYgKGlzUHVsbFR5cGUpIHF0eVJlcXVlc3RlZCA9IGRlbWFuZFBlclJlcGxlbmlzaG1lbnRQZXJpb2QgLSBxdWFudGl0eU9uSGFuZDtlbHNlIHF0eVJlcXVlc3RlZCA9IHF1YW50aXR5QWxsb3dlZDsKICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHZhbCksIHt9LCB7CiAgICAgICAgICAgIHF1YW50aXR5T25IYW5kOiAnJywKICAgICAgICAgICAgZGlzYWJsZWQ6IHRydWUsCiAgICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiBxdHlSZXF1ZXN0ZWQgPj0gMCA/IHF0eVJlcXVlc3RlZCA6IDAKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKGlzUHVsbFR5cGUpIHsKICAgICAgICBsaW5lSXRlbXNEYXRhID0gXy5tYXAoZGF0YSwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgdmFyIHF1YW50aXR5UmVxdWVzdGVkID0gdmFsLnF1YW50aXR5UmVxdWVzdGVkLAogICAgICAgICAgICBkZW1hbmRQZXJSZXBsZW5pc2htZW50UGVyaW9kID0gdmFsLmRlbWFuZFBlclJlcGxlbmlzaG1lbnRQZXJpb2QsCiAgICAgICAgICAgIHF1YW50aXR5QXZhaWxhYmxlID0gdmFsLnF1YW50aXR5QXZhaWxhYmxlOwogICAgICAgICAgdmFyIHF0eVJlcXVlc3RlZCA9IHF1YW50aXR5UmVxdWVzdGVkIHx8IGRlbWFuZFBlclJlcGxlbmlzaG1lbnRQZXJpb2QgLSBxdWFudGl0eUF2YWlsYWJsZTsKICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHZhbCksIHt9LCB7CiAgICAgICAgICAgIGRpc2FibGVkOiB0cnVlLAogICAgICAgICAgICBxdWFudGl0eVJlcXVlc3RlZDogcXR5UmVxdWVzdGVkID49IDAgPyBxdHlSZXF1ZXN0ZWQgOiAwLAogICAgICAgICAgICBxdWFudGl0eU9uSGFuZDogX3RoaXMzLnN0YXRlLmlzUmVxdWVzdEZyb21XYXJkID8gJycgOiB2YWwucXVhbnRpdHlPbkhhbmQKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGxpbmVJdGVtc0RhdGEgPSBfLm1hcChkYXRhLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB2YWwpLCB7fSwgewogICAgICAgICAgICBkaXNhYmxlZDogdHJ1ZSwKICAgICAgICAgICAgcXVhbnRpdHlPbkhhbmQ6IF90aGlzMy5zdGF0ZS5pc1JlcXVlc3RGcm9tV2FyZCA/ICcnIDogdmFsLnF1YW50aXR5T25IYW5kCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICB2YXIgc29ydE9yZGVyID0gXy50b0ludGVnZXIoXy5sYXN0KGxpbmVJdGVtc0RhdGEpLnNvcnRPcmRlcikgKyAxMDA7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIGN1cnJlbnRMaW5lSXRlbXM6IHRoaXMucHJvcHMuaXNQYWdpbmF0ZWQgPyBfLnVuaXFCeShfLmNvbmNhdCh0aGlzLnN0YXRlLmN1cnJlbnRMaW5lSXRlbXMsIGRhdGEpLCAnaWQnKSA6IGRhdGEsCiAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRoaXMuc3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgIGxpbmVJdGVtczogdGhpcy5wcm9wcy5pc1BhZ2luYXRlZCA/IF8udW5pcUJ5KF8uY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLmxpbmVJdGVtcywgbGluZUl0ZW1zRGF0YSksICdpZCcpIDogbGluZUl0ZW1zRGF0YQogICAgICAgIH0pLAogICAgICAgIHNvcnRPcmRlcjogc29ydE9yZGVyCiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIV8uaXNOdWxsKHN0YXJ0SW5kZXgpICYmIF90aGlzMy5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zLmxlbmd0aCAhPT0gX3RoaXMzLnN0YXRlLnRvdGFsQ291bnQpIHsKICAgICAgICAgIF90aGlzMy5sb2FkTW9yZVJvd3MoewogICAgICAgICAgICBzdGFydEluZGV4OiBzdGFydEluZGV4ICsgX3RoaXMzLnByb3BzLnBhZ2VTaXplCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgX3RoaXMzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZVRvdGFsQ291bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVRvdGFsQ291bnQodmFsdWUpIHsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdG90YWxDb3VudDogdGhpcy5zdGF0ZS50b3RhbENvdW50ICsgdmFsdWUgPT09IDAgPyAxIDogdGhpcy5zdGF0ZS50b3RhbENvdW50ICsgdmFsdWUKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlUm93IiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVSb3codmFsdWVzLCBpbmRleCkgewogICAgICB2YXIgaXRlbSA9IHZhbHVlcy5saW5lSXRlbXNbaW5kZXhdOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICB2YWx1ZXM6IHVwZGF0ZSh2YWx1ZXMsIHsKICAgICAgICAgIGxpbmVJdGVtczogX2RlZmluZVByb3BlcnR5KHt9LCBpbmRleCwgewogICAgICAgICAgICAkc2V0OiBpdGVtCiAgICAgICAgICB9KQogICAgICAgIH0pCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInZhbGlkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZSh2YWx1ZXMpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CiAgICAgIHZhciBlcnJvcnMgPSB7fTsKICAgICAgZXJyb3JzLmxpbmVJdGVtcyA9IFtdOwogICAgICB2YXIgZGF0ZSA9IG1vbWVudCh0aGlzLnByb3BzLm1pbmltdW1FeHBpcmF0aW9uRGF0ZSwgJ01NL0REL1lZWVknKTsKICAgICAgXy5mb3JFYWNoKHZhbHVlcy5saW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtLCBrZXkpIHsKICAgICAgICB2YXIgcm93RXJyb3JzID0ge307CiAgICAgICAgaWYgKCFfLmlzTmlsKGl0ZW0ucHJvZHVjdCkpIHsKICAgICAgICAgIGlmIChfLmlzTmlsKGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQpIHx8IGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgPCAwKSB7CiAgICAgICAgICAgIHJvd0Vycm9ycy5xdWFudGl0eVJlcXVlc3RlZCA9ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmVudGVyUXVhbnRpdHkubGFiZWwnOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIV8uaXNFbXB0eShpdGVtLmJveE5hbWUpICYmIF8uaXNFbXB0eShpdGVtLnBhbGxldE5hbWUpKSB7CiAgICAgICAgICByb3dFcnJvcnMuYm94TmFtZSA9ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmJveFdpdGhvdXRQYWxsZXQubGFiZWwnOwogICAgICAgIH0KICAgICAgICB2YXIgZGF0ZVJlcXVlc3RlZCA9IG1vbWVudChpdGVtLmV4cGlyYXRpb25EYXRlLCAnTU0vREQvWVlZWScpOwogICAgICAgIGlmIChkYXRlLmRpZmYoZGF0ZVJlcXVlc3RlZCkgPiAwKSB7CiAgICAgICAgICByb3dFcnJvcnMuZXhwaXJhdGlvbkRhdGUgPSAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5pbnZhbGlkRGF0ZS5sYWJlbCc7CiAgICAgICAgfQogICAgICAgIGlmIChfdGhpczQuc3RhdGUuaXNSZXF1ZXN0RnJvbVdhcmQpIHsKICAgICAgICAgIGlmIChfLmlzTmlsKGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQpIHx8IGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgPCAwKSB7CiAgICAgICAgICAgIHJvd0Vycm9ycy5xdWFudGl0eVJlcXVlc3RlZCA9ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmVudGVyUXVhbnRpdHkubGFiZWwnOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIV8uaXNFbXB0eShyb3dFcnJvcnMpKSB7CiAgICAgICAgICBlcnJvcnMubGluZUl0ZW1zW2tleV0gPSByb3dFcnJvcnM7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGVycm9yczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJuZXdJdGVtQWRkZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG5ld0l0ZW1BZGRlZCgpIHsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgbmV3SXRlbTogdHJ1ZQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4cG9ydHMgY3VycmVudCBzdGF0ZSBvZiBzdG9jayBtb3ZlbWVudCdzIHRvIGNzdiBmaWxlLgogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImV4cG9ydFRlbXBsYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBleHBvcnRUZW1wbGF0ZShmb3JtVmFsdWVzKSB7CiAgICAgIHZhciBsaW5lSXRlbXMgPSBfLmZpbHRlcihmb3JtVmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gIV8uaXNFbXB0eShpdGVtKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2F2ZUl0ZW1zQW5kRXhwb3J0VGVtcGxhdGUoZm9ybVZhbHVlcywgbGluZUl0ZW1zKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4cG9ydHMgY3VycmVudCBzdGF0ZSBvZiBzdG9jayBtb3ZlbWVudCdzIHRvIGNzdiBmaWxlLgogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBsaW5lSXRlbXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVJdGVtc0FuZEV4cG9ydFRlbXBsYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlSXRlbXNBbmRFeHBvcnRUZW1wbGF0ZShmb3JtVmFsdWVzLCBsaW5lSXRlbXMpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CiAgICAgIHZhciBtb3ZlbWVudE51bWJlciA9IGZvcm1WYWx1ZXMubW92ZW1lbnROdW1iZXIsCiAgICAgICAgc3RvY2tNb3ZlbWVudElkID0gZm9ybVZhbHVlcy5zdG9ja01vdmVtZW50SWQ7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L2V4cG9ydENzdi8iLmNvbmNhdChzdG9ja01vdmVtZW50SWQpOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHJldHVybiB0aGlzLnNhdmVSZXF1aXNpdGlvbkl0ZW1zSW5DdXJyZW50U3RlcChsaW5lSXRlbXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIGFwaUNsaWVudC5nZXQodXJsLCB7CiAgICAgICAgICByZXNwb25zZVR5cGU6ICdibG9iJwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBmaWxlRG93bmxvYWQocmVzcG9uc2UuZGF0YSwgIkl0ZW1MaXN0Ii5jb25jYXQobW92ZW1lbnROdW1iZXIgPyAiLSIuY29uY2F0KG1vdmVtZW50TnVtYmVyKSA6ICcnLCAiLmNzdiIpLCAndGV4dC9jc3YnKTsKICAgICAgICAgIF90aGlzNS5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzNS5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIEltcG9ydHMgY2hvc2VuIGZpbGUgdG8gYmFja2VuZCBhbmQgdGhlbiBmZXRjaGVzIGxpbmUgaXRlbXMuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZXZlbnQKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImltcG9ydFRlbXBsYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbXBvcnRUZW1wbGF0ZShldmVudCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgdmFyIGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIHZhciBzdG9ja01vdmVtZW50SWQgPSB0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQ7CiAgICAgIGZvcm1EYXRhLmFwcGVuZCgnaW1wb3J0RmlsZScsIGZpbGUuc2xpY2UoMCwgZmlsZS5zaXplLCAndGV4dC9jc3YnKSk7CiAgICAgIHZhciBjb25maWcgPSB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL3N0b2NrTW92ZW1lbnQvaW1wb3J0Q3N2LyIuY29uY2F0KHN0b2NrTW92ZW1lbnRJZCk7CiAgICAgIHJldHVybiBhcGlDbGllbnQucG9zdCh1cmwsIGZvcm1EYXRhLCBjb25maWcpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNi5zZXRTdGF0ZSh7CiAgICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXM2LnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICAgIGxpbmVJdGVtczogW10KICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgICAgX3RoaXM2LmZldGNoTGluZUl0ZW1zKCk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczYucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93cyBzYXZlIGNvbmZpcm1hdGlvbiBkaWFsb2cuCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBvbkNvbmZpcm0KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImNvbmZpcm1TYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb25maXJtU2F2ZShvbkNvbmZpcm0pIHsKICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQubWVzc2FnZS5jb25maXJtU2F2ZS5sYWJlbCcsICdDb25maXJtIHNhdmUnKSwKICAgICAgICBtZXNzYWdlOiB0aGlzLnN0YXRlLmlzUmVxdWVzdEZyb21XYXJkID8gdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuUU9IV2lsbE5vdEJlU2F2ZWQubWVzc2FnZScsICdUaGlzIHNhdmUgYWN0aW9uIHdvbuKAmXQgc2F2ZSB0aGUgcXVhbnRpdHkgb24gaGFuZCB5b3UgaGF2ZSBlbnRlcmVkLiBZb3Ugd2lsbCBoYXZlIHRvIHJlZW50ZXIgdGhlc2Ugd2hlbiB5b3UgY2FtZSBiYWNrIHRvIHRoaXMgcmVxdWVzdCBsYXRlci4gQWxzbyBpZiB0aGVyZSBhcmUgYW55IGVtcHR5IG9yIHplcm8gcXVhbnRpdHkgbGluZXMsIHRob3NlIGxpbmVzIHdpbGwgYmUgZGVsZXRlZC4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHByb2NlZWQ/JykgOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtU2F2ZS5tZXNzYWdlJywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBzYXZlPyBUaGVyZSBhcmUgc29tZSBsaW5lcyB3aXRoIGVtcHR5IG9yIHplcm8gcXVhbnRpdHksIHRob3NlIGxpbmVzIHdpbGwgYmUgZGVsZXRlZC4nKSwKICAgICAgICBidXR0b25zOiBbewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lnllcy5sYWJlbCcsICdZZXMnKSwKICAgICAgICAgIG9uQ2xpY2s6IG9uQ29uZmlybQogICAgICAgIH0sIHsKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgfV0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93cyB0cmFuc2l0aW9uIGNvbmZpcm1hdGlvbiBkaWFsb2cgaWYgdGhlcmUgYXJlIGl0ZW1zIHdpdGggdGhlIHNhbWUgY29kZS4KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IG9uQ29uZmlybQogICAgICogQHBhcmFtIHtvYmplY3R9IGl0ZW1zCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJjb25maXJtVHJhbnNpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29uZmlybVRyYW5zaXRpb24ob25Db25maXJtLCBpdGVtcykgewogICAgICBjb25maXJtQWxlcnQoewogICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtVHJhbnNpdGlvbi5sYWJlbCcsICdZb3UgaGF2ZSBlbnRlcmVkIHRoZSBzYW1lIGNvZGUgdHdpY2UuIERvIHlvdSB3YW50IHRvIGNvbnRpbnVlPycpLAogICAgICAgIG1lc3NhZ2U6IF8ubWFwKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgdmFyIF9pdGVtJHByb2R1Y3QkZGlzcGxheTsKICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgicCIsIHsKICAgICAgICAgICAga2V5OiBpdGVtLnNvcnRPcmRlcgogICAgICAgICAgfSwgIiIuY29uY2F0KGl0ZW0ucHJvZHVjdC5wcm9kdWN0Q29kZSwgIiAiKS5jb25jYXQoKChfaXRlbSRwcm9kdWN0JGRpc3BsYXkgPSBpdGVtLnByb2R1Y3QuZGlzcGxheU5hbWVzKSA9PT0gbnVsbCB8fCBfaXRlbSRwcm9kdWN0JGRpc3BsYXkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9pdGVtJHByb2R1Y3QkZGlzcGxheVsiZGVmYXVsdCJdKSB8fCBpdGVtLnByb2R1Y3QubmFtZSwgIiAiKS5jb25jYXQoaXRlbS5xdWFudGl0eVJlcXVlc3RlZCkpOwogICAgICAgIH0pLAogICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQueWVzLmxhYmVsJywgJ1llcycpLAogICAgICAgICAgb25DbGljazogb25Db25maXJtCiAgICAgICAgfSwgewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lm5vLmxhYmVsJywgJ05vJykKICAgICAgICB9XQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb25maXJtU3VibWl0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb25maXJtU3VibWl0KG9uQ29uZmlybSkgewogICAgICBjb25maXJtQWxlcnQoewogICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5tZXNzYWdlLmNvbmZpcm1TdWJtaXQubGFiZWwnLCAnQ29uZmlybSBzdWJtaXQnKSwKICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtU3VibWl0Lm1lc3NhZ2UnLCAnUGxlYXNlIGNvbmZpcm0geW91IGFyZSByZWFkeSB0byBzdWJtaXQgeW91ciByZXF1ZXN0LiBPbmNlIHN1Ym1pdHRlZCwgeW91IGNhbm5vdCBlZGl0IHRoZSByZXF1ZXN0LicpLAogICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQuZ29CYWNrLmxhYmVsJywgJ0dvIGJhY2snKQogICAgICAgIH0sIHsKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5zdWJtaXQubGFiZWwnLCAnU3VibWl0JyksCiAgICAgICAgICBvbkNsaWNrOiBvbkNvbmZpcm0KICAgICAgICB9XQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIEZldGNoZXMgYWxsIHJlcXVpcmVkIGRhdGEuCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGZvcmNlRmV0Y2gKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImZldGNoQWxsRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hBbGxEYXRhKCkgewogICAgICB0aGlzLmZldGNoQWRkSXRlbXNQYWdlRGF0YSgpOwogICAgICBpZiAoIXRoaXMucHJvcHMuaXNQYWdpbmF0ZWQpIHsKICAgICAgICB0aGlzLmZldGNoTGluZUl0ZW1zKCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5pc0ZpcnN0UGFnZUxvYWRlZCkgewogICAgICAgIC8vIFdvcmthcm91bmQgZm9yIHJlZmV0Y2hpbmcgaXRlbXMgZnJvbSBzY3JhdGNoCiAgICAgICAgLy8gd2hlbiB0aGUgZmlyc3QgcGFnZSB3YXMgYWxyZWFkeSBsb2FkZWQgYW5kIHRhYmxlIGlzIHBhZ2luYXRlZAogICAgICAgIHRoaXMubG9hZE1vcmVSb3dzKHsKICAgICAgICAgIHN0YXJ0SW5kZXg6IDAKICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmV0Y2hlcyAybmQgc3RlcCBkYXRhIGZyb20gY3VycmVudCBzdG9jayBtb3ZlbWVudC4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImZldGNoTGluZUl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaExpbmVJdGVtcygpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3N0b2NrTW92ZW1lbnRJdGVtcz9zdGVwTnVtYmVyPTIiKTsKICAgICAgcmV0dXJuIGFwaUNsaWVudC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNy5zZXRTdGF0ZSh7CiAgICAgICAgICB0b3RhbENvdW50OiByZXNwb25zZS5kYXRhLmRhdGEubGVuZ3RoCiAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzNy5zZXRMaW5lSXRlbXMocmVzcG9uc2UsIG51bGwpOwogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgcmV0dXJuIGVycjsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNSb3dMb2FkZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzUm93TG9hZGVkKF9yZWYzMCkgewogICAgICB2YXIgaW5kZXggPSBfcmVmMzAuaW5kZXg7CiAgICAgIHJldHVybiAhIXRoaXMuc3RhdGUudmFsdWVzLmxpbmVJdGVtc1tpbmRleF07CiAgICB9CgogICAgLyoqCiAgICAgKiBGZXRjaGVzIHN0b2NrIG1vdmVtZW50J3MgbGluZSBpdGVtcyBhbmQgc2V0cyB0aGVtIGluIHJlZHV4IGZvcm0gYW5kIGluCiAgICAgKiBzdGF0ZSBhcyBjdXJyZW50IGxpbmUgaXRlbXMuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJmZXRjaEFkZEl0ZW1zUGFnZURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoQWRkSXRlbXNQYWdlRGF0YSgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgIHZhciBfcmVzcCRkYXRhID0gcmVzcC5kYXRhLAogICAgICAgICAgX3Jlc3AkZGF0YSRkYXRhID0gX3Jlc3AkZGF0YS5kYXRhLAogICAgICAgICAgaGFzTWFuYWdlSW52ZW50b3J5ID0gX3Jlc3AkZGF0YSRkYXRhLmhhc01hbmFnZUludmVudG9yeSwKICAgICAgICAgIHN0YXR1c0NvZGUgPSBfcmVzcCRkYXRhJGRhdGEuc3RhdHVzQ29kZSwKICAgICAgICAgIHRvdGFsQ291bnQgPSBfcmVzcCRkYXRhLnRvdGFsQ291bnQ7CiAgICAgICAgX3RoaXM4LnNldFN0YXRlKHsKICAgICAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpczguc3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgICAgaGFzTWFuYWdlSW52ZW50b3J5OiBoYXNNYW5hZ2VJbnZlbnRvcnksCiAgICAgICAgICAgIHN0YXR1c0NvZGU6IHN0YXR1c0NvZGUKICAgICAgICAgIH0pLAogICAgICAgICAgdG90YWxDb3VudDogdG90YWxDb3VudCA9PT0gMCA/IDEgOiB0b3RhbENvdW50LAogICAgICAgICAgaXNSZXF1ZXN0RnJvbVdhcmQ6IGlzUmVxdWVzdEZyb21XYXJkKF90aGlzOC5wcm9wcy5jdXJyZW50TG9jYXRpb25JZCwgX3RoaXM4LnN0YXRlLnZhbHVlcy5kZXN0aW5hdGlvbi5pZCwgX3RoaXM4LnByb3BzLnN1cHBvcnRlZEFjdGl2aXRpZXMpCiAgICAgICAgfSk7CiAgICAgICAgX3RoaXM4LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXM4LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImxvYWRNb3JlUm93cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZE1vcmVSb3dzKF9yZWYzMSkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKICAgICAgdmFyIHN0YXJ0SW5kZXggPSBfcmVmMzEuc3RhcnRJbmRleDsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IHRydWUKICAgICAgfSk7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3N0b2NrTW92ZW1lbnRJdGVtcz9vZmZzZXQ9IikuY29uY2F0KHN0YXJ0SW5kZXgsICImbWF4PSIpLmNvbmNhdCh0aGlzLnByb3BzLnBhZ2VTaXplLCAiJnN0ZXBOdW1iZXI9MiIpOwogICAgICBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczkuc2V0TGluZUl0ZW1zKHJlc3BvbnNlLCBzdGFydEluZGV4KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjdXJyZW50IHN0b2NrIG1vdmVtZW50IHByb2dyZXNzIChsaW5lIGl0ZW1zKSBhbmQgZ29lcyB0byB0aGUgbmV4dCBzdG9jayBtb3ZlbWVudCBzdGVwLgogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogIm5leHRQYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBuZXh0UGFnZShmb3JtVmFsdWVzKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKICAgICAgdmFyIGxpbmVJdGVtcyA9IF8uZmlsdGVyKGZvcm1WYWx1ZXMubGluZUl0ZW1zLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcmV0dXJuICFfLmlzRW1wdHkodmFsKSAmJiB2YWwucHJvZHVjdDsKICAgICAgfSk7CiAgICAgIGlmIChfLnNvbWUobGluZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiAhaXRlbS5xdWFudGl0eVJlcXVlc3RlZCB8fCBpdGVtLnF1YW50aXR5UmVxdWVzdGVkID09PSAnMCc7CiAgICAgIH0pKSB7CiAgICAgICAgdGhpcy5jb25maXJtU2F2ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxMC5jaGVja0R1cGxpY2F0ZXNTYXZlQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAoZm9ybVZhbHVlcywgbGluZUl0ZW1zKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNoZWNrRHVwbGljYXRlc1NhdmVBbmRUcmFuc2l0aW9uVG9OZXh0U3RlcChmb3JtVmFsdWVzLCBsaW5lSXRlbXMpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY2hlY2tEdXBsaWNhdGVzU2F2ZUFuZFRyYW5zaXRpb25Ub05leHRTdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGVja0R1cGxpY2F0ZXNTYXZlQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAoZm9ybVZhbHVlcywgbGluZUl0ZW1zKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKICAgICAgdmFyIGl0ZW1zTWFwID0ge307CiAgICAgIF8uZm9yRWFjaChsaW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaWYgKGl0ZW1zTWFwW2l0ZW0ucHJvZHVjdC5wcm9kdWN0Q29kZV0pIHsKICAgICAgICAgIGl0ZW1zTWFwW2l0ZW0ucHJvZHVjdC5wcm9kdWN0Q29kZV0ucHVzaChpdGVtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaXRlbXNNYXBbaXRlbS5wcm9kdWN0LnByb2R1Y3RDb2RlXSA9IFtpdGVtXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB2YXIgaXRlbXNXaXRoU2FtZUNvZGUgPSBfLmZpbHRlcihpdGVtc01hcCwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5sZW5ndGggPiAxOwogICAgICB9KTsKICAgICAgaWYgKF8uc29tZShpdGVtc01hcCwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5sZW5ndGggPiAxOwogICAgICB9KSAmJiAhKHRoaXMuc3RhdGUudmFsdWVzLm9yaWdpbi50eXBlID09PSAnU1VQUExJRVInIHx8ICF0aGlzLnN0YXRlLnZhbHVlcy5oYXNNYW5hZ2VJbnZlbnRvcnkpKSB7CiAgICAgICAgdGhpcy5jb25maXJtVHJhbnNpdGlvbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxMS5zYXZlQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAoZm9ybVZhbHVlcywgbGluZUl0ZW1zKTsKICAgICAgICB9LCBfLnJlZHVjZShpdGVtc1dpdGhTYW1lQ29kZSwgZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLmNvbmNhdChiKTsKICAgICAgICB9LCBbXSkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2F2ZUFuZFRyYW5zaXRpb25Ub05leHRTdGVwKGZvcm1WYWx1ZXMsIGxpbmVJdGVtcyk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGN1cnJlbnQgc3RvY2sgbW92ZW1lbnQgcHJvZ3Jlc3MgKGxpbmUgaXRlbXMpIGFuZCBnb2VzIHRvIHRoZSBuZXh0IHN0b2NrIG1vdmVtZW50IHN0ZXAuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZm9ybVZhbHVlcwogICAgICogQHBhcmFtIHtvYmplY3R9IGxpbmVJdGVtcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZUFuZFRyYW5zaXRpb25Ub05leHRTdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAoZm9ybVZhbHVlcywgbGluZUl0ZW1zKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICBpZiAoZm9ybVZhbHVlcy5vcmlnaW4udHlwZSA9PT0gJ1NVUFBMSUVSJyB8fCAhZm9ybVZhbHVlcy5oYXNNYW5hZ2VJbnZlbnRvcnkpIHsKICAgICAgICB0aGlzLnNhdmVSZXF1aXNpdGlvbkl0ZW1zKGxpbmVJdGVtcykudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgICAgdmFyIHZhbHVlcyA9IGZvcm1WYWx1ZXM7CiAgICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgICB2YWx1ZXMgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGZvcm1WYWx1ZXMpLCB7fSwgewogICAgICAgICAgICAgIGxpbmVJdGVtczogcmVzcC5kYXRhLmRhdGEubGluZUl0ZW1zCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgX3RoaXMxMi50cmFuc2l0aW9uVG9OZXh0U3RlcCgnQ0hFQ0tJTkcnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMxMi5wcm9wcy5uZXh0UGFnZSh2YWx1ZXMpOwogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMxMi5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgICAgfSk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMTIucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNhdmVSZXF1aXNpdGlvbkl0ZW1zKGxpbmVJdGVtcykudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgICAgdmFyIHZhbHVlcyA9IGZvcm1WYWx1ZXM7CiAgICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgICB2YWx1ZXMgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGZvcm1WYWx1ZXMpLCB7fSwgewogICAgICAgICAgICAgIGxpbmVJdGVtczogcmVzcC5kYXRhLmRhdGEubGluZUl0ZW1zCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgX3RoaXMxMi50cmFuc2l0aW9uVG9OZXh0U3RlcCgnVkVSSUZZSU5HJykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMTIucHJvcHMubmV4dFBhZ2UodmFsdWVzKTsKICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMTIucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczEyLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGxpc3Qgb2Ygc3RvY2sgbW92ZW1lbnQgaXRlbXMgd2l0aCBwb3N0IG1ldGhvZC4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBsaW5lSXRlbXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVSZXF1aXNpdGlvbkl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlUmVxdWlzaXRpb25JdGVtcyhsaW5lSXRlbXMpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwogICAgICB2YXIgaXRlbXNUb1NhdmUgPSB0aGlzLmdldExpbmVJdGVtc1RvQmVTYXZlZChsaW5lSXRlbXMpOwogICAgICB2YXIgdXBkYXRlSXRlbXNVcmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3VwZGF0ZUl0ZW1zIik7CiAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIGlkOiB0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsCiAgICAgICAgbGluZUl0ZW1zOiBpdGVtc1RvU2F2ZQogICAgICB9OwogICAgICBpZiAocGF5bG9hZC5saW5lSXRlbXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGFwaUNsaWVudC5wb3N0KHVwZGF0ZUl0ZW1zVXJsLCBwYXlsb2FkKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczEzLmZldGNoQWRkSXRlbXNQYWdlRGF0YSgpOwogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3Iuc2F2ZVJlcXVpc2l0aW9uSXRlbXMubGFiZWwnKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgfQogIH0sIHsKICAgIGtleTogInN1Ym1pdFJlcXVlc3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN1Ym1pdFJlcXVlc3QobGluZUl0ZW1zKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKICAgICAgdGhpcy5jb25maXJtU3VibWl0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbm9uRW1wdHlMaW5lSXRlbXMgPSBfLmZpbHRlcihsaW5lSXRlbXMsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgIHJldHVybiAhXy5pc0VtcHR5KHZhbCkgJiYgdmFsLnByb2R1Y3Q7CiAgICAgICAgfSk7CiAgICAgICAgX3RoaXMxNC5zYXZlUmVxdWlzaXRpb25JdGVtcyhub25FbXB0eUxpbmVJdGVtcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxNC50cmFuc2l0aW9uVG9OZXh0U3RlcCgnUkVRVUVTVEVEJyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgbGlzdCBvZiByZXF1aXNpdGlvbiBpdGVtcyBpbiBjdXJyZW50IHN0ZXAgKHdpdGhvdXQgc3RlcCBjaGFuZ2UpLiBVc2VkIHRvIGV4cG9ydCB0ZW1wbGF0ZS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBpdGVtQ2FuZGlkYXRlc1RvU2F2ZQogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZVJlcXVpc2l0aW9uSXRlbXNJbkN1cnJlbnRTdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlUmVxdWlzaXRpb25JdGVtc0luQ3VycmVudFN0ZXAoaXRlbUNhbmRpZGF0ZXNUb1NhdmUpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwogICAgICB2YXIgaXRlbXNUb1NhdmUgPSB0aGlzLmdldExpbmVJdGVtc1RvQmVTYXZlZChpdGVtQ2FuZGlkYXRlc1RvU2F2ZSk7CiAgICAgIHZhciB1cGRhdGVJdGVtc1VybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvdXBkYXRlSXRlbXMiKTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgaWQ6IHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwKICAgICAgICBsaW5lSXRlbXM6IGl0ZW1zVG9TYXZlCiAgICAgIH07CiAgICAgIGlmIChwYXlsb2FkLmxpbmVJdGVtcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QodXBkYXRlSXRlbXNVcmwsIHBheWxvYWQpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMTUuc2V0U3RhdGUoewogICAgICAgICAgICBjdXJyZW50TGluZUl0ZW1zOiBbXSwKICAgICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzMTUuc3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgICAgICBsaW5lSXRlbXM6IFtdCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBzb3J0T3JkZXI6IDAsCiAgICAgICAgICAgIG5ld0l0ZW06IGZhbHNlLAogICAgICAgICAgICB0b3RhbENvdW50OiAwCiAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpczE1LmZldGNoQWxsRGF0YSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihfdGhpczE1LnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5zYXZlUmVxdWlzaXRpb25JdGVtcy5sYWJlbCcsICdDb3VsZCBub3Qgc2F2ZSByZXF1aXNpdGlvbiBpdGVtcycpKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgbGlzdCBvZiByZXF1aXNpdGlvbiBpdGVtcyBpbiBjdXJyZW50IHN0ZXAgKHdpdGhvdXQgc3RlcCBjaGFuZ2UpLgogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmUoZm9ybVZhbHVlcykgewogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7CiAgICAgIHZhciBsaW5lSXRlbXMgPSBfLmZpbHRlcihmb3JtVmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gIV8uaXNFbXB0eShpdGVtKTsKICAgICAgfSk7CiAgICAgIHZhciB6ZXJvZWRMaW5lcyA9IF8uc29tZShsaW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuICFpdGVtLnF1YW50aXR5UmVxdWVzdGVkIHx8IGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgPT09ICcwJzsKICAgICAgfSk7CiAgICAgIGlmICh6ZXJvZWRMaW5lcyB8fCB0aGlzLnN0YXRlLmlzUmVxdWVzdEZyb21XYXJkKSB7CiAgICAgICAgdGhpcy5jb25maXJtU2F2ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxNi5zYXZlSXRlbXMobGluZUl0ZW1zKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNhdmVJdGVtcyhsaW5lSXRlbXMpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY2FuY2VsUmVxdWVzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsUmVxdWVzdCgpIHsKICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwogICAgICBjb25maXJtQWxlcnQoewogICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5yZXF1ZXN0LmNvbmZpcm1DYW5jZWxsYXRpb24ubGFiZWwnLCAnQ29uZmlybSByZXF1ZXN0IGNhbmNlbGxhdGlvbicpLAogICAgICAgIG1lc3NhZ2U6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LnJlcXVlc3QuY29uZmlybUNhbmNlbGxhdGlvbi5tZXNzYWdlLmxhYmVsJywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgY3VycmVudCByZXF1ZXN0ID8nKSwKICAgICAgICBidXR0b25zOiBbewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lnllcy5sYWJlbCcsICdZZXMnKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgIF90aGlzMTcucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgICAgICAgYXBpQ2xpZW50WyJkZWxldGUiXSgiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQoX3RoaXMxNy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDQpIHsKICAgICAgICAgICAgICAgIF90aGlzMTcucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICAgICAgICAgIEFsZXJ0LnN1Y2Nlc3MoX3RoaXMxNy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQucmVxdWVzdC5zdWNjZXNzZnVsbHlEZWxldGVkLmxhYmVsJywgJ1JlcXVlc3Qgd2FzIHN1Y2Nlc3NmdWxseSBkZWxldGVkJyksIHsKICAgICAgICAgICAgICAgICAgdGltZW91dDogMzAwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxNy5zdGF0ZS5pc1JlcXVlc3RGcm9tV2FyZCkgewogICAgICAgICAgICAgICAgICBfdGhpczE3LnByb3BzLmhpc3RvcnkucHVzaCgnL29wZW5ib3hlcy8nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcvb3BlbmJveGVzL3N0b2NrTW92ZW1lbnQvbGlzdD9kaXJlY3Rpb249SU5CT1VORCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTcucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lm5vLmxhYmVsJywgJ05vJykKICAgICAgICB9XQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGNoYW5nZXMgbWFkZSBieSB1c2VyIGluIHRoaXMgc3RlcCBhbmQgcmVkaXJlY3RzIHRvIHRoZSBzaGlwbWVudCB2aWV3IHBhZ2UKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmb3JtVmFsdWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb25zaXN0ZW50LXJldHVybgogIH0sIHsKICAgIGtleTogInNhdmVBbmRFeGl0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlQW5kRXhpdChmb3JtVmFsdWVzKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKICAgICAgdmFyIHNhdmVBbmRSZWRpcmVjdCA9IGZ1bmN0aW9uIHNhdmVBbmRSZWRpcmVjdChsaW5lSXRlbXMpIHsKICAgICAgICBfdGhpczE4LnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgICAgcmV0dXJuIF90aGlzMTguc2F2ZVJlcXVpc2l0aW9uSXRlbXNJbkN1cnJlbnRTdGVwKGxpbmVJdGVtcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgcmVkaXJlY3RUbyA9ICcvb3BlbmJveGVzL3N0b2NrTW92ZW1lbnQvbGlzdD9kaXJlY3Rpb249SU5CT1VORCc7CiAgICAgICAgICBpZiAoIV90aGlzMTgucHJvcHMuc3VwcG9ydGVkQWN0aXZpdGllcy5pbmNsdWRlcygnTUFOQUdFX0lOVkVOVE9SWScpICYmIF90aGlzMTgucHJvcHMuc3VwcG9ydGVkQWN0aXZpdGllcy5pbmNsdWRlcygnU1VCTUlUX1JFUVVFU1QnKSkgewogICAgICAgICAgICByZWRpcmVjdFRvID0gJy9vcGVuYm94ZXMvZGFzaGJvYXJkJzsKICAgICAgICAgIH0KICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHJlZGlyZWN0VG87CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMxOC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIH0pOwogICAgICB9OwogICAgICB2YXIgZXJyb3JzID0gdGhpcy52YWxpZGF0ZShmb3JtVmFsdWVzKS5saW5lSXRlbXM7CiAgICAgIGlmICghZXJyb3JzLmxlbmd0aCkgewogICAgICAgIHZhciBsaW5lSXRlbXMgPSBfLmZpbHRlcihmb3JtVmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiAhXy5pc0VtcHR5KGl0ZW0pOwogICAgICAgIH0pOwogICAgICAgIHZhciB6ZXJvZWRMaW5lcyA9IF8uc29tZShsaW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gIWl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgfHwgaXRlbS5xdWFudGl0eVJlcXVlc3RlZCA9PT0gJzAnOwogICAgICAgIH0pOwogICAgICAgIGlmICh6ZXJvZWRMaW5lcyB8fCB0aGlzLnN0YXRlLmlzUmVxdWVzdEZyb21XYXJkKSB7CiAgICAgICAgICB0aGlzLmNvbmZpcm1TYXZlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc2F2ZUFuZFJlZGlyZWN0KGxpbmVJdGVtcyk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2F2ZUFuZFJlZGlyZWN0KGxpbmVJdGVtcyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbmZpcm1BbGVydCh7CiAgICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybUV4aXQubGFiZWwnLCAnQ29uZmlybSBzYXZlJyksCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtRXhpdC5tZXNzYWdlJywgJ1ZhbGlkYXRpb24gZXJyb3JzIG9jY3VycmVkLiBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZXhpdCBhbmQgbG9zZSB1bnNhdmVkIGRhdGE/JyksCiAgICAgICAgICBidXR0b25zOiBbewogICAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQueWVzLmxhYmVsJywgJ1llcycpLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHZhciByZWRpcmVjdFRvID0gJy9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9saXN0P2RpcmVjdGlvbj1JTkJPVU5EJzsKICAgICAgICAgICAgICBpZiAoIV90aGlzMTgucHJvcHMuc3VwcG9ydGVkQWN0aXZpdGllcy5pbmNsdWRlcygnTUFOQUdFX0lOVkVOVE9SWScpICYmIF90aGlzMTgucHJvcHMuc3VwcG9ydGVkQWN0aXZpdGllcy5pbmNsdWRlcygnU1VCTUlUX1JFUVVFU1QnKSkgewogICAgICAgICAgICAgICAgcmVkaXJlY3RUbyA9ICcvb3BlbmJveGVzL2Rhc2hib2FyZCc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHJlZGlyZWN0VG87CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lm5vLmxhYmVsJywgJ05vJykKICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGxpc3Qgb2YgcmVxdWlzaXRpb24gaXRlbXMgaW4gY3VycmVudCBzdGVwICh3aXRob3V0IHN0ZXAgY2hhbmdlKS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBsaW5lSXRlbXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVJdGVtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZUl0ZW1zKGxpbmVJdGVtcykgewogICAgICB2YXIgX3RoaXMxOSA9IHRoaXM7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgcmV0dXJuIHRoaXMuc2F2ZVJlcXVpc2l0aW9uSXRlbXNJbkN1cnJlbnRTdGVwKGxpbmVJdGVtcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxOS5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIEFsZXJ0LnN1Y2Nlc3MoX3RoaXMxOS5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuYWxlcnQuc2F2ZVN1Y2Nlc3MubGFiZWwnLCAnQ2hhbmdlcyBzYXZlZCBzdWNjZXNzZnVsbHknKSwgewogICAgICAgICAgdGltZW91dDogMzAwMAogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxOS5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmV0Y2ggdGhlIGRhdGEsIGFsbCBub3Qgc2F2ZWQgY2hhbmdlcyB3aWxsIGJlIGxvc3QuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICB2YXIgX3RoaXMyMCA9IHRoaXM7CiAgICAgIGNvbmZpcm1BbGVydCh7CiAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50Lm1lc3NhZ2UuY29uZmlybVJlZnJlc2gubGFiZWwnLCAnQ29uZmlybSByZWZyZXNoJyksCiAgICAgICAgbWVzc2FnZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVJlZnJlc2gubWVzc2FnZScsICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVmcmVzaD8gWW91ciBwcm9ncmVzcyBzaW5jZSBsYXN0IHNhdmUgd2lsbCBiZSBsb3N0LicpLAogICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQueWVzLmxhYmVsJywgJ1llcycpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMjAuZmV0Y2hBbGxEYXRhKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lm5vLmxhYmVsJywgJ05vJykKICAgICAgICB9XQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZXMgY2hvc2VuIGl0ZW0gZnJvbSByZXF1aXNpdGlvbidzIGl0ZW1zIGxpc3QuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaXRlbUlkCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVJdGVtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVJdGVtKGl0ZW1JZCkgewogICAgICB2YXIgX3RoaXMyMSA9IHRoaXM7CiAgICAgIHZhciByZW1vdmVJdGVtc1VybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50SXRlbXMvIi5jb25jYXQoaXRlbUlkLCAiL3JlbW92ZUl0ZW0iKTsKICAgICAgcmV0dXJuIGFwaUNsaWVudFsiZGVsZXRlIl0ocmVtb3ZlSXRlbXNVcmwpWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIxLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcigncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5kZWxldGVSZXF1aXNpdGlvbkl0ZW0ubGFiZWwnKSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlcyBhbGwgaXRlbXMgZnJvbSByZXF1aXNpdGlvbidzIGl0ZW1zIGxpc3QuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVBbGwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFsbCgpIHsKICAgICAgdmFyIF90aGlzMjIgPSB0aGlzOwogICAgICB2YXIgcmVtb3ZlSXRlbXNVcmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3JlbW92ZUFsbEl0ZW1zIik7CiAgICAgIHJldHVybiBhcGlDbGllbnRbImRlbGV0ZSJdKHJlbW92ZUl0ZW1zVXJsKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIyLnNldFN0YXRlKHsKICAgICAgICAgIHRvdGFsQ291bnQ6IDEsCiAgICAgICAgICBjdXJyZW50TGluZUl0ZW1zOiBbXSwKICAgICAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpczIyLnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICAgIGxpbmVJdGVtczogbmV3IEFycmF5KDEpLmZpbGwoewogICAgICAgICAgICAgIHNvcnRPcmRlcjogMTAwCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyMi5mZXRjaExpbmVJdGVtcygpOwogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3IuZGVsZXRlUmVxdWlzaXRpb25JdGVtLmxhYmVsJykpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zaXRpb24gdG8gbmV4dCBzdG9jayBtb3ZlbWVudCBzdGF0dXM6CiAgICAgKiAtICdDSEVDS0lORycgaWYgb3JpZ2luIHR5cGUgaXMgc3VwcGxpZXIuCiAgICAgKiAtICdWRVJJRllJTkcnIGlmIG9yaWdpbiB0eXBlIGlzIG90aGVyIHRoYW4gc3VwcGxpZXIuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RhdHVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJ0cmFuc2l0aW9uVG9OZXh0U3RlcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdHJhbnNpdGlvblRvTmV4dFN0ZXAoc3RhdHVzKSB7CiAgICAgIHZhciBfdGhpczIzID0gdGhpczsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvc3RhdHVzIik7CiAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIHN0YXR1czogc3RhdHVzCiAgICAgIH07CiAgICAgIHZhciBtb3ZlbWVudE51bWJlciA9IHRoaXMuc3RhdGUudmFsdWVzLm1vdmVtZW50TnVtYmVyOwogICAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZXMuc3RhdHVzQ29kZSA9PT0gJ0NSRUFURUQnKSB7CiAgICAgICAgcmV0dXJuIGFwaUNsaWVudC5wb3N0KHVybCwgcGF5bG9hZCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdHJhbnNsYXRlZFN1Ym1pdE1lc3NhZ2UgPSBfdGhpczIzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5yZXF1ZXN0LnN1Ym1pdE1lc3NhZ2UubGFiZWwnLCAnVGhhbmsgeW91IGZvciBzdWJtaXR0aW5nIHlvdXIgcmVxdWVzdC4gWW91IGNhbiBjaGVjayB0aGUgc3RhdHVzIG9mIHlvdXIgcmVxdWVzdCB1c2luZyBzdG9jayBtb3ZlbWVudCBudW1iZXInKTsKICAgICAgICAgIHZhciByZWRpcmVjdFRvVVJMID0gJyc7CiAgICAgICAgICBpZiAoIV90aGlzMjMucHJvcHMuc3VwcG9ydGVkQWN0aXZpdGllcy5pbmNsdWRlcygnTUFOQUdFX0lOVkVOVE9SWScpICYmIF90aGlzMjMucHJvcHMuc3VwcG9ydGVkQWN0aXZpdGllcy5pbmNsdWRlcygnU1VCTUlUX1JFUVVFU1QnKSkgewogICAgICAgICAgICByZWRpcmVjdFRvVVJMID0gJy9vcGVuYm94ZXMvJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlZGlyZWN0VG9VUkwgPSAnL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L2xpc3Q/ZGlyZWN0aW9uPUlOQk9VTkQnOwogICAgICAgICAgfQogICAgICAgICAgQWxlcnQuc3VjY2VzcygiIi5jb25jYXQodHJhbnNsYXRlZFN1Ym1pdE1lc3NhZ2UsICIgIikuY29uY2F0KG1vdmVtZW50TnVtYmVyKSk7CiAgICAgICAgICBfdGhpczIzLnByb3BzLmhpc3RvcnkucHVzaChyZWRpcmVjdFRvVVJMKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjaGFuZ2VzIG1hZGUgYnkgdXNlciBpbiB0aGlzIHN0ZXAgYW5kIGdvIGJhY2sgdG8gcHJldmlvdXMgcGFnZQogICAgICogQHBhcmFtIHtvYmplY3R9IHZhbHVlcwogICAgICogQHBhcmFtIHtib29sZWFufSBpbnZhbGlkCiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb25zaXN0ZW50LXJldHVybgogIH0sIHsKICAgIGtleTogInByZXZpb3VzUGFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJldmlvdXNQYWdlKHZhbHVlcywgaW52YWxpZCkgewogICAgICB2YXIgX3RoaXMyNCA9IHRoaXM7CiAgICAgIHZhciBzYXZlQW5kUmVkaXJlY3QgPSBmdW5jdGlvbiBzYXZlQW5kUmVkaXJlY3QobGluZUl0ZW1zKSB7CiAgICAgICAgX3RoaXMyNC5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICAgIHJldHVybiBfdGhpczI0LnNhdmVSZXF1aXNpdGlvbkl0ZW1zSW5DdXJyZW50U3RlcChsaW5lSXRlbXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMjQucHJvcHMucHJldmlvdXNQYWdlKHZhbHVlcyk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyNC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgIH0pOwogICAgICB9OwogICAgICBpZiAoIWludmFsaWQpIHsKICAgICAgICB2YXIgbGluZUl0ZW1zID0gXy5maWx0ZXIodmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiAhXy5pc0VtcHR5KGl0ZW0pOwogICAgICAgIH0pOwogICAgICAgIHZhciB6ZXJvZWRMaW5lcyA9IF8uc29tZShsaW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gIWl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgfHwgaXRlbS5xdWFudGl0eVJlcXVlc3RlZCA9PT0gJzAnOwogICAgICAgIH0pOwogICAgICAgIGlmICh6ZXJvZWRMaW5lcyB8fCB0aGlzLnN0YXRlLmlzUmVxdWVzdEZyb21XYXJkKSB7CiAgICAgICAgICB0aGlzLmNvbmZpcm1TYXZlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc2F2ZUFuZFJlZGlyZWN0KGxpbmVJdGVtcyk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2F2ZUFuZFJlZGlyZWN0KGxpbmVJdGVtcyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbmZpcm1BbGVydCh7CiAgICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVByZXZpb3VzUGFnZS5sYWJlbCcsICdWYWxpZGF0aW9uIGVycm9yJyksCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUHJldmlvdXNQYWdlLm1lc3NhZ2UubGFiZWwnLCAnQ2Fubm90IHNhdmUgZHVlIHRvIHZhbGlkYXRpb24gZXJyb3Igb24gcGFnZScpLAogICAgICAgICAgYnV0dG9uczogW3sKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1QcmV2aW91c1BhZ2UuY29ycmVjdEVycm9yLmxhYmVsJywgJ0NvcnJlY3QgZXJyb3InKQogICAgICAgICAgfSwgewogICAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVByZXZpb3VzUGFnZS5jb250aW51ZS5sYWJlbCcsICdDb250aW51ZSAobG9zZSB1bnNhdmVkIHdvcmspJyksCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMjQucHJvcHMucHJldmlvdXNQYWdlKHZhbHVlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVQcm9kdWN0RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlUHJvZHVjdERhdGEocHJvZHVjdCwgdmFsdWVzLCBpbmRleCkgewogICAgICB2YXIgX3RoaXMyNSA9IHRoaXM7CiAgICAgIGlmIChwcm9kdWN0KSB7CiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNSZXF1ZXN0RnJvbVdhcmQpIHsKICAgICAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvcHJvZHVjdHMvIi5jb25jYXQocHJvZHVjdC5pZCwgIi9wcm9kdWN0RGVtYW5kP29yaWdpbklkPSIpLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5vcmlnaW4uaWQsICImZGVzdGluYXRpb25JZD0iKS5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuZGVzdGluYXRpb24uaWQpOwogICAgICAgICAgYXBpQ2xpZW50LmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHZhciBtb250aGx5RGVtYW5kID0gcGFyc2VGbG9hdChyZXNwb25zZS5kYXRhLm1vbnRobHlEZW1hbmQpOwogICAgICAgICAgICB2YXIgcXVhbnRpdHlSZXF1ZXN0ZWQgPSBtb250aGx5RGVtYW5kIC0gKHJlc3BvbnNlLmRhdGEucXVhbnRpdHlPbkhhbmQgfHwgMCk7CiAgICAgICAgICAgIF90aGlzMjUuc2V0U3RhdGUoewogICAgICAgICAgICAgIHZhbHVlczogdXBkYXRlKHZhbHVlcywgewogICAgICAgICAgICAgICAgbGluZUl0ZW1zOiBfZGVmaW5lUHJvcGVydHkoe30sIGluZGV4LCB7CiAgICAgICAgICAgICAgICAgIHByb2R1Y3Q6IHsKICAgICAgICAgICAgICAgICAgICAkc2V0OiBwcm9kdWN0CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHF1YW50aXR5T25IYW5kOiB7CiAgICAgICAgICAgICAgICAgICAgJHNldDogJycKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgbW9udGhseURlbWFuZDogewogICAgICAgICAgICAgICAgICAgICRzZXQ6IG1vbnRobHlEZW1hbmQKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVhbnRpdHlSZXF1ZXN0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICAkc2V0OiBxdWFudGl0eVJlcXVlc3RlZCA+PSAwID8gcXVhbnRpdHlSZXF1ZXN0ZWQgOiAwCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KVsiY2F0Y2giXSh0aGlzLnByb3BzLmhpZGVTcGlubmVyKCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX3VybCA9ICIvb3BlbmJveGVzL2FwaS9wcm9kdWN0cy8iLmNvbmNhdChwcm9kdWN0LmlkLCAiL3Byb2R1Y3RBdmFpbGFiaWxpdHlBbmREZW1hbmQ/bG9jYXRpb25JZD0iKS5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuZGVzdGluYXRpb24uaWQpOwogICAgICAgICAgYXBpQ2xpZW50LmdldChfdXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICB2YXIgX3Jlc3BvbnNlJGRhdGEgPSByZXNwb25zZS5kYXRhLAogICAgICAgICAgICAgIG1vbnRobHlEZW1hbmQgPSBfcmVzcG9uc2UkZGF0YS5tb250aGx5RGVtYW5kLAogICAgICAgICAgICAgIHF1YW50aXR5QXZhaWxhYmxlID0gX3Jlc3BvbnNlJGRhdGEucXVhbnRpdHlBdmFpbGFibGUsCiAgICAgICAgICAgICAgcXVhbnRpdHlPbkhhbmQgPSBfcmVzcG9uc2UkZGF0YS5xdWFudGl0eU9uSGFuZDsKICAgICAgICAgICAgdmFyIHF1YW50aXR5UmVxdWVzdGVkID0gbW9udGhseURlbWFuZCAtIHF1YW50aXR5QXZhaWxhYmxlID4gMCA/IG1vbnRobHlEZW1hbmQgLSBxdWFudGl0eUF2YWlsYWJsZSA6IDA7CiAgICAgICAgICAgIF90aGlzMjUuc2V0U3RhdGUoewogICAgICAgICAgICAgIHZhbHVlczogdXBkYXRlKHZhbHVlcywgewogICAgICAgICAgICAgICAgbGluZUl0ZW1zOiBfZGVmaW5lUHJvcGVydHkoe30sIGluZGV4LCB7CiAgICAgICAgICAgICAgICAgIHByb2R1Y3Q6IHsKICAgICAgICAgICAgICAgICAgICAkc2V0OiBwcm9kdWN0CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHF1YW50aXR5T25IYW5kOiB7CiAgICAgICAgICAgICAgICAgICAgJHNldDogcXVhbnRpdHlPbkhhbmQKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IHsKICAgICAgICAgICAgICAgICAgICAkc2V0OiBxdWFudGl0eUF2YWlsYWJsZQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBtb250aGx5RGVtYW5kOiB7CiAgICAgICAgICAgICAgICAgICAgJHNldDogbW9udGhseURlbWFuZAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBxdWFudGl0eVJlcXVlc3RlZDogewogICAgICAgICAgICAgICAgICAgICRzZXQ6IHF1YW50aXR5UmVxdWVzdGVkCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KVsiY2F0Y2giXSh0aGlzLnByb3BzLmhpZGVTcGlubmVyKCkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgIHZhbHVlczogdXBkYXRlKHZhbHVlcywgewogICAgICAgICAgICBsaW5lSXRlbXM6IF9kZWZpbmVQcm9wZXJ0eSh7fSwgaW5kZXgsIHsKICAgICAgICAgICAgICBwcm9kdWN0OiB7CiAgICAgICAgICAgICAgICAkc2V0OiBudWxsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBxdWFudGl0eU9uSGFuZDogewogICAgICAgICAgICAgICAgJHNldDogJycKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHF1YW50aXR5QXZhaWxhYmxlOiB7CiAgICAgICAgICAgICAgICAkc2V0OiAnJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbW9udGhseURlbWFuZDogewogICAgICAgICAgICAgICAgJHNldDogJycKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiB7CiAgICAgICAgICAgICAgICAkc2V0OiAnJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzMjYgPSB0aGlzOwogICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybSwgewogICAgICAgIG9uU3VibWl0OiBmdW5jdGlvbiBvblN1Ym1pdCgpIHt9LAogICAgICAgIHZhbGlkYXRlOiB0aGlzLnZhbGlkYXRlLAogICAgICAgIG11dGF0b3JzOiBfb2JqZWN0U3ByZWFkKHt9LCBhcnJheU11dGF0b3JzKSwKICAgICAgICBpbml0aWFsVmFsdWVzOiB0aGlzLnN0YXRlLnZhbHVlcywKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihfcmVmMzIpIHsKICAgICAgICAgIHZhciBoYW5kbGVTdWJtaXQgPSBfcmVmMzIuaGFuZGxlU3VibWl0LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMzIudmFsdWVzLAogICAgICAgICAgICBpbnZhbGlkID0gX3JlZjMyLmludmFsaWQ7CiAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZC1mbGV4IGZsZXgtY29sdW1uIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImJ1dHRvbnMtY29udGFpbmVyIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImxhYmVsIiwgewogICAgICAgICAgICBodG1sRm9yOiAiY3N2SW5wdXQiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgbWwtMSBidG4teHMgIi5jb25jYXQoX3RoaXMyNi5zdGF0ZS5pc1JlcXVlc3RGcm9tV2FyZCA/ICdkaXNhYmxlZCcgOiAnJyksCiAgICAgICAgICAgIHRpdGxlOiBfdGhpczI2LnN0YXRlLmlzUmVxdWVzdEZyb21XYXJkID8gJ1RlbXBvcmFyaWx5IGRpc2FibGVkJyA6ICcnCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1kb3dubG9hZCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLmltcG9ydFRlbXBsYXRlLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJJbXBvcnQgdGVtcGxhdGUiCiAgICAgICAgICB9KSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgaWQ6ICJjc3ZJbnB1dCIsCiAgICAgICAgICAgIHR5cGU6ICJmaWxlIiwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25DaGFuZ2U6IF90aGlzMjYuaW1wb3J0VGVtcGxhdGUsCiAgICAgICAgICAgIGRpc2FibGVkOiBfdGhpczI2LnN0YXRlLmlzUmVxdWVzdEZyb21XYXJkLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKGV2ZW50KSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduCiAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gbnVsbDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWNjZXB0OiAiLmNzdiIKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMjYuZXhwb3J0VGVtcGxhdGUodmFsdWVzKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmxvYXQtcmlnaHQgbWItMSBidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGFsaWduLXNlbGYtZW5kIG1sLTEgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtdXBsb2FkIHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uZXhwb3J0VGVtcGxhdGUubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkV4cG9ydCB0ZW1wbGF0ZSIKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczI2LnJlZnJlc2goKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmxvYXQtcmlnaHQgbWItMSBidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGFsaWduLXNlbGYtZW5kIG1sLTEgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtcmVmcmVzaCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnJlZnJlc2gubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlJlbG9hZCIKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBkaXNhYmxlZDogaW52YWxpZCwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyNi5zYXZlKHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBtbC0xIGJ0bi14cyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXNhdmUgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5zYXZlLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZlIgogICAgICAgICAgfSkpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIGRpc2FibGVkOiBpbnZhbGlkLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczI2LnNhdmVBbmRFeGl0KHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBtbC0xIGJ0bi14cyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXNpZ24tb3V0IHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uc2F2ZUFuZEV4aXQubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUgYW5kIGV4aXQiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgZGlzYWJsZWQ6IGludmFsaWQsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMjYucmVtb3ZlQWxsKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLWRhbmdlciBhbGlnbi1zZWxmLWVuZCBtbC0xIGJ0bi14cyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXJlbW92ZSBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLmRlbGV0ZUFsbC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVsZXRlIGFsbCIKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1kYW5nZXIgYWxpZ24tc2VsZi1lbmQgbWwtMSBidG4teHMiLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczI2LmNhbmNlbFJlcXVlc3QoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtcmVtb3ZlIHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3Quc3RvY2tNb3ZlbWVudC5yZXF1ZXN0LmNhbmNlbC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2FuY2VsIFJlcXVlc3QiCiAgICAgICAgICB9KSkpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImZvcm0iLCB7CiAgICAgICAgICAgIG9uU3VibWl0OiBoYW5kbGVTdWJtaXQKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogInRhYmxlLWZvcm0iCiAgICAgICAgICB9LCBfLm1hcChfdGhpczI2LmdldEZpZWxkcygpLCBmdW5jdGlvbiAoZmllbGRDb25maWcsIGZpZWxkTmFtZSkgewogICAgICAgICAgICByZXR1cm4gcmVuZGVyRm9ybUZpZWxkKGZpZWxkQ29uZmlnLCBmaWVsZE5hbWUsIHsKICAgICAgICAgICAgICBzdG9ja2xpc3Q6IHZhbHVlcy5zdG9ja2xpc3QsCiAgICAgICAgICAgICAgcmVtb3ZlSXRlbTogX3RoaXMyNi5yZW1vdmVJdGVtLAogICAgICAgICAgICAgIG9yaWdpbklkOiBfdGhpczI2LnByb3BzLmluaXRpYWxWYWx1ZXMub3JpZ2luLmlkLAogICAgICAgICAgICAgIGdldFNvcnRPcmRlcjogX3RoaXMyNi5nZXRTb3J0T3JkZXIsCiAgICAgICAgICAgICAgbmV3SXRlbUFkZGVkOiBfdGhpczI2Lm5ld0l0ZW1BZGRlZCwKICAgICAgICAgICAgICBuZXdJdGVtOiBfdGhpczI2LnN0YXRlLm5ld0l0ZW0sCiAgICAgICAgICAgICAgdG90YWxDb3VudDogX3RoaXMyNi5zdGF0ZS50b3RhbENvdW50LAogICAgICAgICAgICAgIGxvYWRNb3JlUm93czogX3RoaXMyNi5sb2FkTW9yZVJvd3MsCiAgICAgICAgICAgICAgaXNSb3dMb2FkZWQ6IF90aGlzMjYuaXNSb3dMb2FkZWQsCiAgICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudDogX3RoaXMyNi51cGRhdGVUb3RhbENvdW50LAogICAgICAgICAgICAgIGlzUGFnaW5hdGVkOiBfdGhpczI2LnByb3BzLmlzUGFnaW5hdGVkLAogICAgICAgICAgICAgIGlzRnJvbU9yZGVyOiBfdGhpczI2LnN0YXRlLnZhbHVlcy5pc0Zyb21PcmRlciwKICAgICAgICAgICAgICB1cGRhdGVSb3c6IF90aGlzMjYudXBkYXRlUm93LAogICAgICAgICAgICAgIHZhbHVlczogdmFsdWVzLAogICAgICAgICAgICAgIGlzRmlyc3RQYWdlTG9hZGVkOiBfdGhpczI2LnN0YXRlLmlzRmlyc3RQYWdlTG9hZGVkLAogICAgICAgICAgICAgIHVwZGF0ZVByb2R1Y3REYXRhOiBfdGhpczI2LnVwZGF0ZVByb2R1Y3REYXRhLAogICAgICAgICAgICAgIGNhbGN1bGF0ZVF0eVJlcXVlc3RlZDogX3RoaXMyNi5jYWxjdWxhdGVRdWFudGl0eVJlcXVlc3RlZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAic3VibWl0LWJ1dHRvbnMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgZGlzYWJsZWQ6IGludmFsaWQsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMjYucHJldmlvdXNQYWdlKHZhbHVlcywgaW52YWxpZCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImJ0biBidG4tb3V0bGluZS1wcmltYXJ5IGJ0bi1mb3JtIGJ0bi14cyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnByZXZpb3VzLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJQcmV2aW91cyIKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogInN1Ym1pdCIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMjYuc3VibWl0UmVxdWVzdCh2YWx1ZXMubGluZUl0ZW1zKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiYnRuIGJ0bi1vdXRsaW5lLXByaW1hcnkgYnRuLWZvcm0gZmxvYXQtcmlnaHQgYnRuLXhzIiwKICAgICAgICAgICAgZGlzYWJsZWQ6IGludmFsaWQgfHwgIV8uc29tZSh2YWx1ZXMubGluZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBpdGVtLnByb2R1Y3QgJiYgXy5wYXJzZUludChpdGVtLnF1YW50aXR5UmVxdWVzdGVkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnN1Ym1pdFJlcXVlc3QubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlN1Ym1pdCByZXF1ZXN0IgogICAgICAgICAgfSkpKSkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfV0pOwogIHJldHVybiBBZGRJdGVtc1BhZ2U7Cn0oQ29tcG9uZW50KTsKdmFyIG1hcFN0YXRlVG9Qcm9wcyA9IGZ1bmN0aW9uIG1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSkgewogIHJldHVybiB7CiAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZVdpdGhEZWZhdWx0TWVzc2FnZShnZXRUcmFuc2xhdGUoc3RhdGUubG9jYWxpemUpKSwKICAgIHN0b2NrTW92ZW1lbnRUcmFuc2xhdGlvbnNGZXRjaGVkOiBzdGF0ZS5zZXNzaW9uLmZldGNoZWRUcmFuc2xhdGlvbnMuc3RvY2tNb3ZlbWVudCwKICAgIG1pbmltdW1FeHBpcmF0aW9uRGF0ZTogc3RhdGUuc2Vzc2lvbi5taW5pbXVtRXhwaXJhdGlvbkRhdGUsCiAgICBpc1BhZ2luYXRlZDogc3RhdGUuc2Vzc2lvbi5pc1BhZ2luYXRlZCwKICAgIHBhZ2VTaXplOiBzdGF0ZS5zZXNzaW9uLnBhZ2VTaXplLAogICAgY3VycmVudExvY2F0aW9uSWQ6IHN0YXRlLnNlc3Npb24uY3VycmVudExvY2F0aW9uLmlkLAogICAgc3VwcG9ydGVkQWN0aXZpdGllczogc3RhdGUuc2Vzc2lvbi5zdXBwb3J0ZWRBY3Rpdml0aWVzCiAgfTsKfTsKdmFyIG1hcERpc3BhdGNoVG9Qcm9wcyA9IHsKICBzaG93U3Bpbm5lcjogc2hvd1NwaW5uZXIsCiAgaGlkZVNwaW5uZXI6IGhpZGVTcGlubmVyLAogIGZldGNoVXNlcnM6IGZldGNoVXNlcnMKfTsKZXhwb3J0IGRlZmF1bHQgd2l0aFJvdXRlcihjb25uZWN0KG1hcFN0YXRlVG9Qcm9wcywgbWFwRGlzcGF0Y2hUb1Byb3BzKShBZGRJdGVtc1BhZ2UpKTsKQWRkSXRlbXNQYWdlLnByb3BUeXBlcyA9IHsKICAvKiogSW5pdGlhbCBjb21wb25lbnQncyBkYXRhICovCiAgaW5pdGlhbFZhbHVlczogUHJvcFR5cGVzLnNoYXBlKHsKICAgIG9yaWdpbjogUHJvcFR5cGVzLnNoYXBlKHsKICAgICAgaWQ6IFByb3BUeXBlcy5zdHJpbmcKICAgIH0pLAogICAgaGFzTWFuYWdlSW52ZW50b3J5OiBQcm9wVHlwZXMuYm9vbAogIH0pLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIHJldHVybmluZyB1c2VyIHRvIHRoZSBwcmV2aW91cyBwYWdlICovCiAgcHJldmlvdXNQYWdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKgogICAqIEZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSBmb3JtIGRhdGEgd2hlbiB0aGUgaGFuZGxlU3VibWl0KCkKICAgKiBpcyBmaXJlZCBmcm9tIHdpdGhpbiB0aGUgZm9ybSBjb21wb25lbnQuCiAgICovCiAgbmV4dFBhZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGRhdGEgaXMgbG9hZGluZyAqLwogIHNob3dTcGlubmVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiBkYXRhIGhhcyBsb2FkZWQgKi8KICBoaWRlU3Bpbm5lcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICB0cmFuc2xhdGU6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgc3RvY2tNb3ZlbWVudFRyYW5zbGF0aW9uc0ZldGNoZWQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgbWluaW11bUV4cGlyYXRpb25EYXRlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsCiAgLyoqIFJldHVybiB0cnVlIGlmIHBhZ2luYXRpb24gaXMgZW5hYmxlZCAqLwogIGlzUGFnaW5hdGVkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLAogIHBhZ2VTaXplOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsCiAgY3VycmVudExvY2F0aW9uSWQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCwKICBzdXBwb3J0ZWRBY3Rpdml0aWVzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuc3RyaW5nKS5pc1JlcXVpcmVkLAogIGhpc3Rvcnk6IFByb3BUeXBlcy5zaGFwZSh7CiAgICBwdXNoOiBQcm9wVHlwZXMuZnVuYwogIH0pLmlzUmVxdWlyZWQKfTs="},null]}