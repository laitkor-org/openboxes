{"remainingRequest":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js?presets[]=@babel/react&presets[]=@babel/env!/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js!/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/request/EditPage.jsx","dependencies":[{"path":"/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/request/EditPage.jsx","mtime":1698037750000},{"path":"/opt/MTOBS-BIKASH/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfSwgX3R5cGVvZihvYmopOyB9CmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsgfQpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9CmZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pOyBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB9CmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAodHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgaXRlcltTeW1ib2wuaXRlcmF0b3JdICE9IG51bGwgfHwgaXRlclsiQEBpdGVyYXRvciJdICE9IG51bGwpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KGFycik7IH0KZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBlbnVtZXJhYmxlT25seSAmJiAoc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pKSwga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBudWxsICE9IGFyZ3VtZW50c1tpXSA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpICUgMiA/IG93bktleXMoT2JqZWN0KHNvdXJjZSksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpIDogb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSByZXR1cm4gdGFyZ2V0OyB9CmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOyB9IH0KZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN1YkNsYXNzLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsga2V5ID0gX3RvUHJvcGVydHlLZXkoa2V5KTsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CmZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgeyB2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgInN0cmluZyIpOyByZXR1cm4gX3R5cGVvZihrZXkpID09PSAic3ltYm9sIiA/IGtleSA6IFN0cmluZyhrZXkpOyB9CmZ1bmN0aW9uIF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkgeyBpZiAoX3R5cGVvZihpbnB1dCkgIT09ICJvYmplY3QiIHx8IGlucHV0ID09PSBudWxsKSByZXR1cm4gaW5wdXQ7IHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTsgaWYgKHByaW0gIT09IHVuZGVmaW5lZCkgeyB2YXIgcmVzID0gcHJpbS5jYWxsKGlucHV0LCBoaW50IHx8ICJkZWZhdWx0Iik7IGlmIChfdHlwZW9mKHJlcykgIT09ICJvYmplY3QiKSByZXR1cm4gcmVzOyB0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpOyB9IHJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTsgfQppbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnOwppbXBvcnQgYXJyYXlNdXRhdG9ycyBmcm9tICdmaW5hbC1mb3JtLWFycmF5cyc7CmltcG9ydCB1cGRhdGUgZnJvbSAnaW1tdXRhYmlsaXR5LWhlbHBlcic7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7CmltcG9ydCB7IGNvbmZpcm1BbGVydCB9IGZyb20gJ3JlYWN0LWNvbmZpcm0tYWxlcnQnOwppbXBvcnQgeyBGb3JtIH0gZnJvbSAncmVhY3QtZmluYWwtZm9ybSc7CmltcG9ydCB7IGdldFRyYW5zbGF0ZSB9IGZyb20gJ3JlYWN0LWxvY2FsaXplLXJlZHV4JzsKaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ3JlYWN0LXJlZHV4JzsKaW1wb3J0IEFsZXJ0IGZyb20gJ3JlYWN0LXMtYWxlcnQnOwppbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAncmVhY3QtdGlwcHknOwppbXBvcnQgeyBmZXRjaFJlYXNvbkNvZGVzLCBoaWRlU3Bpbm5lciwgc2hvd1NwaW5uZXIgfSBmcm9tICdhY3Rpb25zJzsKaW1wb3J0IEFycmF5RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL0FycmF5RmllbGQnOwppbXBvcnQgQnV0dG9uRmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL0J1dHRvbkZpZWxkJzsKaW1wb3J0IExhYmVsRmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL0xhYmVsRmllbGQnOwppbXBvcnQgU2VsZWN0RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL1NlbGVjdEZpZWxkJzsKaW1wb3J0IFRhYmxlUm93V2l0aFN1YmZpZWxkcyBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvVGFibGVSb3dXaXRoU3ViZmllbGRzJzsKaW1wb3J0IFRleHRGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvVGV4dEZpZWxkJzsKaW1wb3J0IERldGFpbHNNb2RhbCBmcm9tICdjb21wb25lbnRzL3N0b2NrLW1vdmVtZW50LXdpemFyZC9tb2RhbHMvRGV0YWlsc01vZGFsJzsKaW1wb3J0IFN1YnN0aXR1dGlvbnNNb2RhbCBmcm9tICdjb21wb25lbnRzL3N0b2NrLW1vdmVtZW50LXdpemFyZC9tb2RhbHMvU3Vic3RpdHV0aW9uc01vZGFsJzsKaW1wb3J0IGFwaUNsaWVudCBmcm9tICd1dGlscy9hcGlDbGllbnQnOwppbXBvcnQgeyByZW5kZXJGb3JtRmllbGQgfSBmcm9tICd1dGlscy9mb3JtLXV0aWxzJzsKaW1wb3J0IHsgZm9ybWF0UHJvZHVjdERpc3BsYXlOYW1lLCBzaG93T3V0Ym91bmRFZGl0VmFsaWRhdGlvbkVycm9ycyB9IGZyb20gJ3V0aWxzL2Zvcm0tdmFsdWVzLXV0aWxzJzsKaW1wb3J0IHJlbmRlckhhbmRsaW5nSWNvbnMgZnJvbSAndXRpbHMvcHJvZHVjdC1oYW5kbGluZy1pY29ucyc7CmltcG9ydCBUcmFuc2xhdGUsIHsgdHJhbnNsYXRlV2l0aERlZmF1bHRNZXNzYWdlIH0gZnJvbSAndXRpbHMvVHJhbnNsYXRlJzsKaW1wb3J0ICdyZWFjdC1jb25maXJtLWFsZXJ0L3NyYy9yZWFjdC1jb25maXJtLWFsZXJ0LmNzcyc7CnZhciBCVE5fQ0xBU1NfTUFQUEVSID0gewogIFlFUzogJ2J0biBidG4tb3V0bGluZS1zdWNjZXNzJywKICBOTzogJ2J0biBidG4tb3V0bGluZS1zZWNvbmRhcnknLAogIEVBUkxJRVI6ICdidG4gYnRuLW91dGxpbmUtd2FybmluZycsCiAgSElEREVOOiAnYnRuIGludmlzaWJsZScKfTsKdmFyIEFEX0hPQ0tfRklFTERTID0gewogIGVkaXRQYWdlSXRlbXM6IHsKICAgIHR5cGU6IEFycmF5RmllbGQsCiAgICBhcnJvd3NOYXZpZ2F0aW9uOiB0cnVlLAogICAgdmlydHVhbGl6ZWQ6IHRydWUsCiAgICB0b3RhbENvdW50OiBmdW5jdGlvbiB0b3RhbENvdW50KF9yZWYpIHsKICAgICAgdmFyIF90b3RhbENvdW50ID0gX3JlZi50b3RhbENvdW50OwogICAgICByZXR1cm4gX3RvdGFsQ291bnQ7CiAgICB9LAogICAgaXNSb3dMb2FkZWQ6IGZ1bmN0aW9uIGlzUm93TG9hZGVkKF9yZWYyKSB7CiAgICAgIHZhciBfaXNSb3dMb2FkZWQgPSBfcmVmMi5pc1Jvd0xvYWRlZDsKICAgICAgcmV0dXJuIF9pc1Jvd0xvYWRlZDsKICAgIH0sCiAgICBpc0ZpcnN0UGFnZUxvYWRlZDogZnVuY3Rpb24gaXNGaXJzdFBhZ2VMb2FkZWQoX3JlZjMpIHsKICAgICAgdmFyIF9pc0ZpcnN0UGFnZUxvYWRlZCA9IF9yZWYzLmlzRmlyc3RQYWdlTG9hZGVkOwogICAgICByZXR1cm4gX2lzRmlyc3RQYWdlTG9hZGVkOwogICAgfSwKICAgIGxvYWRNb3JlUm93czogZnVuY3Rpb24gbG9hZE1vcmVSb3dzKF9yZWY0KSB7CiAgICAgIHZhciBfbG9hZE1vcmVSb3dzID0gX3JlZjQubG9hZE1vcmVSb3dzOwogICAgICByZXR1cm4gX2xvYWRNb3JlUm93cygpOwogICAgfSwKICAgIHJvd0NvbXBvbmVudDogVGFibGVSb3dXaXRoU3ViZmllbGRzLAogICAgZ2V0RHluYW1pY1Jvd0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNSb3dBdHRyKF9yZWY1KSB7CiAgICAgIHZhciByb3dWYWx1ZXMgPSBfcmVmNS5yb3dWYWx1ZXMsCiAgICAgICAgc2hvd09ubHlFcnJvcmVkSXRlbXMgPSBfcmVmNS5zaG93T25seUVycm9yZWRJdGVtcywKICAgICAgICBpdGVtRmlsdGVyID0gX3JlZjUuaXRlbUZpbHRlcjsKICAgICAgdmFyIGNsYXNzTmFtZSA9IHJvd1ZhbHVlcy5zdGF0dXNDb2RlID09PSAnU1VCU1RJVFVURUQnID8gJ2Nyb3NzZWQtb3V0ICcgOiAnJzsKICAgICAgaWYgKHJvd1ZhbHVlcy5xdWFudGl0eUF2YWlsYWJsZSA8IHJvd1ZhbHVlcy5xdWFudGl0eVJlcXVlc3RlZCkgewogICAgICAgIGNsYXNzTmFtZSArPSAnZm9udC13ZWlnaHQtYm9sZCc7CiAgICAgIH0KICAgICAgdmFyIGZpbHRlck91dEl0ZW1zID0gaXRlbUZpbHRlciAmJiAhKHJvd1ZhbHVlcy5wcm9kdWN0Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhpdGVtRmlsdGVyLnRvTG93ZXJDYXNlKCkpIHx8IHJvd1ZhbHVlcy5wcm9kdWN0Q29kZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGl0ZW1GaWx0ZXIudG9Mb3dlckNhc2UoKSkpOwogICAgICB2YXIgaGlkZVJvdyA9IHNob3dPbmx5RXJyb3JlZEl0ZW1zICYmICFyb3dWYWx1ZXMuaGFzRXJyb3IgfHwgZmlsdGVyT3V0SXRlbXM7CiAgICAgIHJldHVybiB7CiAgICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWUsCiAgICAgICAgaGlkZVJvdzogaGlkZVJvdwogICAgICB9OwogICAgfSwKICAgIHN1YmZpZWxkS2V5OiAnc3Vic3RpdHV0aW9uSXRlbXMnLAogICAgaGVhZGVyR3JvdXBpbmdzOiB7CiAgICAgIHJlcXVlc3RJbmZvcm1hdGlvbjogewogICAgICAgIGxhYmVsOiAncmVhY3QudmVyaWZ5UmVxdWVzdC5yZXF1ZXN0SW5mb3JtYXRpb24ubGFiZWwnLAogICAgICAgIGRlZmF1bHRMYWJlbDogJ1JlcXVlc3QgSW5mb3JtYXRpb24nLAogICAgICAgIGZsZXhXaWR0aDogMC41ICsgMyArIDEgKyAxICsgMSAvLyA9IFN1bSBvZiBmaWVsZHMgZmxleFdpZHRoCiAgICAgIH0sCgogICAgICBhdmFpbGFiaWxpdHk6IHsKICAgICAgICBsYWJlbDogJ3JlYWN0LnZlcmlmeVJlcXVlc3QuYXZhaWxhYmlsaXR5LmxhYmVsJywKICAgICAgICBkZWZhdWx0TGFiZWw6ICdBdmFpbGFiaWxpdHknLAogICAgICAgIGZsZXhXaWR0aDogMSArIDEgKyAxICsgMSAvLyA9IFN1bSBvZiBmaWVsZHMgZmxleFdpZHRoCiAgICAgIH0sCgogICAgICBlZGl0OiB7CiAgICAgICAgbGFiZWw6ICdyZWFjdC52ZXJpZnlSZXF1ZXN0LmVkaXQubGFiZWwnLAogICAgICAgIGRlZmF1bHRMYWJlbDogJ0VkaXQnLAogICAgICAgIGZsZXhXaWR0aDogMSArIDEgKyAxICsgMC41IC8vID0gU3VtIG9mIGZpZWxkcyBmbGV4V2lkdGgKICAgICAgfQogICAgfSwKCiAgICBmaWVsZHM6IHsKICAgICAgcHJvZHVjdENvZGU6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGhlYWRlckFsaWduOiAnbGVmdCcsCiAgICAgICAgZmxleFdpZHRoOiAnMC41JywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjYpIHsKICAgICAgICAgIHZhciBzdWJmaWVsZCA9IF9yZWY2LnN1YmZpZWxkOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiBzdWJmaWVsZCA/ICd0ZXh0LWNlbnRlcicgOiAndGV4dC1sZWZ0IG1sLTEnCiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmNvZGUubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ29kZScsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZQogICAgICAgIH0KICAgICAgfSwKICAgICAgcHJvZHVjdDogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgaGVhZGVyQWxpZ246ICdsZWZ0JywKICAgICAgICBmbGV4V2lkdGg6ICczJywKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucHJvZHVjdE5hbWUubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUHJvZHVjdCBuYW1lJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgdmFyIF92YWx1ZSRkaXNwbGF5TmFtZXMsIF92YWx1ZSRkaXNwbGF5TmFtZXMkZCwgX3ZhbHVlJGRpc3BsYXlOYW1lczI7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUb29sdGlwLCB7CiAgICAgICAgICAgICAgaHRtbDogLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInRleHQtdHJ1bmNhdGUiCiAgICAgICAgICAgICAgfSwgdmFsdWUubmFtZSksCiAgICAgICAgICAgICAgdGhlbWU6ICJkYXJrIiwKICAgICAgICAgICAgICBkaXNhYmxlZDogISgoX3ZhbHVlJGRpc3BsYXlOYW1lcyA9IHZhbHVlLmRpc3BsYXlOYW1lcykgIT09IG51bGwgJiYgX3ZhbHVlJGRpc3BsYXlOYW1lcyAhPT0gdm9pZCAwICYmIF92YWx1ZSRkaXNwbGF5TmFtZXNbImRlZmF1bHQiXSksCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3Atc3RhcnQiCiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogImQtZmxleCBhbGlnbi1pdGVtcy1jZW50ZXIiCiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogInRleHQtdHJ1bmNhdGUiCiAgICAgICAgICAgIH0sIChfdmFsdWUkZGlzcGxheU5hbWVzJGQgPSAoX3ZhbHVlJGRpc3BsYXlOYW1lczIgPSB2YWx1ZS5kaXNwbGF5TmFtZXMpID09PSBudWxsIHx8IF92YWx1ZSRkaXNwbGF5TmFtZXMyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdmFsdWUkZGlzcGxheU5hbWVzMlsiZGVmYXVsdCJdKSAhPT0gbnVsbCAmJiBfdmFsdWUkZGlzcGxheU5hbWVzJGQgIT09IHZvaWQgMCA/IF92YWx1ZSRkaXNwbGF5TmFtZXMkZCA6IHZhbHVlLm5hbWUpLCByZW5kZXJIYW5kbGluZ0ljb25zKHZhbHVlID8gdmFsdWUuaGFuZGxpbmdJY29ucyA6IG51bGwpKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjcpIHsKICAgICAgICAgIHZhciBzdWJmaWVsZCA9IF9yZWY3LnN1YmZpZWxkOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiBzdWJmaWVsZCA/ICd0ZXh0LWNlbnRlcicgOiAndGV4dC1sZWZ0IG1sLTEnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlPbkhhbmRSZXF1ZXN0aW5nOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucmVxdWVzdGVyUXVhbnRpdHlPbkhhbmQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVxdWVzdGVyIFFPSCcsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IHZhbHVlLnRvTG9jYWxlU3RyaW5nKCdlbi1VUycpIDogdmFsdWU7CiAgICAgICAgICB9LAogICAgICAgICAgbnVtYmVyRmllbGQ6IHRydWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5RGVtYW5kUmVxdWVzdGluZzogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnF1YW50aXR5RGVtYW5kLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0RlbWFuZCcsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IHZhbHVlLnRvTG9jYWxlU3RyaW5nKCdlbi1VUycpIDogdmFsdWU7CiAgICAgICAgICB9LAogICAgICAgICAgbnVtYmVyRmllbGQ6IHRydWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiB7CiAgICAgICAgdHlwZTogZnVuY3Rpb24gdHlwZShwYXJhbXMpIHsKICAgICAgICAgIHZhciBmaWVsZE5hbWUgPSBwYXJhbXMuZmllbGROYW1lLAogICAgICAgICAgICB2YWx1ZXMgPSBwYXJhbXMudmFsdWVzOwogICAgICAgICAgdmFyIGZpZWxkTmFtZVBhcnRzID0gXy5zcGxpdChmaWVsZE5hbWUsICcuJyk7CiAgICAgICAgICBpZiAoZmllbGROYW1lUGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgIHZhciByb3dJZHggPSBmaWVsZE5hbWVQYXJ0c1swXTsKICAgICAgICAgICAgdmFyIHJvd1ZhbHVlcyA9IF8uZ2V0KHZhbHVlcywgcm93SWR4KTsKICAgICAgICAgICAgaWYgKHJvd1ZhbHVlcy5jb21tZW50cykgewogICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiZC1mbGV4IGFsaWduLWl0ZW1zLWNlbnRlciIKICAgICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgZmxleDogMSwKICAgICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJzE0cHgnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTGFiZWxGaWVsZCwgcGFyYW1zKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRvb2x0aXAsIHsKICAgICAgICAgICAgICAgIGh0bWw6IHJvd1ZhbHVlcy5jb21tZW50cywKICAgICAgICAgICAgICAgIHRoZW1lOiAidHJhbnNwYXJlbnQiLAogICAgICAgICAgICAgICAgZGVsYXk6ICIxNTAiLAogICAgICAgICAgICAgICAgZHVyYXRpb246ICIyNTAiLAogICAgICAgICAgICAgICAgaGlkZURlbGF5OiAiNTAiCiAgICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zdGlja3ktbm90ZSBwci0yIgogICAgICAgICAgICAgIH0pKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChMYWJlbEZpZWxkLCBwYXJhbXMpOwogICAgICAgIH0sCiAgICAgICAgbGFiZWw6ICdyZWFjdC52ZXJpZnlSZXF1ZXN0LnF1YW50aXR5UmVxdWVzdGVkLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1F0eSBSZXF1ZXN0ZWQnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGZvcm1hdFZhbHVlOiBmdW5jdGlvbiBmb3JtYXRWYWx1ZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgPyB2YWx1ZS50b0xvY2FsZVN0cmluZygnZW4tVVMnKSA6IHZhbHVlOwogICAgICAgICAgfSwKICAgICAgICAgIG51bWJlckZpZWxkOiB0cnVlCiAgICAgICAgfQogICAgICB9LAogICAgICBxdWFudGl0eU9uSGFuZDogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnF1YW50aXR5T25IYW5kLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1FPSCcsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGhlYWRlckNsYXNzTmFtZTogJ2xlZnQtYm9yZGVyJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnF1YW50aXR5T25IYW5kID8gdmFsdWUucXVhbnRpdHlPbkhhbmQudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJykgOiB2YWx1ZS5xdWFudGl0eU9uSGFuZDsKICAgICAgICAgIH0sCiAgICAgICAgICBudW1iZXJGaWVsZDogdHJ1ZSwKICAgICAgICAgIGNsYXNzTmFtZTogJ2xlZnQtYm9yZGVyJwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5hdmFpbGFibGUubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQXZhaWxhYmxlJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY4KSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWY4LmZpZWxkVmFsdWU7CiAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gJyc7CiAgICAgICAgICBpZiAoZmllbGRWYWx1ZSAmJiAoIWZpZWxkVmFsdWUucXVhbnRpdHlBdmFpbGFibGUgfHwgZmllbGRWYWx1ZS5xdWFudGl0eUF2YWlsYWJsZSA8IGZpZWxkVmFsdWUucXVhbnRpdHlSZXF1ZXN0ZWQpKSB7CiAgICAgICAgICAgIGNsYXNzTmFtZSArPSAndGV4dC1kYW5nZXInOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWUKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnF1YW50aXR5QXZhaWxhYmxlID8gdmFsdWUucXVhbnRpdHlBdmFpbGFibGUudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJykgOiB2YWx1ZS5xdWFudGl0eUF2YWlsYWJsZTsKICAgICAgICAgIH0sCiAgICAgICAgICBudW1iZXJGaWVsZDogdHJ1ZQogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlEZW1hbmRGdWxmaWxsaW5nOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGVtYW5kUGVyTW9udGgubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGVtYW5kIHBlciBNb250aCcsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlICE9PSAnMCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b0xvY2FsZVN0cmluZygnZW4tVVMnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuICcwJzsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIG51bWJlckZpZWxkOiB0cnVlCiAgICAgICAgfQogICAgICB9LAogICAgICBkZXRhaWxzQnV0dG9uOiB7CiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmRldGFpbHMubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGV0YWlscycsCiAgICAgICAgdHlwZTogRGV0YWlsc01vZGFsLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGZpZWxkS2V5OiAnJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0aXRsZTogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucGVuZGluZ1JlcXVpc2l0aW9uRGV0YWlscy5sYWJlbCcsCiAgICAgICAgICBkZWZhdWx0VGl0bGVNZXNzYWdlOiAnUGVuZGluZyBSZXF1aXNpdGlvbiBEZXRhaWxzJwogICAgICAgIH0sCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY5KSB7CiAgICAgICAgICB2YXIgX2ZpZWxkVmFsdWUkcHJvZHVjdCwgX2ZpZWxkVmFsdWUkcHJvZHVjdCRkOwogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmOS5maWVsZFZhbHVlLAogICAgICAgICAgICBzdG9ja01vdmVtZW50SWQgPSBfcmVmOS5zdG9ja01vdmVtZW50SWQsCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWY5LnZhbHVlczsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHByb2R1Y3RJZDogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnByb2R1Y3QgJiYgZmllbGRWYWx1ZS5wcm9kdWN0LmlkLAogICAgICAgICAgICBwcm9kdWN0Q29kZTogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnByb2R1Y3QgJiYgZmllbGRWYWx1ZS5wcm9kdWN0LnByb2R1Y3RDb2RlLAogICAgICAgICAgICBwcm9kdWN0TmFtZTogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnByb2R1Y3QgJiYgZmllbGRWYWx1ZS5wcm9kdWN0Lm5hbWUsCiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBmaWVsZFZhbHVlID09PSBudWxsIHx8IGZpZWxkVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfZmllbGRWYWx1ZSRwcm9kdWN0ID0gZmllbGRWYWx1ZS5wcm9kdWN0KSA9PT0gbnVsbCB8fCBfZmllbGRWYWx1ZSRwcm9kdWN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2ZpZWxkVmFsdWUkcHJvZHVjdCRkID0gX2ZpZWxkVmFsdWUkcHJvZHVjdC5kaXNwbGF5TmFtZXMpID09PSBudWxsIHx8IF9maWVsZFZhbHVlJHByb2R1Y3QkZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2ZpZWxkVmFsdWUkcHJvZHVjdCRkWyJkZWZhdWx0Il0sCiAgICAgICAgICAgIG9yaWdpbklkOiB2YWx1ZXMgJiYgdmFsdWVzLm9yaWdpbiAmJiB2YWx1ZXMub3JpZ2luLmlkLAogICAgICAgICAgICBzdG9ja01vdmVtZW50SWQ6IHN0b2NrTW92ZW1lbnRJZCwKICAgICAgICAgICAgcXVhbnRpdHlSZXF1ZXN0ZWQ6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5xdWFudGl0eVJlcXVlc3RlZCwKICAgICAgICAgICAgcXVhbnRpdHlPbkhhbmQ6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5xdWFudGl0eU9uSGFuZCwKICAgICAgICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5xdWFudGl0eUF2YWlsYWJsZSwKICAgICAgICAgICAgYnRuT3BlblRleHQ6ICdyZWFjdC5zdG9ja01vdmVtZW50LmRldGFpbHMubGFiZWwnLAogICAgICAgICAgICBidG5PcGVuRGVmYXVsdFRleHQ6ICdEZXRhaWxzJywKICAgICAgICAgICAgYnRuQ2FuY2VsVGV4dDogJ0Nsb3NlJywKICAgICAgICAgICAgYnRuU2F2ZVN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ25vbmUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJ0bkNvbnRhaW5lckNsYXNzTmFtZTogJ2Zsb2F0LXJpZ2h0JywKICAgICAgICAgICAgYnRuT3BlbkFzSWNvbjogdHJ1ZSwKICAgICAgICAgICAgYnRuT3BlblN0eWxlOiB7CiAgICAgICAgICAgICAgYm9yZGVyOiAnbm9uZScsCiAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYnRuT3Blbkljb246ICdmYS1zZWFyY2gnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgc3Vic3RpdHV0ZUJ1dHRvbjogewogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5zdWJzdGl0dXRpb24ubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU3Vic3RpdHV0aW9uJywKICAgICAgICB0eXBlOiBTdWJzdGl0dXRpb25zTW9kYWwsCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGhlYWRlckNsYXNzTmFtZTogJ2xlZnQtYm9yZGVyJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBjZWxsQ2xhc3NOYW1lOiAnbGVmdC1ib3JkZXInLAogICAgICAgICAgdGl0bGU6ICdyZWFjdC5zdG9ja01vdmVtZW50LnN1YnN0aXR1dGVzLmxhYmVsJywKICAgICAgICAgIGRlZmF1bHRUaXRsZU1lc3NhZ2U6ICdTdWJzdGl0dXRlcycKICAgICAgICB9LAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTApIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjEwLmZpZWxkVmFsdWUsCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjEwLnJvd0luZGV4LAogICAgICAgICAgICBzdG9ja01vdmVtZW50SWQgPSBfcmVmMTAuc3RvY2tNb3ZlbWVudElkLAogICAgICAgICAgICBvblJlc3BvbnNlID0gX3JlZjEwLm9uUmVzcG9uc2UsCiAgICAgICAgICAgIHJldmlzZVJlcXVpc2l0aW9uSXRlbXMgPSBfcmVmMTAucmV2aXNlUmVxdWlzaXRpb25JdGVtcywKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjEwLnZhbHVlcywKICAgICAgICAgICAgcmVhc29uQ29kZXMgPSBfcmVmMTAucmVhc29uQ29kZXMsCiAgICAgICAgICAgIHNob3dPbmx5ID0gX3JlZjEwLnNob3dPbmx5OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25PcGVuOiBmdW5jdGlvbiBvbk9wZW4oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJldmlzZVJlcXVpc2l0aW9uSXRlbXModmFsdWVzKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJvZHVjdENvZGU6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5wcm9kdWN0Q29kZSwKICAgICAgICAgICAgYnRuT3BlblRleHQ6ICJyZWFjdC5zdG9ja01vdmVtZW50LiIuY29uY2F0KGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdWJzdGl0dXRpb25TdGF0dXMsICIubGFiZWwiKSwKICAgICAgICAgICAgYnRuT3BlbkRlZmF1bHRUZXh0OiAiIi5jb25jYXQoZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnN1YnN0aXR1dGlvblN0YXR1cyksCiAgICAgICAgICAgIGJ0bk9wZW5EaXNhYmxlZDogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnN0YXR1c0NvZGUgPT09ICdTVUJTVElUVVRFRCcgfHwgc2hvd09ubHksCiAgICAgICAgICAgIGJ0bk9wZW5DbGFzc05hbWU6IEJUTl9DTEFTU19NQVBQRVJbZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnN1YnN0aXR1dGlvblN0YXR1cyB8fCAnSElEREVOJ10sCiAgICAgICAgICAgIHJvd0luZGV4OiByb3dJbmRleCwKICAgICAgICAgICAgbGluZUl0ZW06IGZpZWxkVmFsdWUsCiAgICAgICAgICAgIHN0b2NrTW92ZW1lbnRJZDogc3RvY2tNb3ZlbWVudElkLAogICAgICAgICAgICBvblJlc3BvbnNlOiBvblJlc3BvbnNlLAogICAgICAgICAgICByZWFzb25Db2RlczogcmVhc29uQ29kZXMKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBxdWFudGl0eVJldmlzZWQ6IHsKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucXVhbnRpdHlSZXZpc2VkLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1F0eSByZXZpc2VkJywKICAgICAgICB0eXBlOiBUZXh0RmllbGQsCiAgICAgICAgZmllbGRLZXk6ICdzdGF0dXNDb2RlJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0eXBlOiAnbnVtYmVyJwogICAgICAgIH0sCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYxMSkgewogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmMTEuZmllbGRWYWx1ZSwKICAgICAgICAgICAgc3ViZmllbGQgPSBfcmVmMTEuc3ViZmllbGQsCiAgICAgICAgICAgIHNob3dPbmx5ID0gX3JlZjExLnNob3dPbmx5LAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMTEudXBkYXRlUm93LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMTEudmFsdWVzLAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYxMS5yb3dJbmRleDsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRpc2FibGVkOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUgPT09ICdTVUJTVElUVVRFRCcgfHwgc3ViZmllbGQgfHwgc2hvd09ubHksCiAgICAgICAgICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICAgICAgICAgIHJldHVybiB1cGRhdGVSb3codmFsdWVzLCByb3dJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICByZWFzb25Db2RlOiB7CiAgICAgICAgdHlwZTogU2VsZWN0RmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnJlYXNvbkNvZGUubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVhc29uIGNvZGUnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGZpZWxkS2V5OiAncXVhbnRpdHlSZXZpc2VkJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjEyKSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYxMi5maWVsZFZhbHVlLAogICAgICAgICAgICBzdWJmaWVsZCA9IF9yZWYxMi5zdWJmaWVsZCwKICAgICAgICAgICAgcmVhc29uQ29kZXMgPSBfcmVmMTIucmVhc29uQ29kZXMsCiAgICAgICAgICAgIHVwZGF0ZVJvdyA9IF9yZWYxMi51cGRhdGVSb3csCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYxMi52YWx1ZXMsCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjEyLnJvd0luZGV4LAogICAgICAgICAgICBzaG93T25seSA9IF9yZWYxMi5zaG93T25seTsKICAgICAgICAgIHZhciBpc1N1YnN0aXR1dGVkID0gZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnN0YXR1c0NvZGUgPT09ICdTVUJTVElUVVRFRCc7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkaXNhYmxlZDogZmllbGRWYWx1ZSA9PT0gbnVsbCB8fCBmaWVsZFZhbHVlID09PSB1bmRlZmluZWQgfHwgc3ViZmllbGQgfHwgaXNTdWJzdGl0dXRlZCB8fCBzaG93T25seSwKICAgICAgICAgICAgb3B0aW9uczogcmVhc29uQ29kZXMsCiAgICAgICAgICAgIHNob3dWYWx1ZVRvb2x0aXA6IHRydWUsCiAgICAgICAgICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICAgICAgICAgIHJldHVybiB1cGRhdGVSb3codmFsdWVzLCByb3dJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICByZXZlcnQ6IHsKICAgICAgICB0eXBlOiBCdXR0b25GaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LmRlZmF1bHQuYnV0dG9uLnVuZG8ubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVW5kbycsCiAgICAgICAgZmxleFdpZHRoOiAnMC41JywKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgYnV0dG9uTGFiZWw6ICdyZWFjdC5kZWZhdWx0LmJ1dHRvbi51bmRvLmxhYmVsJywKICAgICAgICBidXR0b25EZWZhdWx0TWVzc2FnZTogJ1VuZG8nLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMTMpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjEzLmZpZWxkVmFsdWUsCiAgICAgICAgICAgIHJldmVydEl0ZW0gPSBfcmVmMTMucmV2ZXJ0SXRlbSwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjEzLnZhbHVlcywKICAgICAgICAgICAgc2hvd09ubHkgPSBfcmVmMTMuc2hvd09ubHk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvbkNsaWNrOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucmVxdWlzaXRpb25JdGVtSWQgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJldmVydEl0ZW0odmFsdWVzLCBmaWVsZFZhbHVlLnJlcXVpc2l0aW9uSXRlbUlkKTsKICAgICAgICAgICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGlkZGVuOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuc3RhdHVzQ29kZSA/ICFfLmluY2x1ZGVzKFsnQ0hBTkdFRCcsICdDQU5DRUxFRCddLCBmaWVsZFZhbHVlLnN0YXR1c0NvZGUpIDogZmFsc2UsCiAgICAgICAgICAgIGRpc2FibGVkOiBzaG93T25seQogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNsYXNzTmFtZTogJ2J0biBidG4tb3V0bGluZS1kYW5nZXInCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9Owp2YXIgU1RPQ0tMSVNUX0ZJRUxEU19QVVNIX1RZUEUgPSB7CiAgZWRpdFBhZ2VJdGVtczogewogICAgdHlwZTogQXJyYXlGaWVsZCwKICAgIGFycm93c05hdmlnYXRpb246IHRydWUsCiAgICB2aXJ0dWFsaXplZDogdHJ1ZSwKICAgIHRvdGFsQ291bnQ6IGZ1bmN0aW9uIHRvdGFsQ291bnQoX3JlZjE0KSB7CiAgICAgIHZhciBfdG90YWxDb3VudDIgPSBfcmVmMTQudG90YWxDb3VudDsKICAgICAgcmV0dXJuIF90b3RhbENvdW50MjsKICAgIH0sCiAgICBpc1Jvd0xvYWRlZDogZnVuY3Rpb24gaXNSb3dMb2FkZWQoX3JlZjE1KSB7CiAgICAgIHZhciBfaXNSb3dMb2FkZWQyID0gX3JlZjE1LmlzUm93TG9hZGVkOwogICAgICByZXR1cm4gX2lzUm93TG9hZGVkMjsKICAgIH0sCiAgICBpc0ZpcnN0UGFnZUxvYWRlZDogZnVuY3Rpb24gaXNGaXJzdFBhZ2VMb2FkZWQoX3JlZjE2KSB7CiAgICAgIHZhciBfaXNGaXJzdFBhZ2VMb2FkZWQyID0gX3JlZjE2LmlzRmlyc3RQYWdlTG9hZGVkOwogICAgICByZXR1cm4gX2lzRmlyc3RQYWdlTG9hZGVkMjsKICAgIH0sCiAgICBsb2FkTW9yZVJvd3M6IGZ1bmN0aW9uIGxvYWRNb3JlUm93cyhfcmVmMTcpIHsKICAgICAgdmFyIF9sb2FkTW9yZVJvd3MyID0gX3JlZjE3LmxvYWRNb3JlUm93czsKICAgICAgcmV0dXJuIF9sb2FkTW9yZVJvd3MyKCk7CiAgICB9LAogICAgcm93Q29tcG9uZW50OiBUYWJsZVJvd1dpdGhTdWJmaWVsZHMsCiAgICBnZXREeW5hbWljUm93QXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY1Jvd0F0dHIoX3JlZjE4KSB7CiAgICAgIHZhciByb3dWYWx1ZXMgPSBfcmVmMTgucm93VmFsdWVzLAogICAgICAgIHNob3dPbmx5RXJyb3JlZEl0ZW1zID0gX3JlZjE4LnNob3dPbmx5RXJyb3JlZEl0ZW1zLAogICAgICAgIGl0ZW1GaWx0ZXIgPSBfcmVmMTguaXRlbUZpbHRlcjsKICAgICAgdmFyIGNsYXNzTmFtZSA9IHJvd1ZhbHVlcy5zdGF0dXNDb2RlID09PSAnU1VCU1RJVFVURUQnID8gJ2Nyb3NzZWQtb3V0ICcgOiAnJzsKICAgICAgaWYgKHJvd1ZhbHVlcy5xdWFudGl0eUF2YWlsYWJsZSA8IHJvd1ZhbHVlcy5xdWFudGl0eVJlcXVlc3RlZCkgewogICAgICAgIGNsYXNzTmFtZSArPSAnZm9udC13ZWlnaHQtYm9sZCc7CiAgICAgIH0KICAgICAgdmFyIGZpbHRlck91dEl0ZW1zID0gaXRlbUZpbHRlciAmJiAhKHJvd1ZhbHVlcy5wcm9kdWN0Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhpdGVtRmlsdGVyLnRvTG93ZXJDYXNlKCkpIHx8IHJvd1ZhbHVlcy5wcm9kdWN0Q29kZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGl0ZW1GaWx0ZXIudG9Mb3dlckNhc2UoKSkpOwogICAgICB2YXIgaGlkZVJvdyA9IHNob3dPbmx5RXJyb3JlZEl0ZW1zICYmICFyb3dWYWx1ZXMuaGFzRXJyb3IgfHwgZmlsdGVyT3V0SXRlbXM7CiAgICAgIHJldHVybiB7CiAgICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWUsCiAgICAgICAgaGlkZVJvdzogaGlkZVJvdwogICAgICB9OwogICAgfSwKICAgIHN1YmZpZWxkS2V5OiAnc3Vic3RpdHV0aW9uSXRlbXMnLAogICAgaGVhZGVyR3JvdXBpbmdzOiB7CiAgICAgIHJlcXVlc3RJbmZvcm1hdGlvbjogewogICAgICAgIGxhYmVsOiAncmVhY3QudmVyaWZ5UmVxdWVzdC5yZXF1ZXN0SW5mb3JtYXRpb24ubGFiZWwnLAogICAgICAgIGRlZmF1bHRMYWJlbDogJ1JlcXVlc3QgSW5mb3JtYXRpb24nLAogICAgICAgIGZsZXhXaWR0aDogMC41ICsgMyArIDEgKyAxICsgMSAvLyA9IFN1bSBvZiBmaWVsZHMgZmxleFdpZHRoCiAgICAgIH0sCgogICAgICBhdmFpbGFiaWxpdHk6IHsKICAgICAgICBsYWJlbDogJ3JlYWN0LnZlcmlmeVJlcXVlc3QuYXZhaWxhYmlsaXR5LmxhYmVsJywKICAgICAgICBkZWZhdWx0TGFiZWw6ICdBdmFpbGFiaWxpdHknLAogICAgICAgIGZsZXhXaWR0aDogMSArIDEgKyAxICsgMSAvLyA9IFN1bSBvZiBmaWVsZHMgZmxleFdpZHRoCiAgICAgIH0sCgogICAgICBlZGl0OiB7CiAgICAgICAgbGFiZWw6ICdyZWFjdC52ZXJpZnlSZXF1ZXN0LmVkaXQubGFiZWwnLAogICAgICAgIGRlZmF1bHRMYWJlbDogJ0VkaXQnLAogICAgICAgIGZsZXhXaWR0aDogMSArIDEgKyAxICsgMC41IC8vID0gU3VtIG9mIGZpZWxkcyBmbGV4V2lkdGgKICAgICAgfQogICAgfSwKCiAgICBmaWVsZHM6IHsKICAgICAgcHJvZHVjdENvZGU6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGhlYWRlckFsaWduOiAnbGVmdCcsCiAgICAgICAgZmxleFdpZHRoOiAnMC41JywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjE5KSB7CiAgICAgICAgICB2YXIgc3ViZmllbGQgPSBfcmVmMTkuc3ViZmllbGQ7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjbGFzc05hbWU6IHN1YmZpZWxkID8gJ3RleHQtY2VudGVyJyA6ICd0ZXh0LWxlZnQgbWwtMScKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29kZS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDb2RlJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBzaG93VmFsdWVUb29sdGlwOiB0cnVlCiAgICAgICAgfQogICAgICB9LAogICAgICBwcm9kdWN0OiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBoZWFkZXJBbGlnbjogJ2xlZnQnLAogICAgICAgIGZsZXhXaWR0aDogJzMnLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5wcm9kdWN0TmFtZS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdQcm9kdWN0IG5hbWUnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGZvcm1hdFZhbHVlOiBmb3JtYXRQcm9kdWN0RGlzcGxheU5hbWUKICAgICAgICB9LAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMjApIHsKICAgICAgICAgIHZhciBfZmllbGRWYWx1ZSRkaXNwbGF5TmE7CiAgICAgICAgICB2YXIgc3ViZmllbGQgPSBfcmVmMjAuc3ViZmllbGQsCiAgICAgICAgICAgIGZpZWxkVmFsdWUgPSBfcmVmMjAuZmllbGRWYWx1ZTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogc3ViZmllbGQgPyAndGV4dC1jZW50ZXInIDogJ3RleHQtbGVmdCBtbC0xJywKICAgICAgICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogISEoZmllbGRWYWx1ZSAhPT0gbnVsbCAmJiBmaWVsZFZhbHVlICE9PSB2b2lkIDAgJiYgKF9maWVsZFZhbHVlJGRpc3BsYXlOYSA9IGZpZWxkVmFsdWUuZGlzcGxheU5hbWVzKSAhPT0gbnVsbCAmJiBfZmllbGRWYWx1ZSRkaXNwbGF5TmEgIT09IHZvaWQgMCAmJiBfZmllbGRWYWx1ZSRkaXNwbGF5TmFbImRlZmF1bHQiXSksCiAgICAgICAgICAgIHRvb2x0aXBWYWx1ZTogZmllbGRWYWx1ZSA9PT0gbnVsbCB8fCBmaWVsZFZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZFZhbHVlLm5hbWUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBxdWFudGl0eU9uU3RvY2tsaXN0OiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucXVhbnRpdHlPblN0b2NrbGlzdC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTdG9ja2xpc3QgUVRZJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlID8gdmFsdWUudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJykgOiB2YWx1ZTsKICAgICAgICAgIH0sCiAgICAgICAgICBudW1iZXJGaWVsZDogdHJ1ZQogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlPbkhhbmRSZXF1ZXN0aW5nOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucmVxdWVzdGVyUXVhbnRpdHlPbkhhbmQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVxdWVzdGVyIFFPSCcsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IHZhbHVlLnRvTG9jYWxlU3RyaW5nKCdlbi1VUycpIDogdmFsdWU7CiAgICAgICAgICB9LAogICAgICAgICAgbnVtYmVyRmllbGQ6IHRydWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiB7CiAgICAgICAgdHlwZTogZnVuY3Rpb24gdHlwZShwYXJhbXMpIHsKICAgICAgICAgIHZhciBmaWVsZE5hbWUgPSBwYXJhbXMuZmllbGROYW1lLAogICAgICAgICAgICB2YWx1ZXMgPSBwYXJhbXMudmFsdWVzOwogICAgICAgICAgdmFyIGZpZWxkTmFtZVBhcnRzID0gXy5zcGxpdChmaWVsZE5hbWUsICcuJyk7CiAgICAgICAgICBpZiAoZmllbGROYW1lUGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgIHZhciByb3dJZHggPSBmaWVsZE5hbWVQYXJ0c1swXTsKICAgICAgICAgICAgdmFyIHJvd1ZhbHVlcyA9IF8uZ2V0KHZhbHVlcywgcm93SWR4KTsKICAgICAgICAgICAgaWYgKHJvd1ZhbHVlcy5jb21tZW50cykgewogICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiZC1mbGV4IGFsaWduLWl0ZW1zLWNlbnRlciIKICAgICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgZmxleDogMSwKICAgICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJzE0cHgnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTGFiZWxGaWVsZCwgcGFyYW1zKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRvb2x0aXAsIHsKICAgICAgICAgICAgICAgIGh0bWw6IHJvd1ZhbHVlcy5jb21tZW50cywKICAgICAgICAgICAgICAgIHRoZW1lOiAidHJhbnNwYXJlbnQiLAogICAgICAgICAgICAgICAgZGVsYXk6ICIxNTAiLAogICAgICAgICAgICAgICAgZHVyYXRpb246ICIyNTAiLAogICAgICAgICAgICAgICAgaGlkZURlbGF5OiAiNTAiCiAgICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zdGlja3ktbm90ZSBwci0yIgogICAgICAgICAgICAgIH0pKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChMYWJlbEZpZWxkLCBwYXJhbXMpOwogICAgICAgIH0sCiAgICAgICAgbGFiZWw6ICdyZWFjdC52ZXJpZnlSZXF1ZXN0LnF1YW50aXR5UmVxdWVzdGVkLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1F0eSBSZXF1ZXN0ZWQnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGZvcm1hdFZhbHVlOiBmdW5jdGlvbiBmb3JtYXRWYWx1ZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgPyB2YWx1ZS50b0xvY2FsZVN0cmluZygnZW4tVVMnKSA6IHZhbHVlOwogICAgICAgICAgfSwKICAgICAgICAgIG51bWJlckZpZWxkOiB0cnVlCiAgICAgICAgfQogICAgICB9LAogICAgICBxdWFudGl0eU9uSGFuZDogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnF1YW50aXR5T25IYW5kLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1FPSCcsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGhlYWRlckNsYXNzTmFtZTogJ2xlZnQtYm9yZGVyJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnF1YW50aXR5T25IYW5kID8gdmFsdWUucXVhbnRpdHlPbkhhbmQudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJykgOiB2YWx1ZS5xdWFudGl0eU9uSGFuZDsKICAgICAgICAgIH0sCiAgICAgICAgICBudW1iZXJGaWVsZDogdHJ1ZSwKICAgICAgICAgIGNsYXNzTmFtZTogJ2xlZnQtYm9yZGVyJwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5hdmFpbGFibGUubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQXZhaWxhYmxlJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYyMSkgewogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmMjEuZmllbGRWYWx1ZTsKICAgICAgICAgIHZhciBjbGFzc05hbWUgPSAnJzsKICAgICAgICAgIGlmIChmaWVsZFZhbHVlICYmICghZmllbGRWYWx1ZS5xdWFudGl0eUF2YWlsYWJsZSB8fCBmaWVsZFZhbHVlLnF1YW50aXR5QXZhaWxhYmxlIDwgZmllbGRWYWx1ZS5xdWFudGl0eVJlcXVlc3RlZCkpIHsKICAgICAgICAgICAgY2xhc3NOYW1lICs9ICd0ZXh0LWRhbmdlcic7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZQogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGZvcm1hdFZhbHVlOiBmdW5jdGlvbiBmb3JtYXRWYWx1ZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUucXVhbnRpdHlBdmFpbGFibGUgPyB2YWx1ZS5xdWFudGl0eUF2YWlsYWJsZS50b0xvY2FsZVN0cmluZygnZW4tVVMnKSA6IHZhbHVlLnF1YW50aXR5QXZhaWxhYmxlOwogICAgICAgICAgfSwKICAgICAgICAgIG51bWJlckZpZWxkOiB0cnVlCiAgICAgICAgfQogICAgICB9LAogICAgICBxdWFudGl0eURlbWFuZEZ1bGZpbGxpbmc6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5kZW1hbmRQZXJNb250aC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEZW1hbmQgcGVyIE1vbnRoJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWUgIT09ICcwJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnRvTG9jYWxlU3RyaW5nKCdlbi1VUycpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gJzAnOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzaG93VmFsdWVUb29sdGlwOiB0cnVlCiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgbnVtYmVyRmllbGQ6IHRydWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRldGFpbHNCdXR0b246IHsKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGV0YWlscy5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEZXRhaWxzJywKICAgICAgICB0eXBlOiBEZXRhaWxzTW9kYWwsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHRpdGxlOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5wZW5kaW5nUmVxdWlzaXRpb25EZXRhaWxzLmxhYmVsJywKICAgICAgICAgIGRlZmF1bHRUaXRsZU1lc3NhZ2U6ICdQZW5kaW5nIFJlcXVpc2l0aW9uIERldGFpbHMnCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjIyKSB7CiAgICAgICAgICB2YXIgX2ZpZWxkVmFsdWUkcHJvZHVjdDIsIF9maWVsZFZhbHVlJHByb2R1Y3QyJDsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjIyLmZpZWxkVmFsdWUsCiAgICAgICAgICAgIHN0b2NrTW92ZW1lbnRJZCA9IF9yZWYyMi5zdG9ja01vdmVtZW50SWQsCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYyMi52YWx1ZXM7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwcm9kdWN0SWQ6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5wcm9kdWN0ICYmIGZpZWxkVmFsdWUucHJvZHVjdC5pZCwKICAgICAgICAgICAgcHJvZHVjdENvZGU6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5wcm9kdWN0ICYmIGZpZWxkVmFsdWUucHJvZHVjdC5wcm9kdWN0Q29kZSwKICAgICAgICAgICAgcHJvZHVjdE5hbWU6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5wcm9kdWN0ICYmIGZpZWxkVmFsdWUucHJvZHVjdC5uYW1lLAogICAgICAgICAgICBkaXNwbGF5TmFtZTogZmllbGRWYWx1ZSA9PT0gbnVsbCB8fCBmaWVsZFZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2ZpZWxkVmFsdWUkcHJvZHVjdDIgPSBmaWVsZFZhbHVlLnByb2R1Y3QpID09PSBudWxsIHx8IF9maWVsZFZhbHVlJHByb2R1Y3QyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2ZpZWxkVmFsdWUkcHJvZHVjdDIkID0gX2ZpZWxkVmFsdWUkcHJvZHVjdDIuZGlzcGxheU5hbWVzKSA9PT0gbnVsbCB8fCBfZmllbGRWYWx1ZSRwcm9kdWN0MiQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9maWVsZFZhbHVlJHByb2R1Y3QyJFsiZGVmYXVsdCJdLAogICAgICAgICAgICBvcmlnaW5JZDogdmFsdWVzICYmIHZhbHVlcy5vcmlnaW4gJiYgdmFsdWVzLm9yaWdpbi5pZCwKICAgICAgICAgICAgc3RvY2tNb3ZlbWVudElkOiBzdG9ja01vdmVtZW50SWQsCiAgICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucXVhbnRpdHlSZXF1ZXN0ZWQsCiAgICAgICAgICAgIHF1YW50aXR5T25IYW5kOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucXVhbnRpdHlPbkhhbmQsCiAgICAgICAgICAgIHF1YW50aXR5QXZhaWxhYmxlOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucXVhbnRpdHlBdmFpbGFibGUsCiAgICAgICAgICAgIGJ0bk9wZW5UZXh0OiAncmVhY3Quc3RvY2tNb3ZlbWVudC5kZXRhaWxzLmxhYmVsJywKICAgICAgICAgICAgYnRuT3BlbkRlZmF1bHRUZXh0OiAnRGV0YWlscycsCiAgICAgICAgICAgIGJ0bkNhbmNlbFRleHQ6ICdDbG9zZScsCiAgICAgICAgICAgIGJ0blNhdmVTdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJwogICAgICAgICAgICB9LAogICAgICAgICAgICBidG5Db250YWluZXJDbGFzc05hbWU6ICdmbG9hdC1yaWdodCcsCiAgICAgICAgICAgIGJ0bk9wZW5Bc0ljb246IHRydWUsCiAgICAgICAgICAgIGJ0bk9wZW5TdHlsZTogewogICAgICAgICAgICAgIGJvcmRlcjogJ25vbmUnLAogICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJ0bk9wZW5JY29uOiAnZmEtc2VhcmNoJwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHN1YnN0aXR1dGVCdXR0b246IHsKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuc3Vic3RpdHV0aW9uLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1N1YnN0aXR1dGlvbicsCiAgICAgICAgdHlwZTogU3Vic3RpdHV0aW9uc01vZGFsLAogICAgICAgIGZpZWxkS2V5OiAnJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBoZWFkZXJDbGFzc05hbWU6ICdsZWZ0LWJvcmRlcicsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgY2VsbENsYXNzTmFtZTogJ2xlZnQtYm9yZGVyJywKICAgICAgICAgIHRpdGxlOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5zdWJzdGl0dXRlcy5sYWJlbCcsCiAgICAgICAgICBkZWZhdWx0VGl0bGVNZXNzYWdlOiAnU3Vic3RpdHV0ZXMnCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjIzKSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYyMy5maWVsZFZhbHVlLAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYyMy5yb3dJbmRleCwKICAgICAgICAgICAgc3RvY2tNb3ZlbWVudElkID0gX3JlZjIzLnN0b2NrTW92ZW1lbnRJZCwKICAgICAgICAgICAgb25SZXNwb25zZSA9IF9yZWYyMy5vblJlc3BvbnNlLAogICAgICAgICAgICByZXZpc2VSZXF1aXNpdGlvbkl0ZW1zID0gX3JlZjIzLnJldmlzZVJlcXVpc2l0aW9uSXRlbXMsCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYyMy52YWx1ZXMsCiAgICAgICAgICAgIHJlYXNvbkNvZGVzID0gX3JlZjIzLnJlYXNvbkNvZGVzLAogICAgICAgICAgICBzaG93T25seSA9IF9yZWYyMy5zaG93T25seTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24gb25PcGVuKCkgewogICAgICAgICAgICAgIHJldHVybiByZXZpc2VSZXF1aXNpdGlvbkl0ZW1zKHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByb2R1Y3RDb2RlOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucHJvZHVjdENvZGUsCiAgICAgICAgICAgIGJ0bk9wZW5UZXh0OiAicmVhY3Quc3RvY2tNb3ZlbWVudC4iLmNvbmNhdChmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuc3Vic3RpdHV0aW9uU3RhdHVzLCAiLmxhYmVsIiksCiAgICAgICAgICAgIGJ0bk9wZW5EZWZhdWx0VGV4dDogIiIuY29uY2F0KGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdWJzdGl0dXRpb25TdGF0dXMpLAogICAgICAgICAgICBidG5PcGVuRGlzYWJsZWQ6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdGF0dXNDb2RlID09PSAnU1VCU1RJVFVURUQnIHx8IHNob3dPbmx5LAogICAgICAgICAgICBidG5PcGVuQ2xhc3NOYW1lOiBCVE5fQ0xBU1NfTUFQUEVSW2ZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdWJzdGl0dXRpb25TdGF0dXMgfHwgJ0hJRERFTiddLAogICAgICAgICAgICByb3dJbmRleDogcm93SW5kZXgsCiAgICAgICAgICAgIGxpbmVJdGVtOiBmaWVsZFZhbHVlLAogICAgICAgICAgICBzdG9ja01vdmVtZW50SWQ6IHN0b2NrTW92ZW1lbnRJZCwKICAgICAgICAgICAgb25SZXNwb25zZTogb25SZXNwb25zZSwKICAgICAgICAgICAgcmVhc29uQ29kZXM6IHJlYXNvbkNvZGVzCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlSZXZpc2VkOiB7CiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnF1YW50aXR5UmV2aXNlZC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdRdHkgcmV2aXNlZCcsCiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGZpZWxkS2V5OiAnc3RhdHVzQ29kZScsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgdHlwZTogJ251bWJlcicKICAgICAgICB9LAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMjQpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjI0LmZpZWxkVmFsdWUsCiAgICAgICAgICAgIHN1YmZpZWxkID0gX3JlZjI0LnN1YmZpZWxkLAogICAgICAgICAgICBzaG93T25seSA9IF9yZWYyNC5zaG93T25seSwKICAgICAgICAgICAgdXBkYXRlUm93ID0gX3JlZjI0LnVwZGF0ZVJvdywKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjI0LnZhbHVlcywKICAgICAgICAgICAgcm93SW5kZXggPSBfcmVmMjQucm93SW5kZXg7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkaXNhYmxlZDogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlID09PSAnU1VCU1RJVFVURUQnIHx8IHN1YmZpZWxkIHx8IHNob3dPbmx5LAogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlUm93KHZhbHVlcywgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmVhc29uQ29kZTogewogICAgICAgIHR5cGU6IFNlbGVjdEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZWFzb25Db2RlLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1JlYXNvbiBjb2RlJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBmaWVsZEtleTogJ3F1YW50aXR5UmV2aXNlZCcsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYyNSkgewogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmMjUuZmllbGRWYWx1ZSwKICAgICAgICAgICAgc3ViZmllbGQgPSBfcmVmMjUuc3ViZmllbGQsCiAgICAgICAgICAgIHJlYXNvbkNvZGVzID0gX3JlZjI1LnJlYXNvbkNvZGVzLAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMjUudXBkYXRlUm93LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMjUudmFsdWVzLAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYyNS5yb3dJbmRleCwKICAgICAgICAgICAgc2hvd09ubHkgPSBfcmVmMjUuc2hvd09ubHk7CiAgICAgICAgICB2YXIgaXNTdWJzdGl0dXRlZCA9IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdGF0dXNDb2RlID09PSAnU1VCU1RJVFVURUQnOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZGlzYWJsZWQ6IGZpZWxkVmFsdWUgPT09IG51bGwgfHwgZmllbGRWYWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHN1YmZpZWxkIHx8IGlzU3Vic3RpdHV0ZWQgfHwgc2hvd09ubHksCiAgICAgICAgICAgIG9wdGlvbnM6IHJlYXNvbkNvZGVzLAogICAgICAgICAgICBzaG93VmFsdWVUb29sdGlwOiB0cnVlLAogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlUm93KHZhbHVlcywgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmV2ZXJ0OiB7CiAgICAgICAgdHlwZTogQnV0dG9uRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5kZWZhdWx0LmJ1dHRvbi51bmRvLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VuZG8nLAogICAgICAgIGZsZXhXaWR0aDogJzAuNScsCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGJ1dHRvbkxhYmVsOiAncmVhY3QuZGVmYXVsdC5idXR0b24udW5kby5sYWJlbCcsCiAgICAgICAgYnV0dG9uRGVmYXVsdE1lc3NhZ2U6ICdVbmRvJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjI2KSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYyNi5maWVsZFZhbHVlLAogICAgICAgICAgICByZXZlcnRJdGVtID0gX3JlZjI2LnJldmVydEl0ZW0sCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYyNi52YWx1ZXMsCiAgICAgICAgICAgIHNob3dPbmx5ID0gX3JlZjI2LnNob3dPbmx5OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25DbGljazogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnJlcXVpc2l0aW9uSXRlbUlkID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiByZXZlcnRJdGVtKHZhbHVlcywgZmllbGRWYWx1ZS5yZXF1aXNpdGlvbkl0ZW1JZCk7CiAgICAgICAgICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhpZGRlbjogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnN0YXR1c0NvZGUgPyAhXy5pbmNsdWRlcyhbJ0NIQU5HRUQnLCAnQ0FOQ0VMRUQnXSwgZmllbGRWYWx1ZS5zdGF0dXNDb2RlKSA6IGZhbHNlLAogICAgICAgICAgICBkaXNhYmxlZDogc2hvd09ubHkKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBjbGFzc05hbWU6ICdidG4gYnRuLW91dGxpbmUtZGFuZ2VyJwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfTsKdmFyIFNUT0NLTElTVF9GSUVMRFNfUFVMTF9UWVBFID0gewogIGVkaXRQYWdlSXRlbXM6IHsKICAgIHR5cGU6IEFycmF5RmllbGQsCiAgICBhcnJvd3NOYXZpZ2F0aW9uOiB0cnVlLAogICAgdmlydHVhbGl6ZWQ6IHRydWUsCiAgICB0b3RhbENvdW50OiBmdW5jdGlvbiB0b3RhbENvdW50KF9yZWYyNykgewogICAgICB2YXIgX3RvdGFsQ291bnQzID0gX3JlZjI3LnRvdGFsQ291bnQ7CiAgICAgIHJldHVybiBfdG90YWxDb3VudDM7CiAgICB9LAogICAgaXNSb3dMb2FkZWQ6IGZ1bmN0aW9uIGlzUm93TG9hZGVkKF9yZWYyOCkgewogICAgICB2YXIgX2lzUm93TG9hZGVkMyA9IF9yZWYyOC5pc1Jvd0xvYWRlZDsKICAgICAgcmV0dXJuIF9pc1Jvd0xvYWRlZDM7CiAgICB9LAogICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IGZ1bmN0aW9uIGlzRmlyc3RQYWdlTG9hZGVkKF9yZWYyOSkgewogICAgICB2YXIgX2lzRmlyc3RQYWdlTG9hZGVkMyA9IF9yZWYyOS5pc0ZpcnN0UGFnZUxvYWRlZDsKICAgICAgcmV0dXJuIF9pc0ZpcnN0UGFnZUxvYWRlZDM7CiAgICB9LAogICAgbG9hZE1vcmVSb3dzOiBmdW5jdGlvbiBsb2FkTW9yZVJvd3MoX3JlZjMwKSB7CiAgICAgIHZhciBfbG9hZE1vcmVSb3dzMyA9IF9yZWYzMC5sb2FkTW9yZVJvd3M7CiAgICAgIHJldHVybiBfbG9hZE1vcmVSb3dzMygpOwogICAgfSwKICAgIHJvd0NvbXBvbmVudDogVGFibGVSb3dXaXRoU3ViZmllbGRzLAogICAgZ2V0RHluYW1pY1Jvd0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNSb3dBdHRyKF9yZWYzMSkgewogICAgICB2YXIgcm93VmFsdWVzID0gX3JlZjMxLnJvd1ZhbHVlcywKICAgICAgICBzaG93T25seUVycm9yZWRJdGVtcyA9IF9yZWYzMS5zaG93T25seUVycm9yZWRJdGVtcywKICAgICAgICBpdGVtRmlsdGVyID0gX3JlZjMxLml0ZW1GaWx0ZXI7CiAgICAgIHZhciBjbGFzc05hbWUgPSByb3dWYWx1ZXMuc3RhdHVzQ29kZSA9PT0gJ1NVQlNUSVRVVEVEJyA/ICdjcm9zc2VkLW91dCAnIDogJyc7CiAgICAgIGlmIChyb3dWYWx1ZXMucXVhbnRpdHlBdmFpbGFibGUgPCByb3dWYWx1ZXMucXVhbnRpdHlSZXF1ZXN0ZWQpIHsKICAgICAgICBjbGFzc05hbWUgKz0gJ2ZvbnQtd2VpZ2h0LWJvbGQnOwogICAgICB9CiAgICAgIHZhciBmaWx0ZXJPdXRJdGVtcyA9IGl0ZW1GaWx0ZXIgJiYgIShyb3dWYWx1ZXMucHJvZHVjdC5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaXRlbUZpbHRlci50b0xvd2VyQ2FzZSgpKSB8fCByb3dWYWx1ZXMucHJvZHVjdENvZGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhpdGVtRmlsdGVyLnRvTG93ZXJDYXNlKCkpKTsKICAgICAgdmFyIGhpZGVSb3cgPSBzaG93T25seUVycm9yZWRJdGVtcyAmJiAhcm93VmFsdWVzLmhhc0Vycm9yIHx8IGZpbHRlck91dEl0ZW1zOwogICAgICByZXR1cm4gewogICAgICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lLAogICAgICAgIGhpZGVSb3c6IGhpZGVSb3cKICAgICAgfTsKICAgIH0sCiAgICBzdWJmaWVsZEtleTogJ3N1YnN0aXR1dGlvbkl0ZW1zJywKICAgIGhlYWRlckdyb3VwaW5nczogewogICAgICByZXF1ZXN0SW5mb3JtYXRpb246IHsKICAgICAgICBsYWJlbDogJ3JlYWN0LnZlcmlmeVJlcXVlc3QucmVxdWVzdEluZm9ybWF0aW9uLmxhYmVsJywKICAgICAgICBkZWZhdWx0TGFiZWw6ICdSZXF1ZXN0IEluZm9ybWF0aW9uJywKICAgICAgICBmbGV4V2lkdGg6IDAuNSArIDMuNSArIDEgKyAxICsgMSAvLyA9IFN1bSBvZiBmaWVsZHMgZmxleFdpZHRoCiAgICAgIH0sCgogICAgICBhdmFpbGFiaWxpdHk6IHsKICAgICAgICBsYWJlbDogJ3JlYWN0LnZlcmlmeVJlcXVlc3QuYXZhaWxhYmlsaXR5LmxhYmVsJywKICAgICAgICBkZWZhdWx0TGFiZWw6ICdBdmFpbGFiaWxpdHknLAogICAgICAgIGZsZXhXaWR0aDogMSArIDEgKyAxICsgMSAvLyA9IFN1bSBvZiBmaWVsZHMgZmxleFdpZHRoCiAgICAgIH0sCgogICAgICBlZGl0OiB7CiAgICAgICAgbGFiZWw6ICdyZWFjdC52ZXJpZnlSZXF1ZXN0LmVkaXQubGFiZWwnLAogICAgICAgIGRlZmF1bHRMYWJlbDogJ0VkaXQnLAogICAgICAgIGZsZXhXaWR0aDogMSArIDEgKyAxLjUgKyAwLjUgLy8gPSBTdW0gb2YgZmllbGRzIGZsZXhXaWR0aAogICAgICB9CiAgICB9LAoKICAgIGZpZWxkczogewogICAgICBwcm9kdWN0Q29kZTogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgaGVhZGVyQWxpZ246ICdsZWZ0JywKICAgICAgICBmbGV4V2lkdGg6ICcwLjUnLAogICAgICAgIGdldER5bmFtaWNBdHRyOiBmdW5jdGlvbiBnZXREeW5hbWljQXR0cihfcmVmMzIpIHsKICAgICAgICAgIHZhciBzdWJmaWVsZCA9IF9yZWYzMi5zdWJmaWVsZDsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogc3ViZmllbGQgPyAndGV4dC1jZW50ZXInIDogJ3RleHQtbGVmdCBtbC0xJwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5jb2RlLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0NvZGUnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHNob3dWYWx1ZVRvb2x0aXA6IHRydWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHByb2R1Y3Q6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGhlYWRlckFsaWduOiAnbGVmdCcsCiAgICAgICAgZmxleFdpZHRoOiAnMy41JywKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucHJvZHVjdE5hbWUubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUHJvZHVjdCBuYW1lJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZm9ybWF0UHJvZHVjdERpc3BsYXlOYW1lCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjMzKSB7CiAgICAgICAgICB2YXIgX2ZpZWxkVmFsdWUkZGlzcGxheU5hMjsKICAgICAgICAgIHZhciBzdWJmaWVsZCA9IF9yZWYzMy5zdWJmaWVsZCwKICAgICAgICAgICAgZmllbGRWYWx1ZSA9IF9yZWYzMy5maWVsZFZhbHVlOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiBzdWJmaWVsZCA/ICd0ZXh0LWNlbnRlcicgOiAndGV4dC1sZWZ0IG1sLTEnLAogICAgICAgICAgICBzaG93VmFsdWVUb29sdGlwOiAhIShmaWVsZFZhbHVlICE9PSBudWxsICYmIGZpZWxkVmFsdWUgIT09IHZvaWQgMCAmJiAoX2ZpZWxkVmFsdWUkZGlzcGxheU5hMiA9IGZpZWxkVmFsdWUuZGlzcGxheU5hbWVzKSAhPT0gbnVsbCAmJiBfZmllbGRWYWx1ZSRkaXNwbGF5TmEyICE9PSB2b2lkIDAgJiYgX2ZpZWxkVmFsdWUkZGlzcGxheU5hMlsiZGVmYXVsdCJdKSwKICAgICAgICAgICAgdG9vbHRpcFZhbHVlOiBmaWVsZFZhbHVlID09PSBudWxsIHx8IGZpZWxkVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkVmFsdWUubmFtZQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRlbWFuZFBlclJlcGxlbmlzaG1lbnRQZXJpb2Q6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5kZW1hbmRQZXJSZXBsZW5pc2htZW50UGVyaW9kLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0RlbWFuZCBwZXIgUmVwbGVuaXNobWVudCBQZXJpb2QnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGZvcm1hdFZhbHVlOiBmdW5jdGlvbiBmb3JtYXRWYWx1ZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgPyB2YWx1ZS50b0xvY2FsZVN0cmluZygnZW4tVVMnKSA6IHZhbHVlOwogICAgICAgICAgfSwKICAgICAgICAgIG51bWJlckZpZWxkOiB0cnVlCiAgICAgICAgfQogICAgICB9LAogICAgICBxdWFudGl0eU9uSGFuZFJlcXVlc3Rpbmc6IHsKICAgICAgICB0eXBlOiBMYWJlbEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5yZXF1ZXN0ZXJRdWFudGl0eU9uSGFuZC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZXF1ZXN0ZXIgUU9IJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlID8gdmFsdWUudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJykgOiB2YWx1ZTsKICAgICAgICAgIH0sCiAgICAgICAgICBudW1iZXJGaWVsZDogdHJ1ZQogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlSZXF1ZXN0ZWQ6IHsKICAgICAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICAgICAgdmFyIGZpZWxkTmFtZSA9IHBhcmFtcy5maWVsZE5hbWUsCiAgICAgICAgICAgIHZhbHVlcyA9IHBhcmFtcy52YWx1ZXM7CiAgICAgICAgICB2YXIgZmllbGROYW1lUGFydHMgPSBfLnNwbGl0KGZpZWxkTmFtZSwgJy4nKTsKICAgICAgICAgIGlmIChmaWVsZE5hbWVQYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgdmFyIHJvd0lkeCA9IGZpZWxkTmFtZVBhcnRzWzBdOwogICAgICAgICAgICB2YXIgcm93VmFsdWVzID0gXy5nZXQodmFsdWVzLCByb3dJZHgpOwogICAgICAgICAgICBpZiAocm93VmFsdWVzLmNvbW1lbnRzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJkLWZsZXggYWxpZ24taXRlbXMtY2VudGVyIgogICAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICBmbGV4OiAxLAogICAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAnMTRweCcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChMYWJlbEZpZWxkLCBwYXJhbXMpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVG9vbHRpcCwgewogICAgICAgICAgICAgICAgaHRtbDogcm93VmFsdWVzLmNvbW1lbnRzLAogICAgICAgICAgICAgICAgdGhlbWU6ICJ0cmFuc3BhcmVudCIsCiAgICAgICAgICAgICAgICBkZWxheTogIjE1MCIsCiAgICAgICAgICAgICAgICBkdXJhdGlvbjogIjI1MCIsCiAgICAgICAgICAgICAgICBoaWRlRGVsYXk6ICI1MCIKICAgICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXN0aWNreS1ub3RlIHByLTIiCiAgICAgICAgICAgICAgfSkpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KExhYmVsRmllbGQsIHBhcmFtcyk7CiAgICAgICAgfSwKICAgICAgICBsYWJlbDogJ3JlYWN0LnZlcmlmeVJlcXVlc3QucXVhbnRpdHlSZXF1ZXN0ZWQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUXR5IFJlcXVlc3RlZCcsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IHZhbHVlLnRvTG9jYWxlU3RyaW5nKCdlbi1VUycpIDogdmFsdWU7CiAgICAgICAgICB9LAogICAgICAgICAgbnVtYmVyRmllbGQ6IHRydWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5T25IYW5kOiB7CiAgICAgICAgdHlwZTogTGFiZWxGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucXVhbnRpdHlPbkhhbmQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUU9IJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgaGVhZGVyQ2xhc3NOYW1lOiAnbGVmdC1ib3JkZXInLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGZvcm1hdFZhbHVlOiBmdW5jdGlvbiBmb3JtYXRWYWx1ZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUucXVhbnRpdHlPbkhhbmQgPyB2YWx1ZS5xdWFudGl0eU9uSGFuZC50b0xvY2FsZVN0cmluZygnZW4tVVMnKSA6IHZhbHVlLnF1YW50aXR5T25IYW5kOwogICAgICAgICAgfSwKICAgICAgICAgIG51bWJlckZpZWxkOiB0cnVlLAogICAgICAgICAgY2xhc3NOYW1lOiAnbGVmdC1ib3JkZXInCiAgICAgICAgfQogICAgICB9LAogICAgICBxdWFudGl0eUF2YWlsYWJsZTogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmF2YWlsYWJsZS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdBdmFpbGFibGUnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGZpZWxkS2V5OiAnJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjM0KSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYzNC5maWVsZFZhbHVlOwogICAgICAgICAgdmFyIGNsYXNzTmFtZSA9ICcnOwogICAgICAgICAgaWYgKGZpZWxkVmFsdWUgJiYgKCFmaWVsZFZhbHVlLnF1YW50aXR5QXZhaWxhYmxlIHx8IGZpZWxkVmFsdWUucXVhbnRpdHlBdmFpbGFibGUgPCBmaWVsZFZhbHVlLnF1YW50aXR5UmVxdWVzdGVkKSkgewogICAgICAgICAgICBjbGFzc05hbWUgKz0gJ3RleHQtZGFuZ2VyJzsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lCiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5xdWFudGl0eUF2YWlsYWJsZSA/IHZhbHVlLnF1YW50aXR5QXZhaWxhYmxlLnRvTG9jYWxlU3RyaW5nKCdlbi1VUycpIDogdmFsdWUucXVhbnRpdHlBdmFpbGFibGU7CiAgICAgICAgICB9LAogICAgICAgICAgbnVtYmVyRmllbGQ6IHRydWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5RGVtYW5kRnVsZmlsbGluZzogewogICAgICAgIHR5cGU6IExhYmVsRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmRlbWFuZFBlck1vbnRoLmxhYmUnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGVtYW5kIHBlciBNb250aCcsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlICE9PSAnMCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b0xvY2FsZVN0cmluZygnZW4tVVMnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuICcwJzsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIG51bWJlckZpZWxkOiB0cnVlCiAgICAgICAgfQogICAgICB9LAogICAgICBkZXRhaWxzQnV0dG9uOiB7CiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LmRldGFpbHMubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGV0YWlscycsCiAgICAgICAgdHlwZTogRGV0YWlsc01vZGFsLAogICAgICAgIGZpZWxkS2V5OiAnJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0aXRsZTogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucGVuZGluZ1JlcXVpc2l0aW9uRGV0YWlscy5sYWJlbCcsCiAgICAgICAgICBkZWZhdWx0VGl0bGVNZXNzYWdlOiAnUGVuZGluZyBSZXF1aXNpdGlvbiBEZXRhaWxzJwogICAgICAgIH0sCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYzNSkgewogICAgICAgICAgdmFyIF9maWVsZFZhbHVlJHByb2R1Y3QzLCBfZmllbGRWYWx1ZSRwcm9kdWN0MyQ7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYzNS5maWVsZFZhbHVlLAogICAgICAgICAgICBzdG9ja01vdmVtZW50SWQgPSBfcmVmMzUuc3RvY2tNb3ZlbWVudElkLAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMzUudmFsdWVzOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJvZHVjdElkOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucHJvZHVjdCAmJiBmaWVsZFZhbHVlLnByb2R1Y3QuaWQsCiAgICAgICAgICAgIHByb2R1Y3RDb2RlOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucHJvZHVjdCAmJiBmaWVsZFZhbHVlLnByb2R1Y3QucHJvZHVjdENvZGUsCiAgICAgICAgICAgIHByb2R1Y3ROYW1lOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucHJvZHVjdCAmJiBmaWVsZFZhbHVlLnByb2R1Y3QubmFtZSwKICAgICAgICAgICAgZGlzcGxheU5hbWU6IGZpZWxkVmFsdWUgPT09IG51bGwgfHwgZmllbGRWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9maWVsZFZhbHVlJHByb2R1Y3QzID0gZmllbGRWYWx1ZS5wcm9kdWN0KSA9PT0gbnVsbCB8fCBfZmllbGRWYWx1ZSRwcm9kdWN0MyA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9maWVsZFZhbHVlJHByb2R1Y3QzJCA9IF9maWVsZFZhbHVlJHByb2R1Y3QzLmRpc3BsYXlOYW1lcykgPT09IG51bGwgfHwgX2ZpZWxkVmFsdWUkcHJvZHVjdDMkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZmllbGRWYWx1ZSRwcm9kdWN0MyRbImRlZmF1bHQiXSwKICAgICAgICAgICAgb3JpZ2luSWQ6IHZhbHVlcyAmJiB2YWx1ZXMub3JpZ2luICYmIHZhbHVlcy5vcmlnaW4uaWQsCiAgICAgICAgICAgIHN0b2NrTW92ZW1lbnRJZDogc3RvY2tNb3ZlbWVudElkLAogICAgICAgICAgICBxdWFudGl0eVJlcXVlc3RlZDogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnF1YW50aXR5UmVxdWVzdGVkLAogICAgICAgICAgICBxdWFudGl0eU9uSGFuZDogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnF1YW50aXR5T25IYW5kLAogICAgICAgICAgICBxdWFudGl0eUF2YWlsYWJsZTogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnF1YW50aXR5QXZhaWxhYmxlLAogICAgICAgICAgICBidG5PcGVuVGV4dDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZGV0YWlscy5sYWJlbCcsCiAgICAgICAgICAgIGJ0bk9wZW5EZWZhdWx0VGV4dDogJ0RldGFpbHMnLAogICAgICAgICAgICBidG5DYW5jZWxUZXh0OiAnQ2xvc2UnLAogICAgICAgICAgICBidG5TYXZlU3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYnRuQ29udGFpbmVyQ2xhc3NOYW1lOiAnZmxvYXQtcmlnaHQnLAogICAgICAgICAgICBidG5PcGVuQXNJY29uOiB0cnVlLAogICAgICAgICAgICBidG5PcGVuU3R5bGU6IHsKICAgICAgICAgICAgICBib3JkZXI6ICdub25lJywKICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgICAgICB9LAogICAgICAgICAgICBidG5PcGVuSWNvbjogJ2ZhLXNlYXJjaCcKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBzdWJzdGl0dXRlQnV0dG9uOiB7CiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnN1YnN0aXR1dGlvbi5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTdWJzdGl0dXRpb24nLAogICAgICAgIHR5cGU6IFN1YnN0aXR1dGlvbnNNb2RhbCwKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgaGVhZGVyQ2xhc3NOYW1lOiAnbGVmdC1ib3JkZXInLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNlbGxDbGFzc05hbWU6ICdsZWZ0LWJvcmRlcicsCiAgICAgICAgICB0aXRsZTogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuc3Vic3RpdHV0ZXMubGFiZWwnLAogICAgICAgICAgZGVmYXVsdFRpdGxlTWVzc2FnZTogJ1N1YnN0aXR1dGVzJwogICAgICAgIH0sCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYzNikgewogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmMzYuZmllbGRWYWx1ZSwKICAgICAgICAgICAgcm93SW5kZXggPSBfcmVmMzYucm93SW5kZXgsCiAgICAgICAgICAgIHN0b2NrTW92ZW1lbnRJZCA9IF9yZWYzNi5zdG9ja01vdmVtZW50SWQsCiAgICAgICAgICAgIG9uUmVzcG9uc2UgPSBfcmVmMzYub25SZXNwb25zZSwKICAgICAgICAgICAgcmV2aXNlUmVxdWlzaXRpb25JdGVtcyA9IF9yZWYzNi5yZXZpc2VSZXF1aXNpdGlvbkl0ZW1zLAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMzYudmFsdWVzLAogICAgICAgICAgICByZWFzb25Db2RlcyA9IF9yZWYzNi5yZWFzb25Db2RlcywKICAgICAgICAgICAgc2hvd09ubHkgPSBfcmVmMzYuc2hvd09ubHk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvbk9wZW46IGZ1bmN0aW9uIG9uT3BlbigpIHsKICAgICAgICAgICAgICByZXR1cm4gcmV2aXNlUmVxdWlzaXRpb25JdGVtcyh2YWx1ZXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBwcm9kdWN0Q29kZTogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnByb2R1Y3RDb2RlLAogICAgICAgICAgICBidG5PcGVuVGV4dDogInJlYWN0LnN0b2NrTW92ZW1lbnQuIi5jb25jYXQoZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnN1YnN0aXR1dGlvblN0YXR1cywgIi5sYWJlbCIpLAogICAgICAgICAgICBidG5PcGVuRGVmYXVsdFRleHQ6ICIiLmNvbmNhdChmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuc3Vic3RpdHV0aW9uU3RhdHVzKSwKICAgICAgICAgICAgYnRuT3BlbkRpc2FibGVkOiBmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuc3RhdHVzQ29kZSA9PT0gJ1NVQlNUSVRVVEVEJyB8fCBzaG93T25seSwKICAgICAgICAgICAgYnRuT3BlbkNsYXNzTmFtZTogQlROX0NMQVNTX01BUFBFUltmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuc3Vic3RpdHV0aW9uU3RhdHVzIHx8ICdISURERU4nXSwKICAgICAgICAgICAgcm93SW5kZXg6IHJvd0luZGV4LAogICAgICAgICAgICBsaW5lSXRlbTogZmllbGRWYWx1ZSwKICAgICAgICAgICAgc3RvY2tNb3ZlbWVudElkOiBzdG9ja01vdmVtZW50SWQsCiAgICAgICAgICAgIG9uUmVzcG9uc2U6IG9uUmVzcG9uc2UsCiAgICAgICAgICAgIHJlYXNvbkNvZGVzOiByZWFzb25Db2RlcwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5UmV2aXNlZDogewogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5xdWFudGl0eVJldmlzZWQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUXR5IHJldmlzZWQnLAogICAgICAgIHR5cGU6IFRleHRGaWVsZCwKICAgICAgICBmaWVsZEtleTogJ3N0YXR1c0NvZGUnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHR5cGU6ICdudW1iZXInCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjM3KSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYzNy5maWVsZFZhbHVlLAogICAgICAgICAgICBzdWJmaWVsZCA9IF9yZWYzNy5zdWJmaWVsZCwKICAgICAgICAgICAgc2hvd09ubHkgPSBfcmVmMzcuc2hvd09ubHksCiAgICAgICAgICAgIHVwZGF0ZVJvdyA9IF9yZWYzNy51cGRhdGVSb3csCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYzNy52YWx1ZXMsCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjM3LnJvd0luZGV4OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZGlzYWJsZWQ6IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZSA9PT0gJ1NVQlNUSVRVVEVEJyB8fCBzdWJmaWVsZCB8fCBzaG93T25seSwKICAgICAgICAgICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVJvdyh2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJlYXNvbkNvZGU6IHsKICAgICAgICB0eXBlOiBTZWxlY3RGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucmVhc29uQ29kZS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZWFzb24gY29kZScsCiAgICAgICAgZmxleFdpZHRoOiAnMS41JywKICAgICAgICBmaWVsZEtleTogJ3F1YW50aXR5UmV2aXNlZCcsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYzOCkgewogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmMzguZmllbGRWYWx1ZSwKICAgICAgICAgICAgc3ViZmllbGQgPSBfcmVmMzguc3ViZmllbGQsCiAgICAgICAgICAgIHJlYXNvbkNvZGVzID0gX3JlZjM4LnJlYXNvbkNvZGVzLAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMzgudXBkYXRlUm93LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMzgudmFsdWVzLAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWYzOC5yb3dJbmRleCwKICAgICAgICAgICAgc2hvd09ubHkgPSBfcmVmMzguc2hvd09ubHk7CiAgICAgICAgICB2YXIgaXNTdWJzdGl0dXRlZCA9IGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zdGF0dXNDb2RlID09PSAnU1VCU1RJVFVURUQnOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZGlzYWJsZWQ6IGZpZWxkVmFsdWUgPT09IG51bGwgfHwgZmllbGRWYWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHN1YmZpZWxkIHx8IGlzU3Vic3RpdHV0ZWQgfHwgc2hvd09ubHksCiAgICAgICAgICAgIG9wdGlvbnM6IHJlYXNvbkNvZGVzLAogICAgICAgICAgICBzaG93VmFsdWVUb29sdGlwOiB0cnVlLAogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlUm93KHZhbHVlcywgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmV2ZXJ0OiB7CiAgICAgICAgdHlwZTogQnV0dG9uRmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5kZWZhdWx0LmJ1dHRvbi51bmRvLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VuZG8nLAogICAgICAgIGZsZXhXaWR0aDogJzAuNScsCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGJ1dHRvbkxhYmVsOiAncmVhY3QuZGVmYXVsdC5idXR0b24udW5kby5sYWJlbCcsCiAgICAgICAgYnV0dG9uRGVmYXVsdE1lc3NhZ2U6ICdVbmRvJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjM5KSB7CiAgICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IF9yZWYzOS5maWVsZFZhbHVlLAogICAgICAgICAgICByZXZlcnRJdGVtID0gX3JlZjM5LnJldmVydEl0ZW0sCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYzOS52YWx1ZXMsCiAgICAgICAgICAgIHNob3dPbmx5ID0gX3JlZjM5LnNob3dPbmx5OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25DbGljazogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnJlcXVpc2l0aW9uSXRlbUlkID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiByZXZlcnRJdGVtKHZhbHVlcywgZmllbGRWYWx1ZS5yZXF1aXNpdGlvbkl0ZW1JZCk7CiAgICAgICAgICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhpZGRlbjogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnN0YXR1c0NvZGUgPyAhXy5pbmNsdWRlcyhbJ0NIQU5HRUQnLCAnQ0FOQ0VMRUQnXSwgZmllbGRWYWx1ZS5zdGF0dXNDb2RlKSA6IGZhbHNlLAogICAgICAgICAgICBkaXNhYmxlZDogc2hvd09ubHkKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBjbGFzc05hbWU6ICdidG4gYnRuLW91dGxpbmUtZGFuZ2VyJwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfTsKdmFyIFJFUExFTklTSE1FTlRfVFlQRV9QVUxMID0gJ1BVTEwnOwpmdW5jdGlvbiB2YWxpZGF0ZUZvclNhdmUodmFsdWVzKSB7CiAgdmFyIGVycm9ycyA9IHt9OwogIGVycm9ycy5lZGl0UGFnZUl0ZW1zID0gW107CiAgXy5mb3JFYWNoKHZhbHVlcy5lZGl0UGFnZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7CiAgICBpZiAoIV8uaXNFbXB0eShpdGVtLnF1YW50aXR5UmV2aXNlZCkgJiYgXy5pc0VtcHR5KGl0ZW0ucmVhc29uQ29kZSkpIHsKICAgICAgZXJyb3JzLmVkaXRQYWdlSXRlbXNba2V5XSA9IHsKICAgICAgICByZWFzb25Db2RlOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvcnMucmVhc29uQ29kZVJlcXVpcmVkLmxhYmVsJwogICAgICB9OwogICAgfSBlbHNlIGlmIChfLmlzTmlsKGl0ZW0ucXVhbnRpdHlSZXZpc2VkKSAmJiAhXy5pc0VtcHR5KGl0ZW0ucmVhc29uQ29kZSkgJiYgaXRlbS5zdGF0dXNDb2RlICE9PSAnU1VCU1RJVFVURUQnKSB7CiAgICAgIGVycm9ycy5lZGl0UGFnZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgcXVhbnRpdHlSZXZpc2VkOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvcnMucmV2aXNlZFF1YW50aXR5UmVxdWlyZWQubGFiZWwnCiAgICAgIH07CiAgICB9CiAgICBpZiAocGFyc2VJbnQoaXRlbS5xdWFudGl0eVJldmlzZWQsIDEwKSA9PT0gaXRlbS5xdWFudGl0eVJlcXVlc3RlZCkgewogICAgICBlcnJvcnMuZWRpdFBhZ2VJdGVtc1trZXldID0gewogICAgICAgIHF1YW50aXR5UmV2aXNlZDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3JzLnNhbWVSZXZpc2VkUXR5LmxhYmVsJwogICAgICB9OwogICAgfQogICAgaWYgKCFfLmlzRW1wdHkoaXRlbS5xdWFudGl0eVJldmlzZWQpICYmIGl0ZW0ucXVhbnRpdHlBdmFpbGFibGUgPj0gMCAmJiBpdGVtLnF1YW50aXR5UmV2aXNlZCA+IGl0ZW0ucXVhbnRpdHlBdmFpbGFibGUpIHsKICAgICAgZXJyb3JzLmVkaXRQYWdlSXRlbXNba2V5XSA9IHsKICAgICAgICBxdWFudGl0eVJldmlzZWQ6ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9ycy5oaWdoZXJRdHkubGFiZWwnCiAgICAgIH07CiAgICB9CiAgICBpZiAoIV8uaXNFbXB0eShpdGVtLnF1YW50aXR5UmV2aXNlZCkgJiYgaXRlbS5xdWFudGl0eVJldmlzZWQgPCAwKSB7CiAgICAgIGVycm9ycy5lZGl0UGFnZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgcXVhbnRpdHlSZXZpc2VkOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvcnMubmVnYXRpdmVRdHkubGFiZWwnCiAgICAgIH07CiAgICB9CiAgfSk7CiAgcmV0dXJuIGVycm9yczsKfQoKLyoqCiAqIFRoZSB0aGlyZCBzdGVwIG9mIHN0b2NrIG1vdmVtZW50KGZvciBzdG9jayByZXF1ZXN0cykgd2hlcmUgdXNlciBjYW4gc2VlIHRoZQogKiBzdG9jayBhdmFpbGFibGUgYW5kIGFkanVzdCBxdWFudGl0aWVzIG9yIG1ha2Ugc3Vic3RpdHV0aW9ucyBiYXNlZCBvbiB0aGF0IGluZm9ybWF0aW9uLgogKiBvciB2YWxpZGF0ZSB0aGUgY3VycmVudCBzdGF0dXMgb2YgYSByZXF1ZXN0CiAqLwp2YXIgRWRpdEl0ZW1zUGFnZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhFZGl0SXRlbXNQYWdlLCBfQ29tcG9uZW50KTsKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEVkaXRJdGVtc1BhZ2UpOwogIGZ1bmN0aW9uIEVkaXRJdGVtc1BhZ2UocHJvcHMpIHsKICAgIHZhciBfdGhpczsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFZGl0SXRlbXNQYWdlKTsKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpOwogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZGF0YUZldGNoZWQiLCBmYWxzZSk7CiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgc3RhdHVzQ29kZTogJycsCiAgICAgIHJldmlzZWRJdGVtczogW10sCiAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5wcm9wcy5pbml0aWFsVmFsdWVzKSwge30sIHsKICAgICAgICBlZGl0UGFnZUl0ZW1zOiBbXQogICAgICB9KSwKICAgICAgaGFzSXRlbXNMb2FkZWQ6IGZhbHNlLAogICAgICB0b3RhbENvdW50OiAwLAogICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogZmFsc2UsCiAgICAgIHNob3dPbmx5RXJyb3JlZEl0ZW1zOiBmYWxzZSwKICAgICAgaXRlbUZpbHRlcjogJycKICAgIH07CiAgICBfdGhpcy5yZXZlcnRJdGVtID0gX3RoaXMucmV2ZXJ0SXRlbS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmZldGNoRWRpdFBhZ2VJdGVtcyA9IF90aGlzLmZldGNoRWRpdFBhZ2VJdGVtcy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnJldmlzZVJlcXVpc2l0aW9uSXRlbXMgPSBfdGhpcy5yZXZpc2VSZXF1aXNpdGlvbkl0ZW1zLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMuaXNSb3dMb2FkZWQgPSBfdGhpcy5pc1Jvd0xvYWRlZC5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmxvYWRNb3JlUm93cyA9IF90aGlzLmxvYWRNb3JlUm93cy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnVwZGF0ZVJvdyA9IF90aGlzLnVwZGF0ZVJvdy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLm1hcmtFcnJvcmVkTGluZXMgPSBfdGhpcy5tYXJrRXJyb3JlZExpbmVzLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMudmFsaWRhdGUgPSBfdGhpcy52YWxpZGF0ZS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQogIF9jcmVhdGVDbGFzcyhFZGl0SXRlbXNQYWdlLCBbewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICBpZiAodGhpcy5wcm9wcy5zdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZCkgewogICAgICAgIHRoaXMuZGF0YUZldGNoZWQgPSB0cnVlOwogICAgICAgIHRoaXMuZmV0Y2hBbGxEYXRhKGZhbHNlKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7CiAgICAgIGlmIChuZXh0UHJvcHMuc3RvY2tNb3ZlbWVudFRyYW5zbGF0aW9uc0ZldGNoZWQgJiYgIXRoaXMuZGF0YUZldGNoZWQpIHsKICAgICAgICB0aGlzLmRhdGFGZXRjaGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmZldGNoQWxsRGF0YShmYWxzZSk7CiAgICAgIH0KCiAgICAgIC8vIElmIHdlIGNoYW5nZSB0aGUgbGFuZ3VhZ2UsIHJlZmV0Y2ggdGhlIHJlYXNvbiBjb2RlcwogICAgICBpZiAobmV4dFByb3BzLmN1cnJlbnRMb2NhbGUgIT09IHRoaXMucHJvcHMuY3VycmVudExvY2FsZSkgewogICAgICAgIHRoaXMucHJvcHMuZmV0Y2hSZWFzb25Db2RlcygpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0RWRpdFBhZ2VJdGVtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RWRpdFBhZ2VJdGVtcyhyZXNwb25zZSwgc3RhcnRJbmRleCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgdmFyIGVkaXRQYWdlSXRlbXMgPSBfLm1hcChkYXRhLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdmFsKSwge30sIHsKICAgICAgICAgIGRpc2FibGVkOiB0cnVlLAogICAgICAgICAgcXVhbnRpdHlPbkhhbmQ6IHZhbC5xdWFudGl0eU9uSGFuZCA+IDAgPyB2YWwucXVhbnRpdHlPbkhhbmQgOiAwLAogICAgICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IHZhbC5xdWFudGl0eUF2YWlsYWJsZSA+IDAgPyB2YWwucXVhbnRpdHlBdmFpbGFibGUgOiAwLAogICAgICAgICAgcHJvZHVjdDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB2YWwucHJvZHVjdCksIHt9LCB7CiAgICAgICAgICAgIGxhYmVsOiAiIi5jb25jYXQodmFsLnByb2R1Y3RDb2RlLCAiICIpLmNvbmNhdCh2YWwucHJvZHVjdE5hbWUpCiAgICAgICAgICB9KSwKICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuCiAgICAgICAgICByZWFzb25Db2RlOiBfLmZpbmQoX3RoaXMyLnByb3BzLnJlYXNvbkNvZGVzLCBmdW5jdGlvbiAoX3JlZjQwKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9yZWY0MC52YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIF8uaW5jbHVkZXModmFsLnJlYXNvbkNvZGUsIHZhbHVlKTsKICAgICAgICAgIH0pLAogICAgICAgICAgc3Vic3RpdHV0aW9uSXRlbXM6IF8ubWFwKHZhbC5zdWJzdGl0dXRpb25JdGVtcywgZnVuY3Rpb24gKHN1YikgewogICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzdWIpLCB7fSwgewogICAgICAgICAgICAgIHJlcXVpc2l0aW9uSXRlbUlkOiB2YWwucmVxdWlzaXRpb25JdGVtSWQsCiAgICAgICAgICAgICAgcHJvZHVjdDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzdWIucHJvZHVjdCksIHt9LCB7CiAgICAgICAgICAgICAgICBsYWJlbDogIiIuY29uY2F0KHN1Yi5wcm9kdWN0Q29kZSwgIiAiKS5jb25jYXQoc3ViLnByb2R1Y3ROYW1lKQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuCiAgICAgICAgICAgICAgcmVhc29uQ29kZTogXy5maW5kKF90aGlzMi5wcm9wcy5yZWFzb25Db2RlcywgZnVuY3Rpb24gKF9yZWY0MSkgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gX3JlZjQxLnZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuIF8uaW5jbHVkZXModmFsLnJlYXNvbkNvZGUsIHZhbHVlKTsKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICByZXZpc2VkSXRlbXM6IF8uZmlsdGVyKGVkaXRQYWdlSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5zdGF0dXNDb2RlID09PSAnQ0hBTkdFRCc7CiAgICAgICAgfSksCiAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRoaXMuc3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgIGVkaXRQYWdlSXRlbXM6IF8udW5pcUJ5KF8uY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLmVkaXRQYWdlSXRlbXMsIGVkaXRQYWdlSXRlbXMpLCAncmVxdWlzaXRpb25JdGVtSWQnKQogICAgICAgIH0pLAogICAgICAgIGhhc0l0ZW1zTG9hZGVkOiB0aGlzLnN0YXRlLmhhc0l0ZW1zTG9hZGVkIHx8IHRoaXMuc3RhdGUudG90YWxDb3VudCA9PT0gXy51bmlxQnkoXy5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuZWRpdFBhZ2VJdGVtcywgZWRpdFBhZ2VJdGVtcyksICdyZXF1aXNpdGlvbkl0ZW1JZCcpLmxlbmd0aAogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW4KICAgICAgICBpZiAoIV8uaXNOdWxsKHN0YXJ0SW5kZXgpICYmIF90aGlzMi5zdGF0ZS52YWx1ZXMuZWRpdFBhZ2VJdGVtcy5sZW5ndGggIT09IF90aGlzMi5zdGF0ZS50b3RhbENvdW50KSB7CiAgICAgICAgICBfdGhpczIubG9hZE1vcmVSb3dzKHsKICAgICAgICAgICAgc3RhcnRJbmRleDogc3RhcnRJbmRleCArIF90aGlzMi5wcm9wcy5wYWdlU2l6ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIF90aGlzMi5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpZWxkcygpIHsKICAgICAgaWYgKF8uZ2V0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrbGlzdCwgJ2lkJykpIHsKICAgICAgICBpZiAoXy5nZXQodGhpcy5zdGF0ZS52YWx1ZXMucmVwbGVuaXNobWVudFR5cGUsICduYW1lJykgPT09IFJFUExFTklTSE1FTlRfVFlQRV9QVUxMKSB7CiAgICAgICAgICByZXR1cm4gU1RPQ0tMSVNUX0ZJRUxEU19QVUxMX1RZUEU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBTVE9DS0xJU1RfRklFTERTX1BVU0hfVFlQRTsKICAgICAgfQogICAgICByZXR1cm4gQURfSE9DS19GSUVMRFM7CiAgICB9CiAgfSwgewogICAga2V5OiAidmFsaWRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlKHZhbHVlcykgewogICAgICB2YXIgZXJyb3JzID0gdmFsaWRhdGVGb3JTYXZlKHZhbHVlcyk7CiAgICAgIF8uZm9yRWFjaCh2YWx1ZXMuZWRpdFBhZ2VJdGVtcywgZnVuY3Rpb24gKGl0ZW0sIGtleSkgewogICAgICAgIGlmIChfLmlzTmlsKGl0ZW0ucXVhbnRpdHlSZXZpc2VkKSAmJiBpdGVtLnF1YW50aXR5UmVxdWVzdGVkID4gaXRlbS5xdWFudGl0eUF2YWlsYWJsZSAmJiBpdGVtLnN0YXR1c0NvZGUgIT09ICdTVUJTVElUVVRFRCcpIHsKICAgICAgICAgIGVycm9ycy5lZGl0UGFnZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgICAgIHF1YW50aXR5UmV2aXNlZDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3JzLmxvd2VyUXR5LmxhYmVsJwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLm1hcmtFcnJvcmVkTGluZXModmFsdWVzLCBlcnJvcnMpOwogICAgICByZXR1cm4gZXJyb3JzOwogICAgfQogIH0sIHsKICAgIGtleTogIm1hcmtFcnJvcmVkTGluZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1hcmtFcnJvcmVkTGluZXModmFsdWVzLCBlcnJvcnMpIHsKICAgICAgdmFyIHVwZGF0ZWRWYWx1ZXMgPSB2YWx1ZXM7CiAgICAgIF8uZm9yRWFjaCh0aGlzLnN0YXRlLnZhbHVlcy5lZGl0UGFnZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSwgaXRlbUlkeCkgewogICAgICAgIHVwZGF0ZWRWYWx1ZXMgPSB1cGRhdGUodXBkYXRlZFZhbHVlcywgewogICAgICAgICAgZWRpdFBhZ2VJdGVtczogX2RlZmluZVByb3BlcnR5KHt9LCBpdGVtSWR4LCB7CiAgICAgICAgICAgIGhhc0Vycm9yOiB7CiAgICAgICAgICAgICAgJHNldDogISFfLmZpbmQoZXJyb3JzLmVkaXRQYWdlSXRlbXMsIGZ1bmN0aW9uIChlcnJvciwgZXJyb3JJZHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtSWR4ID09PSBlcnJvcklkeDsKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdmFsdWVzOiB1cGRhdGVkVmFsdWVzLAogICAgICAgIHNob3dPbmx5RXJyb3JlZEl0ZW1zOiAhZXJyb3JzLmVkaXRQYWdlSXRlbXMubGVuZ3RoID8gZmFsc2UgOiB0aGlzLnN0YXRlLnNob3dPbmx5RXJyb3JlZEl0ZW1zCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImZldGNoQWxsRGF0YSIsCiAgICB2YWx1ZToKICAgIC8qKgogICAgICogRmV0Y2hlcyBhbGwgcmVxdWlyZWQgZGF0YS4KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gZm9yY2VGZXRjaAogICAgICogQHB1YmxpYwogICAgICovCiAgICBmdW5jdGlvbiBmZXRjaEFsbERhdGEoZm9yY2VGZXRjaCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICAvLyBUT0RPOiBXaGVuIGhhdmluZyBmdWxsIFJlYWN0LCBmZXRjaCBvbmx5IGlmIG5vdCBmZXRjaGVkIHlldCBvciBsYW5ndWFnZSBjaGFuZ2VkCiAgICAgIHRoaXMucHJvcHMuZmV0Y2hSZWFzb25Db2RlcygpOwogICAgICB0aGlzLmZldGNoRWRpdFBhZ2VEYXRhKCkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgIHZhciBzdGF0dXNDb2RlID0gcmVzcC5kYXRhLmRhdGEuc3RhdHVzQ29kZTsKICAgICAgICB2YXIgdG90YWxDb3VudCA9IHJlc3AuZGF0YS50b3RhbENvdW50OwogICAgICAgIF90aGlzMy5zZXRTdGF0ZSh7CiAgICAgICAgICBzdGF0dXNDb2RlOiBzdGF0dXNDb2RlLAogICAgICAgICAgdG90YWxDb3VudDogdG90YWxDb3VudAogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICghX3RoaXMzLnByb3BzLmlzUGFnaW5hdGVkIHx8IGZvcmNlRmV0Y2gpIHsKICAgICAgICAgICAgX3RoaXMzLmZldGNoSXRlbXMoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmZXRjaEl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaEl0ZW1zKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvc3RvY2tNb3ZlbWVudEl0ZW1zP3N0ZXBOdW1iZXI9MyIpOwogICAgICBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczQuc2V0RWRpdFBhZ2VJdGVtcyhyZXNwb25zZSwgbnVsbCk7CiAgICAgICAgX3RoaXM0LnNldFN0YXRlKHsKICAgICAgICAgIGhhc0l0ZW1zTG9hZGVkOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImZldGNoRWRpdFBhZ2VJdGVtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hFZGl0UGFnZUl0ZW1zKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvc3RvY2tNb3ZlbWVudEl0ZW1zP3N0ZXBOdW1iZXI9MyIpOwogICAgICBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICBfdGhpczUuc2V0U3RhdGUoewogICAgICAgICAgaGFzSXRlbXNMb2FkZWQ6IHRydWUsCiAgICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXM1LnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICAgIGVkaXRQYWdlSXRlbXM6IF8ubWFwKGRhdGEsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaXRlbSksIHt9LCB7CiAgICAgICAgICAgICAgICBxdWFudGl0eU9uSGFuZDogaXRlbS5xdWFudGl0eU9uSGFuZCB8fCAwLAogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW4KICAgICAgICAgICAgICAgIHJlYXNvbkNvZGU6IF8uZmluZChfdGhpczUucHJvcHMucmVhc29uQ29kZXMsIGZ1bmN0aW9uIChfcmVmNDIpIHsKICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gX3JlZjQyLnZhbHVlOwogICAgICAgICAgICAgICAgICByZXR1cm4gXy5pbmNsdWRlcyhpdGVtLnJlYXNvbkNvZGUsIHZhbHVlKTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uSXRlbXM6IF8ubWFwKGl0ZW0uc3Vic3RpdHV0aW9uSXRlbXMsIGZ1bmN0aW9uIChzdWIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc3ViKSwge30sIHsKICAgICAgICAgICAgICAgICAgICByZXF1aXNpdGlvbkl0ZW1JZDogaXRlbS5yZXF1aXNpdGlvbkl0ZW1JZCwKICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlbgogICAgICAgICAgICAgICAgICAgIHJlYXNvbkNvZGU6IF8uZmluZChfdGhpczUucHJvcHMucmVhc29uQ29kZXMsIGZ1bmN0aW9uIChfcmVmNDMpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9yZWY0My52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfLmluY2x1ZGVzKGl0ZW0ucmVhc29uQ29kZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgIH0pCiAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXM1LmZldGNoQWxsRGF0YShmYWxzZSk7CiAgICAgICAgICBfdGhpczUucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNS5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJsb2FkTW9yZVJvd3MiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWRNb3JlUm93cyhfcmVmNDQpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CiAgICAgIHZhciBzdGFydEluZGV4ID0gX3JlZjQ0LnN0YXJ0SW5kZXg7CiAgICAgIGlmICh0aGlzLnN0YXRlLnRvdGFsQ291bnQpIHsKICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGlzRmlyc3RQYWdlTG9hZGVkOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvc3RvY2tNb3ZlbWVudEl0ZW1zP29mZnNldD0iKS5jb25jYXQoc3RhcnRJbmRleCwgIiZtYXg9IikuY29uY2F0KHRoaXMucHJvcHMucGFnZVNpemUsICImc3RlcE51bWJlcj0zIik7CiAgICAgICAgYXBpQ2xpZW50LmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczYuc2V0RWRpdFBhZ2VJdGVtcyhyZXNwb25zZSwgc3RhcnRJbmRleCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc1Jvd0xvYWRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNSb3dMb2FkZWQoX3JlZjQ1KSB7CiAgICAgIHZhciBpbmRleCA9IF9yZWY0NS5pbmRleDsKICAgICAgcmV0dXJuICEhdGhpcy5zdGF0ZS52YWx1ZXMuZWRpdFBhZ2VJdGVtc1tpbmRleF07CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kcyBkYXRhIG9mIHJldmlzZWQgaXRlbXMgd2l0aCBwb3N0IG1ldGhvZC4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInJldmlzZVJlcXVpc2l0aW9uSXRlbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJldmlzZVJlcXVpc2l0aW9uSXRlbXModmFsdWVzKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwogICAgICB2YXIgaXRlbXNUb1JldmlzZSA9IF8uZmlsdGVyKHZhbHVlcy5lZGl0UGFnZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlmIChpdGVtLnF1YW50aXR5UmV2aXNlZCAmJiBpdGVtLnJlYXNvbkNvZGUpIHsKICAgICAgICAgIHZhciBvbGRSZXZpc2lvbiA9IF8uZmluZChfdGhpczcuc3RhdGUucmV2aXNlZEl0ZW1zLCBmdW5jdGlvbiAocmV2aXNpb24pIHsKICAgICAgICAgICAgcmV0dXJuIHJldmlzaW9uLnJlcXVpc2l0aW9uSXRlbUlkID09PSBpdGVtLnJlcXVpc2l0aW9uSXRlbUlkOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gXy5pc0VtcHR5KG9sZFJldmlzaW9uKSA/IHRydWUgOiBfLnRvSW50ZWdlcihvbGRSZXZpc2lvbi5xdWFudGl0eVJldmlzZWQpICE9PSBfLnRvSW50ZWdlcihpdGVtLnF1YW50aXR5UmV2aXNlZCkgfHwgb2xkUmV2aXNpb24ucmVhc29uQ29kZSAhPT0gaXRlbS5yZWFzb25Db2RlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0pOwogICAgICB2YXIgdXBkYXRlZFZhbHVlcyA9IHZhbHVlczsKICAgICAgXy5mb3JFYWNoKGl0ZW1zVG9SZXZpc2UsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdmFyIGVkaXRQYWdlSXRlbUluZGV4ID0gXy5maW5kSW5kZXgoX3RoaXM3LnN0YXRlLnZhbHVlcy5lZGl0UGFnZUl0ZW1zLCBmdW5jdGlvbiAoZWRpdFBhZ2VJdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5yZXF1aXNpdGlvbkl0ZW1JZCA9PT0gZWRpdFBhZ2VJdGVtLnJlcXVpc2l0aW9uSXRlbUlkOwogICAgICAgIH0pOwogICAgICAgIHVwZGF0ZWRWYWx1ZXMgPSB1cGRhdGUodXBkYXRlZFZhbHVlcywgewogICAgICAgICAgZWRpdFBhZ2VJdGVtczogX2RlZmluZVByb3BlcnR5KHt9LCBlZGl0UGFnZUl0ZW1JbmRleCwgewogICAgICAgICAgICBzdGF0dXNDb2RlOiB7CiAgICAgICAgICAgICAgJHNldDogJ0NIQU5HRUQnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICB2YWx1ZXM6IHVwZGF0ZWRWYWx1ZXMKICAgICAgfSk7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3JldmlzZUl0ZW1zIik7CiAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIGxpbmVJdGVtczogXy5tYXAoaXRlbXNUb1JldmlzZSwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGlkOiBpdGVtLnJlcXVpc2l0aW9uSXRlbUlkLAogICAgICAgICAgICBxdWFudGl0eVJldmlzZWQ6IGl0ZW0ucXVhbnRpdHlSZXZpc2VkLAogICAgICAgICAgICByZWFzb25Db2RlOiBpdGVtLnJlYXNvbkNvZGUudmFsdWUKICAgICAgICAgIH07CiAgICAgICAgfSkKICAgICAgfTsKICAgICAgaWYgKHBheWxvYWQubGluZUl0ZW1zLmxlbmd0aCkgewogICAgICAgIHJldHVybiBhcGlDbGllbnQucG9zdCh1cmwsIHBheWxvYWQpOwogICAgICB9CiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVSb3ciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVJvdyh2YWx1ZXMsIGluZGV4KSB7CiAgICAgIHZhciBpdGVtID0gdmFsdWVzLmVkaXRQYWdlSXRlbXNbaW5kZXhdOwogICAgICB2YXIgdmFsID0gdmFsdWVzOwogICAgICB2YWwgPSB1cGRhdGUodmFsdWVzLCB7CiAgICAgICAgZWRpdFBhZ2VJdGVtczogX2RlZmluZVByb3BlcnR5KHt9LCBpbmRleCwgewogICAgICAgICAgJHNldDogaXRlbQogICAgICAgIH0pCiAgICAgIH0pOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICB2YWx1ZXM6IHZhbAogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGxpc3Qgb2YgcmVxdWlzaXRpb24gaXRlbXMgaW4gY3VycmVudCBzdGVwICh3aXRob3V0IHN0ZXAgY2hhbmdlKS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmb3JtVmFsdWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlKGZvcm1WYWx1ZXMpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgdmFyIGVycm9ycyA9IHZhbGlkYXRlRm9yU2F2ZShmb3JtVmFsdWVzKS5lZGl0UGFnZUl0ZW1zOwogICAgICBpZiAoZXJyb3JzLmxlbmd0aCkgewogICAgICAgIHNob3dPdXRib3VuZEVkaXRWYWxpZGF0aW9uRXJyb3JzKHsKICAgICAgICAgIHRyYW5zbGF0ZTogdGhpcy5wcm9wcy50cmFuc2xhdGUsCiAgICAgICAgICBlcnJvcnM6IGVycm9ycwogICAgICAgIH0pOwogICAgICAgIHRoaXMucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5yZXZpc2VSZXF1aXNpdGlvbkl0ZW1zKGZvcm1WYWx1ZXMpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAvLyBJZiByZXBvbnNlIDIwMCwgdGhlbiBzYXZlIHJldmlzZSBpdGVtcyB0YWtlbiBmcm9tIHRoZSBwYXlsb2FkCiAgICAgICAgdmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKHJlc3AuY29uZmlnLmRhdGEpOwogICAgICAgIGlmIChwYXlsb2FkLmxpbmVJdGVtcyAmJiBwYXlsb2FkLmxpbmVJdGVtcy5sZW5ndGgpIHsKICAgICAgICAgIHZhciBzYXZlZEl0ZW1JZHMgPSBwYXlsb2FkLmxpbmVJdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0uaWQ7CiAgICAgICAgICB9KTsKICAgICAgICAgIC8vIE1hcCB0byBoYXZlIHRoZSByZXF1aXJlZCBmaWVsZAogICAgICAgICAgLy8gKHJlcXVpc2l0aW9uSXRlbUlkLCBxdWFudGl0eVJldmlzZWQgYW5kIHJlYXNvbkNvZGUgYXMgb2JqKQogICAgICAgICAgdmFyIHNhdmVkSXRlbXMgPSBwYXlsb2FkLmxpbmVJdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaXRlbSksIHt9LCB7CiAgICAgICAgICAgICAgcmVxdWlzaXRpb25JdGVtSWQ6IGl0ZW0uaWQsCiAgICAgICAgICAgICAgcmVhc29uQ29kZTogXy5maW5kKF90aGlzOC5wcm9wcy5yZWFzb25Db2RlcywgZnVuY3Rpb24gKF9yZWY0NikgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gX3JlZjQ2LnZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuIF8uaW5jbHVkZXMoaXRlbS5yZWFzb25Db2RlLCB2YWx1ZSk7CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIC8vIEdldCBvbGQgcmV2aXNlIGl0ZW1zLCB0aGF0IHdlcmUgbm90IGNoYW5nZWQgaW4gdGhpcyByZXF1ZXN0CiAgICAgICAgICB2YXIgb2xkSXRlbXMgPSBfLmZpbHRlcihfdGhpczguc3RhdGUudmFsdWVzLmVkaXRQYWdlSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBzYXZlZEl0ZW1JZHMuaW5kZXhPZihpdGVtLnJlcXVpc2l0aW9uSXRlbUlkKSA8IDA7CiAgICAgICAgICB9KTsKICAgICAgICAgIF90aGlzOC5zZXRTdGF0ZSh7CiAgICAgICAgICAgIHJldmlzZWRJdGVtczogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShvbGRJdGVtcyksIF90b0NvbnN1bWFibGVBcnJheShzYXZlZEl0ZW1zKSkKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBfdGhpczgucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICBBbGVydC5zdWNjZXNzKF90aGlzOC5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuYWxlcnQuc2F2ZVN1Y2Nlc3MubGFiZWwnLCAnQ2hhbmdlcyBzYXZlZCBzdWNjZXNzZnVsbHknKSwgewogICAgICAgICAgdGltZW91dDogMzAwMAogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzOC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmV0Y2ggdGhlIGRhdGEsIGFsbCBub3Qgc2F2ZWQgY2hhbmdlcyB3aWxsIGJlIGxvc3QuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyZWZyZXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQubWVzc2FnZS5jb25maXJtUmVmcmVzaC5sYWJlbCcsICdDb25maXJtIHJlZnJlc2gnKSwKICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUmVmcmVzaC5tZXNzYWdlJywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZWZyZXNoPyBZb3VyIHByb2dyZXNzIHNpbmNlIGxhc3Qgc2F2ZSB3aWxsIGJlIGxvc3QuJyksCiAgICAgICAgYnV0dG9uczogW3sKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC55ZXMubGFiZWwnLCAnWWVzJyksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICBfdGhpczkuc2V0U3RhdGUoewogICAgICAgICAgICAgIHJldmlzZWRJdGVtczogW10sCiAgICAgICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzOS5wcm9wcy5pbml0aWFsVmFsdWVzKSwge30sIHsKICAgICAgICAgICAgICAgIGVkaXRQYWdlSXRlbXM6IFtdCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgaGFzSXRlbXNMb2FkZWQ6IGZhbHNlLAogICAgICAgICAgICAgIHRvdGFsQ291bnQ6IDAsCiAgICAgICAgICAgICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfdGhpczkuZmV0Y2hBbGxEYXRhKHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgfV0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2l0aW9uIHRvIG5leHQgc3RvY2sgbW92ZW1lbnQgc3RhdHVzIChQSUNLSU5HKQogICAgICogYWZ0ZXIgc2VuZGluZyBjcmVhdGVQaWNrbGlzdDogJ3RydWUnIHRvIGJhY2tlbmQgYXV0b3BpY2sgZnVuY3Rpb25hbGl0eSBpcyBpbnZva2VkLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAidHJhbnNpdGlvblRvTmV4dFN0ZXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyYW5zaXRpb25Ub05leHRTdGVwKCkgewogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi9zdGF0dXMiKTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgc3RhdHVzOiAnUElDS0lORycsCiAgICAgICAgY3JlYXRlUGlja2xpc3Q6IHRoaXMuc3RhdGUuc3RhdHVzQ29kZSA9PT0gJ1JFUVVFU1RFRCcgPyAndHJ1ZScgOiAnZmFsc2UnCiAgICAgIH07CiAgICAgIHJldHVybiBhcGlDbGllbnQucG9zdCh1cmwsIHBheWxvYWQpOwogICAgfQoKICAgIC8qKgogICAgICogRmV0Y2hlcyAzcmQgc3RlcCBkYXRhIGZyb20gY3VycmVudCBzdG9jayBtb3ZlbWVudC4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImZldGNoRWRpdFBhZ2VEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaEVkaXRQYWdlRGF0YSgpIHsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICByZXR1cm4gYXBpQ2xpZW50LmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICByZXR1cm4gcmVzcDsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycikgewogICAgICAgIHJldHVybiBlcnI7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgY3VycmVudCBzdG9jayBtb3ZlbWVudCBwcm9ncmVzcyAobGluZSBpdGVtcykgYW5kIGdvZXMgdG8gdGhlIG5leHQgc3RvY2sgbW92ZW1lbnQgc3RlcC4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmb3JtVmFsdWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJuZXh0UGFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbmV4dFBhZ2UoZm9ybVZhbHVlcykgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgdGhpcy5yZXZpc2VSZXF1aXNpdGlvbkl0ZW1zKGZvcm1WYWx1ZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTAudHJhbnNpdGlvblRvTmV4dFN0ZXAoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczEwLnByb3BzLm5leHRQYWdlKGZvcm1WYWx1ZXMpOwogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczEwLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgfSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXMxMC5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGNoYW5nZXMgbWFkZSB3aGVuIGl0ZW0gcmV2ZXJ0ZWQuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZWRpdFBhZ2VJdGVtCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVFZGl0UGFnZUl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZUVkaXRQYWdlSXRlbSh2YWx1ZXMsIGVkaXRQYWdlSXRlbSkgewogICAgICB2YXIgZWRpdFBhZ2VJdGVtSW5kZXggPSBfLmZpbmRJbmRleCh0aGlzLnN0YXRlLnZhbHVlcy5lZGl0UGFnZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnJlcXVpc2l0aW9uSXRlbUlkID09PSBlZGl0UGFnZUl0ZW0ucmVxdWlzaXRpb25JdGVtSWQ7CiAgICAgIH0pOwogICAgICB2YXIgcmV2aXNlZEl0ZW1JbmRleCA9IF8uZmluZEluZGV4KHRoaXMuc3RhdGUucmV2aXNlZEl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnJlcXVpc2l0aW9uSXRlbUlkID09PSBlZGl0UGFnZUl0ZW0ucmVxdWlzaXRpb25JdGVtSWQ7CiAgICAgIH0pOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdmFsdWVzKSwge30sIHsKICAgICAgICAgIGVkaXRQYWdlSXRlbXM6IHVwZGF0ZSh2YWx1ZXMuZWRpdFBhZ2VJdGVtcywgX2RlZmluZVByb3BlcnR5KHt9LCBlZGl0UGFnZUl0ZW1JbmRleCwgewogICAgICAgICAgICAkc2V0OiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdmFsdWVzLmVkaXRQYWdlSXRlbXNbZWRpdFBhZ2VJdGVtSW5kZXhdKSwgZWRpdFBhZ2VJdGVtKSwge30sIHsKICAgICAgICAgICAgICBxdWFudGl0eU9uSGFuZDogZWRpdFBhZ2VJdGVtLnF1YW50aXR5T25IYW5kIHx8IDAsCiAgICAgICAgICAgICAgcXVhbnRpdHlBdmFpbGFibGU6IGVkaXRQYWdlSXRlbS5xdWFudGl0eUF2YWlsYWJsZSB8fCAwLAogICAgICAgICAgICAgIHN1YnN0aXR1dGlvbkl0ZW1zOiBfLm1hcChlZGl0UGFnZUl0ZW0uc3Vic3RpdHV0aW9uSXRlbXMsIGZ1bmN0aW9uIChzdWIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHN1YiksIHt9LCB7CiAgICAgICAgICAgICAgICAgIHJlcXVpc2l0aW9uSXRlbUlkOiBlZGl0UGFnZUl0ZW0ucmVxdWlzaXRpb25JdGVtSWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KSkKICAgICAgICB9KSwKICAgICAgICByZXZpc2VkSXRlbXM6IHVwZGF0ZSh0aGlzLnN0YXRlLnJldmlzZWRJdGVtcywgcmV2aXNlZEl0ZW1JbmRleCA+IC0xID8gewogICAgICAgICAgJHNwbGljZTogW1tyZXZpc2VkSXRlbUluZGV4LCAxXV0KICAgICAgICB9IDoge30pCiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgY2hhbmdlcyBtYWRlIGJ5IHVzZXIgaW4gdGhpcyBzdGVwIGFuZCByZWRpcmVjdHMgdG8gdGhlIHNoaXBtZW50IHZpZXcgcGFnZQogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVBbmRFeGl0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlQW5kRXhpdChmb3JtVmFsdWVzKSB7CiAgICAgIHZhciBlcnJvcnMgPSB2YWxpZGF0ZUZvclNhdmUoZm9ybVZhbHVlcykuZWRpdFBhZ2VJdGVtczsKICAgICAgaWYgKGVycm9ycy5sZW5ndGgpIHsKICAgICAgICBjb25maXJtQWxlcnQoewogICAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1FeGl0LmxhYmVsJywgJ0NvbmZpcm0gc2F2ZScpLAogICAgICAgICAgbWVzc2FnZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybUV4aXQubWVzc2FnZScsICdWYWxpZGF0aW9uIGVycm9ycyBvY2N1cnJlZC4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGV4aXQgYW5kIGxvc2UgdW5zYXZlZCBkYXRhPycpLAogICAgICAgICAgYnV0dG9uczogW3sKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lnllcy5sYWJlbCcsICdZZXMnKSwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAiL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L3Nob3cvIi5jb25jYXQoZm9ybVZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgICB9XQogICAgICAgIH0pOwogICAgICAgIHRoaXMucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJldmlzZVJlcXVpc2l0aW9uSXRlbXMoZm9ybVZhbHVlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAiL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L3Nob3cvIi5jb25jYXQoZm9ybVZhbHVlcy5zdG9ja01vdmVtZW50SWQpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXZlcnRzIHRvIHByZXZpb3VzIHN0YXRlIG9mIHJlcXVpc2l0aW9uIGl0ZW0gKHJldmVydHMgc3Vic3RpdHV0aW9ucyBhbmQgcXVhbnRpdHkgcmV2aXNpb25zKQogICAgICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1JZAogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAicmV2ZXJ0SXRlbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmV2ZXJ0SXRlbSh2YWx1ZXMsIGl0ZW1JZCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgdmFyIHJldmVydEl0ZW1zVXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRJdGVtcy8iLmNvbmNhdChpdGVtSWQsICIvcmV2ZXJ0SXRlbSIpOwogICAgICB2YXIgaXRlbXNVcmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudEl0ZW1zLyIuY29uY2F0KGl0ZW1JZCwgIj9zdGVwTnVtYmVyPTMiKTsKICAgICAgcmV0dXJuIGFwaUNsaWVudC5wb3N0KHJldmVydEl0ZW1zVXJsKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gYXBpQ2xpZW50LmdldChpdGVtc1VybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciBlZGl0UGFnZUl0ZW0gPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICBfdGhpczExLnVwZGF0ZUVkaXRQYWdlSXRlbSh2YWx1ZXMsIGVkaXRQYWdlSXRlbSk7CiAgICAgICAgICBfdGhpczExLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMxMS5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihfdGhpczExLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5yZXZlcnRSZXF1aXNpdGlvbkl0ZW0ubGFiZWwnLCAnQ291bGQgbm90IHJldmVydCByZXF1aXNpdGlvbiBpdGVtcycpKSk7CiAgICAgICAgfSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczExLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihfdGhpczExLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5yZXZlcnRSZXF1aXNpdGlvbkl0ZW0ubGFiZWwnLCAnQ291bGQgbm90IHJldmVydCByZXF1aXNpdGlvbiBpdGVtcycpKSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CiAgICAgIHZhciBfdGhpcyRzdGF0ZSA9IHRoaXMuc3RhdGUsCiAgICAgICAgc2hvd09ubHlFcnJvcmVkSXRlbXMgPSBfdGhpcyRzdGF0ZS5zaG93T25seUVycm9yZWRJdGVtcywKICAgICAgICBpdGVtRmlsdGVyID0gX3RoaXMkc3RhdGUuaXRlbUZpbHRlcjsKICAgICAgdmFyIHNob3dPbmx5ID0gdGhpcy5wcm9wcy5zaG93T25seTsKICAgICAgdmFyIGVycm9yZWRJdGVtc0NvdW50ID0gdGhpcy5zdGF0ZS52YWx1ZXMgJiYgdGhpcy5zdGF0ZS52YWx1ZXMuZWRpdFBhZ2VJdGVtcy5sZW5ndGggPiAwID8gXy5maWx0ZXIodGhpcy5zdGF0ZS52YWx1ZXMuZWRpdFBhZ2VJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5oYXNFcnJvcjsKICAgICAgfSkubGVuZ3RoIDogJzAnOwogICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybSwgewogICAgICAgIG9uU3VibWl0OiBmdW5jdGlvbiBvblN1Ym1pdCgpIHt9LAogICAgICAgIHZhbGlkYXRlOiB0aGlzLnZhbGlkYXRlLAogICAgICAgIG11dGF0b3JzOiBfb2JqZWN0U3ByZWFkKHt9LCBhcnJheU11dGF0b3JzKSwKICAgICAgICBpbml0aWFsVmFsdWVzOiB0aGlzLnN0YXRlLnZhbHVlcywKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihfcmVmNDcpIHsKICAgICAgICAgIHZhciBoYW5kbGVTdWJtaXQgPSBfcmVmNDcuaGFuZGxlU3VibWl0LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmNDcudmFsdWVzLAogICAgICAgICAgICBpbnZhbGlkID0gX3JlZjQ3LmludmFsaWQ7CiAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZC1mbGV4IGZsZXgtY29sdW1uIgogICAgICAgICAgfSwgIXNob3dPbmx5ID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImJ1dHRvbnMtY29udGFpbmVyIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZC1mbGV4IG1yLWF1dG8ganVzdGlmeS1jb250ZW50LWNlbnRlciBhbGlnbi1pdGVtcy1jZW50ZXIiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICAgICAgICAgIHZhbHVlOiBpdGVtRmlsdGVyLAogICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZXZlbnQpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMi5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpdGVtRmlsdGVyOiBldmVudC50YXJnZXQudmFsdWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmxvYXQtbGVmdCBidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGJ0bi14cyBmaWx0ZXItaW5wdXQgbXItMSBtYi0xIiwKICAgICAgICAgICAgcGxhY2Vob2xkZXI6IF90aGlzMTIucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LnNlYXJjaFBsYWNlaG9sZGVyLmxhYmVsJywgJ1NlYXJjaC4uLicpCiAgICAgICAgICB9KSwgaXRlbUZpbHRlciAmJiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgcm9sZTogImJ1dHRvbiIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXRpbWVzLWNpcmNsZSIsCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgY29sb3I6ICdncmV5JywKICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczEyLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGl0ZW1GaWx0ZXI6ICcnCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uS2V5UHJlc3M6IGZ1bmN0aW9uIG9uS2V5UHJlc3MoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTIuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXRlbUZpbHRlcjogJycKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGFiSW5kZXg6IDAKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTIuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgc2hvd09ubHlFcnJvcmVkSXRlbXM6ICFzaG93T25seUVycm9yZWRJdGVtcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgbWwtMyBidG4teHMgIi5jb25jYXQoc2hvd09ubHlFcnJvcmVkSXRlbXMgPyAnYWN0aXZlJyA6ICcnKQogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBlcnJvcmVkSXRlbXNDb3VudCwgIiAiLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yZWRJdGVtc0NvdW50LmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJpdGVtKHMpIHJlcXVpcmUgeW91ciBhdHRlbnRpb24iCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMi5yZWZyZXNoKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBtbC0zIGJ0bi14cyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXJlZnJlc2ggcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5yZWZyZXNoLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJSZWxvYWQiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMi5zYXZlKHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBtbC0zIGJ0bi14cyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXNhdmUgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5zYXZlUHJvZ3Jlc3MubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUgUHJvZ3Jlc3MiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMi5zYXZlQW5kRXhpdCh2YWx1ZXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYWxpZ24tc2VsZi1lbmQgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtc2lnbi1vdXQgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5zYXZlQW5kRXhpdC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSBhbmQgZXhpdCIKICAgICAgICAgIH0pKSkpIDogLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gIV90aGlzMTIucHJvcHMuc3VwcG9ydGVkQWN0aXZpdGllcy5pbmNsdWRlcygnTUFOQUdFX0lOVkVOVE9SWScpICYmIF90aGlzMTIucHJvcHMuc3VwcG9ydGVkQWN0aXZpdGllcy5pbmNsdWRlcygnU1VCTUlUX1JFUVVFU1QnKSA/ICcvb3BlbmJveGVzL2Rhc2hib2FyZCcgOiAnL29wZW5ib3hlcy9zdG9ja01vdmVtZW50L2xpc3Q/ZGlyZWN0aW9uPUlOQk9VTkQnOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1kYW5nZXIgYWxpZ24tc2VsZi1lbmQgYnRuLXhzIG1yLTIiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1zaWduLW91dCBwci0yIgogICAgICAgICAgfSksICIgIiwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uZXhpdC5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRXhpdCIKICAgICAgICAgIH0pLCAiICIpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImZvcm0iLCB7CiAgICAgICAgICAgIG9uU3VibWl0OiBoYW5kbGVTdWJtaXQKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogInRhYmxlLWZvcm0iCiAgICAgICAgICB9LCBfLm1hcChfdGhpczEyLmdldEZpZWxkcygpLCBmdW5jdGlvbiAoZmllbGRDb25maWcsIGZpZWxkTmFtZSkgewogICAgICAgICAgICByZXR1cm4gcmVuZGVyRm9ybUZpZWxkKGZpZWxkQ29uZmlnLCBmaWVsZE5hbWUsIHsKICAgICAgICAgICAgICBzdG9ja01vdmVtZW50SWQ6IHZhbHVlcy5zdG9ja01vdmVtZW50SWQsCiAgICAgICAgICAgICAgaGFzU3RvY2tMaXN0OiAhIV8uZ2V0KHZhbHVlcy5zdG9ja2xpc3QsICdpZCcpLAogICAgICAgICAgICAgIHRyYW5zbGF0ZTogX3RoaXMxMi5wcm9wcy50cmFuc2xhdGUsCiAgICAgICAgICAgICAgcmVhc29uQ29kZXM6IF90aGlzMTIucHJvcHMucmVhc29uQ29kZXMsCiAgICAgICAgICAgICAgb25SZXNwb25zZTogX3RoaXMxMi5mZXRjaEVkaXRQYWdlSXRlbXMsCiAgICAgICAgICAgICAgcmV2ZXJ0SXRlbTogX3RoaXMxMi5yZXZlcnRJdGVtLAogICAgICAgICAgICAgIHJldmlzZVJlcXVpc2l0aW9uSXRlbXM6IF90aGlzMTIucmV2aXNlUmVxdWlzaXRpb25JdGVtcywKICAgICAgICAgICAgICB0b3RhbENvdW50OiBfdGhpczEyLnN0YXRlLnRvdGFsQ291bnQsCiAgICAgICAgICAgICAgbG9hZE1vcmVSb3dzOiBfdGhpczEyLmxvYWRNb3JlUm93cywKICAgICAgICAgICAgICBpc1Jvd0xvYWRlZDogX3RoaXMxMi5pc1Jvd0xvYWRlZCwKICAgICAgICAgICAgICBpc1BhZ2luYXRlZDogX3RoaXMxMi5wcm9wcy5pc1BhZ2luYXRlZCwKICAgICAgICAgICAgICB1cGRhdGVSb3c6IF90aGlzMTIudXBkYXRlUm93LAogICAgICAgICAgICAgIGlzRmlyc3RQYWdlTG9hZGVkOiBfdGhpczEyLnN0YXRlLmlzRmlyc3RQYWdlTG9hZGVkLAogICAgICAgICAgICAgIHZhbHVlczogdmFsdWVzLAogICAgICAgICAgICAgIHNob3dPbmx5OiBzaG93T25seSwKICAgICAgICAgICAgICBzaG93T25seUVycm9yZWRJdGVtczogc2hvd09ubHlFcnJvcmVkSXRlbXMsCiAgICAgICAgICAgICAgaXRlbUZpbHRlcjogaXRlbUZpbHRlcgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAic3VibWl0LWJ1dHRvbnMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgZGlzYWJsZWQ6ICFfdGhpczEyLnN0YXRlLmhhc0l0ZW1zTG9hZGVkIHx8IHNob3dPbmx5IHx8IGludmFsaWQsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgaWYgKCFpbnZhbGlkKSB7CiAgICAgICAgICAgICAgICBfdGhpczEyLm5leHRQYWdlKHZhbHVlcyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtcHJpbWFyeSBidG4tZm9ybSBmbG9hdC1yaWdodCBidG4teHMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5zdG9ja01vdmVtZW50LmJ1dHRvbi5nZW5lcmF0ZVBpY2tsaXN0LmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJHZW5lcmF0ZSBQaWNrbGlzdCIKICAgICAgICAgIH0pKSkpKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH1dKTsKICByZXR1cm4gRWRpdEl0ZW1zUGFnZTsKfShDb21wb25lbnQpOwp2YXIgbWFwU3RhdGVUb1Byb3BzID0gZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKHN0YXRlKSB7CiAgcmV0dXJuIHsKICAgIHJlYXNvbkNvZGVzOiBzdGF0ZS5yZWFzb25Db2Rlcy5kYXRhLAogICAgdHJhbnNsYXRlOiB0cmFuc2xhdGVXaXRoRGVmYXVsdE1lc3NhZ2UoZ2V0VHJhbnNsYXRlKHN0YXRlLmxvY2FsaXplKSksCiAgICBzdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZDogc3RhdGUuc2Vzc2lvbi5mZXRjaGVkVHJhbnNsYXRpb25zLnN0b2NrTW92ZW1lbnQsCiAgICBpc1BhZ2luYXRlZDogc3RhdGUuc2Vzc2lvbi5pc1BhZ2luYXRlZCwKICAgIHBhZ2VTaXplOiBzdGF0ZS5zZXNzaW9uLnBhZ2VTaXplLAogICAgc3VwcG9ydGVkQWN0aXZpdGllczogc3RhdGUuc2Vzc2lvbi5zdXBwb3J0ZWRBY3Rpdml0aWVzLAogICAgY3VycmVudExvY2FsZTogc3RhdGUuc2Vzc2lvbi5hY3RpdmVMYW5ndWFnZQogIH07Cn07CmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzLCB7CiAgZmV0Y2hSZWFzb25Db2RlczogZmV0Y2hSZWFzb25Db2RlcywKICBzaG93U3Bpbm5lcjogc2hvd1NwaW5uZXIsCiAgaGlkZVNwaW5uZXI6IGhpZGVTcGlubmVyCn0pKEVkaXRJdGVtc1BhZ2UpOwpFZGl0SXRlbXNQYWdlLnByb3BUeXBlcyA9IHsKICAvKiogSW5pdGlhbCBjb21wb25lbnQncyBkYXRhICovCiAgaW5pdGlhbFZhbHVlczogUHJvcFR5cGVzLnNoYXBlKHt9KS5pc1JlcXVpcmVkLAogIC8qKgogICAqIEZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSBmb3JtIGRhdGEgd2hlbiB0aGUgaGFuZGxlU3VibWl0KCkKICAgKiBpcyBmaXJlZCBmcm9tIHdpdGhpbiB0aGUgZm9ybSBjb21wb25lbnQuCiAgICovCiAgbmV4dFBhZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGRhdGEgaXMgbG9hZGluZyAqLwogIHNob3dTcGlubmVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiBkYXRhIGhhcyBsb2FkZWQgKi8KICBoaWRlU3Bpbm5lcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAvKiogRnVuY3Rpb24gZmV0Y2hpbmcgcmVhc29uIGNvZGVzICovCiAgZmV0Y2hSZWFzb25Db2RlczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAvKiogQXJyYXkgb2YgYXZhaWxhYmxlIHJlYXNvbiBjb2RlcyAqLwogIHJlYXNvbkNvZGVzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuc2hhcGUoe30pKS5pc1JlcXVpcmVkLAogIHRyYW5zbGF0ZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICBzdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICAvKiogUmV0dXJuIHRydWUgaWYgcGFnaW5hdGlvbiBpcyBlbmFibGVkICovCiAgaXNQYWdpbmF0ZWQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgLyoqIFJldHVybiB0cnVlIGlmIHNob3cgb25seSAqLwogIHNob3dPbmx5OiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLAogIHBhZ2VTaXplOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsCiAgc3VwcG9ydGVkQWN0aXZpdGllczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnN0cmluZykuaXNSZXF1aXJlZCwKICBjdXJyZW50TG9jYWxlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQKfTs="},null]}