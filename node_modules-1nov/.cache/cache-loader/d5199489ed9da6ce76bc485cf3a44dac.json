{"remainingRequest":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js?presets[]=@babel/react&presets[]=@babel/env!/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js!/opt/MTOBS-BIKASH/src/js/components/receiving/PartialReceivingPage.jsx","dependencies":[{"path":"/opt/MTOBS-BIKASH/src/js/components/receiving/PartialReceivingPage.jsx","mtime":1698037749000},{"path":"/opt/MTOBS-BIKASH/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfSwgX3R5cGVvZihvYmopOyB9CmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgeyByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOyB9CmZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7IH0KZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IH0KZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsgdmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTsgaWYgKG51bGwgIT0gX2kpIHsgdmFyIF9zLCBfZSwgX3gsIF9yLCBfYXJyID0gW10sIF9uID0gITAsIF9kID0gITE7IHRyeSB7IGlmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkgeyBpZiAoT2JqZWN0KF9pKSAhPT0gX2kpIHJldHVybjsgX24gPSAhMTsgfSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApIHsgOyB9IH0gY2F0Y2ggKGVycikgeyBfZCA9ICEwLCBfZSA9IGVycjsgfSBmaW5hbGx5IHsgdHJ5IHsgaWYgKCFfbiAmJiBudWxsICE9IF9pWyJyZXR1cm4iXSAmJiAoX3IgPSBfaVsicmV0dXJuIl0oKSwgT2JqZWN0KF9yKSAhPT0gX3IpKSByZXR1cm47IH0gZmluYWxseSB7IGlmIChfZCkgdGhyb3cgX2U7IH0gfSByZXR1cm4gX2FycjsgfSB9CmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsgfQpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgZW51bWVyYWJsZU9ubHkgJiYgKHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KSksIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gbnVsbCAhPSBhcmd1bWVudHNbaV0gPyBhcmd1bWVudHNbaV0gOiB7fTsgaSAlIDIgPyBvd25LZXlzKE9iamVjdChzb3VyY2UpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKSA6IG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gcmV0dXJuIHRhcmdldDsgfQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgX3RvUHJvcGVydHlLZXkoZGVzY3JpcHRvci5rZXkpLCBkZXNjcmlwdG9yKTsgfSB9CmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzdWJDbGFzcywgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQpmdW5jdGlvbiBfY3JlYXRlU3VwZXIoRGVyaXZlZCkgeyB2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKTsgcmV0dXJuIGZ1bmN0aW9uIF9jcmVhdGVTdXBlckludGVybmFsKCkgeyB2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCksIHJlc3VsdDsgaWYgKGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QpIHsgdmFyIE5ld1RhcmdldCA9IF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3RvcjsgcmVzdWx0ID0gUmVmbGVjdC5jb25zdHJ1Y3QoU3VwZXIsIGFyZ3VtZW50cywgTmV3VGFyZ2V0KTsgfSBlbHNlIHsgcmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgcmVzdWx0KTsgfTsgfQpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gZWxzZSBpZiAoY2FsbCAhPT0gdm9pZCAwKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkRlcml2ZWQgY29uc3RydWN0b3JzIG1heSBvbmx5IHJldHVybiBvYmplY3Qgb3IgdW5kZWZpbmVkIik7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQpmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOyBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlOyBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGtleSA9IF90b1Byb3BlcnR5S2V5KGtleSk7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQpmdW5jdGlvbiBfdG9Qcm9wZXJ0eUtleShhcmcpIHsgdmFyIGtleSA9IF90b1ByaW1pdGl2ZShhcmcsICJzdHJpbmciKTsgcmV0dXJuIF90eXBlb2Yoa2V5KSA9PT0gInN5bWJvbCIgPyBrZXkgOiBTdHJpbmcoa2V5KTsgfQpmdW5jdGlvbiBfdG9QcmltaXRpdmUoaW5wdXQsIGhpbnQpIHsgaWYgKF90eXBlb2YoaW5wdXQpICE9PSAib2JqZWN0IiB8fCBpbnB1dCA9PT0gbnVsbCkgcmV0dXJuIGlucHV0OyB2YXIgcHJpbSA9IGlucHV0W1N5bWJvbC50b1ByaW1pdGl2ZV07IGlmIChwcmltICE9PSB1bmRlZmluZWQpIHsgdmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCAiZGVmYXVsdCIpOyBpZiAoX3R5cGVvZihyZXMpICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKTsgfSByZXR1cm4gKGhpbnQgPT09ICJzdHJpbmciID8gU3RyaW5nIDogTnVtYmVyKShpbnB1dCk7IH0KZnVuY3Rpb24gX2V4dGVuZHMoKSB7IF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiA/IE9iamVjdC5hc3NpZ24uYmluZCgpIDogZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07IHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9CmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7CmltcG9ydCBhcnJheU11dGF0b3JzIGZyb20gJ2ZpbmFsLWZvcm0tYXJyYXlzJzsKaW1wb3J0IHVwZGF0ZSBmcm9tICdpbW11dGFiaWxpdHktaGVscGVyJzsKaW1wb3J0IGZpbGVEb3dubG9hZCBmcm9tICdqcy1maWxlLWRvd25sb2FkJzsKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJzsKaW1wb3J0IHsgRm9ybSB9IGZyb20gJ3JlYWN0LWZpbmFsLWZvcm0nOwppbXBvcnQgeyBnZXRUcmFuc2xhdGUgfSBmcm9tICdyZWFjdC1sb2NhbGl6ZS1yZWR1eCc7CmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWFjdC1yZWR1eCc7CmltcG9ydCB7IGhpZGVTcGlubmVyLCBzaG93U3Bpbm5lciB9IGZyb20gJ2FjdGlvbnMnOwppbXBvcnQgQXJyYXlGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvQXJyYXlGaWVsZCc7CmltcG9ydCBMYWJlbEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9MYWJlbEZpZWxkJzsKaW1wb3J0IFNlbGVjdEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9TZWxlY3RGaWVsZCc7CmltcG9ydCBUYWJsZVJvd1dpdGhTdWJmaWVsZHMgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL1RhYmxlUm93V2l0aFN1YmZpZWxkcyc7CmltcG9ydCBUZXh0RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL1RleHRGaWVsZCc7CmltcG9ydCBFZGl0TGluZU1vZGFsIGZyb20gJ2NvbXBvbmVudHMvcmVjZWl2aW5nL21vZGFscy9FZGl0TGluZU1vZGFsJzsKaW1wb3J0IGFwaUNsaWVudCwgeyBmbGF0dGVuUmVxdWVzdCwgcGFyc2VSZXNwb25zZSB9IGZyb20gJ3V0aWxzL2FwaUNsaWVudCc7CmltcG9ydCBDaGVja2JveCBmcm9tICd1dGlscy9DaGVja2JveCc7CmltcG9ydCB7IHJlbmRlckZvcm1GaWVsZCB9IGZyb20gJ3V0aWxzL2Zvcm0tdXRpbHMnOwppbXBvcnQgeyBmb3JtYXRQcm9kdWN0RGlzcGxheU5hbWUsIGdldFJlY2VpdmluZ1BheWxvYWRDb250YWluZXJzIH0gZnJvbSAndXRpbHMvZm9ybS12YWx1ZXMtdXRpbHMnOwppbXBvcnQgU2VsZWN0IGZyb20gJ3V0aWxzL1NlbGVjdCc7CmltcG9ydCBUcmFuc2xhdGUsIHsgdHJhbnNsYXRlV2l0aERlZmF1bHRNZXNzYWdlIH0gZnJvbSAndXRpbHMvVHJhbnNsYXRlJzsKdmFyIGlzUmVjZWl2ZWQgPSBmdW5jdGlvbiBpc1JlY2VpdmVkKHN1YmZpZWxkLCBmaWVsZFZhbHVlKSB7CiAgaWYgKCFmaWVsZFZhbHVlKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmIChmaWVsZFZhbHVlICYmIHN1YmZpZWxkKSB7CiAgICByZXR1cm4gXy50b0ludGVnZXIoZmllbGRWYWx1ZS5xdWFudGl0eVJlY2VpdmVkKSArIF8udG9JbnRlZ2VyKGZpZWxkVmFsdWUucXVhbnRpdHlDYW5jZWxlZCkgPj0gXy50b0ludGVnZXIoZmllbGRWYWx1ZS5xdWFudGl0eVNoaXBwZWQpOwogIH0KICBpZiAoZmllbGRWYWx1ZSAmJiAhZmllbGRWYWx1ZS5zaGlwbWVudEl0ZW1zKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmV0dXJuIF8uZXZlcnkoZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnNoaXBtZW50SXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICByZXR1cm4gXy50b0ludGVnZXIoaXRlbS5xdWFudGl0eVJlY2VpdmVkKSArIF8udG9JbnRlZ2VyKGl0ZW0ucXVhbnRpdHlDYW5jZWxlZCkgPj0gXy50b0ludGVnZXIoaXRlbS5xdWFudGl0eVNoaXBwZWQpOwogIH0pOwp9Owp2YXIgaXNSZWNlaXZpbmcgPSBmdW5jdGlvbiBpc1JlY2VpdmluZyhzdWJmaWVsZCwgZmllbGRWYWx1ZSkgewogIGlmIChzdWJmaWVsZCkgewogICAgcmV0dXJuIGZpZWxkVmFsdWUgJiYgIV8uaXNOaWwoZmllbGRWYWx1ZS5xdWFudGl0eVJlY2VpdmluZykgJiYgZmllbGRWYWx1ZS5xdWFudGl0eVJlY2VpdmluZyAhPT0gJyc7CiAgfQogIGlmICghZmllbGRWYWx1ZS5zaGlwbWVudEl0ZW1zKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHJldHVybiBfLmV2ZXJ5KGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zaGlwbWVudEl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuICFfLmlzTmlsKGl0ZW0ucXVhbnRpdHlSZWNlaXZpbmcpICYmIGl0ZW0ucXVhbnRpdHlSZWNlaXZpbmcgIT09ICcnIHx8IGlzUmVjZWl2ZWQodHJ1ZSwgaXRlbSk7CiAgfSkgJiYgXy5zb21lKGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5zaGlwbWVudEl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuICFfLmlzTmlsKGl0ZW0ucXVhbnRpdHlSZWNlaXZpbmcpICYmIGl0ZW0ucXVhbnRpdHlSZWNlaXZpbmcgIT09ICcnOwogIH0pOwp9Owp2YXIgaXNJbmRldGVybWluYXRlID0gZnVuY3Rpb24gaXNJbmRldGVybWluYXRlKHN1YmZpZWxkLCBmaWVsZFZhbHVlKSB7CiAgaWYgKHN1YmZpZWxkKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmIChmaWVsZFZhbHVlICYmICFmaWVsZFZhbHVlLnNoaXBtZW50SXRlbXMpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuIF8uc29tZShmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUuc2hpcG1lbnRJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgIHJldHVybiAhXy5pc05pbChpdGVtLnF1YW50aXR5UmVjZWl2aW5nKSAmJiBpdGVtLnF1YW50aXR5UmVjZWl2aW5nICE9PSAnJzsKICB9KSAmJiBfLnNvbWUoZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnNoaXBtZW50SXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICByZXR1cm4gKF8uaXNOaWwoaXRlbS5xdWFudGl0eVJlY2VpdmluZykgfHwgaXRlbS5xdWFudGl0eVJlY2VpdmluZyA9PT0gJycpICYmICFpc1JlY2VpdmVkKHRydWUsIGl0ZW0pOwogIH0pOwp9Owp2YXIgaXNBbnlJdGVtU2VsZWN0ZWQgPSBmdW5jdGlvbiBpc0FueUl0ZW1TZWxlY3RlZChjb250YWluZXJzKSB7CiAgaWYgKCFfLnNpemUoY29udGFpbmVycykpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuIF8uc29tZShjb250YWluZXJzLCBmdW5jdGlvbiAoY29udCkgewogICAgcmV0dXJuIF8uc2l6ZShjb250LnNoaXBtZW50SXRlbXMpICYmIF8uc29tZShjb250LnNoaXBtZW50SXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIHJldHVybiAhXy5pc05pbChpdGVtLnF1YW50aXR5UmVjZWl2aW5nKSAmJiBpdGVtLnF1YW50aXR5UmVjZWl2aW5nICE9PSAnJzsKICAgIH0pOwogIH0pOwp9Owp2YXIgVEFCTEVfRklFTERTID0gewogIGNvbnRhaW5lcnM6IHsKICAgIHR5cGU6IEFycmF5RmllbGQsCiAgICBhcnJvd3NOYXZpZ2F0aW9uOiB0cnVlLAogICAgcm93Q29tcG9uZW50OiBUYWJsZVJvd1dpdGhTdWJmaWVsZHMsCiAgICBoZWFkZXJGb250U2l6ZTogJzAuNzc1cmVtJywKICAgIHN1YmZpZWxkS2V5OiAnc2hpcG1lbnRJdGVtcycsCiAgICBnZXREeW5hbWljUm93QXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY1Jvd0F0dHIoX3JlZikgewogICAgICB2YXIgcm93VmFsdWVzID0gX3JlZi5yb3dWYWx1ZXMsCiAgICAgICAgc3ViZmllbGQgPSBfcmVmLnN1YmZpZWxkLAogICAgICAgIHRyYW5zbGF0ZSA9IF9yZWYudHJhbnNsYXRlOwogICAgICB2YXIgY2xhc3NOYW1lID0gJyc7CiAgICAgIHZhciB0b29sdGlwID0gbnVsbDsKICAgICAgdmFyIHJlY2VpdmVkID0gaXNSZWNlaXZlZChzdWJmaWVsZCwgcm93VmFsdWVzKTsKICAgICAgdmFyIHJlY2VpdmluZyA9IGlzUmVjZWl2aW5nKHN1YmZpZWxkLCByb3dWYWx1ZXMpOwogICAgICBpZiAocmVjZWl2ZWQpIHsKICAgICAgICBjbGFzc05hbWUgPSAndGV4dC1kaXNhYmxlZCc7CiAgICAgIH0KICAgICAgaWYgKCFyZWNlaXZlZCAmJiByZWNlaXZpbmcgJiYgcm93VmFsdWVzLnByb2R1Y3QgJiYgcm93VmFsdWVzLnByb2R1Y3QubG90QW5kRXhwaXJ5Q29udHJvbCkgewogICAgICAgIGlmICghcm93VmFsdWVzLmxvdE51bWJlciB8fCAhcm93VmFsdWVzLmV4cGlyYXRpb25EYXRlKSB7CiAgICAgICAgICB0b29sdGlwID0gdHJhbnNsYXRlKCdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLmVycm9yLmxvdEFuZEV4cGlyeUNvbnRyb2wubGFiZWwnKTsKICAgICAgICAgIGNsYXNzTmFtZSArPSAnIGhhcy1jb250cm9sLWVycm9yJzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZSwKICAgICAgICB0b29sdGlwOiB0b29sdGlwCiAgICAgIH07CiAgICB9LAogICAgZmllbGRzOiB7CiAgICAgIGF1dG9maWxsTGluZTogewogICAgICAgIGZpZWxkS2V5OiAnJywKICAgICAgICBsYWJlbDogJycsCiAgICAgICAgZmxleFdpZHRoOiAnMC4xJywKICAgICAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKF9yZWYyKSB7CiAgICAgICAgICB2YXIgc3ViZmllbGQgPSBfcmVmMi5zdWJmaWVsZCwKICAgICAgICAgICAgcGFyZW50SW5kZXggPSBfcmVmMi5wYXJlbnRJbmRleCwKICAgICAgICAgICAgcm93SW5kZXggPSBfcmVmMi5yb3dJbmRleCwKICAgICAgICAgICAgYXV0b2ZpbGxMaW5lcyA9IF9yZWYyLmF1dG9maWxsTGluZXMsCiAgICAgICAgICAgIGZpZWxkVmFsdWUgPSBfcmVmMi5maWVsZFZhbHVlLAogICAgICAgICAgICBzaGlwbWVudFJlY2VpdmVkID0gX3JlZjIuc2hpcG1lbnRSZWNlaXZlZCwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjIudmFsdWVzOwogICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KENoZWNrYm94LCB7CiAgICAgICAgICAgIGRpc2FibGVkOiBzaGlwbWVudFJlY2VpdmVkIHx8IGlzUmVjZWl2ZWQoc3ViZmllbGQsIGZpZWxkVmFsdWUpLAogICAgICAgICAgICBjbGFzc05hbWU6IHN1YmZpZWxkID8gJ21sLTQnIDogJ21yLTQnLAogICAgICAgICAgICB2YWx1ZTogaXNSZWNlaXZpbmcoc3ViZmllbGQsIGZpZWxkVmFsdWUpLAogICAgICAgICAgICBpbmRldGVybWluYXRlOiBpc0luZGV0ZXJtaW5hdGUoc3ViZmllbGQsIGZpZWxkVmFsdWUpLAogICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UodmFsdWUpIHsKICAgICAgICAgICAgICBpZiAoc3ViZmllbGQpIHsKICAgICAgICAgICAgICAgIGF1dG9maWxsTGluZXModmFsdWVzLCAhdmFsdWUsIHBhcmVudEluZGV4LCByb3dJbmRleCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGF1dG9maWxsTGluZXModmFsdWVzLCAhdmFsdWUsIHJvd0luZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgJ3BhcmVudENvbnRhaW5lci5uYW1lJzogewogICAgICAgIGZpZWxkS2V5OiAnJywKICAgICAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICAgICAgcmV0dXJuICFwYXJhbXMuc3ViZmllbGQgPyAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChMYWJlbEZpZWxkLCBwYXJhbXMpIDogbnVsbDsKICAgICAgICB9LAogICAgICAgIGxhYmVsOiAncmVhY3QucGFydGlhbFJlY2VpdmluZy5wYWNrTGV2ZWwxLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1BhY2sgbGV2ZWwgMScsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKGZpZWxkVmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIF8uZ2V0KGZpZWxkVmFsdWUsICdwYXJlbnRDb250YWluZXIubmFtZScpIHx8IF8uZ2V0KGZpZWxkVmFsdWUsICdjb250YWluZXIubmFtZScpIHx8ICdVbnBhY2tlZCc7CiAgICAgICAgICB9LAogICAgICAgICAgc2hvd1ZhbHVlVG9vbHRpcDogdHJ1ZQogICAgICAgIH0KICAgICAgfSwKICAgICAgJ2NvbnRhaW5lci5uYW1lJzogewogICAgICAgIGZpZWxkS2V5OiAnJywKICAgICAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICAgICAgcmV0dXJuICFwYXJhbXMuc3ViZmllbGQgPyAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChMYWJlbEZpZWxkLCBwYXJhbXMpIDogbnVsbDsKICAgICAgICB9LAogICAgICAgIGxhYmVsOiAncmVhY3QucGFydGlhbFJlY2VpdmluZy5wYWNrTGV2ZWwyLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1BhY2sgbGV2ZWwgMicsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgZm9ybWF0VmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFZhbHVlKGZpZWxkVmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIF8uZ2V0KGZpZWxkVmFsdWUsICdwYXJlbnRDb250YWluZXIubmFtZScpID8gXy5nZXQoZmllbGRWYWx1ZSwgJ2NvbnRhaW5lci5uYW1lJykgfHwgJycgOiAnJzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgICdwcm9kdWN0LnByb2R1Y3RDb2RlJzogewogICAgICAgIHR5cGU6IGZ1bmN0aW9uIHR5cGUocGFyYW1zKSB7CiAgICAgICAgICByZXR1cm4gcGFyYW1zLnN1YmZpZWxkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTGFiZWxGaWVsZCwgcGFyYW1zKSA6IG51bGw7CiAgICAgICAgfSwKICAgICAgICBsYWJlbDogJ3JlYWN0LnBhcnRpYWxSZWNlaXZpbmcuY29kZS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDb2RlJywKICAgICAgICBoZWFkZXJBbGlnbjogJ2xlZnQnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNsYXNzTmFtZTogJ3RleHQtbGVmdCBtbC0xJwogICAgICAgIH0KICAgICAgfSwKICAgICAgcHJvZHVjdDogewogICAgICAgIHR5cGU6IGZ1bmN0aW9uIHR5cGUocGFyYW1zKSB7CiAgICAgICAgICByZXR1cm4gcGFyYW1zLnN1YmZpZWxkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTGFiZWxGaWVsZCwgcGFyYW1zKSA6IG51bGw7CiAgICAgICAgfSwKICAgICAgICBsYWJlbDogJ3JlYWN0LnBhcnRpYWxSZWNlaXZpbmcucHJvZHVjdC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdQcm9kdWN0JywKICAgICAgICBoZWFkZXJBbGlnbjogJ2xlZnQnLAogICAgICAgIGZsZXhXaWR0aDogJzQnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNsYXNzTmFtZTogJ3RleHQtbGVmdCBtbC0xJywKICAgICAgICAgIHNob3dWYWx1ZVRvb2x0aXA6IHRydWUsCiAgICAgICAgICBmb3JtYXRWYWx1ZTogZm9ybWF0UHJvZHVjdERpc3BsYXlOYW1lCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjMpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjMuZmllbGRWYWx1ZTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRvb2x0aXBWYWx1ZTogZmllbGRWYWx1ZSA9PT0gbnVsbCB8fCBmaWVsZFZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZFZhbHVlLm5hbWUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBsb3ROdW1iZXI6IHsKICAgICAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICAgICAgcmV0dXJuIHBhcmFtcy5zdWJmaWVsZCA/IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KExhYmVsRmllbGQsIHBhcmFtcykgOiBudWxsOwogICAgICAgIH0sCiAgICAgICAgbGFiZWw6ICdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLmxvdFNlcmlhbE5vLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0xvdC9TZXJpYWwgTm8uJywKICAgICAgICBmbGV4V2lkdGg6ICcxJwogICAgICB9LAogICAgICBleHBpcmF0aW9uRGF0ZTogewogICAgICAgIHR5cGU6IGZ1bmN0aW9uIHR5cGUocGFyYW1zKSB7CiAgICAgICAgICByZXR1cm4gcGFyYW1zLnN1YmZpZWxkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTGFiZWxGaWVsZCwgcGFyYW1zKSA6IG51bGw7CiAgICAgICAgfSwKICAgICAgICBsYWJlbDogJ3JlYWN0LnBhcnRpYWxSZWNlaXZpbmcuZXhwaXJhdGlvbkRhdGUubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRXhwaXJhdGlvbiBkYXRlJywKICAgICAgICBmbGV4V2lkdGg6ICcxJwogICAgICB9LAogICAgICBiaW5Mb2NhdGlvbjogewogICAgICAgIHR5cGU6IGZ1bmN0aW9uIHR5cGUocGFyYW1zKSB7CiAgICAgICAgICByZXR1cm4gcGFyYW1zLnN1YmZpZWxkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoU2VsZWN0RmllbGQsIHBhcmFtcykgOiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChTZWxlY3QsIHsKICAgICAgICAgICAgZGlzYWJsZWQ6ICFwYXJhbXMuaGFzQmluTG9jYXRpb25TdXBwb3J0IHx8IHBhcmFtcy5zaGlwbWVudFJlY2VpdmVkIHx8IGlzUmVjZWl2ZWQoZmFsc2UsIHBhcmFtcy5maWVsZFZhbHVlKSwKICAgICAgICAgICAgb3B0aW9uczogcGFyYW1zLmJpbnMsCiAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZSh2YWx1ZSkgewogICAgICAgICAgICAgIHJldHVybiBwYXJhbXMuc2V0TG9jYXRpb24ocGFyYW1zLnJvd0luZGV4LCB2YWx1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZhbHVlS2V5OiAiaWQiLAogICAgICAgICAgICBsYWJlbEtleTogIm5hbWUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJzZWxlY3QteHMiLAogICAgICAgICAgICBjbGVhcmFibGU6IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGZpZWxkS2V5OiAnJywKICAgICAgICBmbGV4V2lkdGg6ICcyJywKICAgICAgICBsYWJlbDogJ3JlYWN0LnBhcnRpYWxSZWNlaXZpbmcuYmluTG9jYXRpb24ubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQmluIExvY2F0aW9uJywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjQpIHsKICAgICAgICAgIHZhciBiaW5zID0gX3JlZjQuYmlucywKICAgICAgICAgICAgaGFzQmluTG9jYXRpb25TdXBwb3J0ID0gX3JlZjQuaGFzQmluTG9jYXRpb25TdXBwb3J0LAogICAgICAgICAgICBzaGlwbWVudFJlY2VpdmVkID0gX3JlZjQuc2hpcG1lbnRSZWNlaXZlZCwKICAgICAgICAgICAgZmllbGRWYWx1ZSA9IF9yZWY0LmZpZWxkVmFsdWU7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvcHRpb25zOiBiaW5zLAogICAgICAgICAgICBkaXNhYmxlZDogIWhhc0JpbkxvY2F0aW9uU3VwcG9ydCB8fCBzaGlwbWVudFJlY2VpdmVkIHx8IGlzUmVjZWl2ZWQodHJ1ZSwgZmllbGRWYWx1ZSksCiAgICAgICAgICAgIGhpZGU6ICFoYXNCaW5Mb2NhdGlvblN1cHBvcnQKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBjbGVhcmFibGU6IGZhbHNlLAogICAgICAgICAgdmFsdWVLZXk6ICdpZCcsCiAgICAgICAgICBsYWJlbEtleTogJ25hbWUnCiAgICAgICAgfQogICAgICB9LAogICAgICAncmVjaXBpZW50Lm5hbWUnOiB7CiAgICAgICAgdHlwZTogZnVuY3Rpb24gdHlwZShwYXJhbXMpIHsKICAgICAgICAgIHJldHVybiBwYXJhbXMuc3ViZmllbGQgPyAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChMYWJlbEZpZWxkLCBwYXJhbXMpIDogbnVsbDsKICAgICAgICB9LAogICAgICAgIGxhYmVsOiAncmVhY3QucGFydGlhbFJlY2VpdmluZy5yZWNpcGllbnQubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVjaXBpZW50JywKICAgICAgICBoZWFkZXJBbGlnbjogJ2xlZnQnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNsYXNzTmFtZTogJ3RleHQtbGVmdCBtbC0xJywKICAgICAgICAgIHNob3dWYWx1ZVRvb2x0aXA6IHRydWUKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5U2hpcHBlZDogewogICAgICAgIHR5cGU6IGZ1bmN0aW9uIHR5cGUocGFyYW1zKSB7CiAgICAgICAgICByZXR1cm4gcGFyYW1zLnN1YmZpZWxkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTGFiZWxGaWVsZCwgcGFyYW1zKSA6IG51bGw7CiAgICAgICAgfSwKICAgICAgICBsYWJlbDogJ3JlYWN0LnBhcnRpYWxSZWNlaXZpbmcuc2hpcHBlZC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTaGlwcGVkJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlID8gdmFsdWUudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJykgOiB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5UmVjZWl2ZWQ6IHsKICAgICAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICAgICAgcmV0dXJuIHBhcmFtcy5zdWJmaWVsZCA/IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KExhYmVsRmllbGQsIHBhcmFtcykgOiBudWxsOwogICAgICAgIH0sCiAgICAgICAgbGFiZWw6ICdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLnJlY2VpdmVkLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1JlY2VpdmVkJywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlID8gdmFsdWUudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJykgOiAnMCc7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjUpIHsKICAgICAgICAgIHZhciBoYXNQYXJ0aWFsUmVjZWl2aW5nU3VwcG9ydCA9IF9yZWY1Lmhhc1BhcnRpYWxSZWNlaXZpbmdTdXBwb3J0OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaGlkZTogIWhhc1BhcnRpYWxSZWNlaXZpbmdTdXBwb3J0CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlSZW1haW5pbmc6IHsKICAgICAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICAgICAgcmV0dXJuIHBhcmFtcy5zdWJmaWVsZCA/IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KExhYmVsRmllbGQsIHBhcmFtcykgOiBudWxsOwogICAgICAgIH0sCiAgICAgICAgbGFiZWw6ICdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLnRvUmVjZWl2ZS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUbyByZWNlaXZlJywKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgZmxleFdpZHRoOiAnMC44JywKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjYpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjYuZmllbGRWYWx1ZSwKICAgICAgICAgICAgc2hpcG1lbnRSZWNlaXZlZCA9IF9yZWY2LnNoaXBtZW50UmVjZWl2ZWQsCiAgICAgICAgICAgIGhhc1BhcnRpYWxSZWNlaXZpbmdTdXBwb3J0ID0gX3JlZjYuaGFzUGFydGlhbFJlY2VpdmluZ1N1cHBvcnQ7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjbGFzc05hbWU6IF8udG9JbnRlZ2VyKGZpZWxkVmFsdWUgJiYgZmllbGRWYWx1ZS5xdWFudGl0eVJlbWFpbmluZykgPCAwICYmICFzaGlwbWVudFJlY2VpdmVkICYmICFpc1JlY2VpdmVkKHRydWUsIGZpZWxkVmFsdWUpID8gJ3RleHQtZGFuZ2VyJyA6ICcnLAogICAgICAgICAgICBmb3JtYXRWYWx1ZTogZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsKSB7CiAgICAgICAgICAgICAgaWYgKCF2YWwucXVhbnRpdHlSZW1haW5pbmcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWwucXVhbnRpdHlSZW1haW5pbmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChfLnRvSW50ZWdlcihmaWVsZFZhbHVlICYmIGZpZWxkVmFsdWUucXVhbnRpdHlSZW1haW5pbmcpIDwgMCAmJiAoc2hpcG1lbnRSZWNlaXZlZCB8fCBpc1JlY2VpdmVkKHRydWUsIGZpZWxkVmFsdWUpKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICcwJzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHZhbC5xdWFudGl0eVJlbWFpbmluZy50b0xvY2FsZVN0cmluZygnZW4tVVMnKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGlkZTogIWhhc1BhcnRpYWxSZWNlaXZpbmdTdXBwb3J0CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVhbnRpdHlSZWNlaXZpbmc6IHsKICAgICAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKHBhcmFtcykgewogICAgICAgICAgcmV0dXJuIHBhcmFtcy5zdWJmaWVsZCA/IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRleHRGaWVsZCwgcGFyYW1zKSA6IG51bGw7CiAgICAgICAgfSwKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLnJlY2VpdmluZ05vdy5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZWNlaXZpbmcgbm93JywKICAgICAgICBmbGV4V2lkdGg6ICcxJywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBhdXRvQ29tcGxldGU6ICdvZmYnCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjcpIHsKICAgICAgICAgIHZhciBzaGlwbWVudFJlY2VpdmVkID0gX3JlZjcuc2hpcG1lbnRSZWNlaXZlZCwKICAgICAgICAgICAgZmllbGRWYWx1ZSA9IF9yZWY3LmZpZWxkVmFsdWU7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkaXNhYmxlZDogc2hpcG1lbnRSZWNlaXZlZCB8fCBpc1JlY2VpdmVkKHRydWUsIGZpZWxkVmFsdWUpCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgZWRpdDogewogICAgICAgIHR5cGU6IGZ1bmN0aW9uIHR5cGUocGFyYW1zKSB7CiAgICAgICAgICByZXR1cm4gcGFyYW1zLnN1YmZpZWxkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRWRpdExpbmVNb2RhbCwgX2V4dGVuZHMoe30sIHBhcmFtcywgewogICAgICAgICAgICB3cmFwcGVyQ2xhc3NOYW1lOiAiZWRpdC1idXR0b24tY2VsbCIKICAgICAgICAgIH0pKSA6IG51bGw7CiAgICAgICAgfSwKICAgICAgICBmaWVsZEtleTogJycsCiAgICAgICAgZmxleFdpZHRoOiAnMC45JywKICAgICAgICBsYWJlbDogJycsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgYnRuT3BlblRleHQ6ICdyZWFjdC5kZWZhdWx0LmJ1dHRvbi5lZGl0LmxhYmVsJywKICAgICAgICAgIGJ0bk9wZW5EZWZhdWx0VGV4dDogJ0VkaXQgbGluZScsCiAgICAgICAgICB0aXRsZTogJ3JlYWN0LmRlZmF1bHQuYnV0dG9uLmVkaXQubGFiZWwnLAogICAgICAgICAgY2xhc3NOYW1lOiAnYnRuIGJ0bi1vdXRsaW5lLXByaW1hcnknLAogICAgICAgICAgZGVmYXVsdFRpdGxlTWVzc2FnZTogJ0VkaXQnCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjgpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gX3JlZjguZmllbGRWYWx1ZSwKICAgICAgICAgICAgc2F2ZUVkaXRMaW5lID0gX3JlZjguc2F2ZUVkaXRMaW5lLAogICAgICAgICAgICBwYXJlbnRJbmRleCA9IF9yZWY4LnBhcmVudEluZGV4LAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWY4LnJvd0luZGV4LAogICAgICAgICAgICBzaGlwbWVudFJlY2VpdmVkID0gX3JlZjguc2hpcG1lbnRSZWNlaXZlZDsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGZpZWxkVmFsdWU6IGZpZWxkVmFsdWUsCiAgICAgICAgICAgIHNhdmVFZGl0TGluZTogc2F2ZUVkaXRMaW5lLAogICAgICAgICAgICBwYXJlbnRJbmRleDogcGFyZW50SW5kZXgsCiAgICAgICAgICAgIHJvd0luZGV4OiByb3dJbmRleCwKICAgICAgICAgICAgYnRuT3BlbkRpc2FibGVkOiBzaGlwbWVudFJlY2VpdmVkIHx8IGlzUmVjZWl2ZWQodHJ1ZSwgZmllbGRWYWx1ZSkKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBjb21tZW50OiB7CiAgICAgICAgdHlwZTogZnVuY3Rpb24gdHlwZShwYXJhbXMpIHsKICAgICAgICAgIHJldHVybiBwYXJhbXMuc3ViZmllbGQgPyAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUZXh0RmllbGQsIHBhcmFtcykgOiBudWxsOwogICAgICAgIH0sCiAgICAgICAgZmllbGRLZXk6ICcnLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIGxhYmVsOiAncmVhY3QucGFydGlhbFJlY2VpdmluZy5jb21tZW50LmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0NvbW1lbnQnLAogICAgICAgIGhlYWRlckFsaWduOiAnbGVmdCcsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgYXV0b0NvbXBsZXRlOiAnb2ZmJwogICAgICAgIH0sCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY5KSB7CiAgICAgICAgICB2YXIgc2hpcG1lbnRSZWNlaXZlZCA9IF9yZWY5LnNoaXBtZW50UmVjZWl2ZWQsCiAgICAgICAgICAgIGZpZWxkVmFsdWUgPSBfcmVmOS5maWVsZFZhbHVlOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZGlzYWJsZWQ6IHNoaXBtZW50UmVjZWl2ZWQgfHwgaXNSZWNlaXZlZCh0cnVlLCBmaWVsZFZhbHVlKQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9Cn07CmZ1bmN0aW9uIHZhbGlkYXRlKHZhbHVlcykgewogIHZhciBlcnJvcnMgPSB7fTsKICBlcnJvcnMuY29udGFpbmVycyA9IFtdOwogIGlmICghdmFsdWVzLmRhdGVEZWxpdmVyZWQpIHsKICAgIGVycm9ycy5kYXRlRGVsaXZlcmVkID0gJ3JlYWN0LmRlZmF1bHQuZXJyb3IucmVxdWlyZWRGaWVsZC5sYWJlbCc7CiAgfQogIF8uZm9yRWFjaCh2YWx1ZXMuY29udGFpbmVycywgZnVuY3Rpb24gKGNvbnRhaW5lciwga2V5KSB7CiAgICBlcnJvcnMuY29udGFpbmVyc1trZXldID0gewogICAgICBzaGlwbWVudEl0ZW1zOiBbXQogICAgfTsKICAgIF8uZm9yRWFjaChjb250YWluZXIuc2hpcG1lbnRJdGVtcywgZnVuY3Rpb24gKGl0ZW0sIGtleTIpIHsKICAgICAgaWYgKGl0ZW0ucXVhbnRpdHlSZWNlaXZpbmcgPCAwKSB7CiAgICAgICAgZXJyb3JzLmNvbnRhaW5lcnNba2V5XS5zaGlwbWVudEl0ZW1zW2tleTJdID0gewogICAgICAgICAgcXVhbnRpdHlSZWNlaXZpbmc6ICdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLmVycm9yLnF1YW50aXR5VG9SZWNlaXZlTmVnYXRpdmUubGFiZWwnCiAgICAgICAgfTsKICAgICAgfQogICAgICB2YXIgcmVjZWl2aW5nID0gIV8uaXNOaWwoaXRlbS5xdWFudGl0eVJlY2VpdmluZykgJiYgaXRlbS5xdWFudGl0eVJlY2VpdmluZyAhPT0gJyc7CiAgICAgIGlmIChyZWNlaXZpbmcgJiYgIV8uaXNOaWwoaXRlbS5wcm9kdWN0KSAmJiBpdGVtLnByb2R1Y3QubG90QW5kRXhwaXJ5Q29udHJvbCkgewogICAgICAgIGlmICghaXRlbS5leHBpcmF0aW9uRGF0ZSAmJiAoXy5pc05pbChpdGVtLmxvdE51bWJlcikgfHwgXy5pc0VtcHR5KGl0ZW0ubG90TnVtYmVyKSkpIHsKICAgICAgICAgIGVycm9ycy5jb250YWluZXJzW2tleV0uc2hpcG1lbnRJdGVtc1trZXkyXSA9IHsKICAgICAgICAgICAgZXhwaXJhdGlvbkRhdGU6ICdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLmVycm9yLmxvdEFuZEV4cGlyeUNvbnRyb2wubGFiZWwnLAogICAgICAgICAgICBsb3ROdW1iZXI6ICdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLmVycm9yLmxvdEFuZEV4cGlyeUNvbnRyb2wubGFiZWwnCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSBpZiAoIWl0ZW0uZXhwaXJhdGlvbkRhdGUpIHsKICAgICAgICAgIGVycm9ycy5jb250YWluZXJzW2tleV0uc2hpcG1lbnRJdGVtc1trZXkyXSA9IHsKICAgICAgICAgICAgZXhwaXJhdGlvbkRhdGU6ICdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLmVycm9yLmxvdEFuZEV4cGlyeUNvbnRyb2wubGFiZWwnCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSBpZiAoXy5pc05pbChpdGVtLmxvdE51bWJlcikgfHwgXy5pc0VtcHR5KGl0ZW0ubG90TnVtYmVyKSkgewogICAgICAgICAgZXJyb3JzLmNvbnRhaW5lcnNba2V5XS5zaGlwbWVudEl0ZW1zW2tleTJdID0gewogICAgICAgICAgICBsb3ROdW1iZXI6ICdyZWFjdC5wYXJ0aWFsUmVjZWl2aW5nLmVycm9yLmxvdEFuZEV4cGlyeUNvbnRyb2wubGFiZWwnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfSk7CiAgcmV0dXJuIGVycm9yczsKfQoKLyoqIFRoZSBmaXJzdCBwYWdlIG9mIHBhcnRpYWwgcmVjZWl2aW5nIHdoZXJlIHVzZXIgY2FuIHNlZSByZWNlaXB0IGxpbmVzIGFuZCBjb21wbGV0ZSBpdCBpbgogKiBkaWZmZXJlbnQgd2F5cyBkZXBlbmRpbmcgb24gaG93IHRoZXkgcmVjZWl2ZSBpdC4KICogLSBJZiB0aGUgdXNlciBpcyByZWNlaXZpbmcgZXZlcnl0aGluZyB3aXRoIG5vIGNoYW5nZXMsIHRoZXkgY2xpY2sgImF1dG9maWxsIGFsbCBxdWFudGl0aWVzIgogKiBidXR0b24gd2hhdCB3aWxsIGF1dG9tYXRpY2FsbHkgZmlsbCBhbGwgb2YgdGhlICJ0byByZWNlaXZlIiBjZWxscyB3aXRoIHF1YW50aXR5IGxlZnQgaW4gdGhlIGxpbmUuCiAqIC0gSWYgdGhlIHVzZXIgaXMgcmVjZWl2aW5nIGJ5IHBhbGxldCB3aXRoIG5vIGNoYW5nZXMsIHRoZXkgY2xpY2sgdGhlIGNoZWNrYm94IG5leHQgdG8gdGhlIHBhbGxldAogKiB0aGV5IHdhbnQgdG8gcmVjZWl2ZSB3aGF0IHdpbGwgYXV0b21hdGljYWxseSBmaWxsICJ0byByZWNlaXZlIiBjb2x1bW4gZm9yIGxpbmVzCiAqIGluIHRoYXQgcGFsbGV0IHdpdGggZnVsbCBxdWFudGl0eS4KICogLSBJZiB0aGUgdXNlciBpcyByZWNlaXZpbmcgYnkgbGluZSB3aXRoIG5vIGxvdCBjaGFuZ2VzLCB0aGV5IGdvIGxpbmUgYnkgbGluZSBhbmQgdHlwZSBpbiB0aGUKICogcXVhbnRpdHkgZnJvbSBlYWNoIGxpbmUgdGhleSB3YW50IHRvIHJlY2VpdmUuCiAqIC0gSWYgdGhlIHVzZXIgaGFzIHRvIGNoYW5nZSBsb3QgaW5mb3JtYXRpb24sIHRoZXkgY2xpY2sgdGhlIGVkaXQgbGluZSBidXR0b24gd2hpY2ggYWxsb3dzIHRoZW0KICogdG8gZWRpdCB0aGUgbGluZS4KICovCnZhciBQYXJ0aWFsUmVjZWl2aW5nUGFnZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhQYXJ0aWFsUmVjZWl2aW5nUGFnZSwgX0NvbXBvbmVudCk7CiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihQYXJ0aWFsUmVjZWl2aW5nUGFnZSk7CiAgZnVuY3Rpb24gUGFydGlhbFJlY2VpdmluZ1BhZ2UocHJvcHMpIHsKICAgIHZhciBfdGhpczsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQYXJ0aWFsUmVjZWl2aW5nUGFnZSk7CiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKTsKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRhdGFGZXRjaGVkIiwgZmFsc2UpOwogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIHZhbHVlczoge30KICAgIH07CiAgICBfdGhpcy5hdXRvZmlsbExpbmVzID0gX3RoaXMuYXV0b2ZpbGxMaW5lcy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnNldExvY2F0aW9uID0gX3RoaXMuc2V0TG9jYXRpb24uYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5zYXZlID0gX3RoaXMuc2F2ZS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnNhdmVBbmRFeGl0ID0gX3RoaXMuc2F2ZUFuZEV4aXQuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5zYXZlVmFsdWVzID0gX3RoaXMuc2F2ZVZhbHVlcy5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLnNhdmVFZGl0TGluZSA9IF90aGlzLnNhdmVFZGl0TGluZS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmV4cG9ydFRlbXBsYXRlID0gX3RoaXMuZXhwb3J0VGVtcGxhdGUuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5pbXBvcnRUZW1wbGF0ZSA9IF90aGlzLmltcG9ydFRlbXBsYXRlLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgcmV0dXJuIF90aGlzOwogIH0KICBfY3JlYXRlQ2xhc3MoUGFydGlhbFJlY2VpdmluZ1BhZ2UsIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIHRoaXMuZmV0Y2hQYXJ0aWFsUmVjZWlwdENhbmRpZGF0ZXMoKTsKICAgICAgaWYgKHRoaXMucHJvcHMucGFydGlhbFJlY2VpdmluZ1RyYW5zbGF0aW9uc0ZldGNoZWQpIHsKICAgICAgICB0aGlzLmRhdGFGZXRjaGVkID0gdHJ1ZTsKICAgICAgfQogICAgICB0aGlzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHsKICAgICAgaWYgKG5leHRQcm9wcy5wYXJ0aWFsUmVjZWl2aW5nVHJhbnNsYXRpb25zRmV0Y2hlZCAmJiAhdGhpcy5kYXRhRmV0Y2hlZCkgewogICAgICAgIHRoaXMuZGF0YUZldGNoZWQgPSB0cnVlOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAib25TdWJtaXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uU3VibWl0KGZvcm1WYWx1ZXMpIHsKICAgICAgdmFyIGNvbnRhaW5lcnMgPSBfLm1hcChmb3JtVmFsdWVzLmNvbnRhaW5lcnMsIGZ1bmN0aW9uIChjb250YWluZXIpIHsKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBjb250YWluZXIpLCB7fSwgewogICAgICAgICAgc2hpcG1lbnRJdGVtczogXy5jaGFpbihjb250YWluZXIuc2hpcG1lbnRJdGVtcykubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmIChpdGVtLnJlY2VpcHRJdGVtSWQpIHsKICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpdGVtKSwge30sIHsKICAgICAgICAgICAgICAgIHF1YW50aXR5UmVjZWl2aW5nOiBpdGVtLnF1YW50aXR5UmVjZWl2aW5nID8gaXRlbS5xdWFudGl0eVJlY2VpdmluZyA6IDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gIV8uaXNOaWwoaXRlbS5xdWFudGl0eVJlY2VpdmluZykgJiYgaXRlbS5xdWFudGl0eVJlY2VpdmluZyAhPT0gJyc7CiAgICAgICAgICB9KS52YWx1ZSgpCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB2YXIgdmFsdWVzID0gdGhpcy5zdGF0ZS52YWx1ZXM7CiAgICAgIHZhbHVlcy5jb250YWluZXJzID0gY29udGFpbmVyczsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdmFsdWVzOiB2YWx1ZXMKICAgICAgfSk7CiAgICAgIHRoaXMubmV4dFBhZ2UodmFsdWVzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZXMgaXRlbXMgd2l0aCBhIGxvY2F0aW9uIG9mIHRoZSBiaW4uCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzZXRMb2NhdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TG9jYXRpb24ocm93SW5kZXgsIGxvY2F0aW9uKSB7CiAgICAgIGlmICh0aGlzLnN0YXRlLnZhbHVlcy5jb250YWluZXJzICYmICFfLmlzTmlsKHJvd0luZGV4KSkgewogICAgICAgIHZhciBjb250YWluZXJzID0gdXBkYXRlKHRoaXMuc3RhdGUudmFsdWVzLmNvbnRhaW5lcnMsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgcm93SW5kZXgsIHsKICAgICAgICAgIHNoaXBtZW50SXRlbXM6IHsKICAgICAgICAgICAgJGFwcGx5OiBmdW5jdGlvbiAkYXBwbHkoaXRlbXMpIHsKICAgICAgICAgICAgICByZXR1cm4gIWl0ZW1zID8gW10gOiBpdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChpc1JlY2VpdmVkKHRydWUsIGl0ZW0pKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaXRlbSksIHt9LCB7CiAgICAgICAgICAgICAgICAgIGJpbkxvY2F0aW9uOiBsb2NhdGlvbgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgICAgdmFyIHZhbHVlcyA9IHRoaXMuc3RhdGUudmFsdWVzOwogICAgICAgIHZhbHVlcy5jb250YWluZXJzID0gY29udGFpbmVyczsKICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgIHZhbHVlczogdmFsdWVzCiAgICAgICAgfSk7CiAgICAgICAgd2luZG93LnNldEZvcm1WYWx1ZSgnY29udGFpbmVycycsIGNvbnRhaW5lcnMpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGZXRjaGVzIGF2YWlsYWJsZSByZWNlaXB0cyBmcm9tIEFQSS4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImZldGNoUGFydGlhbFJlY2VpcHRDYW5kaWRhdGVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFBhcnRpYWxSZWNlaXB0Q2FuZGlkYXRlcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9wYXJ0aWFsUmVjZWl2aW5nLyIuY29uY2F0KHRoaXMucHJvcHMubWF0Y2gucGFyYW1zLnNoaXBtZW50SWQsICI/c3RlcE51bWJlcj0xIik7CiAgICAgIHJldHVybiBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczIuc2V0U3RhdGUoewogICAgICAgICAgdmFsdWVzOiB7fQogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7CiAgICAgICAgICAgIHZhbHVlczogcGFyc2VSZXNwb25zZShyZXNwb25zZS5kYXRhLmRhdGEpCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczIucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2F2ZVZhbHVlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZVZhbHVlcyhmb3JtVmFsdWVzKSB7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9wYXJ0aWFsUmVjZWl2aW5nLyIuY29uY2F0KHRoaXMucHJvcHMubWF0Y2gucGFyYW1zLnNoaXBtZW50SWQsICI/c3RlcE51bWJlcj0xIik7CiAgICAgIHZhciBwYXlsb2FkID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBmb3JtVmFsdWVzKSwge30sIHsKICAgICAgICBjb250YWluZXJzOiBnZXRSZWNlaXZpbmdQYXlsb2FkQ29udGFpbmVycyhmb3JtVmFsdWVzKQogICAgICB9KTsKICAgICAgcmV0dXJuIGFwaUNsaWVudC5wb3N0KHVybCwgZmxhdHRlblJlcXVlc3QocGF5bG9hZCkpOwogICAgfQogIH0sIHsKICAgIGtleTogInNhdmVBbmRFeGl0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlQW5kRXhpdChmb3JtVmFsdWVzKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgICB0aGlzLnNhdmVWYWx1ZXMoZm9ybVZhbHVlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHJlcXVpc2l0aW9uID0gZm9ybVZhbHVlcy5yZXF1aXNpdGlvbiwKICAgICAgICAgIHNoaXBtZW50SWQgPSBmb3JtVmFsdWVzLnNoaXBtZW50SWQ7CiAgICAgICAgd2luZG93LmxvY2F0aW9uID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9zaG93LyIuY29uY2F0KHJlcXVpc2l0aW9uIHx8IHNoaXBtZW50SWQpOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMy5wcm9wcy5oaWRlU3Bpbm5lcigpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIENhbGxzIHNhdmUgbWV0aG9kLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZShmb3JtVmFsdWVzLCBjYWxsYmFjaykgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKICAgICAgdGhpcy5zYXZlVmFsdWVzKGZvcm1WYWx1ZXMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM0LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgX3RoaXM0LnNldFN0YXRlKHsKICAgICAgICAgIHZhbHVlczoge30KICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXM0LnNldFN0YXRlKHsKICAgICAgICAgICAgdmFsdWVzOiBwYXJzZVJlc3BvbnNlKHJlc3BvbnNlLmRhdGEuZGF0YSkKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICB9CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXM0LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImF1dG9maWxsTGluZXMiLAogICAgdmFsdWU6CiAgICAvKioKICAgICAqIEF1dG9maWxscyAidG8gcmVjZWl2ZSIgY2VsbHMgaW4gZGlmZmVyZW50IHdheXMgZGVwZW5kaW5nIG9uIHdoYXQgdXNlciBkaWQuCiAgICAgKiBJZiB0aGV5IGNsaWNrICJBdXRvZmlsbCBxdWFudGl0ZXMiIGJ1dHRvbiwgaXQgd2lsbCBhdXRvbWF0aWNhbGx5IGZpbGwgYWxsIGxpbmVzLgogICAgICogSWYgdGhleSBjbGljayBjaGVja2JveCBuZXh0IHRvIHRoZSBwYWxsZXQsIGl0IHdpbGwgYXV0b21hdGljYWxseSBmaWxsIGFsbCBsaW5lcyBpbiB0aGF0IHBhbGxldC4KICAgICAqIElmIHRoZXkgY2xpY2sgY2hlY2JveCBuZXh0IHRvIHRoZSBsaW5lLCBpdCB3aWxsIGF1dG9tYXRpY2FsbHkgZmlsbCB0aGlzIGxpbmUuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIGZ1bmN0aW9uIGF1dG9maWxsTGluZXModmFsdWVzLCBjbGVhclZhbHVlLCBwYXJlbnRJbmRleCwgcm93SW5kZXgpIHsKICAgICAgaWYgKHZhbHVlcy5jb250YWluZXJzKSB7CiAgICAgICAgdmFyIGNvbnRhaW5lcnMgPSBbXTsKICAgICAgICBpZiAoXy5pc05pbChwYXJlbnRJbmRleCkpIHsKICAgICAgICAgIGNvbnRhaW5lcnMgPSB1cGRhdGUodmFsdWVzLmNvbnRhaW5lcnMsIHsKICAgICAgICAgICAgJGFwcGx5OiBmdW5jdGlvbiAkYXBwbHkoaXRlbXMpIHsKICAgICAgICAgICAgICByZXR1cm4gIWl0ZW1zID8gW10gOiBpdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGUoaXRlbSwgewogICAgICAgICAgICAgICAgICBzaGlwbWVudEl0ZW1zOiB7CiAgICAgICAgICAgICAgICAgICAgJGFwcGx5OiBmdW5jdGlvbiAkYXBwbHkoc2hpcG1lbnRJdGVtcykgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFzaGlwbWVudEl0ZW1zID8gW10gOiBzaGlwbWVudEl0ZW1zLm1hcChmdW5jdGlvbiAoc2hpcG1lbnRJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQYXJ0aWFsUmVjZWl2aW5nUGFnZS5hdXRvZmlsbExpbmUoY2xlYXJWYWx1ZSwgc2hpcG1lbnRJdGVtKTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoXy5pc05pbChyb3dJbmRleCkpIHsKICAgICAgICAgIGNvbnRhaW5lcnMgPSB1cGRhdGUodmFsdWVzLmNvbnRhaW5lcnMsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgcGFyZW50SW5kZXgsIHsKICAgICAgICAgICAgc2hpcG1lbnRJdGVtczogewogICAgICAgICAgICAgICRhcHBseTogZnVuY3Rpb24gJGFwcGx5KGl0ZW1zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIWl0ZW1zID8gW10gOiBpdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFBhcnRpYWxSZWNlaXZpbmdQYWdlLmF1dG9maWxsTGluZShjbGVhclZhbHVlLCBpdGVtKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb250YWluZXJzID0gdXBkYXRlKHZhbHVlcy5jb250YWluZXJzLCBfZGVmaW5lUHJvcGVydHkoe30sIHBhcmVudEluZGV4LCB7CiAgICAgICAgICAgIHNoaXBtZW50SXRlbXM6IF9kZWZpbmVQcm9wZXJ0eSh7fSwgcm93SW5kZXgsIHsKICAgICAgICAgICAgICAkYXBwbHk6IGZ1bmN0aW9uICRhcHBseShpdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUGFydGlhbFJlY2VpdmluZ1BhZ2UuYXV0b2ZpbGxMaW5lKGNsZWFyVmFsdWUsIGl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgdmFyIG5ld1ZhbHVlcyA9IF9vYmplY3RTcHJlYWQoe30sIHZhbHVlcyk7CiAgICAgICAgbmV3VmFsdWVzLmNvbnRhaW5lcnMgPSBjb250YWluZXJzOwogICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgdmFsdWVzOiBuZXdWYWx1ZXMKICAgICAgICB9KTsKICAgICAgICB3aW5kb3cuc2V0Rm9ybVZhbHVlKCdjb250YWluZXJzJywgY29udGFpbmVycyk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGNoYW5nZXMgbWFkZSBpbiBlZGl0IGxpbmUgbW9kYWwgYW5kIHVwZGF0ZXMgZGF0YS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBlZGl0TGluZXMKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwYXJlbnRJbmRleAogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZUVkaXRMaW5lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlRWRpdExpbmUoZWRpdExpbmVzLCBwYXJlbnRJbmRleCkgewogICAgICB2YXIgZm9ybVZhbHVlcyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgIGNvbnRhaW5lcnM6IFtfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRoaXMuc3RhdGUudmFsdWVzLmNvbnRhaW5lcnNbcGFyZW50SW5kZXhdKSwge30sIHsKICAgICAgICAgIHNoaXBtZW50SXRlbXM6IGVkaXRMaW5lcwogICAgICAgIH0pXQogICAgICB9KTsKICAgICAgdGhpcy5zYXZlKGZvcm1WYWx1ZXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImV4cG9ydFRlbXBsYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBleHBvcnRUZW1wbGF0ZSgpIHsKICAgICAgdmFyIF92YWx1ZXMkY29udGFpbmVycywKICAgICAgICBfdmFsdWVzJGNvbnRhaW5lcnMkbWEsCiAgICAgICAgX3RoaXM1ID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB2YXIgdmFsdWVzID0gdGhpcy5zdGF0ZS52YWx1ZXM7CiAgICAgIHZhciBzaGlwbWVudElkID0gdmFsdWVzLnNoaXBtZW50SWQ7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvcGFydGlhbFJlY2VpdmluZy9leHBvcnRDc3YvIi5jb25jYXQoc2hpcG1lbnRJZCk7CiAgICAgIC8qKiBXZSBoYXZlIHRvIG9taXQgcHJvZHVjdC5kaXNwbGF5TmFtZXMsIGR1ZSB0byBhbiBlcnJvcgogICAgICAgKiAgd2hpbGUgYmluZGluZyBiaW5kRGF0YShwYXJ0aWFsUmVjZWlwdEl0ZW0sIHNoaXBtZW50SXRlbU1hcCkKICAgICAgICogIGl0IGV4cGVjdHMgcHJvZHVjdC5kaXNwbGF5TmFtZXMgdG8gaGF2ZSBhIHNldHRlciwgYXMgd2UgcGFzcwogICAgICAgKiAgcHJvZHVjdC5kaXNwbGF5TmFtZXMuZGVmYXVsdDogWFlaLCB0byB0aGUgdXBkYXRlIG1ldGhvZCwgYnV0IGl0J3Mgbm90IGEKICAgICAgICogIHdyaXRhYmxlIHByb3BlcnR5LgogICAgICAgKiAgV2l0aCBkZXByZWNhdGVkIHByb2R1Y3QudHJhbnNsYXRlZE5hbWUgaXQgd2FzIG5vdCB0aGUgY2FzZSwgYmVjYXVzZQogICAgICAgKiAgaXQgd2FzIHJlY29nbml6aW5nIHRoZSB0cmFuc2llbnQgYW5kIHdlIGRpZG4ndCBhY2Nlc3MgcHJvZHVjdC50cmFuc2xhdGVkTmFtZS5zb21ldGhpbmcKICAgICAgICogIGJ1dCBwcm9kdWN0LnRyYW5zbGF0ZWROYW1lIGRpcmVjdGx5CiAgICAgICAqICovCiAgICAgIHZhciB2YWx1ZXNXaXRob3V0RGlzcGxheU5hbWVzID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB2YWx1ZXMpLCB7fSwgewogICAgICAgIGNvbnRhaW5lcnM6IHZhbHVlcyA9PT0gbnVsbCB8fCB2YWx1ZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdmFsdWVzJGNvbnRhaW5lcnMgPSB2YWx1ZXMuY29udGFpbmVycykgPT09IG51bGwgfHwgX3ZhbHVlcyRjb250YWluZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3ZhbHVlcyRjb250YWluZXJzJG1hID0gX3ZhbHVlcyRjb250YWluZXJzLm1hcCkgPT09IG51bGwgfHwgX3ZhbHVlcyRjb250YWluZXJzJG1hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdmFsdWVzJGNvbnRhaW5lcnMkbWEuY2FsbChfdmFsdWVzJGNvbnRhaW5lcnMsIGZ1bmN0aW9uIChjb250YWluZXIpIHsKICAgICAgICAgIHZhciBfY29udGFpbmVyJHNoaXBtZW50SXQsIF9jb250YWluZXIkc2hpcG1lbnRJdDI7CiAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBjb250YWluZXIpLCB7fSwgewogICAgICAgICAgICBzaGlwbWVudEl0ZW1zOiBjb250YWluZXIgPT09IG51bGwgfHwgY29udGFpbmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2NvbnRhaW5lciRzaGlwbWVudEl0ID0gY29udGFpbmVyLnNoaXBtZW50SXRlbXMpID09PSBudWxsIHx8IF9jb250YWluZXIkc2hpcG1lbnRJdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9jb250YWluZXIkc2hpcG1lbnRJdDIgPSBfY29udGFpbmVyJHNoaXBtZW50SXQubWFwKSA9PT0gbnVsbCB8fCBfY29udGFpbmVyJHNoaXBtZW50SXQyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY29udGFpbmVyJHNoaXBtZW50SXQyLmNhbGwoX2NvbnRhaW5lciRzaGlwbWVudEl0LCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBfLm9taXQoaXRlbSwgJ3Byb2R1Y3QuZGlzcGxheU5hbWVzJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICB9KTsKICAgICAgYXBpQ2xpZW50LnBvc3QodXJsLCBmbGF0dGVuUmVxdWVzdCh2YWx1ZXNXaXRob3V0RGlzcGxheU5hbWVzKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBmaWxlRG93bmxvYWQocmVzcG9uc2UuZGF0YSwgIlBhcnRpYWxSZWNlaXZpbmciLmNvbmNhdChzaGlwbWVudElkID8gIi0iLmNvbmNhdChzaGlwbWVudElkKSA6ICcnLCAiLmNzdiIpLCAndGV4dC9jc3YnKTsKICAgICAgICBfdGhpczUucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczUucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaW1wb3J0VGVtcGxhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGltcG9ydFRlbXBsYXRlKGV2ZW50KSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICB2YXIgZmlsZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgZm9ybURhdGEuYXBwZW5kKCdpbXBvcnRGaWxlJywgZmlsZS5zbGljZSgwLCBmaWxlLnNpemUsICd0ZXh0L2NzdicpKTsKICAgICAgdmFyIGNvbmZpZyA9IHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAnY29udGVudC10eXBlJzogJ211bHRpcGFydC9mb3JtLWRhdGEnCiAgICAgICAgfQogICAgICB9OwogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3BhcnRpYWxSZWNlaXZpbmcvaW1wb3J0Q3N2LyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnNoaXBtZW50SWQpOwogICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QodXJsLCBmb3JtRGF0YSwgY29uZmlnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczYucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczYucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidHJhbnNpdGlvblRvTmV4dFN0ZXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyYW5zaXRpb25Ub05leHRTdGVwKGZvcm1WYWx1ZXMpIHsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9wYXJ0aWFsUmVjZWl2aW5nLyIuY29uY2F0KHRoaXMucHJvcHMubWF0Y2gucGFyYW1zLnNoaXBtZW50SWQsICI/c3RlcE51bWJlcj0xIik7CiAgICAgIHZhciBwYXlsb2FkID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHsKICAgICAgICByZWNlaXB0U3RhdHVzOiAnQ0hFQ0tJTkcnCiAgICAgIH0sIGZvcm1WYWx1ZXMpLCB7fSwgewogICAgICAgIGNvbnRhaW5lcnM6IGdldFJlY2VpdmluZ1BheWxvYWRDb250YWluZXJzKGZvcm1WYWx1ZXMpCiAgICAgIH0pOwogICAgICByZXR1cm4gYXBpQ2xpZW50LnBvc3QodXJsLCBmbGF0dGVuUmVxdWVzdChwYXlsb2FkKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAibmV4dFBhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG5leHRQYWdlKGZvcm1WYWx1ZXMpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgdGhpcy50cmFuc2l0aW9uVG9OZXh0U3RlcChmb3JtVmFsdWVzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXM3LnByb3BzLm5leHRQYWdlKGZvcm1WYWx1ZXMpOwogICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXM3LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXM3LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb3JtLCB7CiAgICAgICAgb25TdWJtaXQ6IGZ1bmN0aW9uIG9uU3VibWl0KHZhbHVlcykgewogICAgICAgICAgcmV0dXJuIF90aGlzOC5vblN1Ym1pdCh2YWx1ZXMpOwogICAgICAgIH0sCiAgICAgICAgdmFsaWRhdGU6IHZhbGlkYXRlLAogICAgICAgIGF1dG9maWxsTGluZXM6IHRoaXMuYXV0b2ZpbGxMaW5lcywKICAgICAgICBtdXRhdG9yczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBhcnJheU11dGF0b3JzKSwge30sIHsKICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZShfcmVmMTAsIHN0YXRlLCBfcmVmMTEpIHsKICAgICAgICAgICAgdmFyIF9yZWYxMiA9IF9zbGljZWRUb0FycmF5KF9yZWYxMCwgMiksCiAgICAgICAgICAgICAgZmllbGQgPSBfcmVmMTJbMF0sCiAgICAgICAgICAgICAgdmFsdWUgPSBfcmVmMTJbMV07CiAgICAgICAgICAgIHZhciBjaGFuZ2VWYWx1ZSA9IF9yZWYxMS5jaGFuZ2VWYWx1ZTsKICAgICAgICAgICAgY2hhbmdlVmFsdWUoc3RhdGUsIGZpZWxkLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBpbml0aWFsVmFsdWVzOiB0aGlzLnN0YXRlLnZhbHVlcywKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihfcmVmMTMpIHsKICAgICAgICAgIHZhciBoYW5kbGVTdWJtaXQgPSBfcmVmMTMuaGFuZGxlU3VibWl0LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMTMudmFsdWVzLAogICAgICAgICAgICBmb3JtID0gX3JlZjEzLmZvcm07CiAgICAgICAgICBpZiAoIXdpbmRvdy5zZXRGb3JtVmFsdWUpIHsKICAgICAgICAgICAgd2luZG93LnNldEZvcm1WYWx1ZSA9IGZvcm0ubXV0YXRvcnMuc2V0VmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImZvcm0iLCB7CiAgICAgICAgICAgIG9uU3VibWl0OiBoYW5kbGVTdWJtaXQKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImQtZmxleCBmbGV4LWNvbHVtbiIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiYnV0dG9ucy1jb250YWluZXIiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBmbG9hdC1yaWdodCBidG4tZm9ybSBidG4teHMiLAogICAgICAgICAgICBkaXNhYmxlZDogX3RoaXM4LnN0YXRlLnZhbHVlcy5zaGlwbWVudFN0YXR1cyA9PT0gJ1JFQ0VJVkVEJywKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM4LmF1dG9maWxsTGluZXModmFsdWVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QucGFydGlhbFJlY2VpdmluZy5hdXRvZmlsbFF1YW50aXRpZXMubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkF1dG9maWxsIHF1YW50aXRpZXMiCiAgICAgICAgICB9KSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGZsb2F0LXJpZ2h0IGJ0bi1mb3JtIGJ0bi14cyIsCiAgICAgICAgICAgIGRpc2FibGVkOiAhaXNBbnlJdGVtU2VsZWN0ZWQodmFsdWVzLmNvbnRhaW5lcnMpIHx8IHZhbHVlcy5zaGlwbWVudFN0YXR1cyA9PT0gJ1JFQ0VJVkVEJywKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM4LnNhdmVBbmRFeGl0KHZhbHVlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXNpZ24tb3V0IHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uc2F2ZUFuZEV4aXQubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUgYW5kIGV4aXQiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBmbG9hdC1yaWdodCBidG4tZm9ybSBidG4teHMiLAogICAgICAgICAgICBkaXNhYmxlZDogIWlzQW55SXRlbVNlbGVjdGVkKHZhbHVlcy5jb250YWluZXJzKSB8fCB2YWx1ZXMuc2hpcG1lbnRTdGF0dXMgPT09ICdSRUNFSVZFRCcsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzOC5zYXZlKHZhbHVlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnNhdmUubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUiCiAgICAgICAgICB9KSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGJ0bi14cyBtci0zIiwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM4LmV4cG9ydFRlbXBsYXRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXVwbG9hZCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLmV4cG9ydFRlbXBsYXRlLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJFeHBvcnQgdGVtcGxhdGUiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgibGFiZWwiLCB7CiAgICAgICAgICAgIGh0bWxGb3I6ICJjc3ZJbnB1dCIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYnRuLXhzIG1yLTMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJmYSBmYS1kb3dubG9hZCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLmltcG9ydFRlbXBsYXRlLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJJbXBvcnQgdGVtcGxhdGUiCiAgICAgICAgICB9KSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgaWQ6ICJjc3ZJbnB1dCIsCiAgICAgICAgICAgIHR5cGU6ICJmaWxlIiwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25DaGFuZ2U6IF90aGlzOC5pbXBvcnRUZW1wbGF0ZSwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljayhldmVudCkgewogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnbgogICAgICAgICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9IG51bGw7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFjY2VwdDogIi5jc3YiCiAgICAgICAgICB9KSkpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAibXktMiB0YWJsZS1mb3JtIgogICAgICAgICAgfSwgXy5tYXAoVEFCTEVfRklFTERTLCBmdW5jdGlvbiAoZmllbGRDb25maWcsIGZpZWxkTmFtZSkgewogICAgICAgICAgICByZXR1cm4gcmVuZGVyRm9ybUZpZWxkKGZpZWxkQ29uZmlnLCBmaWVsZE5hbWUsIHsKICAgICAgICAgICAgICBhdXRvZmlsbExpbmVzOiBfdGhpczguYXV0b2ZpbGxMaW5lcywKICAgICAgICAgICAgICBzYXZlRWRpdExpbmU6IF90aGlzOC5zYXZlRWRpdExpbmUsCiAgICAgICAgICAgICAgc2V0TG9jYXRpb246IF90aGlzOC5zZXRMb2NhdGlvbiwKICAgICAgICAgICAgICBiaW5zOiBfdGhpczgucHJvcHMuYmlucywKICAgICAgICAgICAgICBoYXNCaW5Mb2NhdGlvblN1cHBvcnQ6IF90aGlzOC5wcm9wcy5oYXNCaW5Mb2NhdGlvblN1cHBvcnQsCiAgICAgICAgICAgICAgbG9jYXRpb25JZDogX3RoaXM4LnByb3BzLmxvY2F0aW9uSWQsCiAgICAgICAgICAgICAgc2hpcG1lbnRSZWNlaXZlZDogX3RoaXM4LnN0YXRlLnZhbHVlcy5zaGlwbWVudFN0YXR1cyA9PT0gJ1JFQ0VJVkVEJywKICAgICAgICAgICAgICB2YWx1ZXM6IHZhbHVlcywKICAgICAgICAgICAgICBoYXNQYXJ0aWFsUmVjZWl2aW5nU3VwcG9ydDogX3RoaXM4LnByb3BzLmhhc1BhcnRpYWxSZWNlaXZpbmdTdXBwb3J0LAogICAgICAgICAgICAgIHRyYW5zbGF0ZTogX3RoaXM4LnByb3BzLnRyYW5zbGF0ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAic3VibWl0LWJ1dHRvbnMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiYnRuIGJ0bi1vdXRsaW5lLXByaW1hcnkgYnRuLWZvcm0gZmxvYXQtcmlnaHQgYnRuLXhzIiwKICAgICAgICAgICAgZGlzYWJsZWQ6ICFpc0FueUl0ZW1TZWxlY3RlZCh2YWx1ZXMuY29udGFpbmVycykgfHwgdmFsdWVzLnNoaXBtZW50U3RhdHVzID09PSAnUkVDRUlWRUQnCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5uZXh0LmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJOZXh0IgogICAgICAgICAgfSkpKSkpOwogICAgICAgIH0KICAgICAgfSkpOwogICAgfQogIH1dLCBbewogICAga2V5OiAiYXV0b2ZpbGxMaW5lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhdXRvZmlsbExpbmUoY2xlYXJWYWx1ZSwgc2hpcG1lbnRJdGVtKSB7CiAgICAgIGlmIChpc1JlY2VpdmVkKHRydWUsIHNoaXBtZW50SXRlbSkpIHsKICAgICAgICByZXR1cm4gc2hpcG1lbnRJdGVtOwogICAgICB9CiAgICAgIHZhciBhdXRvZmlsbFF1YW50aXR5ID0gXy50b0ludGVnZXIoc2hpcG1lbnRJdGVtLnF1YW50aXR5U2hpcHBlZCkgLSBfLnRvSW50ZWdlcihzaGlwbWVudEl0ZW0ucXVhbnRpdHlSZWNlaXZlZCk7CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHNoaXBtZW50SXRlbSksIHt9LCB7CiAgICAgICAgcXVhbnRpdHlSZWNlaXZpbmc6IGNsZWFyVmFsdWUgfHwgYXV0b2ZpbGxRdWFudGl0eSA8IDAgPyBudWxsIDogYXV0b2ZpbGxRdWFudGl0eQogICAgICB9KTsKICAgIH0KICB9XSk7CiAgcmV0dXJuIFBhcnRpYWxSZWNlaXZpbmdQYWdlOwp9KENvbXBvbmVudCk7CnZhciBtYXBTdGF0ZVRvUHJvcHMgPSBmdW5jdGlvbiBtYXBTdGF0ZVRvUHJvcHMoc3RhdGUpIHsKICByZXR1cm4gewogICAgaGFzQmluTG9jYXRpb25TdXBwb3J0OiBzdGF0ZS5zZXNzaW9uLmN1cnJlbnRMb2NhdGlvbi5oYXNCaW5Mb2NhdGlvblN1cHBvcnQsCiAgICBwYXJ0aWFsUmVjZWl2aW5nVHJhbnNsYXRpb25zRmV0Y2hlZDogc3RhdGUuc2Vzc2lvbi5mZXRjaGVkVHJhbnNsYXRpb25zLnBhcnRpYWxSZWNlaXZpbmcsCiAgICBoYXNQYXJ0aWFsUmVjZWl2aW5nU3VwcG9ydDogc3RhdGUuc2Vzc2lvbi5jdXJyZW50TG9jYXRpb24uaGFzUGFydGlhbFJlY2VpdmluZ1N1cHBvcnQsCiAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZVdpdGhEZWZhdWx0TWVzc2FnZShnZXRUcmFuc2xhdGUoc3RhdGUubG9jYWxpemUpKQogIH07Cn07CmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzLCB7CiAgc2hvd1NwaW5uZXI6IHNob3dTcGlubmVyLAogIGhpZGVTcGlubmVyOiBoaWRlU3Bpbm5lcgp9KShQYXJ0aWFsUmVjZWl2aW5nUGFnZSk7ClBhcnRpYWxSZWNlaXZpbmdQYWdlLnByb3BUeXBlcyA9IHsKICAvKiogRnVuY3Rpb24gY2FsbGVkIHdoZW4gZGF0YSBpcyBsb2FkaW5nICovCiAgc2hvd1NwaW5uZXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGRhdGEgaGFzIGxvYWRlZCAqLwogIGhpZGVTcGlubmVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIGhhc0JpbkxvY2F0aW9uU3VwcG9ydDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICAvKiogQXJyYXkgb2YgYXZhaWxhYmxlIGJpbiBsb2NhdGlvbnMgICovCiAgYmluczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnNoYXBlKHt9KSksCiAgLyoqIExvY2F0aW9uIElEIChkZXN0aW5hdGlvbikuIE5lZWRzIHRvIGJlIHVzZWQgaW4gL2FwaS9wcm9kdWN0cyByZXF1ZXN0LiAqLwogIGxvY2F0aW9uSWQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCwKICBwYXJ0aWFsUmVjZWl2aW5nVHJhbnNsYXRpb25zRmV0Y2hlZDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICBtYXRjaDogUHJvcFR5cGVzLnNoYXBlKHsKICAgIHBhcmFtczogUHJvcFR5cGVzLnNoYXBlKHsKICAgICAgc2hpcG1lbnRJZDogUHJvcFR5cGVzLnN0cmluZwogICAgfSkKICB9KS5pc1JlcXVpcmVkLAogIG5leHRQYWdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBJcyB0cnVlIHdoZW4gY3VycmVudGx5IHNlbGVjdGVkIGxvY2F0aW9uIHN1cHBvcnRzIHBhcnRpYWwgcmVjZWl2aW5nICovCiAgaGFzUGFydGlhbFJlY2VpdmluZ1N1cHBvcnQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgdHJhbnNsYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkCn07ClBhcnRpYWxSZWNlaXZpbmdQYWdlLmRlZmF1bHRQcm9wcyA9IHsKICBiaW5zOiBbXSwKICBtYXRjaDoge30KfTs="},null]}