{"remainingRequest":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js?presets[]=@babel/react&presets[]=@babel/env!/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js!/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/inbound/AddItemsPage.jsx","dependencies":[{"path":"/opt/MTOBS-BIKASH/src/js/components/stock-movement-wizard/inbound/AddItemsPage.jsx","mtime":1698037749000},{"path":"/opt/MTOBS-BIKASH/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/MTOBS-BIKASH/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/opt/MTOBS-BIKASH/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfSwgX3R5cGVvZihvYmopOyB9CmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBlbnVtZXJhYmxlT25seSAmJiAoc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pKSwga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBudWxsICE9IGFyZ3VtZW50c1tpXSA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpICUgMiA/IG93bktleXMoT2JqZWN0KHNvdXJjZSksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpIDogb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSByZXR1cm4gdGFyZ2V0OyB9CmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOyB9IH0KZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN1YkNsYXNzLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsga2V5ID0gX3RvUHJvcGVydHlLZXkoa2V5KTsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CmZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgeyB2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgInN0cmluZyIpOyByZXR1cm4gX3R5cGVvZihrZXkpID09PSAic3ltYm9sIiA/IGtleSA6IFN0cmluZyhrZXkpOyB9CmZ1bmN0aW9uIF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkgeyBpZiAoX3R5cGVvZihpbnB1dCkgIT09ICJvYmplY3QiIHx8IGlucHV0ID09PSBudWxsKSByZXR1cm4gaW5wdXQ7IHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTsgaWYgKHByaW0gIT09IHVuZGVmaW5lZCkgeyB2YXIgcmVzID0gcHJpbS5jYWxsKGlucHV0LCBoaW50IHx8ICJkZWZhdWx0Iik7IGlmIChfdHlwZW9mKHJlcykgIT09ICJvYmplY3QiKSByZXR1cm4gcmVzOyB0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpOyB9IHJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTsgfQppbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnOwppbXBvcnQgYXJyYXlNdXRhdG9ycyBmcm9tICdmaW5hbC1mb3JtLWFycmF5cyc7CmltcG9ydCB1cGRhdGUgZnJvbSAnaW1tdXRhYmlsaXR5LWhlbHBlcic7CmltcG9ydCBmaWxlRG93bmxvYWQgZnJvbSAnanMtZmlsZS1kb3dubG9hZCc7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JzsKaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJzsKaW1wb3J0IHsgY29uZmlybUFsZXJ0IH0gZnJvbSAncmVhY3QtY29uZmlybS1hbGVydCc7CmltcG9ydCB7IEZvcm0gfSBmcm9tICdyZWFjdC1maW5hbC1mb3JtJzsKaW1wb3J0IHsgZ2V0VHJhbnNsYXRlIH0gZnJvbSAncmVhY3QtbG9jYWxpemUtcmVkdXgnOwppbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnOwppbXBvcnQgQWxlcnQgZnJvbSAncmVhY3Qtcy1hbGVydCc7CmltcG9ydCB7IGZldGNoVXNlcnMsIGhpZGVTcGlubmVyLCBzaG93U3Bpbm5lciB9IGZyb20gJ2FjdGlvbnMnOwppbXBvcnQgQXJyYXlGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvQXJyYXlGaWVsZCc7CmltcG9ydCBCdXR0b25GaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvQnV0dG9uRmllbGQnOwppbXBvcnQgRGF0ZUZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9EYXRlRmllbGQnOwppbXBvcnQgUHJvZHVjdFNlbGVjdEZpZWxkIGZyb20gJ2NvbXBvbmVudHMvZm9ybS1lbGVtZW50cy9Qcm9kdWN0U2VsZWN0RmllbGQnOwppbXBvcnQgU2VsZWN0RmllbGQgZnJvbSAnY29tcG9uZW50cy9mb3JtLWVsZW1lbnRzL1NlbGVjdEZpZWxkJzsKaW1wb3J0IFRleHRGaWVsZCBmcm9tICdjb21wb25lbnRzL2Zvcm0tZWxlbWVudHMvVGV4dEZpZWxkJzsKaW1wb3J0IGFwaUNsaWVudCBmcm9tICd1dGlscy9hcGlDbGllbnQnOwppbXBvcnQgeyByZW5kZXJGb3JtRmllbGQgfSBmcm9tICd1dGlscy9mb3JtLXV0aWxzJzsKaW1wb3J0IFRyYW5zbGF0ZSwgeyB0cmFuc2xhdGVXaXRoRGVmYXVsdE1lc3NhZ2UgfSBmcm9tICd1dGlscy9UcmFuc2xhdGUnOwppbXBvcnQgJ3JlYWN0LWNvbmZpcm0tYWxlcnQvc3JjL3JlYWN0LWNvbmZpcm0tYWxlcnQuY3NzJzsKdmFyIERFTEVURV9CVVRUT05fRklFTEQgPSB7CiAgdHlwZTogQnV0dG9uRmllbGQsCiAgbGFiZWw6ICdyZWFjdC5kZWZhdWx0LmJ1dHRvbi5kZWxldGUubGFiZWwnLAogIGRlZmF1bHRNZXNzYWdlOiAnRGVsZXRlJywKICBmbGV4V2lkdGg6ICcxJywKICBmaWVsZEtleTogJycsCiAgYnV0dG9uTGFiZWw6ICdyZWFjdC5kZWZhdWx0LmJ1dHRvbi5kZWxldGUubGFiZWwnLAogIGJ1dHRvbkRlZmF1bHRNZXNzYWdlOiAnRGVsZXRlJywKICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZikgewogICAgdmFyIGZpZWxkVmFsdWUgPSBfcmVmLmZpZWxkVmFsdWUsCiAgICAgIHJlbW92ZUl0ZW0gPSBfcmVmLnJlbW92ZUl0ZW0sCiAgICAgIHJlbW92ZVJvdyA9IF9yZWYucmVtb3ZlUm93LAogICAgICB1cGRhdGVUb3RhbENvdW50ID0gX3JlZi51cGRhdGVUb3RhbENvdW50OwogICAgcmV0dXJuIHsKICAgICAgb25DbGljazogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLmlkID8gZnVuY3Rpb24gKCkgewogICAgICAgIHJlbW92ZUl0ZW0oZmllbGRWYWx1ZS5pZCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB1cGRhdGVUb3RhbENvdW50KC0xKTsKICAgICAgICAgIHJlbW92ZVJvdygpOwogICAgICAgIH0pOwogICAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgIHVwZGF0ZVRvdGFsQ291bnQoLTEpOwogICAgICAgIHJlbW92ZVJvdygpOwogICAgICB9LAogICAgICBkaXNhYmxlZDogZmllbGRWYWx1ZSAmJiBmaWVsZFZhbHVlLnN0YXR1c0NvZGUgPT09ICdTVUJTVElUVVRFRCcKICAgIH07CiAgfSwKICBhdHRyaWJ1dGVzOiB7CiAgICBjbGFzc05hbWU6ICdidG4gYnRuLW91dGxpbmUtZGFuZ2VyJwogIH0KfTsKdmFyIFZFTkRPUl9GSUVMRFMgPSB7CiAgbGluZUl0ZW1zOiB7CiAgICB0eXBlOiBBcnJheUZpZWxkLAogICAgYXJyb3dzTmF2aWdhdGlvbjogdHJ1ZSwKICAgIHZpcnR1YWxpemVkOiB0cnVlLAogICAgdG90YWxDb3VudDogZnVuY3Rpb24gdG90YWxDb3VudChfcmVmMikgewogICAgICB2YXIgX3RvdGFsQ291bnQgPSBfcmVmMi50b3RhbENvdW50OwogICAgICByZXR1cm4gX3RvdGFsQ291bnQ7CiAgICB9LAogICAgaXNSb3dMb2FkZWQ6IGZ1bmN0aW9uIGlzUm93TG9hZGVkKF9yZWYzKSB7CiAgICAgIHZhciBfaXNSb3dMb2FkZWQgPSBfcmVmMy5pc1Jvd0xvYWRlZDsKICAgICAgcmV0dXJuIF9pc1Jvd0xvYWRlZDsKICAgIH0sCiAgICBsb2FkTW9yZVJvd3M6IGZ1bmN0aW9uIGxvYWRNb3JlUm93cyhfcmVmNCkgewogICAgICB2YXIgX2xvYWRNb3JlUm93cyA9IF9yZWY0LmxvYWRNb3JlUm93czsKICAgICAgcmV0dXJuIF9sb2FkTW9yZVJvd3MoKTsKICAgIH0sCiAgICBpc0ZpcnN0UGFnZUxvYWRlZDogZnVuY3Rpb24gaXNGaXJzdFBhZ2VMb2FkZWQoX3JlZjUpIHsKICAgICAgdmFyIF9pc0ZpcnN0UGFnZUxvYWRlZCA9IF9yZWY1LmlzRmlyc3RQYWdlTG9hZGVkOwogICAgICByZXR1cm4gX2lzRmlyc3RQYWdlTG9hZGVkOwogICAgfSwKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9wcm9wLXR5cGVzCiAgICBhZGRCdXR0b246IGZ1bmN0aW9uIGFkZEJ1dHRvbihfcmVmNikgewogICAgICB2YXIgYWRkUm93ID0gX3JlZjYuYWRkUm93LAogICAgICAgIGdldFNvcnRPcmRlciA9IF9yZWY2LmdldFNvcnRPcmRlciwKICAgICAgICBpc0Zyb21PcmRlciA9IF9yZWY2LmlzRnJvbU9yZGVyLAogICAgICAgIHVwZGF0ZVRvdGFsQ291bnQgPSBfcmVmNi51cGRhdGVUb3RhbENvdW50OwogICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtc3VjY2VzcyBidG4teHMiLAogICAgICAgIGhpZGRlbjogaXNGcm9tT3JkZXIsCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHVwZGF0ZVRvdGFsQ291bnQoMSk7CiAgICAgICAgICBhZGRSb3coewogICAgICAgICAgICBzb3J0T3JkZXI6IGdldFNvcnRPcmRlcigpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtcGx1cyBwci0yIgogICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5hZGRMaW5lLmxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkFkZCBsaW5lIgogICAgICB9KSkpOwogICAgfSwKICAgIGZpZWxkczogewogICAgICBwYWxsZXROYW1lOiB7CiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5wYWNrTGV2ZWwxLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1BhY2sgbGV2ZWwgMScsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY3KSB7CiAgICAgICAgICB2YXIgcm93SW5kZXggPSBfcmVmNy5yb3dJbmRleCwKICAgICAgICAgICAgcm93Q291bnQgPSBfcmVmNy5yb3dDb3VudCwKICAgICAgICAgICAgdXBkYXRlUm93ID0gX3JlZjcudXBkYXRlUm93LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmNy52YWx1ZXM7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBhdXRvRm9jdXM6IHJvd0luZGV4ID09PSByb3dDb3VudCAtIDEsCiAgICAgICAgICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICAgICAgICAgIHJldHVybiB1cGRhdGVSb3codmFsdWVzLCByb3dJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBib3hOYW1lOiB7CiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5wYWNrTGV2ZWwyLmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1BhY2sgbGV2ZWwgMicsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWY4KSB7CiAgICAgICAgICB2YXIgcm93SW5kZXggPSBfcmVmOC5yb3dJbmRleCwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjgudmFsdWVzLAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmOC51cGRhdGVSb3c7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlUm93KHZhbHVlcywgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcHJvZHVjdDogewogICAgICAgIHR5cGU6IFByb2R1Y3RTZWxlY3RGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQucHJvZHVjdC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdQcm9kdWN0JywKICAgICAgICBoZWFkZXJBbGlnbjogJ2xlZnQnLAogICAgICAgIGZsZXhXaWR0aDogJzQnLAogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHNob3dTZWxlY3RlZE9wdGlvbkNvbG9yOiB0cnVlCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjkpIHsKICAgICAgICAgIHZhciB1cGRhdGVSb3cgPSBfcmVmOS51cGRhdGVSb3csCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjkucm93SW5kZXgsCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWY5LnZhbHVlcywKICAgICAgICAgICAgb3JpZ2luSWQgPSBfcmVmOS5vcmlnaW5JZCwKICAgICAgICAgICAgZm9jdXNGaWVsZCA9IF9yZWY5LmZvY3VzRmllbGQ7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsb2NhdGlvbklkOiBvcmlnaW5JZCwKICAgICAgICAgICAgb25FeGFjdFByb2R1Y3RTZWxlY3RlZDogZnVuY3Rpb24gb25FeGFjdFByb2R1Y3RTZWxlY3RlZChfcmVmMTApIHsKICAgICAgICAgICAgICB2YXIgcHJvZHVjdCA9IF9yZWYxMC5wcm9kdWN0OwogICAgICAgICAgICAgIGlmIChmb2N1c0ZpZWxkICYmIHByb2R1Y3QpIHsKICAgICAgICAgICAgICAgIGZvY3VzRmllbGQocm93SW5kZXgsICdxdWFudGl0eVJlcXVlc3RlZCcpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVJvdyh2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGxvdE51bWJlcjogewogICAgICAgIHR5cGU6IFRleHRGaWVsZCwKICAgICAgICBsYWJlbDogJ3JlYWN0LnN0b2NrTW92ZW1lbnQubG90LmxhYmVsJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0xvdCcsCiAgICAgICAgZmxleFdpZHRoOiAnMScsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYxMSkgewogICAgICAgICAgdmFyIHJvd0luZGV4ID0gX3JlZjExLnJvd0luZGV4LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMTEudmFsdWVzLAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMTEudXBkYXRlUm93OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVJvdyh2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGV4cGlyYXRpb25EYXRlOiB7CiAgICAgICAgdHlwZTogRGF0ZUZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5leHBpcnkubGFiZWwnLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRXhwaXJ5JywKICAgICAgICBmbGV4V2lkdGg6ICcxLjUnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGRhdGVGb3JtYXQ6ICdNTS9ERC9ZWVlZJywKICAgICAgICAgIGF1dG9Db21wbGV0ZTogJ29mZicsCiAgICAgICAgICBwbGFjZWhvbGRlclRleHQ6ICdNTS9ERC9ZWVlZJwogICAgICAgIH0sCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYxMikgewogICAgICAgICAgdmFyIHJvd0luZGV4ID0gX3JlZjEyLnJvd0luZGV4LAogICAgICAgICAgICB2YWx1ZXMgPSBfcmVmMTIudmFsdWVzLAogICAgICAgICAgICB1cGRhdGVSb3cgPSBfcmVmMTIudXBkYXRlUm93OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVJvdyh2YWx1ZXMsIHJvd0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiB7CiAgICAgICAgdHlwZTogVGV4dEZpZWxkLAogICAgICAgIGxhYmVsOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5xdWFudGl0eS5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdRdHknLAogICAgICAgIGZsZXhXaWR0aDogJzEnLAogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHR5cGU6ICdudW1iZXInCiAgICAgICAgfSwKICAgICAgICBnZXREeW5hbWljQXR0cjogZnVuY3Rpb24gZ2V0RHluYW1pY0F0dHIoX3JlZjEzKSB7CiAgICAgICAgICB2YXIgcm93SW5kZXggPSBfcmVmMTMucm93SW5kZXgsCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYxMy52YWx1ZXMsCiAgICAgICAgICAgIHVwZGF0ZVJvdyA9IF9yZWYxMy51cGRhdGVSb3c7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlUm93KHZhbHVlcywgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmVjaXBpZW50OiB7CiAgICAgICAgdHlwZTogU2VsZWN0RmllbGQsCiAgICAgICAgbGFiZWw6ICdyZWFjdC5zdG9ja01vdmVtZW50LnJlY2lwaWVudC5sYWJlbCcsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZWNpcGllbnQnLAogICAgICAgIGZsZXhXaWR0aDogJzEuNScsCiAgICAgICAgZ2V0RHluYW1pY0F0dHI6IGZ1bmN0aW9uIGdldER5bmFtaWNBdHRyKF9yZWYxNCkgewogICAgICAgICAgdmFyIHJlY2lwaWVudHMgPSBfcmVmMTQucmVjaXBpZW50cywKICAgICAgICAgICAgYWRkUm93ID0gX3JlZjE0LmFkZFJvdywKICAgICAgICAgICAgcm93Q291bnQgPSBfcmVmMTQucm93Q291bnQsCiAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjE0LnJvd0luZGV4LAogICAgICAgICAgICBnZXRTb3J0T3JkZXIgPSBfcmVmMTQuZ2V0U29ydE9yZGVyLAogICAgICAgICAgICB1cGRhdGVUb3RhbENvdW50ID0gX3JlZjE0LnVwZGF0ZVRvdGFsQ291bnQsCiAgICAgICAgICAgIHVwZGF0ZVJvdyA9IF9yZWYxNC51cGRhdGVSb3csCiAgICAgICAgICAgIHZhbHVlcyA9IF9yZWYxNC52YWx1ZXM7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvcHRpb25zOiByZWNpcGllbnRzLAogICAgICAgICAgICBvblRhYlByZXNzOiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHVwZGF0ZVRvdGFsQ291bnQoMSk7CiAgICAgICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgIGFycm93UmlnaHQ6IHJvd0NvdW50ID09PSByb3dJbmRleCArIDEgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdXBkYXRlVG90YWxDb3VudCgxKTsKICAgICAgICAgICAgICBhZGRSb3coewogICAgICAgICAgICAgICAgc29ydE9yZGVyOiBnZXRTb3J0T3JkZXIoKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IDogbnVsbCwKICAgICAgICAgICAgYXJyb3dEb3duOiByb3dDb3VudCA9PT0gcm93SW5kZXggKyAxID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHVwZGF0ZVRvdGFsQ291bnQoMSk7CiAgICAgICAgICAgICAgYWRkUm93KHsKICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogZ2V0U29ydE9yZGVyKCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICAgICAgICAgIHJldHVybiB1cGRhdGVSb3codmFsdWVzLCByb3dJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBsYWJlbEtleTogJ25hbWUnLAogICAgICAgICAgb3Blbk9uQ2xpY2s6IGZhbHNlCiAgICAgICAgfQogICAgICB9LAogICAgICBkZWxldGVCdXR0b246IERFTEVURV9CVVRUT05fRklFTEQKICAgIH0KICB9Cn07CgovKiBlc2xpbnQgY2xhc3MtbWV0aG9kcy11c2UtdGhpczogWyJlcnJvciIseyAiZXhjZXB0TWV0aG9kcyI6IFsiZ2V0TGluZUl0ZW1zVG9CZVNhdmVkIl0gfV0gKi8KLyoqCiAqIFRoZSBzZWNvbmQgc3RlcCBvZiBzdG9jayBtb3ZlbWVudCB3aGVyZSB1c2VyIGNhbiBhZGQgaXRlbXMgdG8gc3RvY2sgbGlzdC4KICogVGhpcyBjb21wb25lbnQgc3VwcG9ydHMgdGhyZWUgZGlmZmVyZW50IGNhc2VzOiB3aXRoIG9yIHdpdGhvdXQgc3RvY2tsaXN0CiAqIHdoZW4gbW92ZW1lbnQgaXMgZnJvbSBhIGRlcG90IGFuZCB3aGVuIG1vdmVtZW50IGlzIGZyb20gYSB2ZW5kb3IuCiAqLwp2YXIgQWRkSXRlbXNQYWdlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKEFkZEl0ZW1zUGFnZSwgX0NvbXBvbmVudCk7CiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihBZGRJdGVtc1BhZ2UpOwogIGZ1bmN0aW9uIEFkZEl0ZW1zUGFnZShwcm9wcykgewogICAgdmFyIF90aGlzOwogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFkZEl0ZW1zUGFnZSk7CiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKTsKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRhdGFGZXRjaGVkIiwgZmFsc2UpOwogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIGN1cnJlbnRMaW5lSXRlbXM6IFtdLAogICAgICBzb3J0T3JkZXI6IDAsCiAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5wcm9wcy5pbml0aWFsVmFsdWVzKSwge30sIHsKICAgICAgICBsaW5lSXRlbXM6IFtdCiAgICAgIH0pLAogICAgICBuZXdJdGVtOiBmYWxzZSwKICAgICAgdG90YWxDb3VudDogMCwKICAgICAgaXNGaXJzdFBhZ2VMb2FkZWQ6IGZhbHNlCiAgICB9OwogICAgX3RoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgIF90aGlzLnJlbW92ZUl0ZW0gPSBfdGhpcy5yZW1vdmVJdGVtLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMuaW1wb3J0VGVtcGxhdGUgPSBfdGhpcy5pbXBvcnRUZW1wbGF0ZS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmdldFNvcnRPcmRlciA9IF90aGlzLmdldFNvcnRPcmRlci5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmNvbmZpcm1TYXZlID0gX3RoaXMuY29uZmlybVNhdmUuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5jb25maXJtVHJhbnNpdGlvbiA9IF90aGlzLmNvbmZpcm1UcmFuc2l0aW9uLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMubmV3SXRlbUFkZGVkID0gX3RoaXMubmV3SXRlbUFkZGVkLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMudmFsaWRhdGUgPSBfdGhpcy52YWxpZGF0ZS5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIF90aGlzLmlzVmFsaWRGb3JTYXZlID0gX3RoaXMuaXNWYWxpZEZvclNhdmUuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5pc1Jvd0xvYWRlZCA9IF90aGlzLmlzUm93TG9hZGVkLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMubG9hZE1vcmVSb3dzID0gX3RoaXMubG9hZE1vcmVSb3dzLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgX3RoaXMudXBkYXRlVG90YWxDb3VudCA9IF90aGlzLnVwZGF0ZVRvdGFsQ291bnQuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy51cGRhdGVSb3cgPSBfdGhpcy51cGRhdGVSb3cuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQogIF9jcmVhdGVDbGFzcyhBZGRJdGVtc1BhZ2UsIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIGlmICh0aGlzLnByb3BzLnN0b2NrTW92ZW1lbnRUcmFuc2xhdGlvbnNGZXRjaGVkKSB7CiAgICAgICAgdGhpcy5kYXRhRmV0Y2hlZCA9IHRydWU7CiAgICAgICAgdGhpcy5mZXRjaEFsbERhdGEoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7CiAgICAgIGlmIChuZXh0UHJvcHMuc3RvY2tNb3ZlbWVudFRyYW5zbGF0aW9uc0ZldGNoZWQgJiYgIXRoaXMuZGF0YUZldGNoZWQpIHsKICAgICAgICB0aGlzLmRhdGFGZXRjaGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmZldGNoQWxsRGF0YSgpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIG5ldyBzdG9jayBtb3ZlbWVudCdzIGl0ZW1zIGFuZCBpdGVtcyB0byBiZQogICAgICogdXBkYXRlZCAoY29tcGFyaW5nIHRvIHByZXZpb3VzIHN0YXRlIG9mIGxpbmUgaXRlbXMpLgogICAgICogQHBhcmFtIHtvYmplY3R9IGxpbmVJdGVtcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiZ2V0TGluZUl0ZW1zVG9CZVNhdmVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMaW5lSXRlbXNUb0JlU2F2ZWQobGluZUl0ZW1zKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwogICAgICB2YXIgbGluZUl0ZW1zVG9CZUFkZGVkID0gXy5maWx0ZXIobGluZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiAhaXRlbS5zdGF0dXNDb2RlICYmIGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgJiYgaXRlbS5xdWFudGl0eVJlcXVlc3RlZCAhPT0gJzAnICYmIGl0ZW0ucHJvZHVjdDsKICAgICAgfSk7CiAgICAgIHZhciBsaW5lSXRlbXNXaXRoU3RhdHVzID0gXy5maWx0ZXIobGluZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnN0YXR1c0NvZGU7CiAgICAgIH0pOwogICAgICB2YXIgbGluZUl0ZW1zVG9CZVVwZGF0ZWQgPSBbXTsKICAgICAgXy5mb3JFYWNoKGxpbmVJdGVtc1dpdGhTdGF0dXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdmFyIG9sZEl0ZW0gPSBfLmZpbmQoX3RoaXMyLnN0YXRlLmN1cnJlbnRMaW5lSXRlbXMsIGZ1bmN0aW9uIChvbGQpIHsKICAgICAgICAgIHJldHVybiBvbGQuaWQgPT09IGl0ZW0uaWQ7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIG9sZFF0eSA9IHBhcnNlSW50KG9sZEl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQsIDEwKTsKICAgICAgICB2YXIgbmV3UXR5ID0gcGFyc2VJbnQoaXRlbS5xdWFudGl0eVJlcXVlc3RlZCwgMTApOwogICAgICAgIHZhciBvbGRSZWNpcGllbnQgPSBvbGRJdGVtLnJlY2lwaWVudCAmJiBfLmlzT2JqZWN0KG9sZEl0ZW0ucmVjaXBpZW50KSA/IG9sZEl0ZW0ucmVjaXBpZW50LmlkIDogb2xkSXRlbS5yZWNpcGllbnQ7CiAgICAgICAgdmFyIG5ld1JlY2lwaWVudCA9IGl0ZW0ucmVjaXBpZW50ICYmIF8uaXNPYmplY3QoaXRlbS5yZWNpcGllbnQpID8gaXRlbS5yZWNpcGllbnQuaWQgOiBpdGVtLnJlY2lwaWVudDsKCiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIG9mIGtleXMgY29tbW9uIHRvIGJvdGggb2JqZWN0cyAoZXhjbHVkaW5nIHByb2R1Y3Qga2V5KQogICAgICAgIHZhciBrZXlJbnRlcnNlY3Rpb24gPSBfLnJlbW92ZShfLmludGVyc2VjdGlvbihfLmtleXMob2xkSXRlbSksIF8ua2V5cyhpdGVtKSksIGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIHJldHVybiBrZXkgIT09ICdwcm9kdWN0JzsKICAgICAgICB9KTsKICAgICAgICBpZiAoIV8uaXNFcXVhbChfLnBpY2soaXRlbSwga2V5SW50ZXJzZWN0aW9uKSwgXy5waWNrKG9sZEl0ZW0sIGtleUludGVyc2VjdGlvbikpIHx8IGl0ZW0ucHJvZHVjdC5pZCAhPT0gb2xkSXRlbS5wcm9kdWN0LmlkKSB7CiAgICAgICAgICBsaW5lSXRlbXNUb0JlVXBkYXRlZC5wdXNoKGl0ZW0pOwogICAgICAgIH0gZWxzZSBpZiAobmV3UXR5ICE9PSBvbGRRdHkgfHwgbmV3UmVjaXBpZW50ICE9PSBvbGRSZWNpcGllbnQpIHsKICAgICAgICAgIGxpbmVJdGVtc1RvQmVVcGRhdGVkLnB1c2goaXRlbSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIFtdLmNvbmNhdChfLm1hcChsaW5lSXRlbXNUb0JlQWRkZWQsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICdwcm9kdWN0LmlkJzogaXRlbS5wcm9kdWN0LmlkLAogICAgICAgICAgcXVhbnRpdHlSZXF1ZXN0ZWQ6IGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQsCiAgICAgICAgICBwYWxsZXROYW1lOiBpdGVtLnBhbGxldE5hbWUsCiAgICAgICAgICBib3hOYW1lOiBpdGVtLmJveE5hbWUsCiAgICAgICAgICBsb3ROdW1iZXI6IGl0ZW0ubG90TnVtYmVyLAogICAgICAgICAgZXhwaXJhdGlvbkRhdGU6IGl0ZW0uZXhwaXJhdGlvbkRhdGUsCiAgICAgICAgICAncmVjaXBpZW50LmlkJzogXy5pc09iamVjdChpdGVtLnJlY2lwaWVudCkgPyBpdGVtLnJlY2lwaWVudC5pZCB8fCAnJyA6IGl0ZW0ucmVjaXBpZW50IHx8ICcnLAogICAgICAgICAgc29ydE9yZGVyOiBpdGVtLnNvcnRPcmRlcgogICAgICAgIH07CiAgICAgIH0pLCBfLm1hcChsaW5lSXRlbXNUb0JlVXBkYXRlZCwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaWQ6IGl0ZW0uaWQsCiAgICAgICAgICAncHJvZHVjdC5pZCc6IGl0ZW0ucHJvZHVjdC5pZCwKICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiBpdGVtLnF1YW50aXR5UmVxdWVzdGVkLAogICAgICAgICAgcGFsbGV0TmFtZTogaXRlbS5wYWxsZXROYW1lLAogICAgICAgICAgYm94TmFtZTogaXRlbS5ib3hOYW1lLAogICAgICAgICAgbG90TnVtYmVyOiBpdGVtLmxvdE51bWJlciwKICAgICAgICAgIGV4cGlyYXRpb25EYXRlOiBpdGVtLmV4cGlyYXRpb25EYXRlLAogICAgICAgICAgJ3JlY2lwaWVudC5pZCc6IF8uaXNPYmplY3QoaXRlbS5yZWNpcGllbnQpID8gaXRlbS5yZWNpcGllbnQuaWQgfHwgJycgOiBpdGVtLnJlY2lwaWVudCB8fCAnJywKICAgICAgICAgIHNvcnRPcmRlcjogaXRlbS5zb3J0T3JkZXIKICAgICAgICB9OwogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0U29ydE9yZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTb3J0T3JkZXIoKSB7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIHNvcnRPcmRlcjogdGhpcy5zdGF0ZS5zb3J0T3JkZXIgKyAxMDAKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLnN0YXRlLnNvcnRPcmRlcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRMaW5lSXRlbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldExpbmVJdGVtcyhyZXNwb25zZSwgc3RhcnRJbmRleCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgIHZhciBsaW5lSXRlbXNEYXRhOwogICAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zLmxlbmd0aCA9PT0gMCAmJiAhZGF0YS5sZW5ndGgpIHsKICAgICAgICBsaW5lSXRlbXNEYXRhID0gbmV3IEFycmF5KDEpLmZpbGwoewogICAgICAgICAgc29ydE9yZGVyOiAxMDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsaW5lSXRlbXNEYXRhID0gXy5tYXAoZGF0YSwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdmFsKSwge30sIHsKICAgICAgICAgICAgZGlzYWJsZWQ6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHZhciBzb3J0T3JkZXIgPSBfLnRvSW50ZWdlcihfLmxhc3QobGluZUl0ZW1zRGF0YSkuc29ydE9yZGVyKSArIDEwMDsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgY3VycmVudExpbmVJdGVtczogdGhpcy5wcm9wcy5pc1BhZ2luYXRlZCA/IF8udW5pcUJ5KF8uY29uY2F0KHRoaXMuc3RhdGUuY3VycmVudExpbmVJdGVtcywgZGF0YSksICdpZCcpIDogZGF0YSwKICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5zdGF0ZS52YWx1ZXMpLCB7fSwgewogICAgICAgICAgbGluZUl0ZW1zOiB0aGlzLnByb3BzLmlzUGFnaW5hdGVkID8gXy51bmlxQnkoXy5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMubGluZUl0ZW1zLCBsaW5lSXRlbXNEYXRhKSwgJ2lkJykgOiBsaW5lSXRlbXNEYXRhCiAgICAgICAgfSksCiAgICAgICAgc29ydE9yZGVyOiBzb3J0T3JkZXIKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghXy5pc051bGwoc3RhcnRJbmRleCkgJiYgX3RoaXMzLnN0YXRlLnZhbHVlcy5saW5lSXRlbXMubGVuZ3RoICE9PSBfdGhpczMuc3RhdGUudG90YWxDb3VudCkgewogICAgICAgICAgX3RoaXMzLmxvYWRNb3JlUm93cyh7CiAgICAgICAgICAgIHN0YXJ0SW5kZXg6IHN0YXJ0SW5kZXggKyBfdGhpczMucHJvcHMucGFnZVNpemUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBfdGhpczMucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlVG90YWxDb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlVG90YWxDb3VudCh2YWx1ZSkgewogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICB0b3RhbENvdW50OiB0aGlzLnN0YXRlLnRvdGFsQ291bnQgKyB2YWx1ZSA9PT0gMCA/IDEgOiB0aGlzLnN0YXRlLnRvdGFsQ291bnQgKyB2YWx1ZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVSb3ciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVJvdyh2YWx1ZXMsIGluZGV4KSB7CiAgICAgIHZhciBpdGVtID0gdmFsdWVzLmxpbmVJdGVtc1tpbmRleF07CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIHZhbHVlczogdXBkYXRlKHZhbHVlcywgewogICAgICAgICAgbGluZUl0ZW1zOiBfZGVmaW5lUHJvcGVydHkoe30sIGluZGV4LCB7CiAgICAgICAgICAgICRzZXQ6IGl0ZW0KICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidmFsaWRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlKHZhbHVlcywgaWdub3JlTG90QW5kRXhwaXJ5KSB7CiAgICAgIHZhciBlcnJvcnMgPSB7fTsKICAgICAgZXJyb3JzLmxpbmVJdGVtcyA9IFtdOwogICAgICB2YXIgZGF0ZSA9IG1vbWVudCh0aGlzLnByb3BzLm1pbmltdW1FeHBpcmF0aW9uRGF0ZSwgJ01NL0REL1lZWVknKTsKICAgICAgXy5mb3JFYWNoKHZhbHVlcy5saW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtLCBrZXkpIHsKICAgICAgICBlcnJvcnMubGluZUl0ZW1zW2tleV0gPSB7fTsKICAgICAgICBpZiAoIV8uaXNOaWwoaXRlbS5wcm9kdWN0KSAmJiAoIWl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgfHwgaXRlbS5xdWFudGl0eVJlcXVlc3RlZCA8IDApKSB7CiAgICAgICAgICBlcnJvcnMubGluZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgICAgIHF1YW50aXR5UmVxdWVzdGVkOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5lbnRlclF1YW50aXR5LmxhYmVsJwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKCFfLmlzRW1wdHkoaXRlbS5ib3hOYW1lKSAmJiBfLmlzRW1wdHkoaXRlbS5wYWxsZXROYW1lKSkgewogICAgICAgICAgZXJyb3JzLmxpbmVJdGVtc1trZXldID0gewogICAgICAgICAgICBib3hOYW1lOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5ib3hXaXRob3V0UGFsbGV0LmxhYmVsJwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgdmFyIGRhdGVSZXF1ZXN0ZWQgPSBtb21lbnQoaXRlbS5leHBpcmF0aW9uRGF0ZSwgJ01NL0REL1lZWVknKTsKICAgICAgICBpZiAoZGF0ZS5kaWZmKGRhdGVSZXF1ZXN0ZWQpID4gMCkgewogICAgICAgICAgZXJyb3JzLmxpbmVJdGVtc1trZXldID0gewogICAgICAgICAgICBleHBpcmF0aW9uRGF0ZTogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3IuaW52YWxpZERhdGUubGFiZWwnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAoIWlnbm9yZUxvdEFuZEV4cGlyeSkgewogICAgICAgICAgaWYgKGl0ZW0uZXhwaXJhdGlvbkRhdGUgJiYgKF8uaXNOaWwoaXRlbS5sb3ROdW1iZXIpIHx8IF8uaXNFbXB0eShpdGVtLmxvdE51bWJlcikpKSB7CiAgICAgICAgICAgIGVycm9ycy5saW5lSXRlbXNba2V5XSA9IHsKICAgICAgICAgICAgICBsb3ROdW1iZXI6ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmV4cGlyeVdpdGhvdXRMb3QubGFiZWwnCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIV8uaXNOaWwoaXRlbS5wcm9kdWN0KSAmJiBpdGVtLnByb2R1Y3QubG90QW5kRXhwaXJ5Q29udHJvbCkgewogICAgICAgICAgICBpZiAoIWl0ZW0uZXhwaXJhdGlvbkRhdGUgJiYgKF8uaXNOaWwoaXRlbS5sb3ROdW1iZXIpIHx8IF8uaXNFbXB0eShpdGVtLmxvdE51bWJlcikpKSB7CiAgICAgICAgICAgICAgZXJyb3JzLmxpbmVJdGVtc1trZXldID0gewogICAgICAgICAgICAgICAgZXhwaXJhdGlvbkRhdGU6ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmxvdEFuZEV4cGlyeUNvbnRyb2wubGFiZWwnLAogICAgICAgICAgICAgICAgbG90TnVtYmVyOiAncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5sb3RBbmRFeHBpcnlDb250cm9sLmxhYmVsJwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWl0ZW0uZXhwaXJhdGlvbkRhdGUpIHsKICAgICAgICAgICAgICBlcnJvcnMubGluZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZTogJ3JlYWN0LnN0b2NrTW92ZW1lbnQuZXJyb3IubG90QW5kRXhwaXJ5Q29udHJvbC5sYWJlbCcKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgaWYgKF8uaXNOaWwoaXRlbS5sb3ROdW1iZXIpIHx8IF8uaXNFbXB0eShpdGVtLmxvdE51bWJlcikpIHsKICAgICAgICAgICAgICBlcnJvcnMubGluZUl0ZW1zW2tleV0gPSB7CiAgICAgICAgICAgICAgICBsb3ROdW1iZXI6ICdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmxvdEFuZEV4cGlyeUNvbnRyb2wubGFiZWwnCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBlcnJvcnM7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNWYWxpZEZvclNhdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzVmFsaWRGb3JTYXZlKHZhbHVlcykgewogICAgICB2YXIgZXJyb3JzID0gdGhpcy52YWxpZGF0ZSh2YWx1ZXMsIHRydWUpOwogICAgICByZXR1cm4gIWVycm9ycy5saW5lSXRlbXMgfHwgZXJyb3JzLmxpbmVJdGVtcy5ldmVyeShfLmlzRW1wdHkpOwogICAgfQogIH0sIHsKICAgIGtleTogIm5ld0l0ZW1BZGRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbmV3SXRlbUFkZGVkKCkgewogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBuZXdJdGVtOiB0cnVlCiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2hvd3Mgc2F2ZSBjb25maXJtYXRpb24gZGlhbG9nLgogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gb25Db25maXJtCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJjb25maXJtU2F2ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29uZmlybVNhdmUob25Db25maXJtKSB7CiAgICAgIGNvbmZpcm1BbGVydCh7CiAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50Lm1lc3NhZ2UuY29uZmlybVNhdmUubGFiZWwnLCAnQ29uZmlybSBzYXZlJyksCiAgICAgICAgbWVzc2FnZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVNhdmUubWVzc2FnZScsICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gc2F2ZT8gVGhlcmUgYXJlIHNvbWUgbGluZXMgd2l0aCBlbXB0eSBvciB6ZXJvIHF1YW50aXR5LCB0aG9zZSBsaW5lcyB3aWxsIGJlIGRlbGV0ZWQuJyksCiAgICAgICAgYnV0dG9uczogW3sKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC55ZXMubGFiZWwnLCAnWWVzJyksCiAgICAgICAgICBvbkNsaWNrOiBvbkNvbmZpcm0KICAgICAgICB9LCB7CiAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQubm8ubGFiZWwnLCAnTm8nKQogICAgICAgIH1dCiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2hvd3MgdHJhbnNpdGlvbiBjb25maXJtYXRpb24gZGlhbG9nIGlmIHRoZXJlIGFyZSBpdGVtcyB3aXRoIHRoZSBzYW1lIGNvZGUuCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBvbkNvbmZpcm0KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBpdGVtcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiY29uZmlybVRyYW5zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbmZpcm1UcmFuc2l0aW9uKG9uQ29uZmlybSwgaXRlbXMpIHsKICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVRyYW5zaXRpb24ubGFiZWwnLCAnWW91IGhhdmUgZW50ZXJlZCB0aGUgc2FtZSBjb2RlIHR3aWNlLiBEbyB5b3Ugd2FudCB0byBjb250aW51ZT8nKSwKICAgICAgICBtZXNzYWdlOiBfLm1hcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHZhciBfaXRlbSRwcm9kdWN0JGRpc3BsYXk7CiAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInAiLCB7CiAgICAgICAgICAgIGtleTogaXRlbS5zb3J0T3JkZXIKICAgICAgICAgIH0sICIiLmNvbmNhdChpdGVtLnByb2R1Y3QucHJvZHVjdENvZGUsICIgIikuY29uY2F0KCgoX2l0ZW0kcHJvZHVjdCRkaXNwbGF5ID0gaXRlbS5wcm9kdWN0LmRpc3BsYXlOYW1lcykgPT09IG51bGwgfHwgX2l0ZW0kcHJvZHVjdCRkaXNwbGF5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaXRlbSRwcm9kdWN0JGRpc3BsYXlbImRlZmF1bHQiXSkgfHwgaXRlbS5wcm9kdWN0Lm5hbWUsICIgIikuY29uY2F0KGl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQpKTsKICAgICAgICB9KSwKICAgICAgICBidXR0b25zOiBbewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lnllcy5sYWJlbCcsICdZZXMnKSwKICAgICAgICAgIG9uQ2xpY2s6IG9uQ29uZmlybQogICAgICAgIH0sIHsKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgfV0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93cyBJbnZlbnRvcnkgaXRlbSBleHBpcmF0aW9uIGRhdGUgdXBkYXRlIGNvbmZpcm1hdGlvbiBkaWFsb2cuCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBvbkNvbmZpcm0KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogImNvbmZpcm1JbnZlbnRvcnlJdGVtRXhwaXJhdGlvbkRhdGVVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbmZpcm1JbnZlbnRvcnlJdGVtRXhwaXJhdGlvbkRhdGVVcGRhdGUob25Db25maXJtKSB7CiAgICAgIGNvbmZpcm1BbGVydCh7CiAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50Lm1lc3NhZ2UuY29uZmlybVNhdmUubGFiZWwnLCAnQ29uZmlybSBzYXZlJyksCiAgICAgICAgbWVzc2FnZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybUV4cGlyeURhdGVVcGRhdGUubWVzc2FnZScsICdUaGlzIHdpbGwgdXBkYXRlIHRoZSBleHBpcnkgZGF0ZSBhY3Jvc3MgYWxsIGRlcG90cyBpbiB0aGUgc3lzdGVtLiBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcHJvY2VlZD8nKSwKICAgICAgICBidXR0b25zOiBbewogICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5kZWZhdWx0Lnllcy5sYWJlbCcsICdZZXMnKSwKICAgICAgICAgIG9uQ2xpY2s6IG9uQ29uZmlybQogICAgICAgIH0sIHsKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC5uby5sYWJlbCcsICdObycpCiAgICAgICAgfV0KICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGZXRjaGVzIGFsbCByZXF1aXJlZCBkYXRhLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiZmV0Y2hBbGxEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaEFsbERhdGEoKSB7CiAgICAgIHRoaXMucHJvcHMuZmV0Y2hVc2VycygpOwogICAgICB0aGlzLmZldGNoQWRkSXRlbXNQYWdlRGF0YSgpOwogICAgICBpZiAoIXRoaXMucHJvcHMuaXNQYWdpbmF0ZWQpIHsKICAgICAgICB0aGlzLmZldGNoTGluZUl0ZW1zKCk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZldGNoZXMgMm5kIHN0ZXAgZGF0YSBmcm9tIGN1cnJlbnQgc3RvY2sgbW92ZW1lbnQuCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJmZXRjaExpbmVJdGVtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hMaW5lSXRlbXMoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRzLyIuY29uY2F0KHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwgIi9zdG9ja01vdmVtZW50SXRlbXM/c3RlcE51bWJlcj0yIik7CiAgICAgIHJldHVybiBhcGlDbGllbnQuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczQuc2V0U3RhdGUoewogICAgICAgICAgdG90YWxDb3VudDogcmVzcG9uc2UuZGF0YS5kYXRhLmxlbmd0aAogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczQuc2V0TGluZUl0ZW1zKHJlc3BvbnNlLCBudWxsKTsKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycikgewogICAgICAgIHJldHVybiBlcnI7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogRmV0Y2hlcyBzdG9jayBtb3ZlbWVudCdzIGxpbmUgaXRlbXMgYW5kIHNldHMgdGhlbSBpbiByZWR1eCBmb3JtIGFuZCBpbgogICAgICogc3RhdGUgYXMgY3VycmVudCBsaW5lIGl0ZW1zLgogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAiZmV0Y2hBZGRJdGVtc1BhZ2VEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaEFkZEl0ZW1zUGFnZURhdGEoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHZhciB1cmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkKTsKICAgICAgYXBpQ2xpZW50LmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICB2YXIgaGFzTWFuYWdlSW52ZW50b3J5ID0gcmVzcC5kYXRhLmRhdGEuaGFzTWFuYWdlSW52ZW50b3J5OwogICAgICAgIHZhciBzdGF0dXNDb2RlID0gcmVzcC5kYXRhLmRhdGEuc3RhdHVzQ29kZTsKICAgICAgICB2YXIgdG90YWxDb3VudCA9IHJlc3AuZGF0YS50b3RhbENvdW50OwogICAgICAgIF90aGlzNS5zZXRTdGF0ZSh7CiAgICAgICAgICB2YWx1ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXM1LnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICAgIGhhc01hbmFnZUludmVudG9yeTogaGFzTWFuYWdlSW52ZW50b3J5LAogICAgICAgICAgICBzdGF0dXNDb2RlOiBzdGF0dXNDb2RlCiAgICAgICAgICB9KSwKICAgICAgICAgIHRvdGFsQ291bnQ6IHRvdGFsQ291bnQgPT09IDAgPyAxIDogdG90YWxDb3VudAogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczUucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAibG9hZE1vcmVSb3dzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkTW9yZVJvd3MoX3JlZjE1KSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwogICAgICB2YXIgc3RhcnRJbmRleCA9IF9yZWYxNS5zdGFydEluZGV4OwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogdHJ1ZQogICAgICB9KTsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvc3RvY2tNb3ZlbWVudEl0ZW1zP29mZnNldD0iKS5jb25jYXQoc3RhcnRJbmRleCwgIiZtYXg9IikuY29uY2F0KHRoaXMucHJvcHMucGFnZVNpemUsICImc3RlcE51bWJlcj0yIik7CiAgICAgIGFwaUNsaWVudC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNi5zZXRMaW5lSXRlbXMocmVzcG9uc2UsIHN0YXJ0SW5kZXgpOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGN1cnJlbnQgc3RvY2sgbW92ZW1lbnQgcHJvZ3Jlc3MgKGxpbmUgaXRlbXMpIGFuZCBnb2VzIHRvIHRoZSBuZXh0IHN0b2NrIG1vdmVtZW50IHN0ZXAuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZm9ybVZhbHVlcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAibmV4dFBhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG5leHRQYWdlKGZvcm1WYWx1ZXMpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CiAgICAgIHZhciBsaW5lSXRlbXMgPSBfLmZpbHRlcihmb3JtVmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHJldHVybiAhXy5pc0VtcHR5KHZhbCkgJiYgdmFsLnByb2R1Y3Q7CiAgICAgIH0pOwogICAgICBpZiAoXy5zb21lKGxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gIWl0ZW0ucXVhbnRpdHlSZXF1ZXN0ZWQgfHwgaXRlbS5xdWFudGl0eVJlcXVlc3RlZCA9PT0gJzAnOwogICAgICB9KSkgewogICAgICAgIHRoaXMuY29uZmlybVNhdmUoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzNy5jaGVja0R1cGxpY2F0ZXNTYXZlQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAoZm9ybVZhbHVlcywgbGluZUl0ZW1zKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNoZWNrRHVwbGljYXRlc1NhdmVBbmRUcmFuc2l0aW9uVG9OZXh0U3RlcChmb3JtVmFsdWVzLCBsaW5lSXRlbXMpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY2hlY2tEdXBsaWNhdGVzU2F2ZUFuZFRyYW5zaXRpb25Ub05leHRTdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGVja0R1cGxpY2F0ZXNTYXZlQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAoZm9ybVZhbHVlcywgbGluZUl0ZW1zKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwogICAgICB2YXIgaXRlbXNNYXAgPSB7fTsKICAgICAgXy5mb3JFYWNoKGxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbXNNYXBbaXRlbS5wcm9kdWN0LnByb2R1Y3RDb2RlXSkgewogICAgICAgICAgaXRlbXNNYXBbaXRlbS5wcm9kdWN0LnByb2R1Y3RDb2RlXS5wdXNoKGl0ZW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpdGVtc01hcFtpdGVtLnByb2R1Y3QucHJvZHVjdENvZGVdID0gW2l0ZW1dOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHZhciBpdGVtc1dpdGhTYW1lQ29kZSA9IF8uZmlsdGVyKGl0ZW1zTWFwLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLmxlbmd0aCA+IDE7CiAgICAgIH0pOwogICAgICBpZiAoXy5zb21lKGl0ZW1zTWFwLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLmxlbmd0aCA+IDE7CiAgICAgIH0pICYmICEodGhpcy5zdGF0ZS52YWx1ZXMub3JpZ2luLnR5cGUgPT09ICdTVVBQTElFUicgfHwgIXRoaXMuc3RhdGUudmFsdWVzLmhhc01hbmFnZUludmVudG9yeSkpIHsKICAgICAgICB0aGlzLmNvbmZpcm1UcmFuc2l0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczguc2F2ZUFuZFRyYW5zaXRpb25Ub05leHRTdGVwKGZvcm1WYWx1ZXMsIGxpbmVJdGVtcyk7CiAgICAgICAgfSwgXy5yZWR1Y2UoaXRlbXNXaXRoU2FtZUNvZGUsIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS5jb25jYXQoYik7CiAgICAgICAgfSwgW10pKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNhdmVBbmRUcmFuc2l0aW9uVG9OZXh0U3RlcChmb3JtVmFsdWVzLCBsaW5lSXRlbXMpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjdXJyZW50IHN0b2NrIG1vdmVtZW50IHByb2dyZXNzIChsaW5lIGl0ZW1zKSBhbmQgZ29lcyB0byB0aGUgbmV4dCBzdG9jayBtb3ZlbWVudCBzdGVwLgogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBsaW5lSXRlbXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVBbmRUcmFuc2l0aW9uVG9OZXh0U3RlcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZUFuZFRyYW5zaXRpb25Ub05leHRTdGVwKGZvcm1WYWx1ZXMsIGxpbmVJdGVtcykgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB0aGlzLnNhdmVSZXF1aXNpdGlvbkl0ZW1zKGxpbmVJdGVtcykudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgIHZhciB2YWx1ZXMgPSBmb3JtVmFsdWVzOwogICAgICAgIGlmIChyZXNwKSB7CiAgICAgICAgICB2YWx1ZXMgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGZvcm1WYWx1ZXMpLCB7fSwgewogICAgICAgICAgICBsaW5lSXRlbXM6IHJlc3AuZGF0YS5kYXRhLmxpbmVJdGVtcwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChfLnNvbWUodmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiBpdGVtLmludmVudG9yeUl0ZW0gJiYgaXRlbS5leHBpcmF0aW9uRGF0ZSAhPT0gaXRlbS5pbnZlbnRvcnlJdGVtLmV4cGlyYXRpb25EYXRlOwogICAgICAgIH0pKSB7CiAgICAgICAgICBpZiAoXy5zb21lKHZhbHVlcy5saW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLmludmVudG9yeUl0ZW0ucXVhbnRpdHkgJiYgaXRlbS5pbnZlbnRvcnlJdGVtLnF1YW50aXR5ICE9PSAnMCc7CiAgICAgICAgICB9KSkgewogICAgICAgICAgICBfdGhpczkucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICAgICAgX3RoaXM5LmNvbmZpcm1JbnZlbnRvcnlJdGVtRXhwaXJhdGlvbkRhdGVVcGRhdGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczkudXBkYXRlSW52ZW50b3J5SXRlbXNBbmRUcmFuc2l0aW9uVG9OZXh0U3RlcCh2YWx1ZXMsIGxpbmVJdGVtcyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXM5LnVwZGF0ZUludmVudG9yeUl0ZW1zQW5kVHJhbnNpdGlvblRvTmV4dFN0ZXAodmFsdWVzLCBsaW5lSXRlbXMpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczkudHJhbnNpdGlvblRvTmV4dFN0ZXBBbmRDaGFuZ2VQYWdlKGZvcm1WYWx1ZXMpOwogICAgICAgIH0KICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczkucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGVzIHN0b2NrIG1vdmVtZW50IGludmVudG9yeSBpdGVtcy4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmb3JtVmFsdWVzCiAgICAgKiBAcGFyYW0ge29iamVjdH0gbGluZUl0ZW1zCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVJbnZlbnRvcnlJdGVtc0FuZFRyYW5zaXRpb25Ub05leHRTdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVJbnZlbnRvcnlJdGVtc0FuZFRyYW5zaXRpb25Ub05leHRTdGVwKGZvcm1WYWx1ZXMsIGxpbmVJdGVtcykgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CiAgICAgIHZhciBpdGVtc1RvU2F2ZSA9IHRoaXMuZ2V0TGluZUl0ZW1zVG9CZVNhdmVkKGxpbmVJdGVtcyk7CiAgICAgIHZhciB1cGRhdGVJdGVtc1VybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvdXBkYXRlSW52ZW50b3J5SXRlbXMiKTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgaWQ6IHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZCwKICAgICAgICBsaW5lSXRlbXM6IGl0ZW1zVG9TYXZlCiAgICAgIH07CiAgICAgIHRoaXMucHJvcHMuc2hvd1NwaW5uZXIoKTsKICAgICAgYXBpQ2xpZW50LnBvc3QodXBkYXRlSXRlbXNVcmwsIHBheWxvYWQpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczEwLnRyYW5zaXRpb25Ub05leHRTdGVwQW5kQ2hhbmdlUGFnZShmb3JtVmFsdWVzKTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczEwLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgbGlzdCBvZiBzdG9jayBtb3ZlbWVudCBpdGVtcyB3aXRoIHBvc3QgbWV0aG9kLgogICAgICogQHBhcmFtIHtvYmplY3R9IGxpbmVJdGVtcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZVJlcXVpc2l0aW9uSXRlbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmVSZXF1aXNpdGlvbkl0ZW1zKGxpbmVJdGVtcykgewogICAgICB2YXIgaXRlbXNUb1NhdmUgPSB0aGlzLmdldExpbmVJdGVtc1RvQmVTYXZlZChsaW5lSXRlbXMpOwogICAgICB2YXIgdXBkYXRlSXRlbXNVcmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3VwZGF0ZUl0ZW1zIik7CiAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIGlkOiB0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsCiAgICAgICAgbGluZUl0ZW1zOiBpdGVtc1RvU2F2ZQogICAgICB9OwogICAgICBpZiAocGF5bG9hZC5saW5lSXRlbXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGFwaUNsaWVudC5wb3N0KHVwZGF0ZUl0ZW1zVXJsLCBwYXlsb2FkKVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLnNhdmVSZXF1aXNpdGlvbkl0ZW1zLmxhYmVsJykpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNhdmVzIGxpc3Qgb2YgcmVxdWlzaXRpb24gaXRlbXMgaW4gY3VycmVudCBzdGVwICh3aXRob3V0IHN0ZXAgY2hhbmdlKS4gVXNlZCB0byBleHBvcnQgdGVtcGxhdGUuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gaXRlbUNhbmRpZGF0ZXNUb1NhdmUKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmVSZXF1aXNpdGlvbkl0ZW1zSW5DdXJyZW50U3RlcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZVJlcXVpc2l0aW9uSXRlbXNJbkN1cnJlbnRTdGVwKGl0ZW1DYW5kaWRhdGVzVG9TYXZlKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKICAgICAgdmFyIGl0ZW1zVG9TYXZlID0gdGhpcy5nZXRMaW5lSXRlbXNUb0JlU2F2ZWQoaXRlbUNhbmRpZGF0ZXNUb1NhdmUpOwogICAgICB2YXIgdXBkYXRlSXRlbXNVcmwgPSAiL29wZW5ib3hlcy9hcGkvc3RvY2tNb3ZlbWVudHMvIi5jb25jYXQodGhpcy5zdGF0ZS52YWx1ZXMuc3RvY2tNb3ZlbWVudElkLCAiL3VwZGF0ZUl0ZW1zIik7CiAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIGlkOiB0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsCiAgICAgICAgbGluZUl0ZW1zOiBpdGVtc1RvU2F2ZQogICAgICB9OwogICAgICBpZiAocGF5bG9hZC5saW5lSXRlbXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGFwaUNsaWVudC5wb3N0KHVwZGF0ZUl0ZW1zVXJsLCBwYXlsb2FkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICB2YXIgbGluZUl0ZW1zID0gcmVzcC5kYXRhLmRhdGEubGluZUl0ZW1zOwogICAgICAgICAgdmFyIGxpbmVJdGVtc0JhY2tlbmREYXRhID0gXy5tYXAobGluZUl0ZW1zLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB2YWwpOwogICAgICAgICAgfSk7CiAgICAgICAgICBfdGhpczExLnNldFN0YXRlKHsKICAgICAgICAgICAgY3VycmVudExpbmVJdGVtczogbGluZUl0ZW1zQmFja2VuZERhdGEsCiAgICAgICAgICAgIHZhbHVlczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpczExLnN0YXRlLnZhbHVlcyksIHt9LCB7CiAgICAgICAgICAgICAgbGluZUl0ZW1zOiBsaW5lSXRlbXNCYWNrZW5kRGF0YQogICAgICAgICAgICB9KQogICAgICAgICAgfSk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihfdGhpczExLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5zYXZlUmVxdWlzaXRpb25JdGVtcy5sYWJlbCcsICdDb3VsZCBub3Qgc2F2ZSByZXF1aXNpdGlvbiBpdGVtcycpKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgbGlzdCBvZiByZXF1aXNpdGlvbiBpdGVtcyBpbiBjdXJyZW50IHN0ZXAgKHdpdGhvdXQgc3RlcCBjaGFuZ2UpLgogICAgICogQHBhcmFtIHtvYmplY3R9IGZvcm1WYWx1ZXMKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInNhdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmUoZm9ybVZhbHVlcykgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CiAgICAgIHZhciBsaW5lSXRlbXMgPSBfLmZpbHRlcihmb3JtVmFsdWVzLmxpbmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gIV8uaXNFbXB0eShpdGVtKTsKICAgICAgfSk7CiAgICAgIGlmIChfLnNvbWUobGluZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiAhaXRlbS5xdWFudGl0eVJlcXVlc3RlZCB8fCBpdGVtLnF1YW50aXR5UmVxdWVzdGVkID09PSAnMCc7CiAgICAgIH0pKSB7CiAgICAgICAgdGhpcy5jb25maXJtU2F2ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxMi5zYXZlSXRlbXMobGluZUl0ZW1zKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNhdmVJdGVtcyhsaW5lSXRlbXMpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTYXZlcyBjaGFuZ2VzIG1hZGUgYnkgdXNlciBpbiB0aGlzIHN0ZXAgYW5kIHJlZGlyZWN0cyB0byB0aGUgc2hpcG1lbnQgdmlldyBwYWdlCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZm9ybVZhbHVlcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZUFuZEV4aXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmVBbmRFeGl0KGZvcm1WYWx1ZXMpIHsKICAgICAgdmFyIGVycm9ycyA9IHRoaXMudmFsaWRhdGUoZm9ybVZhbHVlcykubGluZUl0ZW1zOwogICAgICBpZiAoZXJyb3JzLmxlbmd0aCAmJiBlcnJvcnMuZXZlcnkoZnVuY3Rpb24gKG9iaikgewogICAgICAgIHJldHVybiBfdHlwZW9mKG9iaikgPT09ICdvYmplY3QnICYmIF8uaXNFbXB0eShvYmopOwogICAgICB9KSkgewogICAgICAgIHRoaXMuc2F2ZVJlcXVpc2l0aW9uSXRlbXNJbkN1cnJlbnRTdGVwKGZvcm1WYWx1ZXMubGluZUl0ZW1zKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICIvb3BlbmJveGVzL3N0b2NrTW92ZW1lbnQvc2hvdy8iLmNvbmNhdChmb3JtVmFsdWVzLnN0b2NrTW92ZW1lbnRJZCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtRXhpdC5sYWJlbCcsICdDb25maXJtIHNhdmUnKSwKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1FeGl0Lm1lc3NhZ2UnLCAnVmFsaWRhdGlvbiBlcnJvcnMgb2NjdXJyZWQuIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBleGl0IGFuZCBsb3NlIHVuc2F2ZWQgZGF0YT8nKSwKICAgICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC55ZXMubGFiZWwnLCAnWWVzJyksCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9zaG93LyIuY29uY2F0KGZvcm1WYWx1ZXMuc3RvY2tNb3ZlbWVudElkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgewogICAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQubm8ubGFiZWwnLCAnTm8nKQogICAgICAgICAgfV0KICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgbGlzdCBvZiByZXF1aXNpdGlvbiBpdGVtcyBpbiBjdXJyZW50IHN0ZXAgKHdpdGhvdXQgc3RlcCBjaGFuZ2UpLgogICAgICogQHBhcmFtIHtvYmplY3R9IGxpbmVJdGVtcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAic2F2ZUl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlSXRlbXMobGluZUl0ZW1zKSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB0aGlzLnNhdmVSZXF1aXNpdGlvbkl0ZW1zSW5DdXJyZW50U3RlcChsaW5lSXRlbXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTMucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICBBbGVydC5zdWNjZXNzKF90aGlzMTMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmFsZXJ0LnNhdmVTdWNjZXNzLmxhYmVsJywgJ0NoYW5nZXMgc2F2ZWQgc3VjY2Vzc2Z1bGx5JyksIHsKICAgICAgICAgIHRpbWVvdXQ6IDMwMDAKICAgICAgICB9KTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczEzLnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogUmVmZXRjaCB0aGUgZGF0YSwgYWxsIG5vdCBzYXZlZCBjaGFuZ2VzIHdpbGwgYmUgbG9zdC4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInJlZnJlc2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZnJlc2goKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKICAgICAgY29uZmlybUFsZXJ0KHsKICAgICAgICB0aXRsZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQubWVzc2FnZS5jb25maXJtUmVmcmVzaC5sYWJlbCcsICdDb25maXJtIHJlZnJlc2gnKSwKICAgICAgICBtZXNzYWdlOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUmVmcmVzaC5tZXNzYWdlJywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZWZyZXNoPyBZb3VyIHByb2dyZXNzIHNpbmNlIGxhc3Qgc2F2ZSB3aWxsIGJlIGxvc3QuJyksCiAgICAgICAgYnV0dG9uczogW3sKICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3QuZGVmYXVsdC55ZXMubGFiZWwnLCAnWWVzJyksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMxNC5mZXRjaEFsbERhdGEoKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LmRlZmF1bHQubm8ubGFiZWwnLCAnTm8nKQogICAgICAgIH1dCiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlcyBjaG9zZW4gaXRlbSBmcm9tIHJlcXVpc2l0aW9uJ3MgaXRlbXMgbGlzdC4KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpdGVtSWQKICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInJlbW92ZUl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUl0ZW0oaXRlbUlkKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKICAgICAgdmFyIHJlbW92ZUl0ZW1zVXJsID0gIi9vcGVuYm94ZXMvYXBpL3N0b2NrTW92ZW1lbnRJdGVtcy8iLmNvbmNhdChpdGVtSWQsICIvcmVtb3ZlSXRlbSIpOwogICAgICByZXR1cm4gYXBpQ2xpZW50WyJkZWxldGUiXShyZW1vdmVJdGVtc1VybClbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTUucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdyZWFjdC5zdG9ja01vdmVtZW50LmVycm9yLmRlbGV0ZVJlcXVpc2l0aW9uSXRlbS5sYWJlbCcpKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmVzIGFsbCBpdGVtcyBmcm9tIHJlcXVpc2l0aW9uJ3MgaXRlbXMgbGlzdC4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInJlbW92ZUFsbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQWxsKCkgewogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7CiAgICAgIHZhciByZW1vdmVJdGVtc1VybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvcmVtb3ZlQWxsSXRlbXMiKTsKICAgICAgcmV0dXJuIGFwaUNsaWVudFsiZGVsZXRlIl0ocmVtb3ZlSXRlbXNVcmwpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTYuc2V0U3RhdGUoewogICAgICAgICAgdG90YWxDb3VudDogMSwKICAgICAgICAgIGN1cnJlbnRMaW5lSXRlbXM6IFtdLAogICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzMTYuc3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgICAgbGluZUl0ZW1zOiBuZXcgQXJyYXkoMSkuZmlsbCh7CiAgICAgICAgICAgICAgc29ydE9yZGVyOiAxMDAKICAgICAgICAgICAgfSkKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE2LmZldGNoTGluZUl0ZW1zKCk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcigncmVhY3Quc3RvY2tNb3ZlbWVudC5lcnJvci5kZWxldGVSZXF1aXNpdGlvbkl0ZW0ubGFiZWwnKSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNpdGlvbiB0byBuZXh0IHN0b2NrIG1vdmVtZW50IHN0YXR1czoKICAgICAqIC0gJ0NIRUNLSU5HJyBpZiBvcmlnaW4gdHlwZSBpcyBzdXBwbGllci4KICAgICAqIC0gJ1ZFUklGWUlORycgaWYgb3JpZ2luIHR5cGUgaXMgb3RoZXIgdGhhbiBzdXBwbGllci4KICAgICAqIEBwdWJsaWMKICAgICAqLwogIH0sIHsKICAgIGtleTogInRyYW5zaXRpb25Ub05leHRTdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0cmFuc2l0aW9uVG9OZXh0U3RlcCgpIHsKICAgICAgdmFyIHVybCA9ICIvb3BlbmJveGVzL2FwaS9zdG9ja01vdmVtZW50cy8iLmNvbmNhdCh0aGlzLnN0YXRlLnZhbHVlcy5zdG9ja01vdmVtZW50SWQsICIvc3RhdHVzIik7CiAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIHN0YXR1czogJ0NIRUNLSU5HJwogICAgICB9OwogICAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZXMuc3RhdHVzQ29kZSA9PT0gJ0NSRUFURUQnKSB7CiAgICAgICAgcmV0dXJuIGFwaUNsaWVudC5wb3N0KHVybCwgcGF5bG9hZCk7CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNpdGlvbiB0byBuZXh0IHN0b2NrIG1vdmVtZW50IHN0YXR1cyBhbmQgZ28gdG8gbmV4dCBmb3JtIHBhZ2UuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZm9ybVZhbHVlcwogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAidHJhbnNpdGlvblRvTmV4dFN0ZXBBbmRDaGFuZ2VQYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0cmFuc2l0aW9uVG9OZXh0U3RlcEFuZENoYW5nZVBhZ2UoZm9ybVZhbHVlcykgewogICAgICB2YXIgX3RoaXMxNyA9IHRoaXM7CiAgICAgIHRoaXMudHJhbnNpdGlvblRvTmV4dFN0ZXAoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE3LnByb3BzLm5leHRQYWdlKGZvcm1WYWx1ZXMpOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMTcucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHBvcnRzIGN1cnJlbnQgc3RhdGUgb2Ygc3RvY2sgbW92ZW1lbnQncyB0byBjc3YgZmlsZS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmb3JtVmFsdWVzCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJleHBvcnRUZW1wbGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZXhwb3J0VGVtcGxhdGUoZm9ybVZhbHVlcykgewogICAgICB2YXIgbGluZUl0ZW1zID0gXy5maWx0ZXIoZm9ybVZhbHVlcy5saW5lSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuICFfLmlzRW1wdHkoaXRlbSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNhdmVJdGVtc0FuZEV4cG9ydFRlbXBsYXRlKGZvcm1WYWx1ZXMsIGxpbmVJdGVtcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNSb3dMb2FkZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzUm93TG9hZGVkKF9yZWYxNikgewogICAgICB2YXIgaW5kZXggPSBfcmVmMTYuaW5kZXg7CiAgICAgIHJldHVybiAhIXRoaXMuc3RhdGUudmFsdWVzLmxpbmVJdGVtc1tpbmRleF07CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHBvcnRzIGN1cnJlbnQgc3RhdGUgb2Ygc3RvY2sgbW92ZW1lbnQncyB0byBjc3YgZmlsZS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmb3JtVmFsdWVzCiAgICAgKiBAcGFyYW0ge29iamVjdH0gbGluZUl0ZW1zCiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJzYXZlSXRlbXNBbmRFeHBvcnRUZW1wbGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZUl0ZW1zQW5kRXhwb3J0VGVtcGxhdGUoZm9ybVZhbHVlcywgbGluZUl0ZW1zKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKICAgICAgdGhpcy5wcm9wcy5zaG93U3Bpbm5lcigpOwogICAgICB2YXIgbW92ZW1lbnROdW1iZXIgPSBmb3JtVmFsdWVzLm1vdmVtZW50TnVtYmVyLAogICAgICAgIHN0b2NrTW92ZW1lbnRJZCA9IGZvcm1WYWx1ZXMuc3RvY2tNb3ZlbWVudElkOwogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9leHBvcnRDc3YvIi5jb25jYXQoc3RvY2tNb3ZlbWVudElkKTsKICAgICAgdGhpcy5zYXZlUmVxdWlzaXRpb25JdGVtc0luQ3VycmVudFN0ZXAobGluZUl0ZW1zKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBhcGlDbGllbnQuZ2V0KHVybCwgewogICAgICAgICAgcmVzcG9uc2VUeXBlOiAnYmxvYicKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgZmlsZURvd25sb2FkKHJlc3BvbnNlLmRhdGEsICJJdGVtTGlzdCIuY29uY2F0KG1vdmVtZW50TnVtYmVyID8gIi0iLmNvbmNhdChtb3ZlbWVudE51bWJlcikgOiAnJywgIi5jc3YiKSwgJ3RleHQvY3N2Jyk7CiAgICAgICAgICBfdGhpczE4LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMTgucHJvcHMuaGlkZVNwaW5uZXIoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBvcnRzIGNob3NlbiBmaWxlIHRvIGJhY2tlbmQgYW5kIHRoZW4gZmV0Y2hlcyBsaW5lIGl0ZW1zLgogICAgICogQHBhcmFtIHtvYmplY3R9IGV2ZW50CiAgICAgKiBAcHVibGljCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJpbXBvcnRUZW1wbGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW1wb3J0VGVtcGxhdGUoZXZlbnQpIHsKICAgICAgdmFyIF90aGlzMTkgPSB0aGlzOwogICAgICB0aGlzLnByb3BzLnNob3dTcGlubmVyKCk7CiAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICB2YXIgZmlsZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgdmFyIHN0b2NrTW92ZW1lbnRJZCA9IHRoaXMuc3RhdGUudmFsdWVzLnN0b2NrTW92ZW1lbnRJZDsKICAgICAgZm9ybURhdGEuYXBwZW5kKCdpbXBvcnRGaWxlJywgZmlsZS5zbGljZSgwLCBmaWxlLnNpemUsICd0ZXh0L2NzdicpKTsKICAgICAgdmFyIGNvbmZpZyA9IHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAnY29udGVudC10eXBlJzogJ211bHRpcGFydC9mb3JtLWRhdGEnCiAgICAgICAgfQogICAgICB9OwogICAgICB2YXIgdXJsID0gIi9vcGVuYm94ZXMvc3RvY2tNb3ZlbWVudC9pbXBvcnRDc3YvIi5jb25jYXQoc3RvY2tNb3ZlbWVudElkKTsKICAgICAgcmV0dXJuIGFwaUNsaWVudC5wb3N0KHVybCwgZm9ybURhdGEsIGNvbmZpZykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxOS5mZXRjaExpbmVJdGVtcygpOwogICAgICAgIGlmIChfLmlzTmlsKF8ubGFzdChfdGhpczE5LnN0YXRlLnZhbHVlcy5saW5lSXRlbXMpLnByb2R1Y3QpKSB7CiAgICAgICAgICBfdGhpczE5LnNldFN0YXRlKHsKICAgICAgICAgICAgdmFsdWVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzMTkuc3RhdGUudmFsdWVzKSwge30sIHsKICAgICAgICAgICAgICBsaW5lSXRlbXM6IFtdCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE5LnByb3BzLmhpZGVTcGlubmVyKCk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogU2F2ZXMgY2hhbmdlcyBtYWRlIGJ5IHVzZXIgaW4gdGhpcyBzdGVwIGFuZCBnbyBiYWNrIHRvIHByZXZpb3VzIHBhZ2UKICAgICAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXMKICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaW52YWxpZAogICAgICogQHB1YmxpYwogICAgICovCiAgfSwgewogICAga2V5OiAicHJldmlvdXNQYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcmV2aW91c1BhZ2UodmFsdWVzLCBpbnZhbGlkKSB7CiAgICAgIHZhciBfdGhpczIwID0gdGhpczsKICAgICAgaWYgKCFpbnZhbGlkKSB7CiAgICAgICAgdGhpcy5zYXZlUmVxdWlzaXRpb25JdGVtc0luQ3VycmVudFN0ZXAodmFsdWVzLmxpbmVJdGVtcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMyMC5wcm9wcy5wcmV2aW91c1BhZ2UodmFsdWVzKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25maXJtQWxlcnQoewogICAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1QcmV2aW91c1BhZ2UubGFiZWwnLCAnVmFsaWRhdGlvbiBlcnJvcicpLAogICAgICAgICAgbWVzc2FnZTogdGhpcy5wcm9wcy50cmFuc2xhdGUoJ3JlYWN0LnN0b2NrTW92ZW1lbnQuY29uZmlybVByZXZpb3VzUGFnZS5tZXNzYWdlLmxhYmVsJywgJ0Nhbm5vdCBzYXZlIGR1ZSB0byB2YWxpZGF0aW9uIGVycm9yIG9uIHBhZ2UnKSwKICAgICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLnRyYW5zbGF0ZSgncmVhY3Quc3RvY2tNb3ZlbWVudC5jb25maXJtUHJldmlvdXNQYWdlLmNvcnJlY3RFcnJvci5sYWJlbCcsICdDb3JyZWN0IGVycm9yJykKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6IHRoaXMucHJvcHMudHJhbnNsYXRlKCdyZWFjdC5zdG9ja01vdmVtZW50LmNvbmZpcm1QcmV2aW91c1BhZ2UuY29udGludWUubGFiZWwnLCAnQ29udGludWUgKGxvc2UgdW5zYXZlZCB3b3JrKScpLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczIwLnByb3BzLnByZXZpb3VzUGFnZSh2YWx1ZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9XQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpczIxID0gdGhpczsKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEZvcm0sIHsKICAgICAgICBvblN1Ym1pdDogZnVuY3Rpb24gb25TdWJtaXQoKSB7fSwKICAgICAgICB2YWxpZGF0ZTogdGhpcy52YWxpZGF0ZSwKICAgICAgICBtdXRhdG9yczogX29iamVjdFNwcmVhZCh7fSwgYXJyYXlNdXRhdG9ycyksCiAgICAgICAgaW5pdGlhbFZhbHVlczogdGhpcy5zdGF0ZS52YWx1ZXMsCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoX3JlZjE3KSB7CiAgICAgICAgICB2YXIgaGFuZGxlU3VibWl0ID0gX3JlZjE3LmhhbmRsZVN1Ym1pdCwKICAgICAgICAgICAgdmFsdWVzID0gX3JlZjE3LnZhbHVlcywKICAgICAgICAgICAgaW52YWxpZCA9IF9yZWYxNy5pbnZhbGlkOwogICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImQtZmxleCBmbGV4LWNvbHVtbiIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJidXR0b25zLWNvbnRhaW5lciIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJsYWJlbCIsIHsKICAgICAgICAgICAgaHRtbEZvcjogImNzdklucHV0IiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmxvYXQtcmlnaHQgbWItMSBidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGFsaWduLXNlbGYtZW5kIG1sLTEgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtZG93bmxvYWQgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5pbXBvcnRUZW1wbGF0ZS5sYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW1wb3J0IHRlbXBsYXRlIgogICAgICAgICAgfSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICAgICAgICAgIGlkOiAiY3N2SW5wdXQiLAogICAgICAgICAgICB0eXBlOiAiZmlsZSIsCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ25vbmUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uQ2hhbmdlOiBfdGhpczIxLmltcG9ydFRlbXBsYXRlLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKGV2ZW50KSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduCiAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gbnVsbDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWNjZXB0OiAiLmNzdiIKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMjEuZXhwb3J0VGVtcGxhdGUodmFsdWVzKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmxvYXQtcmlnaHQgbWItMSBidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGFsaWduLXNlbGYtZW5kIG1sLTEgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtdXBsb2FkIHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uZXhwb3J0VGVtcGxhdGUubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkV4cG9ydCB0ZW1wbGF0ZSIKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczIxLnJlZnJlc2goKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmxvYXQtcmlnaHQgbWItMSBidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGFsaWduLXNlbGYtZW5kIG1sLTEgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtcmVmcmVzaCBwci0yIgogICAgICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnJlZnJlc2gubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlJlbG9hZCIKICAgICAgICAgIH0pKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7CiAgICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgICBkaXNhYmxlZDogIV90aGlzMjEuaXNWYWxpZEZvclNhdmUodmFsdWVzKSwKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyMS5zYXZlKHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBtbC0xIGJ0bi14cyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXNhdmUgcHItMiIKICAgICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmFuc2xhdGUsIHsKICAgICAgICAgICAgaWQ6ICJyZWFjdC5kZWZhdWx0LmJ1dHRvbi5zYXZlLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZlIgogICAgICAgICAgfSkpKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAgIGRpc2FibGVkOiAhX3RoaXMyMS5pc1ZhbGlkRm9yU2F2ZSh2YWx1ZXMpLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczIxLnNhdmVBbmRFeGl0KHZhbHVlcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImZsb2F0LXJpZ2h0IG1iLTEgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBhbGlnbi1zZWxmLWVuZCBtbC0xIGJ0bi14cyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImkiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogImZhIGZhLXNpZ24tb3V0IHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uc2F2ZUFuZEV4aXQubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUgYW5kIGV4aXQiCiAgICAgICAgICB9KSkpLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgZGlzYWJsZWQ6IGludmFsaWQsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMjEucmVtb3ZlQWxsKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyMS5mZXRjaEFuZFNldExpbmVJdGVtcygpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJmbG9hdC1yaWdodCBtYi0xIGJ0biBidG4tb3V0bGluZS1kYW5nZXIgYWxpZ24tc2VsZi1lbmQgYnRuLXhzIgogICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiaSIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZmEgZmEtcmVtb3ZlIHByLTIiCiAgICAgICAgICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhbnNsYXRlLCB7CiAgICAgICAgICAgIGlkOiAicmVhY3QuZGVmYXVsdC5idXR0b24uZGVsZXRlQWxsLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJEZWxldGUgYWxsIgogICAgICAgICAgfSkpKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJmb3JtIiwgewogICAgICAgICAgICBvblN1Ym1pdDogaGFuZGxlU3VibWl0CiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJ0YWJsZS1mb3JtIgogICAgICAgICAgfSwgXy5tYXAoVkVORE9SX0ZJRUxEUywgZnVuY3Rpb24gKGZpZWxkQ29uZmlnLCBmaWVsZE5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHJlbmRlckZvcm1GaWVsZChmaWVsZENvbmZpZywgZmllbGROYW1lLCB7CiAgICAgICAgICAgICAgc3RvY2tsaXN0OiB2YWx1ZXMuc3RvY2tsaXN0LAogICAgICAgICAgICAgIHJlY2lwaWVudHM6IF90aGlzMjEucHJvcHMucmVjaXBpZW50cywKICAgICAgICAgICAgICByZW1vdmVJdGVtOiBfdGhpczIxLnJlbW92ZUl0ZW0sCiAgICAgICAgICAgICAgb3JpZ2luSWQ6IF90aGlzMjEuc3RhdGUudmFsdWVzLm9yaWdpbi5pZCwKICAgICAgICAgICAgICBnZXRTb3J0T3JkZXI6IF90aGlzMjEuZ2V0U29ydE9yZGVyLAogICAgICAgICAgICAgIG5ld0l0ZW1BZGRlZDogX3RoaXMyMS5uZXdJdGVtQWRkZWQsCiAgICAgICAgICAgICAgbmV3SXRlbTogX3RoaXMyMS5zdGF0ZS5uZXdJdGVtLAogICAgICAgICAgICAgIHRvdGFsQ291bnQ6IF90aGlzMjEuc3RhdGUudG90YWxDb3VudCwKICAgICAgICAgICAgICBsb2FkTW9yZVJvd3M6IF90aGlzMjEubG9hZE1vcmVSb3dzLAogICAgICAgICAgICAgIGlzUm93TG9hZGVkOiBfdGhpczIxLmlzUm93TG9hZGVkLAogICAgICAgICAgICAgIHVwZGF0ZVRvdGFsQ291bnQ6IF90aGlzMjEudXBkYXRlVG90YWxDb3VudCwKICAgICAgICAgICAgICBpc1BhZ2luYXRlZDogX3RoaXMyMS5wcm9wcy5pc1BhZ2luYXRlZCwKICAgICAgICAgICAgICBpc0Zyb21PcmRlcjogX3RoaXMyMS5zdGF0ZS52YWx1ZXMuaXNGcm9tT3JkZXIsCiAgICAgICAgICAgICAgdXBkYXRlUm93OiBfdGhpczIxLnVwZGF0ZVJvdywKICAgICAgICAgICAgICB2YWx1ZXM6IHZhbHVlcywKICAgICAgICAgICAgICBpc0ZpcnN0UGFnZUxvYWRlZDogX3RoaXMyMS5zdGF0ZS5pc0ZpcnN0UGFnZUxvYWRlZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgY2xhc3NOYW1lOiAic3VibWl0LWJ1dHRvbnMiCiAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICAgZGlzYWJsZWQ6IGludmFsaWQsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMjEucHJldmlvdXNQYWdlKHZhbHVlcywgaW52YWxpZCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzTmFtZTogImJ0biBidG4tb3V0bGluZS1wcmltYXJ5IGJ0bi1mb3JtIGJ0bi14cyIKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLnByZXZpb3VzLmxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJQcmV2aW91cyIKICAgICAgICAgIH0pKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsKICAgICAgICAgICAgdHlwZTogInN1Ym1pdCIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgaWYgKCFpbnZhbGlkKSB7CiAgICAgICAgICAgICAgICBfdGhpczIxLm5leHRQYWdlKHZhbHVlcyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc05hbWU6ICJidG4gYnRuLW91dGxpbmUtcHJpbWFyeSBidG4tZm9ybSBmbG9hdC1yaWdodCBidG4teHMiLAogICAgICAgICAgICBkaXNhYmxlZDogIV8uc29tZSh2YWx1ZXMubGluZUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBpdGVtLnByb2R1Y3QgJiYgXy5wYXJzZUludChpdGVtLnF1YW50aXR5UmVxdWVzdGVkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRyYW5zbGF0ZSwgewogICAgICAgICAgICBpZDogInJlYWN0LmRlZmF1bHQuYnV0dG9uLm5leHQubGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk5leHQiCiAgICAgICAgICB9KSkpKSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9XSk7CiAgcmV0dXJuIEFkZEl0ZW1zUGFnZTsKfShDb21wb25lbnQpOwp2YXIgbWFwU3RhdGVUb1Byb3BzID0gZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKHN0YXRlKSB7CiAgcmV0dXJuIHsKICAgIHJlY2lwaWVudHM6IHN0YXRlLnVzZXJzLmRhdGEsCiAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZVdpdGhEZWZhdWx0TWVzc2FnZShnZXRUcmFuc2xhdGUoc3RhdGUubG9jYWxpemUpKSwKICAgIHN0b2NrTW92ZW1lbnRUcmFuc2xhdGlvbnNGZXRjaGVkOiBzdGF0ZS5zZXNzaW9uLmZldGNoZWRUcmFuc2xhdGlvbnMuc3RvY2tNb3ZlbWVudCwKICAgIG1pbmltdW1FeHBpcmF0aW9uRGF0ZTogc3RhdGUuc2Vzc2lvbi5taW5pbXVtRXhwaXJhdGlvbkRhdGUsCiAgICBpc1BhZ2luYXRlZDogc3RhdGUuc2Vzc2lvbi5pc1BhZ2luYXRlZCwKICAgIHBhZ2VTaXplOiBzdGF0ZS5zZXNzaW9uLnBhZ2VTaXplCiAgfTsKfTsKZXhwb3J0IGRlZmF1bHQgY29ubmVjdChtYXBTdGF0ZVRvUHJvcHMsIHsKICBzaG93U3Bpbm5lcjogc2hvd1NwaW5uZXIsCiAgaGlkZVNwaW5uZXI6IGhpZGVTcGlubmVyLAogIGZldGNoVXNlcnM6IGZldGNoVXNlcnMKfSkoQWRkSXRlbXNQYWdlKTsKQWRkSXRlbXNQYWdlLnByb3BUeXBlcyA9IHsKICAvKiogSW5pdGlhbCBjb21wb25lbnQncyBkYXRhICovCiAgaW5pdGlhbFZhbHVlczogUHJvcFR5cGVzLnNoYXBlKHsKICAgIG9yaWdpbjogUHJvcFR5cGVzLnNoYXBlKHsKICAgICAgaWQ6IFByb3BUeXBlcy5zdHJpbmcKICAgIH0pLAogICAgaGFzTWFuYWdlSW52ZW50b3J5OiBQcm9wVHlwZXMuYm9vbAogIH0pLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIHJldHVybmluZyB1c2VyIHRvIHRoZSBwcmV2aW91cyBwYWdlICovCiAgcHJldmlvdXNQYWdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKgogICAqIEZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSBmb3JtIGRhdGEgd2hlbiB0aGUgaGFuZGxlU3VibWl0KCkKICAgKiBpcyBmaXJlZCBmcm9tIHdpdGhpbiB0aGUgZm9ybSBjb21wb25lbnQuCiAgICovCiAgbmV4dFBhZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgLyoqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGRhdGEgaXMgbG9hZGluZyAqLwogIHNob3dTcGlubmVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiBkYXRhIGhhcyBsb2FkZWQgKi8KICBoaWRlU3Bpbm5lcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAvKiogRnVuY3Rpb24gZmV0Y2hpbmcgdXNlcnMgKi8KICBmZXRjaFVzZXJzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIC8qKiBBcnJheSBvZiBhdmFpbGFibGUgcmVjaXBpZW50cyAgKi8KICByZWNpcGllbnRzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuc2hhcGUoe30pKS5pc1JlcXVpcmVkLAogIHRyYW5zbGF0ZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICBzdG9ja01vdmVtZW50VHJhbnNsYXRpb25zRmV0Y2hlZDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICBtaW5pbXVtRXhwaXJhdGlvbkRhdGU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCwKICAvKiogUmV0dXJuIHRydWUgaWYgcGFnaW5hdGlvbiBpcyBlbmFibGVkICovCiAgaXNQYWdpbmF0ZWQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgcGFnZVNpemU6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZAp9Ow=="},null]}