const domain = 'https://userlike-cdn-widgets.s3-eu-west-1.amazonaws.com';
const maxAttempts = 10;
let currentLoadAttempt = 0;
let currentOpenAttempt = 0;

/* eslint-disable */
const loadScript = providerKey => {
  if (window.userlike) return;
  var d = document;

  function l() {
    var _x$parentNode;

    var s = d.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = `${domain}/${providerKey}.js`;
    var x = d.getElementsByTagName('script')[0];
    (_x$parentNode = x.parentNode) === null || _x$parentNode === void 0 ? void 0 : _x$parentNode.insertBefore(s, x);
  }

  l();
};
/* eslint-enable */


const attemptLoad = setState => {
  if (currentLoadAttempt === maxAttempts) {
    return;
  }

  if (!window.userlike) {
    currentLoadAttempt += 1;
    setTimeout(() => attemptLoad(setState), 1000); // Try every second

    return;
  }

  setTimeout(() => setState('complete'), 2000);
};

const load = ({
  providerKey,
  setState
}) => {
  loadScript(providerKey);
  attemptLoad(setState);
};

const open = () => {
  if (currentOpenAttempt === maxAttempts) {
    return;
  }

  if (!window.userlike) {
    currentOpenAttempt += 1;
    setTimeout(open, 1000); // Try every second

    return;
  }

  window.userlike.userlikeStartChat();
};

const close = () => window.userlike && window.userlike.userlikeQuitChat();

export default {
  domain,
  load,
  open,
  close
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcm92aWRlcnMvdXNlcmxpa2UudHMiXSwibmFtZXMiOlsiZG9tYWluIiwibWF4QXR0ZW1wdHMiLCJjdXJyZW50TG9hZEF0dGVtcHQiLCJjdXJyZW50T3BlbkF0dGVtcHQiLCJsb2FkU2NyaXB0IiwicHJvdmlkZXJLZXkiLCJ3aW5kb3ciLCJ1c2VybGlrZSIsImQiLCJkb2N1bWVudCIsImwiLCJzIiwiY3JlYXRlRWxlbWVudCIsInR5cGUiLCJhc3luYyIsInNyYyIsIngiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJhdHRlbXB0TG9hZCIsInNldFN0YXRlIiwic2V0VGltZW91dCIsImxvYWQiLCJvcGVuIiwidXNlcmxpa2VTdGFydENoYXQiLCJjbG9zZSIsInVzZXJsaWtlUXVpdENoYXQiXSwibWFwcGluZ3MiOiJBQUVBLE1BQU1BLE1BQU0sR0FBRyx5REFBZjtBQUNBLE1BQU1DLFdBQVcsR0FBRyxFQUFwQjtBQUNBLElBQUlDLGtCQUFrQixHQUFHLENBQXpCO0FBQ0EsSUFBSUMsa0JBQWtCLEdBQUcsQ0FBekI7O0FBWUE7QUFDQSxNQUFNQyxVQUFVLEdBQUlDLFdBQUQsSUFBeUI7QUFDMUMsTUFBSUMsTUFBTSxDQUFDQyxRQUFYLEVBQXFCO0FBRXJCLE1BQUlDLENBQUMsR0FBR0MsUUFBUjs7QUFDQSxXQUFTQyxDQUFULEdBQWE7QUFBQTs7QUFDWCxRQUFJQyxDQUFDLEdBQUdILENBQUMsQ0FBQ0ksYUFBRixDQUFnQixRQUFoQixDQUFSO0FBQ0FELElBQUFBLENBQUMsQ0FBQ0UsSUFBRixHQUFTLGlCQUFUO0FBQ0FGLElBQUFBLENBQUMsQ0FBQ0csS0FBRixHQUFVLElBQVY7QUFDQUgsSUFBQUEsQ0FBQyxDQUFDSSxHQUFGLEdBQVMsR0FBRWYsTUFBTyxJQUFHSyxXQUFZLEtBQWpDO0FBQ0EsUUFBSVcsQ0FBQyxHQUFHUixDQUFDLENBQUNTLG9CQUFGLENBQXVCLFFBQXZCLEVBQWlDLENBQWpDLENBQVI7QUFDQSxxQkFBQUQsQ0FBQyxDQUFDRSxVQUFGLGdFQUFjQyxZQUFkLENBQTJCUixDQUEzQixFQUE4QkssQ0FBOUI7QUFDRDs7QUFDRE4sRUFBQUEsQ0FBQztBQUNGLENBYkQ7QUFjQTs7O0FBRUEsTUFBTVUsV0FBVyxHQUFJQyxRQUFELElBQXNDO0FBQ3hELE1BQUluQixrQkFBa0IsS0FBS0QsV0FBM0IsRUFBd0M7QUFDdEM7QUFDRDs7QUFFRCxNQUFJLENBQUNLLE1BQU0sQ0FBQ0MsUUFBWixFQUFzQjtBQUNwQkwsSUFBQUEsa0JBQWtCLElBQUksQ0FBdEI7QUFDQW9CLElBQUFBLFVBQVUsQ0FBQyxNQUFNRixXQUFXLENBQUNDLFFBQUQsQ0FBbEIsRUFBOEIsSUFBOUIsQ0FBVixDQUZvQixDQUUwQjs7QUFDOUM7QUFDRDs7QUFFREMsRUFBQUEsVUFBVSxDQUFDLE1BQU1ELFFBQVEsQ0FBQyxVQUFELENBQWYsRUFBNkIsSUFBN0IsQ0FBVjtBQUNELENBWkQ7O0FBY0EsTUFBTUUsSUFBSSxHQUFHLENBQUM7QUFDWmxCLEVBQUFBLFdBRFk7QUFFWmdCLEVBQUFBO0FBRlksQ0FBRCxLQU1EO0FBQ1ZqQixFQUFBQSxVQUFVLENBQUNDLFdBQUQsQ0FBVjtBQUNBZSxFQUFBQSxXQUFXLENBQUNDLFFBQUQsQ0FBWDtBQUNELENBVEQ7O0FBV0EsTUFBTUcsSUFBSSxHQUFHLE1BQVk7QUFDdkIsTUFBSXJCLGtCQUFrQixLQUFLRixXQUEzQixFQUF3QztBQUN0QztBQUNEOztBQUVELE1BQUksQ0FBQ0ssTUFBTSxDQUFDQyxRQUFaLEVBQXNCO0FBQ3BCSixJQUFBQSxrQkFBa0IsSUFBSSxDQUF0QjtBQUNBbUIsSUFBQUEsVUFBVSxDQUFDRSxJQUFELEVBQU8sSUFBUCxDQUFWLENBRm9CLENBRUc7O0FBQ3ZCO0FBQ0Q7O0FBRURsQixFQUFBQSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JrQixpQkFBaEI7QUFDRCxDQVpEOztBQWNBLE1BQU1DLEtBQUssR0FBRyxNQUFZcEIsTUFBTSxDQUFDQyxRQUFQLElBQW1CRCxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JvQixnQkFBaEIsRUFBN0M7O0FBRUEsZUFBZTtBQUNiM0IsRUFBQUEsTUFEYTtBQUVidUIsRUFBQUEsSUFGYTtBQUdiQyxFQUFBQSxJQUhhO0FBSWJFLEVBQUFBO0FBSmEsQ0FBZiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN0YXRlIH0gZnJvbSAndHlwZXMnXG5cbmNvbnN0IGRvbWFpbiA9ICdodHRwczovL3VzZXJsaWtlLWNkbi13aWRnZXRzLnMzLWV1LXdlc3QtMS5hbWF6b25hd3MuY29tJ1xuY29uc3QgbWF4QXR0ZW1wdHMgPSAxMFxubGV0IGN1cnJlbnRMb2FkQXR0ZW1wdCA9IDBcbmxldCBjdXJyZW50T3BlbkF0dGVtcHQgPSAwXG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgaW50ZXJmYWNlIFdpbmRvdyB7XG4gICAgLy9lc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIHVzZXJsaWtlOiB7XG4gICAgICB1c2VybGlrZVN0YXJ0Q2hhdDogKCkgPT4gdm9pZFxuICAgICAgdXNlcmxpa2VRdWl0Q2hhdDogKCkgPT4gdm9pZFxuICAgIH1cbiAgfVxufVxuXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xuY29uc3QgbG9hZFNjcmlwdCA9IChwcm92aWRlcktleTogc3RyaW5nKSA9PiB7XG4gIGlmICh3aW5kb3cudXNlcmxpa2UpIHJldHVyblxuXG4gIHZhciBkID0gZG9jdW1lbnRcbiAgZnVuY3Rpb24gbCgpIHtcbiAgICB2YXIgcyA9IGQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JylcbiAgICBzLnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0J1xuICAgIHMuYXN5bmMgPSB0cnVlXG4gICAgcy5zcmMgPSBgJHtkb21haW59LyR7cHJvdmlkZXJLZXl9LmpzYFxuICAgIHZhciB4ID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF1cbiAgICB4LnBhcmVudE5vZGU/Lmluc2VydEJlZm9yZShzLCB4KVxuICB9XG4gIGwoKVxufVxuLyogZXNsaW50LWVuYWJsZSAqL1xuXG5jb25zdCBhdHRlbXB0TG9hZCA9IChzZXRTdGF0ZTogKHN0YXRlOiBTdGF0ZSkgPT4gdm9pZCkgPT4ge1xuICBpZiAoY3VycmVudExvYWRBdHRlbXB0ID09PSBtYXhBdHRlbXB0cykge1xuICAgIHJldHVyblxuICB9XG5cbiAgaWYgKCF3aW5kb3cudXNlcmxpa2UpIHtcbiAgICBjdXJyZW50TG9hZEF0dGVtcHQgKz0gMVxuICAgIHNldFRpbWVvdXQoKCkgPT4gYXR0ZW1wdExvYWQoc2V0U3RhdGUpLCAxMDAwKSAvLyBUcnkgZXZlcnkgc2Vjb25kXG4gICAgcmV0dXJuXG4gIH1cblxuICBzZXRUaW1lb3V0KCgpID0+IHNldFN0YXRlKCdjb21wbGV0ZScpLCAyMDAwKVxufVxuXG5jb25zdCBsb2FkID0gKHtcbiAgcHJvdmlkZXJLZXksXG4gIHNldFN0YXRlXG59OiB7XG4gIHByb3ZpZGVyS2V5OiBzdHJpbmdcbiAgc2V0U3RhdGU6IChzdGF0ZTogU3RhdGUpID0+IHZvaWRcbn0pOiB2b2lkID0+IHtcbiAgbG9hZFNjcmlwdChwcm92aWRlcktleSlcbiAgYXR0ZW1wdExvYWQoc2V0U3RhdGUpXG59XG5cbmNvbnN0IG9wZW4gPSAoKTogdm9pZCA9PiB7XG4gIGlmIChjdXJyZW50T3BlbkF0dGVtcHQgPT09IG1heEF0dGVtcHRzKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICBpZiAoIXdpbmRvdy51c2VybGlrZSkge1xuICAgIGN1cnJlbnRPcGVuQXR0ZW1wdCArPSAxXG4gICAgc2V0VGltZW91dChvcGVuLCAxMDAwKSAvLyBUcnkgZXZlcnkgc2Vjb25kXG4gICAgcmV0dXJuXG4gIH1cblxuICB3aW5kb3cudXNlcmxpa2UudXNlcmxpa2VTdGFydENoYXQoKVxufVxuXG5jb25zdCBjbG9zZSA9ICgpOiB2b2lkID0+IHdpbmRvdy51c2VybGlrZSAmJiB3aW5kb3cudXNlcmxpa2UudXNlcmxpa2VRdWl0Q2hhdCgpXG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgZG9tYWluLFxuICBsb2FkLFxuICBvcGVuLFxuICBjbG9zZVxufVxuIl19